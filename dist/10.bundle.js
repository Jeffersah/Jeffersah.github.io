(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{74:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class n{constructor(t,e){this.x=t,this.y=e}static zero(){return new n(0,0)}static fromAngle(t,e){return new n(Math.cos(t)*(null!=e?e:1),Math.sin(t)*(null!=e?e:1))}LengthSq(){return n.Dot(this,this)}Length(){return Math.sqrt(this.LengthSq())}Clone(){return new n(this.x,this.y)}Negate(){return new n(-this.x,-this.y)}NegateInPlace(){return this.x=-this.x,this.y=-this.y,this}static Dot(t,e){return t.x*e.x+t.y*e.y}DotWith(t){return n.Dot(this,t)}normalize(){let t=this.Length();return n.Multiply(this,1/t)}Direction(){return Math.atan2(this.y,this.x)}AddWith(t,e){const{x:i,y:n}=s(t,e);return this.x+=i,this.y+=n,this}MultWith(t,e){const{x:i,y:n}=function(t,e){if(void 0===e)return void 0!==t.x?{x:t.x,y:t.y}:{x:t,y:t};return{x:t,y:e}}(t,e);return this.x*=i,this.y*=n,this}SubtractWith(t,e){const{x:i,y:n}=s(t,e);return this.x-=i,this.y-=n,this}DivideWith(t,e){const{x:i,y:n}=s(t,e);return this.x/=i,this.y/=n,this}Equals(t){return this.x===t.x&&this.y===t.y}static add(t,e,i){const{x:o,y:r}=s(e,i);return new n(t.x+o,t.y+r)}static subtract(t,e,i){const{x:o,y:r}=s(e,i);return new n(t.x-o,t.y-r)}static Multiply(t,e,i){return void 0!==i?new n(t.x*e,t.y*i):void 0!==e.x?new n(t.x*e.x,t.y*e.y):new n(t.x*e,t.y*e)}static interpolate(t,e,i){return new n(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)}static componentMin(t,e){return t.x<=e.x&&t.y<=e.y?t:e.x<=t.x&&e.y<=t.y?e:new n(Math.min(t.x,e.x),Math.min(t.y,e.y))}static componentMax(t,e){return t.x>=e.x&&t.y>=e.y?t:e.x>=t.x&&e.y>=t.y?e:new n(Math.max(t.x,e.x),Math.max(t.y,e.y))}static Bezier(t,e){return 1===t.length?t[0]:2===t.length?n.add(n.Multiply(t[1],e),n.Multiply(t[0],1-e)):n.add(n.Multiply(n.Bezier(t.slice(1),e),e),n.Multiply(n.Bezier(t.slice(0,t.length-1),e),1-e))}rotate(t){const e=Math.atan2(this.y,this.x),i=this.Length();return n.fromAngle(e+t,i)}}function s(t,e){return void 0===e?{x:t.x,y:t.y}:{x:t,y:e}}},82:function(t,e,i){"use strict";i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return a}));var n=i(74);class s{constructor(t,e,i,s,o){this.atlas=t,this.sourceOffset=e,this.sourceSize=i,this.numFrames=s,this.origin=null!=o?o:new n.a(0,0)}draw(t,e,i,n,s){t.save(),t.translate(e.x,e.y),void 0!==s&&t.rotate(s),t.scale(i.x,i.y),t.translate(-this.origin.x,-this.origin.y),t.drawImage(this.atlas.image,this.sourceOffset.x+n*this.sourceSize.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),t.restore()}play(t,e){var i;return void 0!==t.animation?new o(this,t.maxTime,null!==(i=t.loop)&&void 0!==i&&i):new o(this,t,null!=e&&e)}}class o{constructor(t,e,i){this.source=t,this.maxTime=e,this.loop=i,this.currentTime=0}tick(){return this.currentTime++,!(this.currentTime<this.maxTime)&&(this.loop&&(this.currentTime=0),!0)}draw(t,e,i,n){const s=Math.floor(this.currentTime*this.source.numFrames/this.maxTime);this.source.draw(t,e,i,s,n)}}class r{constructor(t,e){this.onload=e,this.image=document.createElement("img"),this.image.src=t,this.image.addEventListener("load",()=>this.loadFinished())}loadFinished(){this.onload()}getSprite(t,e,i,n){return new a(this,t,e,i,n)}getAnimation(t,e,i,n){return new s(this,t,e,n,i)}}class a{constructor(t,e,i,s,o){this.atlas=t,this.sourceOffset=e,this.sourceSize=i,this.origin=null!=s?s:new n.a(0,0),this.sourceRotation=null!=o?o:0}draw(t,e,i,n){t.save(),t.translate(e.x,e.y),t.rotate((null!=n?n:0)+this.sourceRotation),t.scale(i.x,i.y),t.translate(-this.origin.x,-this.origin.y),t.drawImage(this.atlas.image,this.sourceOffset.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),t.restore()}}},85:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));const n=2*Math.PI;class s{static normalize(t){return(t%=n)<0&&(t+=n),t}static relativeNormalize(t){return(t%=n)>Math.PI?t-=n:t<-Math.PI&&(t+=n),t}static relativeAngle(t,e){return s.relativeNormalize(t-e)}}},86:function(t){t.exports=JSON.parse('[{"id":0,"name":"L1","width":8,"height":6,"mapdata":[24,6,5,6,5,6,5,18,24,23,14,1,1,1,12,6,24,23,14,12,14,12,23,14,24,22,14,12,14,12,23,7,24,23,14,1,1,12,23,18,0,19,4,7,4,7,19,0],"spawns":[{"position":{"x":0,"y":0},"color":0,"direction":0},{"position":{"x":0,"y":2},"color":1,"direction":0},{"position":{"x":4,"y":2},"color":-1,"direction":1},{"position":{"x":0,"y":4},"color":3,"direction":0},{"position":{"x":0,"y":1},"color":3,"direction":0},{"position":{"x":3,"y":3},"color":-1,"direction":3}],"endpoints":[{"position":{"x":1,"y":5},"color":0},{"position":{"x":6,"y":5},"color":3},{"position":{"x":7,"y":0},"color":1},{"position":{"x":7,"y":4},"color":3}]},{"id":1,"name":"L2","width":8,"height":6,"mapdata":[5,13,13,2,2,13,13,6,1,27,12,13,9,14,1,1,12,2,23,22,23,22,7,1,1,16,14,1,1,1,24,14,19,25,1,12,3,14,24,14,0,4,15,15,15,15,2,7],"spawns":[{"position":{"x":6,"y":3},"color":3,"direction":0},{"position":{"x":1,"y":4},"color":3,"direction":1},{"position":{"x":1,"y":1},"color":1,"direction":3}],"endpoints":[{"position":{"x":0,"y":4},"color":3},{"position":{"x":1,"y":3},"color":3}]},{"id":2,"name":"L3","width":8,"height":6,"mapdata":[5,13,13,2,6,0,17,0,1,12,3,2,23,6,1,0,12,7,1,24,14,1,1,17,12,26,1,0,12,22,14,1,19,25,12,2,15,15,14,1,0,4,15,2,2,2,11,7],"spawns":[{"position":{"x":1,"y":3},"color":2,"direction":2},{"position":{"x":3,"y":2},"color":3,"direction":0},{"position":{"x":1,"y":4},"color":0,"direction":1}],"endpoints":[{"position":{"x":0,"y":4},"color":0},{"position":{"x":6,"y":0},"color":2},{"position":{"x":7,"y":2},"color":3}]},{"id":3,"name":"L4","width":8,"height":6,"mapdata":[5,13,13,9,2,9,13,6,12,14,27,27,0,19,19,1,12,22,26,0,0,0,16,14,4,22,2,2,2,2,2,14,0,12,2,2,2,2,2,14,0,4,2,2,2,2,2,7],"spawns":[{"position":{"x":3,"y":1},"color":0,"direction":3},{"position":{"x":2,"y":1},"color":1,"direction":3},{"position":{"x":2,"y":2},"color":3,"direction":2}],"endpoints":[{"position":{"x":6,"y":1},"color":0},{"position":{"x":5,"y":1},"color":1},{"position":{"x":6,"y":2},"color":3}]},{"id":4,"name":"L5","width":8,"height":6,"mapdata":[0,5,2,9,6,25,5,6,24,10,16,22,22,22,22,7,5,15,13,3,22,22,14,0,4,9,20,3,38,22,22,18,16,22,10,12,22,22,22,6,0,19,27,19,4,7,4,7],"spawns":[{"position":{"x":2,"y":5},"color":2,"direction":3},{"position":{"x":0,"y":1},"color":2,"direction":0},{"position":{"x":5,"y":0},"color":3,"direction":1},{"position":{"x":4,"y":3},"color":1,"direction":2},{"position":{"x":4,"y":3},"color":0,"direction":3},{"position":{"x":4,"y":3},"color":-1,"direction":1},{"position":{"x":5,"y":3},"color":-2,"direction":3},{"position":{"x":6,"y":4},"color":-1,"direction":3}],"endpoints":[{"position":{"x":2,"y":1},"color":0},{"position":{"x":3,"y":5},"color":2},{"position":{"x":7,"y":3},"color":2},{"position":{"x":0,"y":4},"color":1},{"position":{"x":1,"y":5},"color":3}]}]')},92:function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return J}));var n,s=i(0),o=i(24),r=i(13),a=i(11),c=i(74);!function(t){t[t.Red=0]="Red",t[t.Green=1]="Green",t[t.Yellow=2]="Yellow",t[t.Blue=3]="Blue",t[t.Gray_Bounce=-1]="Gray_Bounce",t[t.Gray_TurnLeft=-2]="Gray_TurnLeft",t[t.Gray_TurnRight=-3]="Gray_TurnRight"}(n||(n={}));var h,l=n;!function(t){t[t.Right=0]="Right",t[t.Bottom=1]="Bottom",t[t.Left=2]="Left",t[t.Top=3]="Top"}(h||(h={}));var u=h;const d=Math.PI/2;class p{static EquivalentPosition(t){return{position:c.a.add(t.position,p.AnchorToTileMove(t.anchor)),anchor:p.ReverseDirection(t.anchor)}}static AnchorToIndex(t){return t}static AnchorToTileMove(t){switch(t){case h.Right:return new c.a(1,0);case h.Bottom:return new c.a(0,1);case h.Left:return new c.a(-1,0);case h.Top:return new c.a(0,-1);default:throw"Bad Anchor"}}static ReverseDirection(t){return(t+2)%4}static IndexToAnchor(t){switch(t){case 0:return h.Right;case 1:return h.Bottom;case 2:return h.Left;case 3:return h.Top;default:throw"Bad Index"}}static GetAnchorOffset(t){switch(t){case h.Top:return new c.a(.5,0);case h.Bottom:return new c.a(.5,1);case h.Left:return new c.a(0,.5);case h.Right:return new c.a(1,.5);default:throw"Bad Anchor"}}static GetExitRotation(t){switch(t){case h.Top:return 3*d;case h.Bottom:return d;case h.Left:return 2*d;case h.Right:return 0;default:throw"Bad Anchor"}}static GetEntryRotation(t){return p.GetExitRotation(p.ReverseDirection(t))}static GetRealPosition(t,e){var i=c.a.Multiply(t.position,e),n=c.a.Multiply(p.GetAnchorOffset(t.anchor),e);return i.AddWith(n)}static GetMidpoint(t,e){return c.a.Multiply(t.position,e).AddWith(c.a.Multiply(e,.5))}}p.AllAnchors=[h.Right,h.Bottom,h.Left,h.Top];var w=i(85);const g=new c.a(64,64),x=new c.a(18,18);class y{constructor(t,e,i,n){this.color=t,this.sprite=e,this.position=i,this.isCrashed=n,this.nextPosition=void 0,this.parkedAt=void 0,this.parkAnimationComplete=!1}FindOutputForAlwaysTurn(t,e,i,n){if(1===i.length)return i[0];if(0===n){const t=p.ReverseDirection(e);return-1!==i.indexOf(t)?t:e}for(let t=0;t<4;t++){let s=(e+t*n)%4;if(-1!==i.indexOf(s))return s}return e}CalculateNextPosition(t){if(this.isCrashed)return;if(void 0!==this.parkedAt)return void(this.parkAnimationComplete=!0);const e=t.map[this.position.position.x][this.position.position.y],i=e.definition.connections.allConnections(this.position.anchor),n=this.chooseOutputDirection(t,e,i);if(void 0!==n)return{position:c.a.add(this.position.position,p.AnchorToTileMove(n)),anchor:p.ReverseDirection(n)};e.definition.isStop?(this.parkedAt=this.position.position,this.parkAnimationComplete=!1,Object(a.a)(t.cars,t=>t!==this&&void 0!==t.parkedAt&&t.parkedAt.x===this.position.position.x&&t.parkedAt.y===this.position.position.y)&&(this.isCrashed=!0)):this.isCrashed=!0}chooseOutputDirection(t,e,i){switch(this.color){case l.Gray_Bounce:case l.Gray_TurnLeft:case l.Gray_TurnRight:return 0===i.length?this.position.anchor:this.FindOutputForAlwaysTurn(t,this.position.anchor,i,this.color===l.Gray_Bounce?0:this.color===l.Gray_TurnLeft?1:3);default:if(0===i.length)return;if(1===i.length)return i[0];{let t=e.TryGetSignal(this.position.anchor,this.color);return null!=t?t:i[Math.floor(Math.random()*i.length)]}}}draw(t,e){var i;const n=p.GetRealPosition(this.position,g),s=p.GetMidpoint(this.position,g),o=p.GetEntryRotation(this.position.anchor);if(this.isCrashed){const r=null!==(i=this.nextPosition)&&void 0!==i?i:{position:c.a.add(this.position.position,p.AnchorToTileMove(p.ReverseDirection(this.position.anchor))),anchor:this.position.anchor},a=e<.5?e:.5,h=p.GetRealPosition(r,g),l=c.a.Bezier([n,s,h],a),u=p.GetEntryRotation(r.anchor),d=w.a.relativeAngle(o,u);this.sprite.draw(t,l,this.sprite.sourceSize,o-d*a)}else if(void 0!==this.nextPosition){const i=p.GetRealPosition(this.nextPosition,g),r=c.a.Bezier([n,s,i],e),a=p.GetEntryRotation(this.nextPosition.anchor),h=w.a.relativeAngle(o,a);this.sprite.draw(t,r,this.sprite.sourceSize,o-h*e)}else if(void 0!==this.parkedAt)if(this.parkAnimationComplete)this.sprite.draw(t,s,this.sprite.sourceSize,o);else{const i=c.a.Bezier([n,s,s],e);this.sprite.draw(t,i,this.sprite.sourceSize,o)}}}const f=new c.a(88,88),m=[new c.a(108,88),new c.a(88,108),new c.a(68,88),new c.a(88,68)];new c.a(0,64);class v{constructor(t,e,i,n,s){this.tile=t,this.signal=e,this.assets=i,this.dx=n,this.dy=s,this.selectedColor=l.Red,this.colorButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(0,0),new c.a(63,32)),this.colorButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(0,32),new c.a(63,32)),this.sqButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(63,0),new c.a(16,16)),this.sqButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(63,16),new c.a(16,16)),this.roundButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(63,32),new c.a(16,16)),this.roundButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(63,48),new c.a(16,16)),this.arrowIndicators=[];for(let t=0;t<4;t++)this.arrowIndicators.push(this.assets.ctrlPanelElements.getSprite(new c.a(79,16*t),new c.a(16,16)))}tryHandleClick(t,e){if(t<this.dx||e<this.dy||t>this.dx+128||e>this.dy+128)return!1;if(t-=this.dx,e-=this.dy,t<=64){const t=Math.floor(e/32);return this.selectedColor=t,!0}if(e>=64){if(t>=f.x&&e>=f.y&&t<=f.x+16&&e<=f.y+16)this.signal.clearInstructions(this.selectedColor);else{let i;if(t-=64,e-=64,t-=32,e-=32,i=Math.abs(t)>=Math.abs(e)?t<0?u.Left:u.Right:e<0?u.Top:u.Bottom,-1===this.signal.definition.outputDirs.indexOf(i))return!0;this.signal.setInstruction(this.selectedColor,i)}return!0}return!0}draw(t){var e;this.assets.ctrlPanelBackground.image||console.log("ASSETS IMAGE: "+this.assets.ctrlPanelBackground.image),t.drawImage(this.assets.ctrlPanelBackground.image,this.dx,this.dy);for(let e=0;e<4;e++){(this.selectedColor===e?this.colorButtonDown:this.colorButtonUp).draw(t,new c.a(this.dx+1,this.dy+32*e),new c.a(63,32))}const i=null!==(e=this.signal.getInstruction(this.selectedColor))&&void 0!==e?e:-1;for(let e=0;e<4;e++){(i===e?this.sqButtonDown:this.sqButtonUp).draw(t,new c.a(this.dx+m[e].x,this.dy+m[e].y),new c.a(16,16)),this.arrowIndicators[e].draw(t,new c.a(this.dx+m[e].x,this.dy+m[e].y),new c.a(16,16))}(-1===i?this.roundButtonDown:this.roundButtonUp).draw(t,new c.a(this.dx+f.x,this.dy+f.y),new c.a(16,16))}}const T=[new c.a(1,0),new c.a(0,1),new c.a(-1,0),new c.a(0,-1)];class R{constructor(t){this.definition=t,this.currentSignals=new Map}getInstruction(t){if(this.currentSignals.has(t))return this.currentSignals.get(t)}setInstruction(t,e){this.currentSignals.set(t,e)}clearInstructions(t){null==t?this.currentSignals.clear():this.currentSignals.delete(t)}getRenderPosition(t){return p.GetMidpoint({position:t},g).SubtractWith(3,3).AddWith(this.definition.dx,this.definition.dy)}draw(t,e,i,n){const s=p.GetMidpoint({position:e},g).SubtractWith(3,3);t.drawImage(i,s.x+this.definition.dx,s.y+this.definition.dy);const o=[0,0,0,0];for(var[r,a]of this.currentSignals.entries()){const e=o[a]++,i=T[a],h=c.a.add(s,c.a.Multiply(i,6+3*e)).AddWith(this.definition.dx,this.definition.dy);n.render(t,h.x,h.y,6,6,a,r)}}}class B{constructor(t,e){this.definition=t,this.image=e,this.signals=[];for(const e of t.signals)this.signals.push(new R(e))}TryGetSignal(t,e){for(const i of this.signals)if(-1!==i.definition.inputDirs.indexOf(t))return i.getInstruction(e)}draw(t,e,i,n){this.image.draw(t,new c.a(64*e,64*i),g);for(const s of this.signals)s.draw(t,new c.a(e,i),n.signalHubImage.image,n.signalArrowsImage)}}var L;!function(t){t[t.RR=1]="RR",t[t.RB=2]="RB",t[t.BR=2]="BR",t[t.RL=4]="RL",t[t.LR=4]="LR",t[t.RT=8]="RT",t[t.TR=8]="TR",t[t.BB=16]="BB",t[t.BL=32]="BL",t[t.LB=32]="LB",t[t.BT=64]="BT",t[t.TB=64]="TB",t[t.LL=128]="LL",t[t.LT=256]="LT",t[t.TL=256]="TL",t[t.TT=512]="TT"}(L||(L={}));var A=L;class S{constructor(t){this.connections=[];for(let e=0;e<4;e++){const i=[];for(let n=e;n<4;n++)i.push((1&t)>0),t>>=1;this.connections.push(i)}}connection(t,e,i){const n=p.AnchorToIndex(t),s=p.AnchorToIndex(e),o=Math.min(n,s),r=Math.max(n,s);if(void 0===i)return this.connections[o][r-o];this.connections[o][r-o]=i}allConnections(t){let e=[];for(const i of p.AllAnchors)this.connection(t,i)&&e.push(i);return e}}class b{constructor(t,e,i=!1,n=!1){this.tileId=t,this.isStop=n,this.connections=new S(e),this.signals=[];for(const t of p.AllAnchors){const e=this.connections.allConnections(t);if(e.length>1){let n;i||0===this.signals.length?(n=Object.assign(Object.assign({},M(i,t)),{inputDirs:[],outputDirs:[]}),this.signals.push(n)):n=this.signals[0],n.inputDirs.push(t);for(const t of e)n.outputDirs.push(t)}}}}function M(t,e){if(!t)return{dx:0,dy:0};const i=p.AnchorToTileMove(e).MultWith(16);return{dx:i.x,dy:i.y}}var C=[null,new b(1,A.TB),new b(2,A.LR),new b(3,A.TB|A.LR),new b(4,A.RT),new b(5,A.RB),new b(6,A.LB),new b(7,A.LT),new b(8,A.RT|A.RB,!0),new b(9,A.RB|A.LB,!0),new b(10,A.LT|A.LB,!0),new b(11,A.LT|A.RT,!0),new b(12,A.RT|A.RB|A.TB),new b(13,A.RB|A.LB|A.LR),new b(14,A.LT|A.LB|A.TB),new b(15,A.LT|A.RT|A.LR),new b(16,0,!1,!0),new b(17,0,!1,!0),new b(18,0,!1,!0),new b(19,0,!1,!0),new b(20,A.LT|A.RB),new b(21,A.RT|A.LB),new b(22,A.RB|A.RT|A.LB|A.LT|A.LR|A.TB),new b(23,A.RB|A.RT|A.LB|A.LT,!0),new b(24,A.RR),new b(25,A.BB),new b(26,A.LL),new b(27,A.TT),new b(28,A.RR|A.TT),new b(29,A.BB|A.RR),new b(30,A.LL|A.BB),new b(31,A.TT|A.LL),new b(32,A.RR|A.TT|A.BB),new b(33,A.BB|A.RR|A.LL),new b(34,A.LL|A.BB|A.TT),new b(35,A.TT|A.LL|A.RR),new b(36,A.RR|A.LL),new b(37,A.BB|A.TT),new b(38,A.RR|A.LL|A.BB|A.TT),null];class k{constructor(t,e,i){this.level=t,this.canvas=e,this.assets=i,this.map=[];for(let e=0;e<t.width;e++){let e=[];for(let i=0;i<t.height;i++)e.push(null);this.map.push(e)}const n=[];for(let t=0;t<C.length;t++){const e=t%4,s=Math.floor(t/4);n.push(null===C[t]?null:i.trackImageAtlas.getSprite(new c.a(64*e,64*s),new c.a(64,64)))}for(let e=0;e<t.mapdata.length;e++){let i=e%t.width,s=Math.floor(e/t.width);const o=C[t.mapdata[e]];this.map[i][s]=null===o?null:new B(o,n[o.tileId])}this.ResetLevel()}tryGetOverlay(t,e){const i=new c.a(Math.floor(t.x/64),Math.floor(t.y/64)),n=this.map[i.x][i.y];if(null==n||0===n.signals.length)return;const s=Object(a.c)(n.signals,e=>c.a.subtract(e.getRenderPosition(i),t).LengthSq()),o=new c.a(64*i.x+64,64*i.y);return this.canvas.width/e-o.x<this.assets.ctrlPanelBackground.image.width&&(o.x=64*i.x-this.assets.ctrlPanelBackground.image.width),this.canvas.height/e-o.y<this.assets.ctrlPanelBackground.image.height&&(o.y=this.canvas.height/e-this.assets.ctrlPanelBackground.image.height),new v(n,s,this.assets,o.x,o.y)}ResetLevel(){this.cars=[];for(const t of this.level.spawns)t.color>=0?this.cars.push(new y(t.color,this.assets.carImageAtlas.getSprite(new c.a(18*t.color,0),x,new c.a(.5,.5)),p.EquivalentPosition({position:new c.a(t.position.x,t.position.y),anchor:t.direction}),!1)):this.cars.push(new y(t.color,this.assets.carImageAtlas.getSprite(new c.a(18*(3-t.color),0),x,new c.a(.5,.5)),p.EquivalentPosition({position:new c.a(t.position.x,t.position.y),anchor:t.direction}),!1));this.updateCars()}updateCars(){for(const t of this.cars)t.isCrashed||(void 0!==t.nextPosition&&(t.position=t.nextPosition),t.nextPosition=t.CalculateNextPosition(this))}draw(t,e,i){for(let t=0;t<this.map.length;t++)for(let i=0;i<this.map[t].length;i++)null!==this.map[t][i]&&this.map[t][i].draw(e,t,i,this.assets);for(const t of this.cars)t.draw(e,i)}}var E=i(86),P=i.p+"10702952a8876ff948ce0ba26c9c0a40.png",I=i.p+"3d9508dc6ca8c7a86111cdce9c17741a.png",D=i.p+"068a4cb9e7cd5cde1c23e8fb17e230c2.png",G=i.p+"12b15dc75181d5095f7bc26eeb5312c5.png",O=i.p+"c8060df9573385c396cd3cb0a91f4424.png",z=i.p+"560f633704b347d793db51e0a3fb7475.png",F=i(82),q=i(37),W=i(25);class _{constructor(t){this.trackImageAtlas=new F.b(P,t.registerAssetLoadCallback()),this.carImageAtlas=new F.b(I,t.registerAssetLoadCallback()),this.signalArrowsImage=new W.a(6,6,D,t.registerAssetLoadCallback()),this.signalHubImage=new q.a(G,t.registerAssetLoadCallback()),this.ctrlPanelBackground=new q.a(O,t.registerAssetLoadCallback()),this.ctrlPanelElements=new F.b(z,t.registerAssetLoadCallback())}}var N=0;class j{constructor(t){this.canvas=t,this.runnerID=N++,console.log("Create runner "+this.runnerID),Object(r.b)(t,1024,768),this.ctx=t.getContext("2d"),Object(r.a)(this.ctx),this.ctx.scale(2,2),this.repaintTimer=-1,this.interpFrameCount=0,this.isRunning=!1,this.isDestroyed=!1,this.boundEventListener=this.handleMouseEvent.bind(this),this.overlay=void 0,t.addEventListener("click",this.boundEventListener)}handleMouseEvent(t){var e,i;const n=new c.a(t.offsetX/2,t.offsetY/2);null!==(i=null===(e=this.overlay)||void 0===e?void 0:e.tryHandleClick(n.x,n.y))&&void 0!==i&&i||(this.overlay=this.gameState.tryGetOverlay(n,2))}start(){const t=new o.a;this.assets=new _(t),t.onAllFinished(this.loadComplete.bind(this))}toggleRunning(){this.gameState.ResetLevel(),this.interpFrameCount=0,this.isRunning=!this.isRunning}loadLevel(t){this.gameState=new k(t,this.canvas,this.assets),this.interpFrameCount=0}loadComplete(){this.gameState=new k(E[0],this.canvas,this.assets),this.runTick()}runTick(){this.isDestroyed||(this.tick(),this.draw(),this.repaintTimer=requestAnimationFrame(this.runTick.bind(this)))}tick(){this.isRunning?(this.interpFrameCount++,this.interpFrameCount>=40&&(this.interpFrameCount=0,this.gameState.updateCars())):this.interpFrameCount=0}draw(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.gameState.draw(this.canvas,this.ctx,this.interpFrameCount/40),this.ctx.restore(),void 0!==this.overlay&&this.overlay.draw(this.ctx)}stop(){-1!==this.repaintTimer&&cancelAnimationFrame(this.repaintTimer),this.isDestroyed=!0,this.canvas.removeEventListener("click",this.boundEventListener),console.log("Destroy runner "+this.runnerID)}}var U=i.p+"438abab473a4076d9d4cd251e4a9f56d.png";function H(t){const e=s.useRef();return s.useEffect(()=>{if(void 0===e.current||void 0===t.previewSheet)return;Object(r.b)(e.current,16*t.level.width,16*t.level.height);const i=e.current.getContext("2d");i.clearRect(0,0,16*t.level.width,16*t.level.height);let n=0;for(var s=0;s<t.level.height;s++)for(var o=0;o<t.level.width;o++){const e=t.level.mapdata[n++],r=Math.floor(e%4),a=Math.floor(e/4);t.previewSheet.render(i,16*o,16*s,16,16,r,a)}},[e.current]),s.createElement("div",{className:"flex row align-center",style:{border:"1px solid black",padding:"0 0 0 8px"},onClick:e=>t.onClick(e.nativeEvent)},s.createElement("span",null,t.level.id,": ",t.level.name),s.createElement("canvas",{ref:e}))}function J(){const t=s.useRef(),e=function(t,e){const[i,n]=Object(s.useState)(void 0);return Object(s.useEffect)(()=>{console.log("Reload item");const e=new o.a,i=t(e.registerAssetLoadCallback());e.onAllFinished(()=>{n(i)})},e),i}(t=>new W.a(16,16,U,t),[]),[i,n]=s.useState(void 0),[r,a]=s.useState(!1);return s.useEffect(()=>{if(void 0===t.current)return;const e=new j(t.current);return n(e),e.start(),()=>e.stop()},[t.current,e]),void 0===e?s.createElement("div",null,"Loading..."):s.createElement("div",{className:"flex row"},s.createElement("canvas",{ref:t}),s.createElement("div",{className:"flex col"},s.createElement("button",{onClick:t=>{i&&i.toggleRunning()}},"Start/Reset"),s.createElement("button",{onClick:()=>a(!r)},r?"Hide Level Select":"Show Level Select"),r?E.map(t=>s.createElement(H,{key:t.id,level:t,previewSheet:e,onClick:e=>{null==i||i.loadLevel(t),e.preventDefault(),e.stopImmediatePropagation()}})):s.createElement(s.Fragment,null)))}}}]);
//# sourceMappingURL=10.bundle.js.map