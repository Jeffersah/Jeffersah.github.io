{"version":3,"sources":["webpack:///./src/projects/raymarch/debuilder/GlslValue.ts","webpack:///./src/projects/raymarch/debuilder/DistanceEstimatePrimitives.ts","webpack:///./src/projects/raymarch/index.ts","webpack:///./src/projects/raymarch/debuilder/DistanceEstimateBuilder.ts","webpack:///./src/views/projects/raymarch/RaymarchComponent.tsx","webpack:///./src/projects/common/3d/Vector.ts","webpack:///./src/projects/common/3d/Point3.ts","webpack:///./src/projects/common/input/KeyState.ts","webpack:///./src/projects/common/input/KeyWatcher.ts","webpack:///./src/projects/common/input/KeyboardManager.ts","webpack:///./src/projects/common/3d/Quaternion.ts","webpack:///./src/projects/common/3d/Matrix4.ts"],"names":["GlslSin","rate","min","max","GlslTimeVariable","undefined","GlslCos","timeFunc","glslFloatConst","n","asstr","toString","indexOf","halfRange","midp","glslVec3Const","x","y","z","dglsl","primitive","nextTempVar","this","glsl","xd","yd","zd","glslc","normalX","normalY","normalZ","mtx","getTempVarName","radians","rad","emitGlsl","scale","c","maxIterations","bailoutRange","Vector","symAxis","rXt","rYt","rZt","translate","console","log","fragmentShaderSource","cam","keys","repaintCount","camRotation","Quaternion","moveKeys","camTurnRate","Math","PI","lookKeys","main","canvas","document","getElementById","gl","getContext","alert","clearColor","clear","COLOR_BUFFER_BIT","shaderProgram","vsSource","fsSource","vertexShader","loadShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","initShaderProgram","buffers","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","position","initBuffers","drawScene","KeyboardManager","body","renderLoop","program","update","doRepaint","key","dir","isKeyDown","speed","rel","applyTransform","axis","multiply","axisRotation","requestAnimationFrame","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","DEPTH_BUFFER_BIT","numComponents","type","FLOAT","normalize","stride","offset","vertexAttribPointer","getAttribLocation","enableVertexAttribArray","useProgram","uniform2fv","getUniformLocation","width","height","uniform3fv","uniform4fv","i","j","k","real","uniform1f","vertexCount","drawArrays","TRIANGLE_STRIP","source","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","RaymarchComponent","className","id","other","sqrt","lengthSq","sx","sy","sz","isVector","getxyz","dx","dy","dz","Point3","dot","len","length","div","pxs","iy","iz","splitArgs","allowSingle","KeyState","changes","attachedElement","logKeyNames","addEventListener","onKeyDown","onKeyUp","downKeys","push","change","idx","splice","storeKeys","storeChanges","slice","element","watcher","prvState","currentState","Update","isKeyUp","denom","Dot","a","b","cos","sin","point","inverse","inputQ","qOut","components","Matrix4","identity","p","multRow","w","output","row","col","Array","pt"],"mappings":"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","file":"13.bundle.js","sourcesContent":["export type GlslConstant = number | GlslTimeVariable;\r\n\r\nexport function GlslSin(rate: number, min?: number, max?: number): GlslTimeVariable {\r\n    const useMin = min === undefined ? -1 : min;\r\n    const useMax = max === undefined ? 1 : max;\r\n    return new GlslTimeVariable('sin', useMin, useMax, rate);\r\n}\r\n\r\nexport function GlslCos(rate: number, min?: number, max?: number): GlslTimeVariable {\r\n    const useMin = min === undefined ? -1 : min;\r\n    const useMax = max === undefined ? 1 : max;\r\n    return new GlslTimeVariable('cos', useMin, useMax, rate);\r\n}\r\n\r\nexport class GlslTimeVariable {\r\n    constructor (public timeFunc: 'sin' | 'cos', public min: number, public max: number, public rate: number) {\r\n    }\r\n}\r\n\r\nfunction constIsTimeVar(c: GlslConstant): c is GlslTimeVariable {\r\n    return (c as GlslTimeVariable).timeFunc !== undefined;\r\n}\r\n\r\nexport function glslFloatConst(n: GlslConstant): string {\r\n    if (constIsTimeVar(n)) {\r\n        const range = (n.max - n.min);\r\n        const halfRange = range / 2;\r\n        const midp = (n.max + n.min) / 2;\r\n        const rate = `(t/60.0 * ${glslFloatConst(n.rate)})`;\r\n        switch (n.timeFunc) {\r\n            case 'sin': return `sin(${rate} * PI * 2.0) * ${glslFloatConst(halfRange)} + ${glslFloatConst(midp)}`;\r\n            case 'cos': return `cos(${rate} * PI * 2.0) * ${glslFloatConst(halfRange)} + ${glslFloatConst(midp)}`;\r\n        }\r\n    } else {\r\n        const asstr = n.toString();\r\n        if (asstr.indexOf('.') === -1) return asstr + '.0';\r\n        return asstr;\r\n    }\r\n}","import Vector from \"../../common/3d/Vector\";\r\nimport { glslFloatConst, GlslConstant } from \"./GlslValue\";\r\n\r\nexport default interface IDEPrimitive {\r\n    emitGlsl(): string;\r\n}\r\n\r\nexport function glslVec3Const(x: GlslConstant, y: GlslConstant, z: GlslConstant) {\r\n    return 'vec3(' + glslFloatConst(x) + ',' + glslFloatConst(y) + ',' + glslFloatConst(z)+')';\r\n}\r\n\r\nexport function glslUnitVec3Const(x: GlslConstant, y: GlslConstant, z: GlslConstant) {\r\n    return 'normalize(vec3(' + glslFloatConst(x) + ',' + glslFloatConst(y) + ',' + glslFloatConst(z) + '))';\r\n}\r\n\r\nexport class SphereDE implements IDEPrimitive {\r\n    constructor(public radius: number) { }\r\n    emitGlsl() {\r\n        return `return length(p) - ${glslFloatConst(this.radius)};\\r\\n`;\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class BoxDE implements IDEPrimitive {\r\n    constructor(public xlen: number, public ylen: number, public zlen: number) { }\r\n    emitGlsl() {\r\n        return `vec3 q = abs(p) - ${glslVec3Const(this.xlen, this.ylen, this.zlen)};\\r\\nreturn length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);`;\r\n    }\r\n}\r\n\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class BoundingBoxDE implements IDEPrimitive {\r\n    constructor(public xlen: number, public ylen: number, public zlen: number, public segLen: number) { }\r\n    emitGlsl() {\r\n        return `p = abs(p)-${glslVec3Const(this.xlen, this.ylen, this.zlen)};\r\nvec3 q = abs(p+${glslFloatConst(this.segLen)})-${glslFloatConst(this.segLen)};\r\nreturn min(min(\r\n    length(max(vec3(p.x,q.y,q.z),0.0))+min(max(p.x,max(q.y,q.z)),0.0),\r\n    length(max(vec3(q.x,p.y,q.z),0.0))+min(max(q.x,max(p.y,q.z)),0.0)),\r\n    length(max(vec3(q.x,q.y,p.z),0.0))+min(max(q.x,max(q.y,p.z)),0.0));\\r\\n`;\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class MengerSpongeDE implements IDEPrimitive {\r\n    constructor(private scale: number, private c: Vector, private maxIterations: number, private bailoutRange: number) {\r\n\r\n    }\r\n\r\n    emitGlsl() {\r\n        return `\r\nconst float bailout = ${glslFloatConst(this.bailoutRange)};\r\nconst vec3 C = ${glslVec3Const(this.c.x, this.c.y, this.c.z)};\r\nconst float scale = ${glslFloatConst(this.scale)};\r\nconst int MI = ${this.maxIterations};\r\nfloat r = dot(p, p);\r\nint numi = 0;\r\nfor(int i = 0; i < MI; i++){\r\n    numi = i;\r\n    if(r >= bailout) break;\r\n\r\n    // Rotate 1\r\n    \r\n    p = abs(p);\r\n    if(p.x - p.y < 0.0){ float x1=p.y; p.y=p.x; p.x=x1;}\r\n    if(p.x - p.z < 0.0){ float x1=p.z; p.z=p.x; p.x=x1;}\r\n    if(p.y - p.z < 0.0){ float y1=p.z; p.z=p.y; p.y=y1;}\r\n\r\n    // Rotate 2\r\n\r\n    p.xy = scale * p.xy - C.xy * (scale-1.0);\r\n    p.z=scale*p.z;\r\n    if(p.z>0.5*C.z*(scale-1.0)) p.z-=C.z*(scale-1.0);\r\n    \r\n    r = dot(p, p);\r\n}\r\nreturn (length(p)-2.0)*pow(scale,-float(numi));\\r\\n`;\r\n    }\r\n}\r\n\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class RotaryMengerSpongeDE implements IDEPrimitive {\r\n    constructor(private scale: number, private c: Vector, private maxIterations: number, private bailoutRange: number, private rRate: number) {\r\n\r\n    }\r\n\r\n    emitGlsl() {\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(this.rRate);\r\n        return `\r\nmat3 mx = mat3(\r\n    cos(${radians}), 0.0, -sin(${radians}),\r\n    0.0, 1.0, 0.0,\r\n    sin(${radians}), 0.0, cos(${radians})\r\n);\r\n\r\nconst float bailout = ${glslFloatConst(this.bailoutRange)};\r\nconst vec3 C = ${glslVec3Const(this.c.x, this.c.y, this.c.z)};\r\nconst float scale = ${glslFloatConst(this.scale)};\r\nconst int MI = ${this.maxIterations};\r\nfloat r = dot(p, p);\r\nint numi = 0;\r\nfor(int i = 0; i < MI; i++){\r\n    numi = i;\r\n    if(r >= bailout) break;\r\n\r\n    // Rotate 1\r\n    p = mx * p;\r\n    \r\n    p = abs(p);\r\n    if(p.x - p.y < 0.0){ float x1=p.y; p.y=p.x; p.x=x1;}\r\n    if(p.x - p.z < 0.0){ float x1=p.z; p.z=p.x; p.x=x1;}\r\n    if(p.y - p.z < 0.0){ float y1=p.z; p.z=p.y; p.y=y1;}\r\n\r\n    // Rotate 2\r\n\r\n    p.xy = scale * p.xy - C.xy * (scale-1.0);\r\n    p.z=scale*p.z;\r\n    if(p.z>0.5*C.z*(scale-1.0)) p.z-=C.z*(scale-1.0);\r\n    \r\n    r = dot(p, p);\r\n}\r\nreturn (length(p)-2.0)*pow(scale,-float(numi));\\r\\n`;\r\n    }\r\n}","import { ResizeCanvas } from '../common/CanvasHelpers';\r\nimport { mat4 } from 'gl-matrix';\r\nimport DistanceEstimateBuilder from './debuilder/DistanceEstimateBuilder';\r\nimport { BoundingBoxDE, SphereDE, BoxDE, MengerSpongeDE, RotaryMengerSpongeDE } from './debuilder/DistanceEstimatePrimitives';\r\nimport KeyboardManager from '../common/input/KeyboardManager';\r\nimport Quaternion from '../common/3d/Quaternion';\r\nimport Vector from '../common/3d/Vector';\r\nimport { GlslSin, GlslCos } from './debuilder/GlslValue';\r\n\r\n// TODO: Use asset loader to load these?\r\n\r\nconst distanceFunc: DistanceEstimateBuilder =\r\n    new DistanceEstimateBuilder(new MengerSpongeDE(3, new Vector(1, 1, 1), 100, 100))\r\n        .symAxis(GlslSin(0.03), GlslCos(0.03), GlslCos(1, -.01, .01))\r\n        .symAxis(-.8, .2, 0)\r\n        .symAxis(.4, 0.6, 0)\r\n        .symAxis(-.4, .6, 0)\r\n        .rXt(0.03)\r\n        .rYt(0.003)\r\n        .rZt(-.0009)\r\n        .translate(GlslSin(0.1, -.4, .4), GlslCos(0.2, -.2, .2), 0)\r\n        ;\r\n\r\nconst dglsl = distanceFunc.emitGlsl();\r\n\r\nconsole.log('DISTF: ');\r\nconsole.log(dglsl);\r\n\r\nconst vertexShaderSource = `\r\nattribute vec4 aVertexPosition;\r\nvoid main() {\r\n  gl_Position = aVertexPosition;\r\n}\r\n`;\r\n\r\nconst fragmentShaderSource = `\r\nprecision mediump float;\r\n#define PI 3.1415926538\r\n\r\nuniform vec2 WindowSize;\r\nuniform vec3 cam_pos;\r\nuniform vec4 cam_orient;\r\nuniform float t;\r\n\r\nconst int MaximumRaySteps = 50;\r\nconst float MinimumDistance = 0.001;\r\nconst float MaxFogDist = 20.0;\r\n\r\nconst float nscale = 0.001;\r\nconst vec3 xdir = vec3(1.0, 0.0, 0.0);\r\nconst vec3 ydir = vec3(0.0, 1.0, 0.0);\r\nconst vec3 zdir = vec3(0.0, 0.0, 1.0);\r\nconst vec3 lightdir = normalize(vec3(1.0, 0.0, -1.0));\r\nconst vec3 lightsrc = lightdir * 10.0;\r\nconst vec3 amblight = vec3(0.1, 0.1, 0.1);\r\nconst vec3 normlight = vec3(1, .95, .9);\r\nconst float ambocc = 0.2;\r\nconst float shadowLightness = .3;\r\n\r\nconst float scale = 3.0;\r\nconst vec3 C = vec3(1, 1, 1);\r\nconst int MI = 100;\r\nconst float bailout = 10.0;\r\n\r\nvec4 qInverse(vec4 q) {\r\n    float denom = dot(q, q);\r\n    return vec4(-q.x / denom, -q.y / denom, -q.z / denom, q.w / denom);\r\n}\r\n\r\nvec4 qMult(vec4 a, vec4 b) {\r\n    vec4 res = vec4(0.0, 0.0, 0.0, 0.0);\r\n    res.x = a.w * b.x + a.x * b.w + a.y * b.z - a.z * b.y;\r\n    res.y = a.w * b.y - a.x * b.z + a.y * b.w + a.z * b.x;\r\n    res.z = a.w * b.z + a.x * b.y - a.y * b.x + a.z * b.w;\r\n    res.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\r\n    return res;\r\n}\r\n\r\nvec4 qTransform(vec4 f, vec4 pt) {\r\n    return qMult(f, qMult(pt, qInverse(f)));\r\n}\r\n\r\n${dglsl}\r\n\r\nvec3 trace(vec3 from, vec3 direction) {\r\n\tfloat totalDistance = 0.0;\r\n    int nsteps;\r\n    bool hit = false;\r\n\tfor (int steps = 0; steps < MaximumRaySteps; steps++) {\r\n        nsteps = steps;\r\n\t\tvec3 p = from + totalDistance * direction;\r\n\t\tfloat distance = dist(p);\r\n\t\ttotalDistance += distance;\r\n        if (distance < MinimumDistance) \r\n        {\r\n            hit = true;\r\n            break;\r\n        }\r\n    }\r\n\treturn vec3(totalDistance, 1.0-float(nsteps)/float(MaximumRaySteps), hit ? 1.0 : 0.0);\r\n}\r\n\r\nfloat derel(float f) {\r\n    return f + 1.0 / 2.0;\r\n}\r\n\r\nvoid main() {\r\n\r\n    float losx = (gl_FragCoord.x / WindowSize.x) * 2.0 - 1.0;\r\n    float losy = (gl_FragCoord.y / WindowSize.y) * 2.0 - 1.0;\r\n    vec3 losFwd = normalize(vec3(losx, losy, 1));\r\n    vec3 dir = qTransform(cam_orient, vec4(losFwd.x, losFwd.y, losFwd.z, 0)).xyz;\r\n\r\n    vec3 colis = trace(cam_pos, dir);\r\n\r\n    if(colis.z == 0.0)\r\n    {\r\n        gl_FragColor = vec4(0, 0, 0, 1.0);\r\n    }\r\n    else\r\n    {\r\n        vec3 pos = cam_pos + colis.x * dir;\r\n        vec3 dlight = 1.0 - amblight;\r\n        vec3 n = normalize(vec3(\r\n            dist(pos+xdir*nscale)-dist(pos-xdir*nscale),\r\n            dist(pos+ydir*nscale)-dist(pos-ydir*nscale),\r\n            dist(pos+zdir*nscale)-dist(pos-zdir*nscale)\r\n        ));\r\n\r\n        vec3 lightCastSrc = pos + n * MinimumDistance * 2.0;\r\n        vec3 lcolis = trace(lightCastSrc, normalize(lightsrc - lightCastSrc));\r\n\r\n        float shadow = 1.0 - lcolis.z;\r\n        shadow = min(shadow + shadowLightness, 1.0);\r\n\r\n        float normalLightAmt = clamp(dot(n, lightdir), 0.0, 1.0);\r\n                        \r\n        float fog = 1.0 - min(1.0, colis.x / MaxFogDist);\r\n        float cplx = colis.y;\r\n\r\n        vec3 color = (amblight + (1.0 - amblight) * normlight * normalLightAmt * (1.0 - ambocc + ambocc * colis.y)) * fog * shadow;\r\n        gl_FragColor = vec4(color.x, color.y, color.z, 1.0);\r\n    }\r\n}\r\n`;\r\n\r\nconst fastCamMove = 0.05;\r\nconst camMove = 0.005;\r\nconst cam = {x: 0, y: 0, z: -2};\r\nlet keys: KeyboardManager;\r\nlet repaintCount = 0;\r\nlet camRotation: Quaternion = new Quaternion(1, 0, 0, 0);\r\n\r\nconst moveKeys: [string, Vector][] = [\r\n    ['w', new Vector(0, 0, 1)],\r\n    ['a', new Vector(-1, 0, 0)],\r\n    ['s', new Vector(0, 0, -1)],\r\n    ['d', new Vector(1, 0, 0)],\r\n    ['q', new Vector(0, 1, 0)],\r\n    ['z', new Vector(0, -1, 0)],\r\n];\r\n\r\nconst camTurnRate = -Math.PI / 120;\r\nconst lookKeys: [string, Vector][] = [\r\n    ['ArrowUp', new Vector(1, 0, 0)],\r\n    ['ArrowDown', new Vector(-1, 0, 0)],\r\n    ['ArrowLeft', new Vector(0, 1, 0)],\r\n    ['ArrowRight', new Vector(0, -1, 0)],\r\n];\r\n\r\nexport default function main() {\r\n    const canvas = document.getElementById('canvas') as HTMLCanvasElement;\r\n    ResizeCanvas(canvas, 800, 600);\r\n    const gl = canvas.getContext('webgl');\r\n\r\n    // Only continue if WebGL is available and working\r\n    if (gl === null) {\r\n        alert('Unable to initialize WebGL. Your browser may not support it.');\r\n        return;\r\n    }\r\n\r\n    // Clear black\r\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    const shaderProgram = initShaderProgram(gl, vertexShaderSource, fragmentShaderSource);\r\n    // Here's where we call the routine that builds all the\r\n    // objects we'll be drawing.\r\n    const buffers = initBuffers(gl);\r\n\r\n    // Draw the scene\r\n    drawScene(gl, shaderProgram, buffers, canvas);\r\n\r\n    keys = new KeyboardManager(document.body, false);\r\n    renderLoop(gl, shaderProgram, buffers, canvas);\r\n}\r\n\r\nfunction renderLoop(gl: WebGLRenderingContext, program: WebGLProgram, buffers: { position: WebGLBuffer }, canvas: HTMLCanvasElement) {\r\n    keys.update();\r\n    let doRepaint = false;\r\n\r\n    for (const [key, dir] of moveKeys) {\r\n        if (keys.isKeyDown(key)) {\r\n            const speed = keys.isKeyDown('Shift') ? fastCamMove : camMove;\r\n            const rel = camRotation.applyTransform(dir);\r\n            cam.x += rel.x * speed;\r\n            cam.y += rel.y * speed;\r\n            cam.z += rel.z * speed;\r\n            doRepaint = true;\r\n        }\r\n    }\r\n\r\n    for (const [key, axis] of lookKeys) {\r\n        if (keys.isKeyDown(key)) {\r\n            camRotation = Quaternion.multiply(camRotation, Quaternion.axisRotation(axis, camTurnRate));\r\n        }\r\n    }\r\n\r\n    drawScene(gl, program, buffers, canvas);\r\n    requestAnimationFrame(() => renderLoop(gl, program, buffers, canvas));\r\n}\r\n\r\n\r\nfunction drawScene(gl: WebGLRenderingContext, program: WebGLProgram, buffers: { position: WebGLBuffer }, canvas: HTMLCanvasElement) {\r\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);  // Clear to black, fully opaque\r\n    gl.clearDepth(1.0);                 // Clear everything\r\n    gl.enable(gl.DEPTH_TEST);           // Enable depth testing\r\n    gl.depthFunc(gl.LEQUAL);            // Near things obscure far things\r\n\r\n    // Clear the canvas before we start drawing on it.\r\n\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n    // Tell WebGL how to pull out the positions from the position\r\n    // buffer into the vertexPosition attribute.\r\n    {\r\n      const numComponents = 2;  // pull out 2 values per iteration\r\n      const type = gl.FLOAT;    // the data in the buffer is 32bit floats\r\n      const normalize = false;  // don't normalize\r\n      const stride = 0;         // how many bytes to get from one set of values to the next\r\n                                // 0 = use type and numComponents above\r\n      const offset = 0;         // how many bytes inside the buffer to start from\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffers.position);\r\n      gl.vertexAttribPointer(\r\n            gl.getAttribLocation(program, 'aVertexPosition'),\r\n            numComponents,\r\n            type,\r\n            normalize,\r\n            stride,\r\n            offset);\r\n      gl.enableVertexAttribArray(\r\n        gl.getAttribLocation(program, 'aVertexPosition'));\r\n    }\r\n\r\n    // Tell WebGL to use our program when drawing\r\n\r\n    gl.useProgram(program);\r\n    gl.uniform2fv(gl.getUniformLocation(program, 'WindowSize'), [canvas.width, canvas.height]);\r\n    gl.uniform3fv(gl.getUniformLocation(program, 'cam_pos'), [cam.x, cam.y, cam.z]);\r\n    gl.uniform4fv(gl.getUniformLocation(program, 'cam_orient'), [camRotation.i, camRotation.j, camRotation.k, camRotation.real]);\r\n    gl.uniform1f(gl.getUniformLocation(program, 't'), repaintCount);\r\n    repaintCount = (repaintCount + 1);\r\n    {\r\n      const offset = 0;\r\n      const vertexCount = 4;\r\n      gl.drawArrays(gl.TRIANGLE_STRIP, offset, vertexCount);\r\n    }\r\n  }\r\n\r\nfunction initBuffers(gl: WebGLRenderingContext) {\r\n    // Create a buffer for the square's positions.\r\n    const positionBuffer = gl.createBuffer();\r\n\r\n    // Select the positionBuffer as the one to apply buffer\r\n    // operations to from here out.\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\r\n\r\n    // Now create an array of positions for the square.\r\n    const positions = [\r\n        -1.0,  1.0,\r\n        1.0,  1.0,\r\n       -1.0, -1.0,\r\n        1.0, -1.0,\r\n    ];\r\n\r\n    // Now pass the list of positions into WebGL to build the\r\n    // shape. We do this by creating a Float32Array from the\r\n    // JavaScript array, then use it to fill the current buffer.\r\n    gl.bufferData(gl.ARRAY_BUFFER,\r\n                  new Float32Array(positions),\r\n                  gl.STATIC_DRAW);\r\n\r\n    return {\r\n      position: positionBuffer,\r\n    };\r\n  }\r\n\r\nfunction initShaderProgram(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\r\n    const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);\r\n    const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);\r\n\r\n    // Create the shader program\r\n\r\n    const shaderProgram = gl.createProgram();\r\n    gl.attachShader(shaderProgram, vertexShader);\r\n    gl.attachShader(shaderProgram, fragmentShader);\r\n    gl.linkProgram(shaderProgram);\r\n\r\n    // If creating the shader program failed, alert\r\n\r\n    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\r\n      alert('Unable to initialize the shader program: ' + gl.getProgramInfoLog(shaderProgram));\r\n      return undefined;\r\n    }\r\n\r\n    return shaderProgram;\r\n  }\r\n\r\n  //\r\n  // creates a shader of the given type, uploads the source and\r\n  // compiles it.\r\n  //\r\nfunction loadShader(gl: WebGLRenderingContext, type: number, source: string) {\r\n    const shader = gl.createShader(type);\r\n\r\n    // Send the source to the shader object\r\n\r\n    gl.shaderSource(shader, source);\r\n\r\n    // Compile the shader program\r\n\r\n    gl.compileShader(shader);\r\n\r\n    // See if it compiled successfully\r\n\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n      alert('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader));\r\n      gl.deleteShader(shader);\r\n      return undefined;\r\n    }\r\n\r\n    return shader;\r\n}\r\n","import IDEPrimitive, { glslVec3Const, glslUnitVec3Const } from './DistanceEstimatePrimitives';\r\nimport { GlslConstant, glslFloatConst } from './GlslValue';\r\n\r\nexport default class DistanceEstimateBuilder {\r\n    private glsl: string;\r\n    private nextTempVar = 0;\r\n    constructor(private primitive: IDEPrimitive) {\r\n        this.glsl = 'float dist(vec3 p) {\\r\\n';\r\n    }\r\n\r\n    protected getTempVarName() {\r\n        return 't' + (this.nextTempVar++);\r\n    }\r\n\r\n\r\n    public elongate(x: number, y: number, z: number): DistanceEstimateBuilder {\r\n        this.glsl += `p = p - clamp(p, -${glslVec3Const(x, y, z)}, ${glslVec3Const(x, y, z)} );\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public repeat(xd: number, yd: number, zd: number): DistanceEstimateBuilder {\r\n        const glslc = glslVec3Const(xd, yd, zd);\r\n        this.glsl += `p = mod(p+0.5*${glslc},${glslc})-0.5*${glslc};\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symX(): DistanceEstimateBuilder {\r\n        this.glsl += `p.x = abs(p.x);\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symY(): DistanceEstimateBuilder {\r\n        this.glsl += `p.y = abs(p.y);\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symZ(): DistanceEstimateBuilder {\r\n        this.glsl += `p.z = abs(p.z);\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symAxis(normalX: GlslConstant, normalY: GlslConstant, normalZ: GlslConstant) {\r\n        const glslc = glslUnitVec3Const(normalX, normalY, normalZ);\r\n        this.glsl += `p -= 2.0 * min(0.00, dot(p, ${glslc})) * ${glslc};\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rXt(rate: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(rate);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            1.0, 0.0, 0.0,\r\n            0.0, cos(${radians}), sin(${radians}),\r\n            0.0, -sin(${radians}), cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rYt(rate: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(rate);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), 0.0, -sin(${radians}),\r\n            0.0, 1.0, 0.0,\r\n            sin(${radians}), 0.0, cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rZt(rate: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(rate);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), sin(${radians}), 0.0,\r\n            -sin(${radians}), cos(${radians}), 0.0,\r\n            0.0, 0.0, 1.0\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n\r\n    public rX(rad: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = glslFloatConst(rad);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            1.0, 0.0, 0.0,\r\n            0.0, cos(${radians}), sin(${radians}),\r\n            0.0, -sin(${radians}), cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rY(rad: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = glslFloatConst(rad);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), 0.0, -sin(${radians}),\r\n            0.0, 1.0, 0.0,\r\n            sin(${radians}), 0.0, cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rZ(rad: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = glslFloatConst(rad);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), sin(${radians}), 0.0,\r\n            -sin(${radians}), cos(${radians}), 0.0,\r\n            0.0, 0.0, 1.0\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public translate(x: GlslConstant, y: GlslConstant, z: GlslConstant): DistanceEstimateBuilder {\r\n        this.glsl += `p = p-vec3(${glslFloatConst(x)},${glslFloatConst(y)},${glslFloatConst(z)});\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public customGlsl(glsl: string) {\r\n        this.glsl += glsl;\r\n        return this;\r\n    }\r\n\r\n    public emitGlsl(): string {\r\n        this.glsl += this.primitive.emitGlsl();\r\n        this.glsl += '}';\r\n        return this.glsl;\r\n    }\r\n}","import * as React from 'react';\r\nimport main from '../../../projects/raymarch';\r\n\r\nexport default function RaymarchComponent() {\r\n    React.useEffect(() => main());\r\n    return <div className='conway conway_body full_body'>\r\n        <canvas id='canvas'></canvas>\r\n    </div>;\r\n}","\r\nexport default class Vector {\r\n    constructor(public x: number, public y: number, public z: number) {\r\n    }\r\n\r\n    dot(other: Vector) {\r\n        return this.x * other.x + this.y * other.y + this.z * other.z;\r\n    }\r\n\r\n    length() {\r\n        return Math.sqrt(this.lengthSq());\r\n    }\r\n\r\n    lengthSq() {\r\n        return this.x * this.x + this.y * this.y + this.z * this.z;\r\n    }\r\n\r\n    normalize() {\r\n        return this.multiply(1 / this.lengthSq());\r\n    }\r\n    negate() {\r\n        return new Vector(-this.x, -this.y, -this.z);\r\n    }\r\n\r\n    multiply(scale: number): Vector;\r\n    multiply(xscale: number, yscale: number, zscale: number): Vector;\r\n    multiply(scale: Vector): Vector;\r\n    multiply(sx: number | Vector, sy ?: number, sz ?: number): Vector {\r\n        if(!isVector(sx))\r\n        {\r\n            sy = sy ?? <number>sx;\r\n            sz = sz ?? <number>sx;\r\n        }\r\n        var [x, y, z] = Vector.getxyz(sx, sy, sz);\r\n        return new Vector(this.x * x, this.y * y, this.z * z);\r\n    }\r\n\r\n    add(dx: number, dy: number, dz: number): Vector;\r\n    add(v: Vector): Vector;\r\n    add(dx: number | Vector, dy ?: number, dz ?: number): Vector {\r\n        var [x, y, z] = Vector.getxyz(dx, dy, dz);\r\n        return new Vector(this.x + x, this.y + y, this.z + z);\r\n    }\r\n\r\n    subtract(dx: number, dy: number, dz: number): Vector;\r\n    subtract(v: Vector): Vector;\r\n    subtract(dx: number | Vector, dy ?: number, dz ?: number): Vector {\r\n        var [x, y, z] = Vector.getxyz(dx, dy, dz);\r\n        return new Vector(this.x - x, this.y - y, this.z - z);\r\n    }\r\n\r\n    private static getxyz(x: number | Vector, y?: number, z?: number): [number, number, number] {\r\n        if(isVector(x)) {\r\n            return [x.x, x.y, x.z];\r\n        }\r\n        else {\r\n            return [x, y, z];\r\n        }\r\n    }\r\n}\r\n\r\nfunction isVector(x: number | Vector) : x is Vector {\r\n    return (<any>x).x !== undefined;\r\n}","export default class Point3 {\r\n\r\n    static zero(): Point3  {\r\n        return new Point3(0,0,0);\r\n    }\r\n\r\n    constructor(public x: number, public y: number, public z: number) {\r\n\r\n    }\r\n    public lengthSq(): number {\r\n        return this.dot(this);\r\n    }\r\n\r\n    public length(): number {\r\n        return Math.sqrt(this.lengthSq());\r\n    }\r\n\r\n    public clone(): Point3 {\r\n        return new Point3(this.x, this.y, this.z);\r\n    }\r\n\r\n    public dot(other: Point3): number {\r\n        return this.x * other.x + this.y * other.y + this.z * other.z;\r\n    }\r\n\r\n    public normalize(): Point3 {\r\n        let len = this.length();\r\n        return this.div(len);\r\n    }\r\n\r\n    public mult(p: Point3): Point3\r\n    public mult(x: number, y: number, z: number): Point3\r\n    public mult(s: number): Point3\r\n    public mult(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz, true);\r\n        return new Point3(x * this.x, y * this.y, z * this.z);\r\n    }\r\n\r\n    \r\n    public div(p: Point3): Point3\r\n    public div(x: number, y: number, z: number): Point3\r\n    public div(s: number): Point3\r\n    public div(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz, true);\r\n        return new Point3(this.x / x, this.y / y, this.z / z);\r\n    }\r\n\r\n    public add(p: Point3): Point3\r\n    public add(x: number, y: number, z: number): Point3\r\n    public add(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz);\r\n        return new Point3(this.x + x, this.y + y, this.z + z);\r\n    }\r\n\r\n    public sub(p: Point3): Point3\r\n    public sub(x: number, y: number, z: number): Point3\r\n    public sub(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz);\r\n        return new Point3(this.x - x, this.y - y, this.z - z);\r\n    }\r\n}\r\n\r\nfunction splitArgs(pxs: Point3 | number, y?: number, z?: number, allowSingle: boolean = false): {x: number, y: number, z: number} {\r\n    if(y === undefined) {\r\n        if(!allowSingle || (pxs as Point3).x !== undefined) {\r\n            return (pxs as Point3);\r\n        } else {\r\n            return { x: pxs as number, y: pxs as number, z: pxs as number };\r\n        }\r\n    }\r\n    else {\r\n        return { x: pxs as number, y, z };\r\n    }\r\n}","import { IKeyChange } from './KeyWatcher';\r\n\r\nexport default class KeyState {\r\n    constructor(public keys: string[], public changes: IKeyChange[]) {\r\n\r\n    }\r\n\r\n    public isKeyDown(key: string) {\r\n        return this.keys.indexOf(key) !== -1;\r\n    }\r\n\r\n    public isKeyUp(key: string) {\r\n        return this.keys.indexOf(key) === -1;\r\n    }\r\n}","import KeyState from './KeyState';\r\n\r\nexport interface IKeyChange {\r\n    key: string;\r\n    change: 'press'|'release';\r\n}\r\n\r\nexport default class KeyWatcher {\r\n    downKeys: string[];\r\n    changes: IKeyChange[];\r\n\r\n    constructor(public attachedElement: HTMLElement, private logKeyNames?: boolean) {\r\n        if  (this.logKeyNames === undefined) {\r\n            this.logKeyNames = false;\r\n        }\r\n        attachedElement.addEventListener('keydown', k => this.onKeyDown(k));\r\n        attachedElement.addEventListener('keyup', k => this.onKeyUp(k));\r\n\r\n        this.downKeys = [];\r\n        this.changes = [];\r\n    }\r\n\r\n    private onKeyDown(key: KeyboardEvent) {\r\n        if (this.logKeyNames) {\r\n            // tslint:disable-next-line: no-console\r\n            console.log(key.key);\r\n        }\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        if (idx === -1) {\r\n            this.changes.push({ key: key.key, change: 'press' });\r\n            this.downKeys.push(key.key);\r\n        }\r\n    }\r\n\r\n    private onKeyUp(key: KeyboardEvent) {\r\n        this.changes.push({ key: key.key, change: 'release' });\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        this.downKeys.splice(idx, 1);\r\n    }\r\n\r\n    public Update(): KeyState {\r\n        const storeKeys = this.downKeys;\r\n        const storeChanges = this.changes;\r\n\r\n        this.downKeys = storeKeys.slice();\r\n        this.changes = [];\r\n\r\n        return new KeyState(storeKeys, storeChanges);\r\n    }\r\n}","import KeyWatcher, { IKeyChange } from './KeyWatcher';\r\nimport KeyState from './KeyState';\r\n\r\nexport default class KeyboardManager {\r\n\r\n    watcher: KeyWatcher;\r\n    prvState: KeyState;\r\n    currentState: KeyState;\r\n\r\n    constructor(element: HTMLElement, logKeyNames?: boolean) {\r\n        this.watcher = new KeyWatcher(element, logKeyNames);\r\n        this.prvState = this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public update(): void {\r\n        this.prvState = this.currentState;\r\n        this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public isKeyDown(key: string): boolean {\r\n        return this.currentState.isKeyDown(key);\r\n    }\r\n\r\n    public isKeyUp(key: string): boolean {\r\n        return this.currentState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyPressed(key: string): boolean {\r\n        return this.currentState.isKeyDown(key) && this.prvState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyReleased(key: string): boolean {\r\n        return this.currentState.isKeyUp(key) && this.prvState.isKeyDown(key);\r\n    }\r\n\r\n    public changes(): IKeyChange[] {\r\n        return this.currentState.changes;\r\n    }\r\n}","import Vector from './Vector';\r\nimport { vec2 } from 'gl-matrix';\r\nimport Matrix4 from './Matrix4';\r\n\r\nexport default class Quaternion {\r\n    constructor(public real: number, public i: number, public j: number, public k: number) {\r\n    }\r\n\r\n    public inverse(): Quaternion {\r\n        const denom = Quaternion.Dot(this, this);\r\n        return new Quaternion(this.real / denom, -this.i / denom, -this.j / denom, -this.k / denom);\r\n    }\r\n\r\n    public static Dot(a: Quaternion, b: Quaternion): number {\r\n        return a.real * b.real + a.i * b.i + a.j * b.j + a.k * b.k;\r\n    }\r\n\r\n    public static axisRotation(axis: Vector, radians: number): Quaternion {\r\n        const cos = Math.cos(radians / 2);\r\n        const sin = Math.sin(radians / 2);\r\n        const len = axis.length();\r\n\r\n        return new Quaternion(cos, sin * axis.x / len, sin * axis.y / len, sin * axis.z / len);\r\n    }\r\n\r\n    public static multiply(a: Quaternion, b: Quaternion) {\r\n        return new Quaternion (\r\n            a.real * b.real - a.i * b.i - a.j * b.j - a.k * b.k,\r\n            a.real * b.i + a.i * b.real + a.j * b.k - a.k * b.j,\r\n            a.real * b.j - a.i * b.k + a.j * b.real + a.k * b.i,\r\n            a.real * b.k + a.i * b.j - a.j * b.i + a.k * b.real\r\n        );\r\n    }\r\n\r\n    public applyTransform(point: Quaternion): Quaternion;\r\n    public applyTransform(vec3: Vector): Vector;\r\n    public applyTransform(point: Quaternion|Vector): Quaternion|Vector {\r\n        if ((point as any).real !== undefined) {\r\n            return Quaternion.multiply(this, Quaternion.multiply(point as Quaternion, this.inverse()));\r\n        }\r\n        else {\r\n            const inputQ = new Quaternion(0, (point as Vector).x, (point as Vector).y, (point as Vector).z);\r\n            const qOut = Quaternion.multiply(this, Quaternion.multiply(inputQ, this.inverse()));\r\n            return new Vector(qOut.i, qOut.j, qOut.k);\r\n        }\r\n    }\r\n\r\n    // Stolen from https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToMatrix/index.htm\r\n    public toMatrix():Matrix4 {\r\n        const mtx = new Matrix4();\r\n        mtx.components[0][0] = 1 - 2 * this.j * this.j - 2 * this.k * this.k;\r\n        mtx.components[0][1] = 2 * this.i * this.j - 2 * this.k * this.real;\r\n        mtx.components[0][2] = 2 * this.i * this.k + 2 * this.j * this.real;\r\n        \r\n        mtx.components[1][0] = 2 * this.i * this.j + 2 * this.k * this.real;\r\n        mtx.components[1][1] = 1 - 2 * this.i * this.i - 2 * this.k * this.k;\r\n        mtx.components[1][2] = 2 * this.j * this.k - 2 * this.i * this.real;\r\n        \r\n        mtx.components[2][0] = 2 * this.i * this.k - 2 * this.j * this.real;\r\n        mtx.components[2][1] = 2 * this.j * this.k + 2 * this.i * this.real;\r\n        mtx.components[2][2] = 1 - 2 * this.i * this.i - 2 * this.j * this.j;\r\n\r\n        return mtx;\r\n    }\r\n}","import Point3 from \"./Point3\";\r\n\r\nconst identity = [\r\n    [1, 0, 0, 0],\r\n    [0, 1, 0, 0],\r\n    [0, 0, 1, 0],\r\n    [0, 0, 0, 1]\r\n];\r\n\r\nexport default class Matrix4 {\r\n    components: [\r\n        [number, number, number, number],\r\n        [number, number, number, number],\r\n        [number, number, number, number],\r\n        [number, number, number, number]\r\n    ];\r\n\r\n    constructor(identity: boolean = true) {\r\n        if(identity) {\r\n            this.components = [\r\n                [1, 0, 0, 0],\r\n                [0, 1, 0, 0],\r\n                [0, 0, 1, 0],\r\n                [0, 0, 0, 1]\r\n            ];\r\n        } else {\r\n            this.components = [\r\n                [0, 0, 0, 0],\r\n                [0, 0, 0, 0],\r\n                [0, 0, 0, 0],\r\n                [0, 0, 0, 1]\r\n            ];\r\n        }\r\n    }\r\n\r\n    public transform(p: Point3) : Point3 {\r\n        let x = this.multRow(this.components[0], p);\r\n        let y = this.multRow(this.components[1], p);\r\n        let z = this.multRow(this.components[2], p);\r\n        let w = this.multRow(this.components[3], p);\r\n        return new Point3(x/w, y/w, z/w);\r\n    }\r\n\r\n    public mult(other: Matrix4): Matrix4 {\r\n        const output = new Matrix4();\r\n        for(let row = 0; row < 4; row++) {\r\n            for(let col = 0; col < 4; col ++) {\r\n                output.components[row][col] = 0;\r\n                for(let i = 0; i < 4; i++) {\r\n                    output.components[row][col] +=\r\n                        this.components[row][i] *\r\n                        other.components[i][col];\r\n                }\r\n            }\r\n        }\r\n\r\n        return output;\r\n    }\r\n\r\n    private multRow(row: [number, number, number, number], p: Point3) {\r\n        return row[0] * p.x + row[1] * p.y + row[2] * p.z + row[3];\r\n    }\r\n    \r\n    public colMajor(): number[] {\r\n        let output = new Array(16);\r\n        let i = 0;\r\n        for(let row = 0; row < 4; row++) {\r\n            for(let col = 0; col < 4; col++) {\r\n                output[i++] = this.components[row][col];\r\n            }\r\n        }\r\n        return output;\r\n    }\r\n    \r\n    public rowMajor(): number[] {\r\n        let output = new Array(16);\r\n        let i = 0;\r\n        for(let col = 0; col < 4; col++) {\r\n            for(let row = 0; row < 4; row++) {\r\n                output[i++] = this.components[row][col];\r\n            }\r\n        }\r\n        return output;\r\n    }\r\n\r\n    public static translate(pt: Point3) {\r\n        let output = new Matrix4();\r\n        output.components[0][3] = pt.x;\r\n        output.components[1][3] = pt.y;\r\n        output.components[2][3] = pt.z;\r\n        return output;\r\n    }\r\n}"],"sourceRoot":""}