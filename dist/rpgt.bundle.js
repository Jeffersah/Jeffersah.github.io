"use strict";(self.webpackChunktrading_game=self.webpackChunktrading_game||[]).push([[749],{1647:(e,t,s)=>{s.d(t,{Z:()=>i});const i=s.p+"bbb298f00b41bbd627d27aa0529a20ba.png"},6718:(e,t,s)=>{s.d(t,{Z:()=>r});class i{constructor(e,t){this.keys=e,this.changes=t}isKeyDown(e){return-1!==this.keys.indexOf(e)}isKeyUp(e){return-1===this.keys.indexOf(e)}}class n{constructor(e,t){this.attachedElement=e,this.logKeyNames=t,void 0===this.logKeyNames&&(this.logKeyNames=!1),e.addEventListener("keydown",(e=>this.onKeyDown(e))),e.addEventListener("keyup",(e=>this.onKeyUp(e))),this.downKeys=[],this.changes=[]}onKeyDown(e){this.logKeyNames&&console.log(e.key),-1===this.downKeys.indexOf(e.key)&&(this.changes.push({key:e.key,change:"press"}),this.downKeys.push(e.key))}onKeyUp(e){this.changes.push({key:e.key,change:"release"});const t=this.downKeys.indexOf(e.key);this.downKeys.splice(t,1)}Update(){const e=this.downKeys,t=this.changes;return this.downKeys=e.slice(),this.changes=[],new i(e,t)}}class r{constructor(e,t){this.watcher=new n(e,t),this.prvState=this.currentState=this.watcher.Update()}update(){this.prvState=this.currentState,this.currentState=this.watcher.Update()}isKeyDown(e){return this.currentState.isKeyDown(e)}isKeyUp(e){return this.currentState.isKeyUp(e)}isKeyPressed(e){return this.currentState.isKeyDown(e)&&this.prvState.isKeyUp(e)}isKeyReleased(e){return this.currentState.isKeyUp(e)&&this.prvState.isKeyDown(e)}changes(){return this.currentState.changes}}},174:(e,t,s)=>{s.r(t),s.d(t,{default:()=>D});const i=16;var n=s(127),r=s(3486),h=s(1647);const a=s.p+"42ace1eb95edbc899165c10bb9cc20ab.png",o=s.p+"e5352b303b79e08de36a8c4248cdbb28.png";var l=s(5901),c=s(7604),d=s(615);function y(e,t,s){let i=!1;const n={break:()=>{i=!0}};if(t===e)return void s(e,n);const r=t>e?1:-1,h=t+r;for(let t=e;t!==h&&!i;t+=r)s(t,n)}class w{constructor(e,t,s){this.width=e,this.height=t,this.cells=[];for(let i=0;i<e;i++){const e=[];for(let i=0;i<t;i++)e.push(s());this.cells.push(e)}this.prerender=document.getElementById("world_prerender")}updatePrerender(){(0,l.f5)(this.prerender,i*this.width,i*this.height);const e=this.prerender.getContext("2d");for(let t=0;t<this.width;t++)for(let s=0;s<this.height;s++)this.cells[t][s].paint(e,t*i,s*i)}tryMoveEntity(e,t,s){const n=t.x>=0?d.Nm.Right:d.Nm.Left,r=t.y>=0?d.Nm.Down:d.Nm.Up;if(0!==t.x){const r=Math.floor(e.edge(n)/i),h=Math.floor((e.edge(n)+t.x)/i),a=Math.floor(e.edge(d.Nm.Up)/i),o=Math.floor((e.edge(d.Nm.Down)-1)/i);let l;y(r,h,((e,t)=>{for(let i=a;i<=o;i++){if(e<0||e>=this.width)return l=e,void t.break();s&&s(e,i),this.cells[e][i].pathable||(t.break(),l=e)}})),void 0===l?e.x+=t.x:t.x>=0?e.x=l*i-e.w:e.x=(l+1)*i}if(0!==t.y){const n=Math.floor(e.edge(r)/i),h=Math.floor((e.edge(r)+t.y)/i),a=Math.floor(e.edge(d.Nm.Left)/i),o=Math.floor((e.edge(d.Nm.Right)-1)/i);let l;y(n,h,((e,t)=>{for(let i=a;i<=o;i++){if(e<0||e>=this.height)return l=e,void t.break();s&&s(i,e),this.cells[i][e].pathable||(t.break(),l=e)}})),void 0===l?e.y+=t.y:t.y>=0?e.y=l*i-e.h:e.y=(l+1)*i}}}class g{constructor(e,t,s){this.sheet=e,this.tileX=t,this.tileY=s,this.width=e.spriteWidth,this.height=e.spriteHeight}paint(e,t,s,i,n){this.sheet.render(e,t,s,i,n,this.tileX,this.tileY)}}const p=[[10,0],[10,0],[10,0],[10,0],[10,0],[7,1],[7,1],[10,1],[10,2],[9,2]];class u{constructor(e,t){this.pathable=e,this.graphic=t}paint(e,t,s){this.graphic.paint(e,t,s,i,i)}static GrassFloor(e){const t=p[Math.floor(Math.random()*p.length)];return new u(!0,new g(e,t[0],t[1]))}static RockWall(e){return new u(!1,new g(e,7,24))}}var f=s(5907),b=s(6718),m=s(8785),K=s(6417);class k{constructor(e,t){this.onload=t,K.ZP.get(e).subscribe((e=>{this.body=e.data,this.onload()}))}}let x,v,M,S;function D(){const e=new n.Z;x={tiles:new r.V(16,16,a,e.registerAssetLoadCallback()),wizard:new r.V(16,16,o,e.registerAssetLoadCallback()),arrows:new r.V(16,16,h.Z,e.registerAssetLoadCallback()),tilesets:new k("../dist/assets/rpgtest/tilesets.json",e.registerAssetLoadCallback())},S=new b.Z(document.body),e.onAllFinished(N)}function N(){M=new w(56,56,(()=>Math.random()<=.15?u.RockWall(x.tiles):u.GrassFloor(x.tiles))),M.updatePrerender();const e=document.getElementById("mainCanvas");v=e.getContext("2d"),new c.Z(e,v,448,448,!0,(()=>{})),R()}const U=new m.Z(0,0),C=new f.Z(0,0,14,14);let Z=!1;function R(){v.clearRect(0,0,448,448),(0,l.Ci)(v),v.save();let e=0,t=0;M.width>28&&(e=Math.max(0,Math.min((M.width-28)*i,C.x-224))),M.height>28&&(t=Math.max(0,Math.min((M.height-28)*i,C.y-224))),U.multWith(3,3).addWith(e,t).divideWith(4,4),v.translate(-U.x,-U.y),v.drawImage(M.prerender,0,0),S.update(),v.fillStyle="blue",v.fillRect(C.x,C.y,C.w,C.h);const s=new m.Z(0,0);S.isKeyDown("a")&&(s.x=-3),S.isKeyDown("d")&&(s.x=3),S.isKeyDown("w")&&(s.y=-3),S.isKeyDown("s")&&(s.y=3),v.fillStyle="yellow",v.globalAlpha=.6,M.tryMoveEntity(C,s,((e,t)=>{v.fillRect(e*i,t*i,i,i)})),v.globalAlpha=1,Z=!Z,Z&&(v.fillStyle="white",v.fillRect(0,0,10,10)),v.restore(),requestAnimationFrame((()=>R()))}}}]);
//# sourceMappingURL=rpgt.bundle.js.map