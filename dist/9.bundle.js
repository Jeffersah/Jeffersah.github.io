(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{74:function(i,t,o){"use strict";o.d(t,"a",(function(){return n}));class n{constructor(i,t){this.x=i,this.y=t}static zero(){return new n(0,0)}static fromAngle(i,t){return new n(Math.cos(i)*(null!=t?t:1),Math.sin(i)*(null!=t?t:1))}LengthSq(){return n.Dot(this,this)}Length(){return Math.sqrt(this.LengthSq())}Clone(){return new n(this.x,this.y)}Negate(){return new n(-this.x,-this.y)}NegateInPlace(){return this.x=-this.x,this.y=-this.y,this}static Dot(i,t){return i.x*t.x+i.y*t.y}DotWith(i){return n.Dot(this,i)}normalize(){let i=this.Length();return n.Multiply(this,1/i)}Direction(){return Math.atan2(this.y,this.x)}AddWith(i,t){const{x:o,y:n}=e(i,t);return this.x+=o,this.y+=n,this}MultWith(i,t){const{x:o,y:n}=function(i,t){if(void 0===t)return void 0!==i.x?{x:i.x,y:i.y}:{x:i,y:i};return{x:i,y:t}}(i,t);return this.x*=o,this.y*=n,this}SubtractWith(i,t){const{x:o,y:n}=e(i,t);return this.x-=o,this.y-=n,this}DivideWith(i,t){const{x:o,y:n}=e(i,t);return this.x/=o,this.y/=n,this}Equals(i){return this.x===i.x&&this.y===i.y}static add(i,t,o){const{x:s,y:r}=e(t,o);return new n(i.x+s,i.y+r)}static subtract(i,t,o){const{x:s,y:r}=e(t,o);return new n(i.x-s,i.y-r)}static Multiply(i,t,o){return void 0!==o?new n(i.x*t,i.y*o):void 0!==t.x?new n(i.x*t.x,i.y*t.y):new n(i.x*t,i.y*t)}static interpolate(i,t,o){return new n(i.x+(t.x-i.x)*o,i.y+(t.y-i.y)*o)}static componentMin(i,t){return i.x<=t.x&&i.y<=t.y?i:t.x<=i.x&&t.y<=i.y?t:new n(Math.min(i.x,t.x),Math.min(i.y,t.y))}static componentMax(i,t){return i.x>=t.x&&i.y>=t.y?i:t.x>=i.x&&t.y>=i.y?t:new n(Math.max(i.x,t.x),Math.max(i.y,t.y))}static Bezier(i,t){return 1===i.length?i[0]:2===i.length?n.add(n.Multiply(i[1],t),n.Multiply(i[0],1-t)):n.add(n.Multiply(n.Bezier(i.slice(1),t),t),n.Multiply(n.Bezier(i.slice(0,i.length-1),t),1-t))}rotate(i){const t=Math.atan2(this.y,this.x),o=this.Length();return n.fromAngle(t+i,o)}}function e(i,t){return void 0===t?{x:i.x,y:i.y}:{x:i,y:t}}},83:function(i,t,o){"use strict";o.d(t,"b",(function(){return s})),o.d(t,"a",(function(){return r}));var n=o(74),e=o(84);class s{constructor(i,t){this.onload=t,this.image=document.createElement("img"),this.image.src=i,this.image.addEventListener("load",()=>this.loadFinished())}loadFinished(){this.onload()}getSprite(i,t,o,n){return new r(this,i,t,o,n)}getAnimation(i,t,o,n){return new e.a(this,i,t,n,o)}}class r{constructor(i,t,o,e,s){this.atlas=i,this.sourceOffset=t,this.sourceSize=o,this.origin=null!=e?e:new n.a(0,0),this.sourceRotation=null!=s?s:0}draw(i,t,o,n){i.save(),i.translate(t.x,t.y),i.rotate((null!=n?n:0)+this.sourceRotation),i.scale(o.x,o.y),i.translate(-this.origin.x,-this.origin.y),i.drawImage(this.atlas.image,this.sourceOffset.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),i.restore()}}},84:function(i,t,o){"use strict";o.d(t,"a",(function(){return e}));var n=o(74);class e{constructor(i,t,o,e,s){this.atlas=i,this.sourceOffset=t,this.sourceSize=o,this.numFrames=e,this.origin=null!=s?s:new n.a(0,0)}static FromJson(i,t){return new e(i,new n.a(t.sourceOffset[0],t.sourceOffset[1]),new n.a(t.frameSize[0],t.frameSize[1]),t.numFrames,void 0===t.origin?void 0:new n.a(t.origin[0],t.origin[1]))}draw(i,t,o,n,e){i.save(),i.translate(t.x,t.y),void 0!==e&&i.rotate(e),i.scale(o.x,o.y),i.translate(-this.origin.x,-this.origin.y),i.drawImage(this.atlas.image,this.sourceOffset.x+n*this.sourceSize.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),i.restore()}play(i,t){var o;return void 0!==i.animation?new s(this,i.maxTime,null!==(o=i.loop)&&void 0!==o&&o):new s(this,i,null!=t&&t)}}class s{constructor(i,t,o){this.source=i,this.maxTime=t,this.loop=o,this.currentTime=0}tick(){return this.currentTime++,!(this.currentTime<this.maxTime)&&(this.loop&&(this.currentTime=0),!0)}draw(i,t,o,n){const e=Math.floor(this.currentTime*this.source.numFrames/this.maxTime);this.source.draw(i,t,o,e,n)}}},90:function(i,t,o){"use strict";o.d(t,"a",(function(){return e}));const n=2*Math.PI;class e{static normalize(i){return(i%=n)<0&&(i+=n),i}static relativeNormalize(i){return(i%=n)>Math.PI?i-=n:i<-Math.PI&&(i+=n),i}static relativeAngle(i,t){return e.relativeNormalize(i-t)}}},91:function(i,t,o){"use strict";o.d(t,"a",(function(){return n}));class n{static Int(i,t){const o=Math.random();return void 0===i&&void 0===t?Math.floor(o*Number.MAX_SAFE_INTEGER):void 0===t?Math.floor(o*i):i+Math.floor(o*(t-i))}static Float(i,t){const o=Math.random();return void 0===i&&void 0===t?o:void 0===t?o*i:i+o*(t-i)}}},92:function(i){i.exports=JSON.parse('[{"id":0,"name":"Custom_1","width":8,"height":8,"mapdata":[5,26,16,6,17,5,6,17,8,6,24,23,22,3,20,7,8,7,24,22,15,22,15,6,12,33,6,1,17,4,13,7,12,22,14,12,14,5,15,6,12,22,14,12,14,4,13,7,8,22,10,12,14,5,11,6,4,15,15,15,15,15,2,7],"spawns":[{"position":{"x":2,"y":2},"color":0,"direction":0},{"position":{"x":2,"y":1},"color":3,"direction":0},{"position":{"x":5,"y":3},"color":-1,"direction":0},{"position":{"x":6,"y":4},"color":-1,"direction":0},{"position":{"x":6,"y":5},"color":-1,"direction":2},{"position":{"x":1,"y":3},"color":-1,"direction":1},{"position":{"x":1,"y":3},"color":2,"direction":0},{"position":{"x":1,"y":3},"color":0,"direction":2},{"position":{"x":4,"y":7},"color":-2,"direction":3},{"position":{"x":4,"y":5},"color":-2,"direction":3},{"position":{"x":3,"y":6},"color":-3,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":7,"y":0},"color":3},{"position":{"x":2,"y":0},"color":0},{"position":{"x":4,"y":0},"color":2},{"position":{"x":4,"y":3},"color":0}]},{"id":1,"name":"Custom_2","width":8,"height":7,"mapdata":[0,0,25,25,25,25,24,6,5,13,22,22,22,22,13,14,1,1,1,37,1,37,4,7,4,15,22,22,22,22,13,6,0,0,37,1,37,1,1,1,0,16,22,22,22,22,15,7,0,0,27,27,27,27,0,0],"spawns":[{"position":{"x":6,"y":0},"color":0,"direction":0},{"position":{"x":5,"y":2},"color":-1,"direction":3},{"position":{"x":3,"y":2},"color":-1,"direction":3},{"position":{"x":4,"y":1},"color":-1,"direction":1},{"position":{"x":2,"y":0},"color":-1,"direction":1},{"position":{"x":3,"y":2},"color":-1,"direction":1},{"position":{"x":5,"y":2},"color":-1,"direction":1},{"position":{"x":4,"y":4},"color":-1,"direction":1},{"position":{"x":2,"y":5},"color":-1,"direction":1},{"position":{"x":6,"y":4},"color":-2,"direction":1},{"position":{"x":1,"y":2},"color":-2,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":1,"y":5},"color":0}]},{"id":2,"name":"Custom_3","width":8,"height":6,"mapdata":[5,13,26,17,17,0,0,0,4,14,16,23,23,2,6,0,17,4,9,23,23,26,1,0,12,13,23,10,4,2,7,0,12,23,14,4,6,0,25,0,28,15,15,18,4,2,7,0],"spawns":[{"position":{"x":2,"y":0},"color":0,"direction":2},{"position":{"x":6,"y":4},"color":0,"direction":1},{"position":{"x":0,"y":5},"color":0,"direction":0},{"position":{"x":0,"y":5},"color":0,"direction":3},{"position":{"x":5,"y":2},"color":0,"direction":2}],"disableSignals":[{"tile":{"x":1,"y":4},"signalIndex":3,"forceSignals":0},{"tile":{"x":1,"y":4},"signalIndex":0,"forceSignals":0}],"endpoints":[{"position":{"x":2,"y":1},"color":0},{"position":{"x":3,"y":0},"color":0},{"position":{"x":0,"y":2},"color":0},{"position":{"x":3,"y":5},"color":0},{"position":{"x":4,"y":0},"color":0}]},{"id":3,"name":"Original_Expert_1","width":8,"height":6,"mapdata":[5,13,13,2,2,13,13,6,1,27,12,13,9,14,1,1,12,2,23,22,23,22,7,1,1,16,14,1,1,1,24,14,19,25,1,12,3,14,16,14,0,4,15,15,15,15,2,7],"spawns":[{"position":{"x":6,"y":3},"color":3,"direction":0},{"position":{"x":1,"y":4},"color":3,"direction":1},{"position":{"x":1,"y":1},"color":1,"direction":3},{"position":{"x":3,"y":4},"color":-2,"direction":3},{"position":{"x":4,"y":2},"color":-2,"direction":3},{"position":{"x":5,"y":5},"color":-1,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":0,"y":4},"color":3},{"position":{"x":1,"y":3},"color":3},{"position":{"x":6,"y":4},"color":1}]},{"id":4,"name":"Original_Expert_10","width":8,"height":6,"mapdata":[17,17,17,25,25,25,25,0,12,21,14,12,23,15,23,18,4,22,23,23,15,13,22,26,24,10,12,23,13,21,23,18,24,23,22,14,12,22,23,18,0,4,15,15,15,15,7,0],"spawns":[{"position":{"x":6,"y":0},"color":3,"direction":1},{"position":{"x":0,"y":3},"color":3,"direction":0},{"position":{"x":4,"y":0},"color":1,"direction":1},{"position":{"x":0,"y":4},"color":1,"direction":0},{"position":{"x":5,"y":0},"color":0,"direction":1}],"disableSignals":[],"endpoints":[{"position":{"x":0,"y":0},"color":2},{"position":{"x":1,"y":0},"color":1},{"position":{"x":2,"y":0},"color":3},{"position":{"x":7,"y":3},"color":3},{"position":{"x":7,"y":4},"color":1},{"position":{"x":7,"y":1},"color":0}]},{"id":5,"name":"Original_Expert_11","width":8,"height":6,"mapdata":[5,13,13,13,13,2,2,6,1,1,12,23,23,2,13,14,19,1,1,1,12,13,23,10,17,12,23,14,1,37,1,1,1,1,1,4,15,15,23,10,4,15,15,2,2,2,15,7],"spawns":[{"position":{"x":5,"y":3},"color":0,"direction":1},{"position":{"x":5,"y":3},"color":0,"direction":3},{"position":{"x":7,"y":1},"color":-1,"direction":3},{"position":{"x":2,"y":3},"color":-1,"direction":0},{"position":{"x":2,"y":5},"color":-1,"direction":0}],"disableSignals":[{"tile":{"x":5,"y":4},"signalIndex":0,"forceSignals":0}],"endpoints":[{"position":{"x":0,"y":2},"color":0},{"position":{"x":0,"y":3},"color":0}]},{"id":6,"name":"Original_Expert_2","width":8,"height":6,"mapdata":[5,6,25,25,5,26,0,0,12,14,1,1,1,17,17,17,12,15,15,15,15,15,15,14,12,2,2,2,2,2,2,14,12,2,2,2,2,2,2,14,4,2,2,2,2,2,2,7],"spawns":[{"position":{"x":3,"y":0},"color":0,"direction":1},{"position":{"x":2,"y":0},"color":1,"direction":1},{"position":{"x":5,"y":0},"color":3,"direction":2},{"position":{"x":6,"y":2},"color":-1,"direction":2},{"position":{"x":4,"y":3},"color":-2,"direction":2},{"position":{"x":1,"y":3},"color":-2,"direction":2},{"position":{"x":3,"y":4},"color":-2,"direction":0},{"position":{"x":7,"y":4},"color":-2,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":7,"y":1},"color":0},{"position":{"x":6,"y":1},"color":1},{"position":{"x":5,"y":1},"color":3}]},{"id":7,"name":"Original_Expert_3","width":8,"height":6,"mapdata":[5,13,13,2,6,0,17,0,1,12,3,2,23,6,1,0,12,7,1,24,14,1,1,17,12,26,1,0,12,22,14,1,19,25,12,2,15,15,14,1,0,4,15,2,2,2,11,7],"spawns":[{"position":{"x":3,"y":2},"color":3,"direction":0},{"position":{"x":1,"y":4},"color":0,"direction":1},{"position":{"x":1,"y":3},"color":2,"direction":2},{"position":{"x":3,"y":0},"color":-2,"direction":2}],"disableSignals":[],"endpoints":[{"position":{"x":0,"y":4},"color":0},{"position":{"x":6,"y":0},"color":2},{"position":{"x":7,"y":2},"color":3}]},{"id":8,"name":"Original_Expert_4","width":8,"height":6,"mapdata":[5,2,6,5,13,13,13,6,8,6,19,1,4,15,15,14,8,3,9,14,5,13,13,7,8,23,23,11,14,1,1,25,12,14,1,5,15,7,8,7,4,11,7,4,2,2,7,0],"spawns":[{"position":{"x":7,"y":3},"color":0,"direction":1},{"position":{"x":2,"y":5},"color":-2,"direction":3},{"position":{"x":7,"y":0},"color":-2,"direction":2},{"position":{"x":4,"y":1},"color":-2,"direction":0},{"position":{"x":5,"y":1},"color":-3,"direction":3},{"position":{"x":4,"y":2},"color":-3,"direction":0},{"position":{"x":3,"y":2},"color":-3,"direction":1}],"disableSignals":[],"endpoints":[{"position":{"x":2,"y":1},"color":0}]},{"id":9,"name":"Original_Expert_5","width":8,"height":6,"mapdata":[24,2,2,6,5,2,18,0,0,0,0,12,14,0,5,18,16,2,13,14,12,13,7,0,5,2,15,14,12,15,2,18,1,24,13,7,4,13,26,0,19,24,15,2,2,15,26,0],"spawns":[{"position":{"x":0,"y":0},"color":2,"direction":0},{"position":{"x":6,"y":5},"color":2,"direction":2},{"position":{"x":1,"y":5},"color":1,"direction":0},{"position":{"x":1,"y":4},"color":0,"direction":0},{"position":{"x":6,"y":4},"color":3,"direction":2}],"disableSignals":[],"endpoints":[{"position":{"x":0,"y":5},"color":3},{"position":{"x":0,"y":2},"color":2},{"position":{"x":7,"y":3},"color":2},{"position":{"x":6,"y":0},"color":1},{"position":{"x":7,"y":1},"color":0}]},{"id":10,"name":"Original_Expert_6","width":8,"height":6,"mapdata":[16,9,2,9,13,2,9,26,5,14,0,1,4,6,1,0,1,8,13,22,2,15,10,0,4,14,1,1,0,0,12,26,0,8,15,22,2,2,10,0,0,19,0,27,0,0,19,0],"spawns":[{"position":{"x":7,"y":0},"color":0,"direction":2},{"position":{"x":7,"y":3},"color":0,"direction":2},{"position":{"x":3,"y":5},"color":0,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":1,"y":5},"color":0},{"position":{"x":6,"y":5},"color":0},{"position":{"x":0,"y":0},"color":0}]},{"id":11,"name":"Original_Expert_7","width":8,"height":6,"mapdata":[17,17,17,17,17,17,17,17,12,15,22,22,22,22,22,14,1,0,12,23,11,15,22,14,8,13,23,22,13,13,23,34,12,22,22,23,22,22,22,7,27,27,27,27,27,27,27,0],"spawns":[{"position":{"x":6,"y":5},"color":3,"direction":3},{"position":{"x":4,"y":5},"color":3,"direction":3},{"position":{"x":3,"y":5},"color":3,"direction":3},{"position":{"x":5,"y":5},"color":1,"direction":3},{"position":{"x":0,"y":5},"color":1,"direction":3},{"position":{"x":7,"y":3},"color":0,"direction":1},{"position":{"x":2,"y":5},"color":2,"direction":3},{"position":{"x":1,"y":5},"color":2,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":0,"y":0},"color":3},{"position":{"x":7,"y":0},"color":3},{"position":{"x":4,"y":0},"color":3},{"position":{"x":6,"y":0},"color":1},{"position":{"x":2,"y":0},"color":1},{"position":{"x":1,"y":0},"color":0},{"position":{"x":3,"y":0},"color":2},{"position":{"x":5,"y":0},"color":2}]},{"id":12,"name":"Original_Expert_8","width":8,"height":6,"mapdata":[5,9,6,5,6,16,2,6,12,14,8,20,7,5,6,1,19,1,27,1,25,27,1,1,17,1,5,23,20,2,7,1,1,12,14,12,3,2,6,1,4,15,15,15,15,2,15,7],"spawns":[{"position":{"x":5,"y":2},"color":1,"direction":3},{"position":{"x":2,"y":2},"color":0,"direction":3},{"position":{"x":4,"y":2},"color":3,"direction":1},{"position":{"x":1,"y":2},"color":-1,"direction":3},{"position":{"x":3,"y":4},"color":-3,"direction":1}],"disableSignals":[],"endpoints":[{"position":{"x":0,"y":3},"color":3},{"position":{"x":0,"y":2},"color":1},{"position":{"x":5,"y":0},"color":0}]},{"id":13,"name":"Original_Expert_9","width":8,"height":6,"mapdata":[0,24,13,13,2,13,26,0,5,2,22,22,2,3,2,6,4,2,22,3,2,22,6,1,17,5,22,22,2,22,20,7,1,4,22,3,2,3,7,17,4,2,15,7,0,4,2,7],"spawns":[{"position":{"x":6,"y":0},"color":0,"direction":2},{"position":{"x":1,"y":0},"color":1,"direction":0},{"position":{"x":2,"y":1},"color":-1,"direction":2},{"position":{"x":4,"y":1},"color":-1,"direction":2},{"position":{"x":2,"y":2},"color":-1,"direction":0},{"position":{"x":5,"y":2},"color":-1,"direction":0},{"position":{"x":7,"y":2},"color":-1,"direction":3},{"position":{"x":3,"y":3},"color":-1,"direction":2},{"position":{"x":5,"y":3},"color":-1,"direction":2},{"position":{"x":6,"y":3},"color":-1,"direction":0},{"position":{"x":4,"y":4},"color":-1,"direction":0},{"position":{"x":1,"y":4},"color":-1,"direction":0}],"disableSignals":[],"endpoints":[{"position":{"x":7,"y":4},"color":1},{"position":{"x":0,"y":3},"color":0}]},{"id":14,"name":"Original_Genius_1","width":8,"height":6,"mapdata":[0,5,2,9,6,25,5,6,24,10,16,22,22,22,22,7,5,15,13,3,22,22,14,0,4,9,20,3,38,22,22,18,16,22,10,12,22,22,22,6,0,19,27,19,4,7,4,7],"spawns":[{"position":{"x":4,"y":3},"color":1,"direction":2},{"position":{"x":4,"y":3},"color":0,"direction":3},{"position":{"x":4,"y":3},"color":-1,"direction":1},{"position":{"x":6,"y":4},"color":-1,"direction":0},{"position":{"x":5,"y":3},"color":-2,"direction":3},{"position":{"x":2,"y":5},"color":2,"direction":3},{"position":{"x":0,"y":1},"color":2,"direction":0},{"position":{"x":5,"y":0},"color":3,"direction":1}],"disableSignals":[],"endpoints":[{"position":{"x":7,"y":3},"color":2},{"position":{"x":3,"y":5},"color":2},{"position":{"x":0,"y":4},"color":1},{"position":{"x":1,"y":5},"color":3},{"position":{"x":2,"y":1},"color":0}]},{"id":15,"name":"Original_Genius_2","width":8,"height":6,"mapdata":[5,2,6,25,0,25,5,6,12,2,10,4,9,23,20,7,1,17,4,2,11,10,12,18,1,8,9,9,9,10,12,26,8,10,8,10,8,15,11,6,19,4,15,15,11,2,2,7],"spawns":[{"position":{"x":3,"y":0},"color":0,"direction":1},{"position":{"x":5,"y":0},"color":1,"direction":1},{"position":{"x":7,"y":3},"color":3,"direction":2}],"disableSignals":[{"tile":{"x":6,"y":3},"signalIndex":0,"forceSignals":8224}],"endpoints":[{"position":{"x":0,"y":5},"color":0},{"position":{"x":1,"y":2},"color":1},{"position":{"x":7,"y":2},"color":3}]},{"id":16,"name":"Original_Genius_3","width":8,"height":6,"mapdata":[16,6,25,25,25,25,5,26,24,23,23,15,23,22,22,26,16,23,14,24,23,22,23,18,16,22,23,13,23,22,23,26,5,23,22,23,22,22,23,18,27,19,27,19,19,19,19,0],"spawns":[{"position":{"x":4,"y":0},"color":3,"direction":1},{"position":{"x":3,"y":0},"color":3,"direction":1},{"position":{"x":2,"y":0},"color":1,"direction":1},{"position":{"x":7,"y":0},"color":1,"direction":2},{"position":{"x":0,"y":1},"color":1,"direction":0},{"position":{"x":7,"y":1},"color":0,"direction":2},{"position":{"x":7,"y":3},"color":2,"direction":2},{"position":{"x":3,"y":2},"color":2,"direction":0},{"position":{"x":5,"y":0},"color":2,"direction":1},{"position":{"x":2,"y":5},"color":2,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":0,"y":0},"color":0},{"position":{"x":5,"y":5},"color":3},{"position":{"x":1,"y":5},"color":3},{"position":{"x":0,"y":3},"color":1},{"position":{"x":7,"y":4},"color":1},{"position":{"x":3,"y":5},"color":1},{"position":{"x":0,"y":2},"color":2},{"position":{"x":4,"y":5},"color":2},{"position":{"x":6,"y":5},"color":2},{"position":{"x":7,"y":2},"color":2}]},{"id":17,"name":"Original_Genius_4","width":8,"height":6,"mapdata":[24,6,5,6,5,6,5,18,24,23,14,1,1,1,12,6,24,23,14,12,14,12,23,14,24,22,14,12,14,12,23,7,24,23,14,1,1,12,23,18,0,19,4,7,4,7,19,0],"spawns":[{"position":{"x":0,"y":0},"color":0,"direction":0},{"position":{"x":0,"y":1},"color":3,"direction":0},{"position":{"x":0,"y":3},"color":3,"direction":0},{"position":{"x":0,"y":2},"color":1,"direction":0},{"position":{"x":2,"y":0},"color":-1,"direction":1},{"position":{"x":5,"y":3},"color":-2,"direction":3}],"disableSignals":[],"endpoints":[{"position":{"x":7,"y":0},"color":1},{"position":{"x":1,"y":5},"color":0},{"position":{"x":7,"y":4},"color":3},{"position":{"x":6,"y":5},"color":3}]},{"id":18,"name":"Original_Genius_5","width":8,"height":6,"mapdata":[24,6,17,17,17,5,13,26,24,22,23,23,23,22,23,18,16,23,22,38,22,23,23,18,24,22,23,23,23,22,23,6,5,15,14,19,27,1,19,19,4,2,7,0,0,27,0,0],"spawns":[{"position":{"x":3,"y":2},"color":0,"direction":3},{"position":{"x":0,"y":0},"color":2,"direction":0},{"position":{"x":0,"y":3},"color":2,"direction":0},{"position":{"x":5,"y":5},"color":2,"direction":3},{"position":{"x":3,"y":2},"color":1,"direction":1},{"position":{"x":3,"y":2},"color":1,"direction":0},{"position":{"x":3,"y":2},"color":3,"direction":2},{"position":{"x":7,"y":0},"color":3,"direction":2}],"disableSignals":[],"endpoints":[{"position":{"x":7,"y":1},"color":2},{"position":{"x":7,"y":2},"color":2},{"position":{"x":4,"y":0},"color":2},{"position":{"x":6,"y":4},"color":3},{"position":{"x":0,"y":2},"color":3},{"position":{"x":2,"y":0},"color":1},{"position":{"x":3,"y":4},"color":1},{"position":{"x":7,"y":4},"color":1},{"position":{"x":3,"y":0},"color":0}]},{"id":19,"name":"Original_Genius_6","width":8,"height":6,"mapdata":[24,6,0,17,0,17,0,17,24,23,2,23,13,23,13,7,24,23,2,22,23,22,23,26,24,23,26,1,8,23,14,0,24,23,2,15,23,22,15,18,24,7,0,0,19,19,0,0],"spawns":[{"position":{"x":0,"y":0},"color":2,"direction":0},{"position":{"x":0,"y":4},"color":2,"direction":0},{"position":{"x":7,"y":2},"color":0,"direction":2},{"position":{"x":0,"y":2},"color":1,"direction":0},{"position":{"x":0,"y":1},"color":3,"direction":0}],"disableSignals":[],"endpoints":[{"position":{"x":3,"y":0},"color":3},{"position":{"x":5,"y":5},"color":1},{"position":{"x":5,"y":0},"color":1},{"position":{"x":7,"y":0},"color":2},{"position":{"x":7,"y":4},"color":2},{"position":{"x":4,"y":5},"color":0}]},{"id":20,"name":"Original_Genius_7","width":8,"height":6,"mapdata":[0,16,13,2,9,13,6,25,24,9,23,13,20,14,27,1,5,11,23,38,22,22,13,14,12,26,12,11,23,22,15,7,1,16,23,18,8,22,18,17,4,2,11,2,11,15,2,7],"spawns":[{"position":{"x":7,"y":0},"color":0,"direction":1},{"position":{"x":6,"y":1},"color":2,"direction":3},{"position":{"x":3,"y":2},"color":2,"direction":0},{"position":{"x":0,"y":1},"color":1,"direction":0},{"position":{"x":1,"y":3},"color":1,"direction":2}],"disableSignals":[],"endpoints":[{"position":{"x":1,"y":0},"color":0},{"position":{"x":6,"y":4},"color":1},{"position":{"x":7,"y":4},"color":1},{"position":{"x":3,"y":4},"color":2},{"position":{"x":1,"y":4},"color":2}]}]')},94:function(i){i.exports=JSON.parse('[{"carType":0,"repeatCount":1,"conditions":"turnLeft","sourceOffset":[0,0],"numFrames":6},{"carType":0,"repeatCount":1,"conditions":"turnRight","sourceOffset":[0,1],"numFrames":6},{"carType":1,"repeatCount":1,"conditions":"turnLeft","sourceOffset":[0,2],"numFrames":5},{"carType":1,"repeatCount":1,"conditions":"turnRight","sourceOffset":[0,3],"numFrames":5},{"carType":2,"repeatCount":1,"conditions":"turnLeft","sourceOffset":[0,4],"numFrames":7},{"carType":2,"repeatCount":1,"conditions":"turnRight","sourceOffset":[0,5],"numFrames":7},{"carType":3,"repeatCount":1,"conditions":"turnLeft","sourceOffset":[0,6],"numFrames":7},{"carType":3,"repeatCount":1,"conditions":"turnRight","sourceOffset":[0,7],"numFrames":7},{"carType":-1,"repeatCount":1,"conditions":"reverse","sourceOffset":[0,8],"numFrames":7,"overridesRotation":true},{"carType":-2,"repeatCount":1,"conditions":"turnLeft","sourceOffset":[0,9],"numFrames":6},{"carType":-2,"repeatCount":1,"conditions":"turnRight","sourceOffset":[0,10],"numFrames":6},{"carType":-3,"repeatCount":1,"conditions":"turnLeft","sourceOffset":[0,9],"numFrames":6},{"carType":-3,"repeatCount":1,"conditions":"turnRight","sourceOffset":[0,10],"numFrames":6}]')},99:function(i,t,o){"use strict";o.r(t),o.d(t,"default",(function(){return ni}));var n,e=o(0),s=o(24),r=o(13),a=o(11),c=o(74);!function(i){i[i.Red=0]="Red",i[i.Green=1]="Green",i[i.Yellow=2]="Yellow",i[i.Blue=3]="Blue",i[i.Gray_Bounce=-1]="Gray_Bounce",i[i.Gray_TurnLeft=-2]="Gray_TurnLeft",i[i.Gray_TurnRight=-3]="Gray_TurnRight"}(n||(n={}));var l=n;const h=[n.Red,n.Green,n.Yellow,n.Blue,n.Gray_Bounce,n.Gray_TurnLeft,n.Gray_TurnRight];var d;!function(i){i[i.RR=1]="RR",i[i.RB=2]="RB",i[i.BR=2]="BR",i[i.RL=4]="RL",i[i.LR=4]="LR",i[i.RT=8]="RT",i[i.TR=8]="TR",i[i.BB=16]="BB",i[i.BL=32]="BL",i[i.LB=32]="LB",i[i.BT=64]="BT",i[i.TB=64]="TB",i[i.LL=128]="LL",i[i.LT=256]="LT",i[i.TL=256]="TL",i[i.TT=512]="TT"}(d||(d={}));var p,u=d;!function(i){i[i.Right=0]="Right",i[i.Bottom=1]="Bottom",i[i.Left=2]="Left",i[i.Top=3]="Top"}(p||(p={}));const x=[[u.RR,u.RB,u.RL,u.RT],[u.BR,u.BB,u.BL,u.BT],[u.LR,u.LB,u.LL,u.LT],[u.TR,u.TB,u.TL,u.TT]];var y=p;const f=Math.PI/2;class g{static EquivalentPosition(i){if(void 0!==i)return{position:c.a.add(i.position,g.AnchorToTileMove(i.anchor)),anchor:g.ReverseDirection(i.anchor)}}static AnchorToIndex(i){return i}static AnchorToTileMove(i){switch(i){case p.Right:return new c.a(1,0);case p.Bottom:return new c.a(0,1);case p.Left:return new c.a(-1,0);case p.Top:return new c.a(0,-1);default:throw"Bad Anchor"}}static ReverseDirection(i){return(i+2)%4}static IndexToAnchor(i){switch(i){case 0:return p.Right;case 1:return p.Bottom;case 2:return p.Left;case 3:return p.Top;default:throw"Bad Index"}}static GetAnchorOffset(i){switch(i){case p.Top:return new c.a(.5,0);case p.Bottom:return new c.a(.5,1);case p.Left:return new c.a(0,.5);case p.Right:return new c.a(1,.5);default:throw"Bad Anchor"}}static GetExitRotation(i){switch(i){case p.Top:return 3*f;case p.Bottom:return f;case p.Left:return 2*f;case p.Right:return 0;default:throw"Bad Anchor"}}static GetEntryRotation(i){return g.GetExitRotation(g.ReverseDirection(i))}static GetRealPosition(i,t){var o=c.a.Multiply(i.position,t),n=c.a.Multiply(g.GetAnchorOffset(i.anchor),t);return o.AddWith(n)}static GetMidpoint(i,t){return c.a.Multiply(i.position,t).AddWith(c.a.Multiply(t,.5))}static GetConnection(i,t){return x[i][t]}}g.AllAnchors=[p.Right,p.Bottom,p.Left,p.Top];var w=o(90);const m=new c.a(64,64),v=new c.a(18,18);var R=o(91);class T{constructor(i,t,o,n){this.color=i,this.sprite=t,this.position=o,this.assets=n,this.nextPosition=void 0,this.parkedAt=void 0,this.parkAnimationComplete=!1,this.hasPlayedCrashAnimation=!1,this.flameRenders=[],this.animations=n.animationControllers[i],this.currentAnimationDefinition=void 0}isCrashed(){return void 0!==this.crashedAt}crashHere(i){this.isCrashed()||this.startFlames(),this.crashedAt={position:this.position.position,anchor:i}}crashAt(i){this.isCrashed()||this.startFlames(),this.crashedAt=i}FindOutputForAlwaysTurn(i,t,o,n){if(1===o.length)return o[0];if(0===n){const i=g.ReverseDirection(t);return-1!==o.indexOf(i)?i:t}for(let i=0;i<4;i++){let e=(t+i*n)%4;if(-1!==o.indexOf(e))return e}return t}startFlames(){const i=R.a.Int(1,4);for(let t=0;t<i;t++){const i={anim:this.assets.fire.play(30,!0),offset:new c.a(R.a.Int(-6,6)-this.assets.fire.sourceSize.x/2,R.a.Int(-6,6)-this.assets.fire.sourceSize.y)},t=R.a.Int(8);for(let o=0;o<t;o++)i.anim.tick();this.flameRenders.push(i)}}EveryTick(){for(const i of this.flameRenders)i.anim.tick()}LogicTick(){this.isCrashed()&&!this.hasPlayedCrashAnimation&&(this.hasPlayedCrashAnimation=!0),this.currentAnimationDefinition=void 0}CalculateNextPosition(i){if(this.isCrashed())return void(this.hasPlayedCrashAnimation=!0);if(void 0!==this.parkedAt)return void(this.parkAnimationComplete=!0);const t=i.map[this.position.position.x][this.position.position.y],o=t.definition.connections.allConnections(this.position.anchor),n=this.chooseOutputDirection(i,t,o);if(void 0===n)return void(t.definition.isStop?(this.parkedAt=this.position.position,this.parkAnimationComplete=!1,Object(a.a)(i.cars,i=>i!==this&&void 0!==i.parkedAt&&i.parkedAt.x===this.position.position.x&&i.parkedAt.y===this.position.position.y)&&this.crashHere(this.position.anchor)):this.crashHere());let e=this.position.anchor===n?"reverse":this.position.anchor===g.ReverseDirection(n)?"straight":this.position.anchor===(n+1)%4?"turnRight":"turnLeft";return this.currentAnimationDefinition=this.animations.animations[e],{position:c.a.add(this.position.position,g.AnchorToTileMove(n)),anchor:g.ReverseDirection(n)}}chooseOutputDirection(i,t,o){switch(this.color){case l.Gray_Bounce:case l.Gray_TurnLeft:case l.Gray_TurnRight:return 0===o.length?this.position.anchor:this.FindOutputForAlwaysTurn(i,this.position.anchor,o,this.color===l.Gray_Bounce?0:this.color===l.Gray_TurnLeft?1:3);default:if(0===o.length)return;if(1===o.length)return o[0];{let i=t.TryGetSignal(this.position.anchor,this.color);return null!=i&&i!==this.position.anchor?i:-1!==o.indexOf(g.ReverseDirection(this.position.anchor))?g.ReverseDirection(this.position.anchor):void 0}}}draw(i,t,o){var n,e;const s=g.GetRealPosition(this.position,m),r=g.GetMidpoint(this.position,m),a=g.GetEntryRotation(this.position.anchor);let l,h;if(void 0===this.currentAnimationDefinition)l=this.sprite,h=!0;else{const i=t*this.currentAnimationDefinition.repeatCount%1,o=Math.floor(i*this.currentAnimationDefinition.numFrames);h=!(null!==(n=this.currentAnimationDefinition.overridesRotation)&&void 0!==n&&n),l=this.assets.carAnimations.getSprite(new c.a(18*(this.currentAnimationDefinition.sourceOffset[0]+o),18*this.currentAnimationDefinition.sourceOffset[1]),new c.a(18,18),new c.a(.5,.5))}if(this.isCrashed()){let n;n=void 0!==this.nextPosition?this.nextPosition:void 0!==(null===(e=this.crashedAt)||void 0===e?void 0:e.anchor)?this.crashedAt:{position:c.a.add(this.position.position,g.AnchorToTileMove(g.ReverseDirection(this.position.anchor))),anchor:this.position.anchor};const d=void 0===this.crashedAt.anchor?.4:.9,p=this.hasPlayedCrashAnimation?d:t<d?t:d,u=g.GetRealPosition(n,m);let x;x=void 0!==this.parkedAt?r:c.a.Bezier([s,r,u],p),x=x.AddWith(o);const y=g.GetEntryRotation(n.anchor),f=w.a.relativeAngle(a,y);if(l.draw(i,x,l.sourceSize,h?a-f*p:a),this.hasPlayedCrashAnimation||t>p)for(const t of this.flameRenders)t.anim.draw(i,c.a.add(x,t.offset),t.anim.source.sourceSize)}else if(void 0!==this.nextPosition){const n=g.GetRealPosition(this.nextPosition,m),e=c.a.Bezier([s,r,n],t).AddWith(o),d=g.GetEntryRotation(this.nextPosition.anchor),p=w.a.relativeAngle(a,d);l.draw(i,e,l.sourceSize,h?a-p*t:a)}else if(void 0!==this.parkedAt)if(this.parkAnimationComplete)l.draw(i,r,l.sourceSize,a);else{const n=c.a.Bezier([s,r,r],t).AddWith(o);l.draw(i,n,l.sourceSize,a)}}}const L=new c.a(88,88),B=[new c.a(108,88),new c.a(88,108),new c.a(68,88),new c.a(88,68)];new c.a(0,64);class S{constructor(i,t,o,n,e){this.tile=i,this.signal=t,this.assets=o,this.dx=n,this.dy=e,this.selectedColor=l.Red,this.colorButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(0,0),new c.a(63,32)),this.colorButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(0,32),new c.a(63,32)),this.sqButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(63,0),new c.a(16,16)),this.sqButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(63,16),new c.a(16,16)),this.roundButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(63,32),new c.a(16,16)),this.roundButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(63,48),new c.a(16,16)),this.arrowIndicators=[];for(let i=0;i<4;i++)this.arrowIndicators.push(this.assets.ctrlPanelElements.getSprite(new c.a(79,16*i),new c.a(16,16)))}tryHandleClick(i,t){if(i<this.dx||t<this.dy||i>this.dx+128||t>this.dy+128)return!1;if(i-=this.dx,t-=this.dy,i<=64){const i=Math.floor(t/32);return this.selectedColor=i,!0}if(t>=64){if(i>=L.x&&t>=L.y&&i<=L.x+16&&t<=L.y+16)this.signal.clearInstructions(this.selectedColor);else{let o;if(i-=64,t-=64,i-=32,t-=32,o=Math.abs(i)>=Math.abs(t)?i<0?y.Left:y.Right:t<0?y.Top:y.Bottom,-1===this.signal.definition.outputDirs.indexOf(o))return!0;this.signal.setInstruction(this.selectedColor,o)}return!0}return!0}draw(i){var t;this.assets.ctrlPanelBackground.image||console.log("ASSETS IMAGE: "+this.assets.ctrlPanelBackground.image),i.drawImage(this.assets.ctrlPanelBackground.image,this.dx,this.dy);for(let t=0;t<4;t++){(this.selectedColor===t?this.colorButtonDown:this.colorButtonUp).draw(i,new c.a(this.dx+1,this.dy+32*t),new c.a(63,32)),this.assets.carImageAtlas.getSprite(new c.a(18*t,0),new c.a(18,18)).draw(i,new c.a(this.dx+1+31.5-8,this.dy+32*t+16-8),new c.a(18,18))}const o=null!==(t=this.signal.getInstruction(this.selectedColor))&&void 0!==t?t:-1;for(let t=0;t<4;t++){(o===t?this.sqButtonDown:this.sqButtonUp).draw(i,new c.a(this.dx+B[t].x,this.dy+B[t].y),new c.a(16,16)),this.arrowIndicators[t].draw(i,new c.a(this.dx+B[t].x,this.dy+B[t].y),new c.a(16,16))}(-1===o?this.roundButtonDown:this.roundButtonUp).draw(i,new c.a(this.dx+L.x,this.dy+L.y),new c.a(16,16)),this.tile.draw_offgrid(i,this.dx+72,this.dy+8,48,this.assets)}}var b=[[u.LR,1023],[u.TB,1023],[u.RB,u.RB|u.LB|u.TR|u.RR|u.BB],[u.RT,u.RT|u.LT|u.RB|u.RR|u.TT],[u.BL,u.BL|u.RB|u.TL|u.BB|u.LL],[u.LT,u.LT|u.RT|u.LB|u.LL|u.TT],[u.RR,0],[u.BB,0],[u.LL,0],[u.TT,0]],A=[[u.LR,u.LR],[u.TB,u.TB],[u.RB,u.RB],[u.RT,u.RT],[u.BL,u.BL],[u.LT,u.LT],[u.RR,0],[u.BB,0],[u.LL,0],[u.TT,0]];const C=[new c.a(1,0),new c.a(0,1),new c.a(-1,0),new c.a(0,-1)];class O{constructor(i){this.definition=i,this.currentSignals=new Map}disable(i){this.isDisabled=!0;for(let t=0;t<4;t++)for(let o=0;o<4;o++)1==(1&i)&&this.setInstruction(t,o),i>>=1}getInstruction(i){if(this.currentSignals.has(i))return this.currentSignals.get(i)}setInstruction(i,t){this.currentSignals.set(i,t)}clearInstructions(i){null==i?this.currentSignals.clear():this.currentSignals.delete(i)}getRenderPosition(i){return g.GetMidpoint({position:i},m).SubtractWith(3,3).AddWith(this.definition.dx,this.definition.dy)}draw(i,t,o,n){const e=g.GetMidpoint({position:t},m).SubtractWith(3,3);o.render(i,e.x+this.definition.dx,e.y+this.definition.dy,6,6,this.isDisabled?1:0,0);const s=[0,0,0,0];for(var[r,a]of this.currentSignals.entries()){const t=s[a]++,o=C[a],l=c.a.add(e,c.a.Multiply(o,6+3*t)).AddWith(this.definition.dx,this.definition.dy);n.render(i,l.x,l.y,6,6,a,r)}}draw_offgrid(i,t,o,n,e){const s=t.AddWith(c.a.Multiply(o,.5,.5)).SubtractWith(3,3);n.render(i,s.x+this.definition.dx,s.y+this.definition.dy,6,6,this.isDisabled?1:0,0);const r=[0,0,0,0];for(var[a,l]of this.currentSignals.entries()){const t=r[l]++,o=C[l],n=c.a.add(s,c.a.Multiply(o,6+3*t)).AddWith(this.definition.dx,this.definition.dy);e.render(i,n.x,n.y,6,6,l,a)}}}class P{constructor(i,t,o){this.definition=i,this.image=t,this.endpointColor=o,this.signals=[];for(const t of i.signals)this.signals.push(new O(t));this.overdrawAnchors=3===this.definition.tileId?[y.Left,y.Right]:[]}DisableSignal(i,t){this.signals[i].disable(t)}TryGetSignal(i,t){for(const o of this.signals)if(-1!==o.definition.inputDirs.indexOf(i))return o.getInstruction(t)}CheckColisions(i,t){if(void 0===i.nextPosition||void 0===t.nextPosition)return!0;let o=g.GetConnection(i.position.anchor,g.ReverseDirection(i.nextPosition.anchor)),n=g.GetConnection(t.position.anchor,g.ReverseDirection(t.nextPosition.anchor));for(const[i,t]of this.definition.isCrossover?A:b){if(i===o&&(t&n)>0)return!0;if(i===n&&(t&o)>0)return!0}return!1}GetPositionAdjust(i,t,o){if(3===this.definition.tileId&&!(i!==y.Left&&i!==y.Right||t!==y.Left&&t!==y.Right)){let i=2*o;return i>1&&(i=1-i%1),i=Math.pow(i,.5),new c.a(0,5*-i)}return new c.a(0,0)}draw(i,t,o,n){this.image.draw(i,new c.a(64*t,64*o),m);for(const e of this.signals)e.draw(i,new c.a(t,o),n.signalHubSheet,n.signalArrowsImage);if(this.definition.isStop&&void 0!==this.endpointColor&&null!==this.endpointColor){const e=(64-n.spawnRingSheet.spriteWidth)/2;n.spawnRingSheet.render(i,64*t+e,64*o+e,n.spawnRingSheet.spriteWidth,n.spawnRingSheet.spriteHeight,this.endpointColor,1)}}overdraw(i,t,o,n){3===this.definition.tileId&&n.getTrackSprite(39).draw(i,new c.a(64*t,64*o),m)}draw_offgrid(i,t,o,n,e){this.image.draw(i,new c.a(t,o),new c.a(n,n));for(const s of this.signals)s.draw_offgrid(i,new c.a(t,o),new c.a(n,n),e.signalHubSheet,e.signalArrowsImage)}}class E{constructor(i){this.connections=[];for(let t=0;t<4;t++){const o=[];for(let n=t;n<4;n++)o.push((1&i)>0),i>>=1;this.connections.push(o)}}connection(i,t,o){const n=g.AnchorToIndex(i),e=g.AnchorToIndex(t),s=Math.min(n,e),r=Math.max(n,e);if(void 0===o)return this.connections[s][r-s];this.connections[s][r-s]=o}allConnections(i){let t=[];for(const o of g.AllAnchors)this.connection(i,o)&&t.push(o);return t}}class k{constructor(i,t,o=!1,n=!1,e=!1){this.tileId=i,this.isStop=n,this.isCrossover=e,this.connections=new E(t),this.signals=[];for(const i of g.AllAnchors){const t=this.connections.allConnections(i);if(t.length>1){let n;o||0===this.signals.length?(n=Object.assign(Object.assign({},M(o,i)),{inputDirs:[],outputDirs:[]}),this.signals.push(n)):n=this.signals[0],n.inputDirs.push(i);for(const i of t)n.outputDirs.push(i)}}}}function M(i,t){if(!i)return{dx:0,dy:0};const o=g.AnchorToTileMove(t).MultWith(16);return{dx:o.x,dy:o.y}}var _=[null,new k(1,u.TB),new k(2,u.LR),new k(3,u.TB|u.LR,!1,!1,!0),new k(4,u.RT),new k(5,u.RB),new k(6,u.LB),new k(7,u.LT),new k(8,u.RT|u.RB,!0),new k(9,u.RB|u.LB,!0),new k(10,u.LT|u.LB,!0),new k(11,u.LT|u.RT,!0),new k(12,u.RT|u.RB|u.TB),new k(13,u.RB|u.LB|u.LR),new k(14,u.LT|u.LB|u.TB),new k(15,u.LT|u.RT|u.LR),new k(16,0,!1,!0),new k(17,0,!1,!0),new k(18,0,!1,!0),new k(19,0,!1,!0),new k(20,u.LT|u.RB),new k(21,u.RT|u.LB),new k(22,u.RB|u.RT|u.LB|u.LT|u.LR|u.TB),new k(23,u.RB|u.RT|u.LB|u.LT,!0),new k(24,u.RR),new k(25,u.BB),new k(26,u.LL),new k(27,u.TT),new k(28,u.RR|u.TT),new k(29,u.BB|u.RR),new k(30,u.LL|u.BB),new k(31,u.TT|u.LL),new k(32,u.RR|u.TT|u.BB),new k(33,u.BB|u.RR|u.LL),new k(34,u.LL|u.BB|u.TT),new k(35,u.TT|u.LL|u.RR),new k(36,u.RR|u.LL),new k(37,u.BB|u.TT),new k(38,u.RR|u.LL|u.BB|u.TT),null,new k(39,u.RT|u.LL,!1,!1,!0),new k(40,u.RB|u.TT,!1,!1,!0),new k(41,u.LB|u.TT,!1,!1,!0),new k(42,u.LT|u.RR,!1,!1,!0),new k(43,u.RT|u.BB,!1,!1,!0),new k(44,u.RB|u.LL,!1,!1,!0),new k(45,u.LB|u.RR,!1,!1,!0),new k(46,u.LT|u.BB,!1,!1,!0),new k(47,u.RT|u.LL|u.BB,!1,!1,!0),new k(48,u.RB|u.TT|u.LL,!1,!1,!0),new k(49,u.LB|u.TT|u.RR,!1,!1,!0),new k(50,u.LT|u.RR|u.BB,!1,!1,!0)];class D{constructor(i,t,o){this.level=i,this.canvas=t,this.assets=o,this.map=[];for(let t=0;t<i.width;t++){let t=[];for(let o=0;o<i.height;o++)t.push(null);this.map.push(t)}let n=new Array(i.mapdata.length);for(const t of i.endpoints)n[t.position.x+t.position.y*i.width]=t.color;for(let t=0;t<i.mapdata.length;t++){let e=t%i.width,s=Math.floor(t/i.width);const r=_[i.mapdata[t]];this.map[e][s]=null===r?null:new P(r,o.getTrackSprite(r.tileId),n[t])}for(let t=0;t<i.disableSignals.length;t++)this.map[i.disableSignals[t].tile.x][i.disableSignals[t].tile.y].DisableSignal(i.disableSignals[t].signalIndex,i.disableSignals[t].forceSignals);this.ResetLevel()}tryGetOverlay(i,t){const o=new c.a(Math.floor(i.x/64),Math.floor(i.y/64)),n=this.map[o.x][o.y];if(null==n||0===n.signals.length)return;const e=Object(a.c)(n.signals,t=>c.a.subtract(t.getRenderPosition(o),i).LengthSq());if(e.isDisabled)return;const s=new c.a(64*o.x+64,64*o.y);return this.canvas.width/t-s.x<this.assets.ctrlPanelBackground.image.width&&(s.x=64*o.x-this.assets.ctrlPanelBackground.image.width),this.canvas.height/t-s.y<this.assets.ctrlPanelBackground.image.height&&(s.y=this.canvas.height/t-this.assets.ctrlPanelBackground.image.height),new S(n,e,this.assets,s.x,s.y)}ResetLevel(){this.cars=[];for(const i of this.level.spawns)i.color>=0?this.cars.push(new T(i.color,this.assets.carImageAtlas.getSprite(new c.a(18*i.color,0),v,new c.a(.5,.5)),g.EquivalentPosition({position:new c.a(i.position.x,i.position.y),anchor:i.direction}),this.assets)):this.cars.push(new T(i.color,this.assets.carImageAtlas.getSprite(new c.a(18*(3-i.color),0),v,new c.a(.5,.5)),g.EquivalentPosition({position:new c.a(i.position.x,i.position.y),anchor:i.direction}),this.assets));this.updateCars()}updateCars(){for(const i of this.cars)i.LogicTick(),i.isCrashed()||(void 0!==i.nextPosition&&(i.position=i.nextPosition),i.nextPosition=i.CalculateNextPosition(this));for(const[i,t]of Object(a.b)(this.cars,i=>i.position.position,(i,t)=>i.x===t.x&&i.y===t.y))for(let o=0;o<t.length;o++)for(let n=o+1;n<t.length;n++)this.map[i.x][i.y].CheckColisions(t[o],t[n])&&(t[o].crashHere(),t[n].crashHere());for(const i of this.cars){if(void 0===i.nextPosition)continue;const t=g.EquivalentPosition(i.nextPosition);for(const o of this.cars)i!==o&&void 0!==o.nextPosition&&t.anchor===o.nextPosition.anchor&&t.position.Equals(o.nextPosition.position)&&(i.crashAt(i.nextPosition),o.crashAt(o.nextPosition))}}draw(i,t,o){var n,e;for(const i of this.cars)i.EveryTick();for(let i=0;i<this.map.length;i++)for(let o=0;o<this.map[i].length;o++)null!==this.map[i][o]&&this.map[i][o].draw(t,i,o,this.assets);const s=[];for(const i of this.cars){const e=this.map[i.position.position.x][i.position.position.y],r=i.position.anchor,c=null===(n=i.nextPosition)||void 0===n?void 0:n.anchor,l=[i.position,i.nextPosition,g.EquivalentPosition(i.position),g.EquivalentPosition(i.nextPosition)];Object(a.a)(l,i=>void 0!==i&&-1!==this.map[i.position.x][i.position.y].overdrawAnchors.indexOf(i.anchor))?s.push(i):i.draw(t,o,e.GetPositionAdjust(r,c,o))}for(let i=0;i<this.map.length;i++)for(let o=0;o<this.map[i].length;o++)null!==this.map[i][o]&&this.map[i][o].overdraw(t,i,o,this.assets);for(const i of s){const n=this.map[i.position.position.x][i.position.position.y],s=i.position.anchor,r=null===(e=i.nextPosition)||void 0===e?void 0:e.anchor;i.draw(t,o,n.GetPositionAdjust(s,r,o))}}}var I=o(92),G=o.p+"92b0680d8018abdf6ab4dce2cb8e7f4d.png",F=o.p+"40546b074d24707026ba482019c4d3b4.png",z=o.p+"068a4cb9e7cd5cde1c23e8fb17e230c2.png",W=o.p+"48175440e29eba81547fb6a3aae3f6ea.png",q=o.p+"c8060df9573385c396cd3cb0a91f4424.png",j=o.p+"f50a8f7fc9e146163272568decddbc2a.png",N=o.p+"560f633704b347d793db51e0a3fb7475.png",H=o.p+"dbe0d35db913eb26c862f06ff1aad1b0.png",U=o.p+"41279bc0b13b415202281fa495c04151.png",J=o(83),Y=o(37),K=o(25),X=o(84);class Q{constructor(i){this.color=i,this.animations={}}addAnimation(i){if("string"==typeof i.conditions)this.animations[i.conditions]=i;else for(const t of i.conditions)this.animations[t]=i}}var V=o(94);class Z{constructor(i){this.trackImageAtlas=new J.b(G,i.registerAssetLoadCallback()),this.carImageAtlas=new J.b(F,i.registerAssetLoadCallback()),this.signalArrowsImage=new K.a(6,6,z,i.registerAssetLoadCallback()),this.signalHubSheet=new K.a(6,6,W,i.registerAssetLoadCallback()),this.ctrlPanelBackground=new Y.a(q,i.registerAssetLoadCallback()),this.ctrlPanelElements=new J.b(N,i.registerAssetLoadCallback()),this.spawnRingSheet=new K.a(48,48,U,i.registerAssetLoadCallback()),this.carAnimations=new J.b(H,i.registerAssetLoadCallback()),this.fire=new X.a(new J.b(j,i.registerAssetLoadCallback()),new c.a(0,0),new c.a(8,16),4),this.animationControllers={};for(const i of h)this.animationControllers[i]=new Q(i);for(const i of V)this.animationControllers[i.carType].addAnimation(i)}getTrackSprite(i){const t=i%4,o=Math.floor(i/4);return this.trackImageAtlas.getSprite(new c.a(64*t,64*o),m)}}var $=0;class ii{constructor(i){this.canvas=i,this.runnerID=$++,console.log("Create runner "+this.runnerID),Object(r.b)(i,1024,768),this.ctx=i.getContext("2d"),this.ctx.save(),this.repaintTimer=-1,this.interpFrameCount=0,this.isRunning=!1,this.isDestroyed=!1,this.boundEventListener=this.handleMouseEvent.bind(this),this.overlay=void 0,i.addEventListener("click",this.boundEventListener)}handleKeyEvent(i){return"escape"===i.key&&(this.overlay=void 0,!0)}handleMouseEvent(i){var t,o;if(this.isRunning)return;const n=new c.a(i.offsetX/this.canvasScale,i.offsetY/this.canvasScale);null!==(o=null===(t=this.overlay)||void 0===t?void 0:t.tryHandleClick(n.x,n.y))&&void 0!==o&&o||(this.overlay=this.gameState.tryGetOverlay(n,this.canvasScale))}start(){const i=new s.a;this.assets=new Z(i),i.onAllFinished(this.loadComplete.bind(this))}toggleRunning(){this.gameState.ResetLevel(),this.interpFrameCount=0,this.isRunning=!this.isRunning,this.overlay=void 0}loadLevel(i){console.log("LOAD"),this.ctx.restore(),this.ctx.save();const t=64*i.width,o=64*i.height;console.log(2*t+", 1024"),2*t<=1024&&2*o<=1024?(Object(r.b)(this.canvas,2*t,2*o),Object(r.a)(this.ctx),this.ctx.scale(2,2),this.canvasScale=2):(Object(r.b)(this.canvas,t,o),this.canvasScale=1),this.gameState=new D(i,this.canvas,this.assets),this.interpFrameCount=0,this.overlay=void 0}loadComplete(){this.gameState=new D(I[0],this.canvas,this.assets),this.loadLevel(I[0]),this.runTick()}runTick(){this.isDestroyed||(this.tick(),this.draw(),this.repaintTimer=requestAnimationFrame(this.runTick.bind(this)))}tick(){this.isRunning?(this.interpFrameCount++,this.interpFrameCount>=40&&(this.interpFrameCount=0,this.gameState.updateCars())):this.interpFrameCount=0}draw(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.gameState.draw(this.canvas,this.ctx,this.interpFrameCount/40),this.ctx.restore(),void 0!==this.overlay&&this.overlay.draw(this.ctx)}stop(){-1!==this.repaintTimer&&cancelAnimationFrame(this.repaintTimer),this.isDestroyed=!0,this.canvas.removeEventListener("click",this.boundEventListener),console.log("Destroy runner "+this.runnerID)}}var ti=o.p+"a787dffd8ab2ddec59191932b3f33b53.png";function oi(i){const t=e.useRef();return e.useEffect(()=>{if(void 0===t.current||void 0===i.previewSheet)return;Object(r.b)(t.current,16*i.level.width,16*i.level.height);const o=t.current.getContext("2d");o.clearRect(0,0,16*i.level.width,16*i.level.height);let n=0;for(var e=0;e<i.level.height;e++)for(var s=0;s<i.level.width;s++){const t=i.level.mapdata[n++],r=Math.floor(t%4),a=Math.floor(t/4);i.previewSheet.render(o,16*s,16*e,16,16,r,a)}},[t.current]),e.createElement("div",{className:"flex row align-center",style:{border:"1px solid black",padding:"0 0 0 8px"},onClick:t=>i.onClick(t.nativeEvent)},e.createElement("span",null,i.level.id,": ",i.level.name),e.createElement("canvas",{ref:t}))}function ni(){const i=e.useRef(),t=function(i,t){const[o,n]=Object(e.useState)(void 0);return Object(e.useEffect)(()=>{console.log("Reload item");const t=new s.a,o=i(t.registerAssetLoadCallback());t.onAllFinished(()=>{n(o)})},t),o}(i=>new K.a(16,16,ti,i),[]),[o,n]=e.useState(void 0),[r,a]=e.useState(!1);return e.useEffect(()=>{if(void 0===i.current)return;const t=new ii(i.current);return n(t),t.start(),()=>t.stop()},[i.current,t]),void 0===t?e.createElement("div",null,"Loading..."):e.createElement("div",{className:"flex row"},e.createElement("canvas",{ref:i,tabIndex:0,onKeyDown:i=>{var t;32===i.keyCode?(null==o||o.toggleRunning(),i.preventDefault(),i.stopPropagation()):null!==(t=null==o?void 0:o.handleKeyEvent(i.nativeEvent))&&void 0!==t&&t&&(i.preventDefault(),i.stopPropagation())}}),e.createElement("div",{className:"flex col"},e.createElement("button",{onClick:i=>{o&&o.toggleRunning()}},"Start/Reset"),e.createElement("button",{onClick:()=>a(!r)},r?"Hide Level Select":"Show Level Select"),r?I.map(i=>e.createElement(oi,{key:i.id,level:i,previewSheet:t,onClick:t=>{null==o||o.loadLevel(i),t.preventDefault(),t.stopImmediatePropagation()}})):e.createElement(e.Fragment,null)))}}}]);
//# sourceMappingURL=9.bundle.js.map