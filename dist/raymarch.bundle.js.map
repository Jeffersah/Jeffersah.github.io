{"version":3,"file":"raymarch.bundle.js","mappings":"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","sources":["webpack://trading-game/./src/projects/common/3d/Matrix4.ts","webpack://trading-game/./src/projects/common/3d/Point3.ts","webpack://trading-game/./src/projects/common/3d/Quaternion.ts","webpack://trading-game/./src/projects/common/3d/Vector.ts","webpack://trading-game/./src/projects/common/input/KeyState.ts","webpack://trading-game/./src/projects/common/input/KeyWatcher.ts","webpack://trading-game/./src/projects/common/input/KeyboardManager.ts","webpack://trading-game/./src/projects/raymarch/debuilder/GlslValue.ts","webpack://trading-game/./src/projects/raymarch/debuilder/DistanceEstimatePrimitives.ts","webpack://trading-game/./src/projects/raymarch/index.ts","webpack://trading-game/./src/projects/raymarch/debuilder/DistanceEstimateBuilder.ts","webpack://trading-game/./src/views/projects/raymarch/RaymarchComponent.tsx","webpack://trading-game/./src/projects/wave-collapse/assets/TileInfo.ts","webpack://trading-game/./src/projects/wave-collapse/AdjacencyMap.ts","webpack://trading-game/./src/projects/wave-collapse/assets/isotiles.png","webpack://trading-game/./src/projects/wave-collapse/Generator.ts","webpack://trading-game/./src/projects/wave-collapse/index.ts","webpack://trading-game/./src/views/projects/wave-collapse/WaveCollapseComponent.tsx"],"sourcesContent":["import Point3 from \"./Point3\";\r\n\r\nconst identity = [\r\n    [1, 0, 0, 0],\r\n    [0, 1, 0, 0],\r\n    [0, 0, 1, 0],\r\n    [0, 0, 0, 1]\r\n];\r\n\r\nexport default class Matrix4 {\r\n    components: [\r\n        [number, number, number, number],\r\n        [number, number, number, number],\r\n        [number, number, number, number],\r\n        [number, number, number, number]\r\n    ];\r\n\r\n    constructor(identity: boolean = true) {\r\n        if(identity) {\r\n            this.components = [\r\n                [1, 0, 0, 0],\r\n                [0, 1, 0, 0],\r\n                [0, 0, 1, 0],\r\n                [0, 0, 0, 1]\r\n            ];\r\n        } else {\r\n            this.components = [\r\n                [0, 0, 0, 0],\r\n                [0, 0, 0, 0],\r\n                [0, 0, 0, 0],\r\n                [0, 0, 0, 1]\r\n            ];\r\n        }\r\n    }\r\n\r\n    public transform(p: Point3) : Point3 {\r\n        let x = this.multRow(this.components[0], p);\r\n        let y = this.multRow(this.components[1], p);\r\n        let z = this.multRow(this.components[2], p);\r\n        let w = this.multRow(this.components[3], p);\r\n        return new Point3(x/w, y/w, z/w);\r\n    }\r\n\r\n    public mult(other: Matrix4): Matrix4 {\r\n        const output = new Matrix4();\r\n        for(let row = 0; row < 4; row++) {\r\n            for(let col = 0; col < 4; col ++) {\r\n                output.components[row][col] = 0;\r\n                for(let i = 0; i < 4; i++) {\r\n                    output.components[row][col] +=\r\n                        this.components[row][i] *\r\n                        other.components[i][col];\r\n                }\r\n            }\r\n        }\r\n\r\n        return output;\r\n    }\r\n\r\n    private multRow(row: [number, number, number, number], p: Point3) {\r\n        return row[0] * p.x + row[1] * p.y + row[2] * p.z + row[3];\r\n    }\r\n    \r\n    public colMajor(): number[] {\r\n        let output = new Array(16);\r\n        let i = 0;\r\n        for(let row = 0; row < 4; row++) {\r\n            for(let col = 0; col < 4; col++) {\r\n                output[i++] = this.components[row][col];\r\n            }\r\n        }\r\n        return output;\r\n    }\r\n    \r\n    public rowMajor(): number[] {\r\n        let output = new Array(16);\r\n        let i = 0;\r\n        for(let col = 0; col < 4; col++) {\r\n            for(let row = 0; row < 4; row++) {\r\n                output[i++] = this.components[row][col];\r\n            }\r\n        }\r\n        return output;\r\n    }\r\n\r\n    public static translate(pt: Point3) {\r\n        let output = new Matrix4();\r\n        output.components[0][3] = pt.x;\r\n        output.components[1][3] = pt.y;\r\n        output.components[2][3] = pt.z;\r\n        return output;\r\n    }\r\n}","export default class Point3 {\r\n\r\n    static zero(): Point3  {\r\n        return new Point3(0,0,0);\r\n    }\r\n\r\n    constructor(public x: number, public y: number, public z: number) {\r\n\r\n    }\r\n    public lengthSq(): number {\r\n        return this.dot(this);\r\n    }\r\n\r\n    public length(): number {\r\n        return Math.sqrt(this.lengthSq());\r\n    }\r\n\r\n    public clone(): Point3 {\r\n        return new Point3(this.x, this.y, this.z);\r\n    }\r\n\r\n    public dot(other: Point3): number {\r\n        return this.x * other.x + this.y * other.y + this.z * other.z;\r\n    }\r\n\r\n    public normalize(): Point3 {\r\n        let len = this.length();\r\n        return this.div(len);\r\n    }\r\n\r\n    public mult(p: Point3): Point3\r\n    public mult(x: number, y: number, z: number): Point3\r\n    public mult(s: number): Point3\r\n    public mult(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz, true);\r\n        return new Point3(x * this.x, y * this.y, z * this.z);\r\n    }\r\n\r\n    \r\n    public div(p: Point3): Point3\r\n    public div(x: number, y: number, z: number): Point3\r\n    public div(s: number): Point3\r\n    public div(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz, true);\r\n        return new Point3(this.x / x, this.y / y, this.z / z);\r\n    }\r\n\r\n    public add(p: Point3): Point3\r\n    public add(x: number, y: number, z: number): Point3\r\n    public add(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz);\r\n        return new Point3(this.x + x, this.y + y, this.z + z);\r\n    }\r\n\r\n    public sub(p: Point3): Point3\r\n    public sub(x: number, y: number, z: number): Point3\r\n    public sub(pxs: Point3 | number, iy?: number, iz?: number): Point3 {\r\n        let {x, y, z} = splitArgs(pxs, iy, iz);\r\n        return new Point3(this.x - x, this.y - y, this.z - z);\r\n    }\r\n}\r\n\r\nfunction splitArgs(pxs: Point3 | number, y?: number, z?: number, allowSingle: boolean = false): {x: number, y: number, z: number} {\r\n    if(y === undefined) {\r\n        if(!allowSingle || (pxs as Point3).x !== undefined) {\r\n            return (pxs as Point3);\r\n        } else {\r\n            return { x: pxs as number, y: pxs as number, z: pxs as number };\r\n        }\r\n    }\r\n    else {\r\n        return { x: pxs as number, y, z };\r\n    }\r\n}","import Vector from './Vector';\r\nimport { vec2 } from 'gl-matrix';\r\nimport Matrix4 from './Matrix4';\r\n\r\nexport default class Quaternion {\r\n    constructor(public real: number, public i: number, public j: number, public k: number) {\r\n    }\r\n\r\n    public inverse(): Quaternion {\r\n        const denom = Quaternion.Dot(this, this);\r\n        return new Quaternion(this.real / denom, -this.i / denom, -this.j / denom, -this.k / denom);\r\n    }\r\n\r\n    public static Dot(a: Quaternion, b: Quaternion): number {\r\n        return a.real * b.real + a.i * b.i + a.j * b.j + a.k * b.k;\r\n    }\r\n\r\n    public static axisRotation(axis: Vector, radians: number): Quaternion {\r\n        const cos = Math.cos(radians / 2);\r\n        const sin = Math.sin(radians / 2);\r\n        const len = axis.length();\r\n\r\n        return new Quaternion(cos, sin * axis.x / len, sin * axis.y / len, sin * axis.z / len);\r\n    }\r\n\r\n    public static multiply(a: Quaternion, b: Quaternion) {\r\n        return new Quaternion (\r\n            a.real * b.real - a.i * b.i - a.j * b.j - a.k * b.k,\r\n            a.real * b.i + a.i * b.real + a.j * b.k - a.k * b.j,\r\n            a.real * b.j - a.i * b.k + a.j * b.real + a.k * b.i,\r\n            a.real * b.k + a.i * b.j - a.j * b.i + a.k * b.real\r\n        );\r\n    }\r\n\r\n    public applyTransform(point: Quaternion): Quaternion;\r\n    public applyTransform(vec3: Vector): Vector;\r\n    public applyTransform(point: Quaternion|Vector): Quaternion|Vector {\r\n        if ((point as any).real !== undefined) {\r\n            return Quaternion.multiply(this, Quaternion.multiply(point as Quaternion, this.inverse()));\r\n        }\r\n        else {\r\n            const inputQ = new Quaternion(0, (point as Vector).x, (point as Vector).y, (point as Vector).z);\r\n            const qOut = Quaternion.multiply(this, Quaternion.multiply(inputQ, this.inverse()));\r\n            return new Vector(qOut.i, qOut.j, qOut.k);\r\n        }\r\n    }\r\n\r\n    // Stolen from https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToMatrix/index.htm\r\n    public toMatrix():Matrix4 {\r\n        const mtx = new Matrix4();\r\n        mtx.components[0][0] = 1 - 2 * this.j * this.j - 2 * this.k * this.k;\r\n        mtx.components[0][1] = 2 * this.i * this.j - 2 * this.k * this.real;\r\n        mtx.components[0][2] = 2 * this.i * this.k + 2 * this.j * this.real;\r\n        \r\n        mtx.components[1][0] = 2 * this.i * this.j + 2 * this.k * this.real;\r\n        mtx.components[1][1] = 1 - 2 * this.i * this.i - 2 * this.k * this.k;\r\n        mtx.components[1][2] = 2 * this.j * this.k - 2 * this.i * this.real;\r\n        \r\n        mtx.components[2][0] = 2 * this.i * this.k - 2 * this.j * this.real;\r\n        mtx.components[2][1] = 2 * this.j * this.k + 2 * this.i * this.real;\r\n        mtx.components[2][2] = 1 - 2 * this.i * this.i - 2 * this.j * this.j;\r\n\r\n        return mtx;\r\n    }\r\n}","\r\nexport default class Vector {\r\n    constructor(public x: number, public y: number, public z: number) {\r\n    }\r\n\r\n    dot(other: Vector) {\r\n        return this.x * other.x + this.y * other.y + this.z * other.z;\r\n    }\r\n\r\n    length() {\r\n        return Math.sqrt(this.lengthSq());\r\n    }\r\n\r\n    lengthSq() {\r\n        return this.x * this.x + this.y * this.y + this.z * this.z;\r\n    }\r\n\r\n    normalize() {\r\n        return this.multiply(1 / this.lengthSq());\r\n    }\r\n    negate() {\r\n        return new Vector(-this.x, -this.y, -this.z);\r\n    }\r\n\r\n    multiply(scale: number): Vector;\r\n    multiply(xscale: number, yscale: number, zscale: number): Vector;\r\n    multiply(scale: Vector): Vector;\r\n    multiply(sx: number | Vector, sy ?: number, sz ?: number): Vector {\r\n        if(!isVector(sx))\r\n        {\r\n            sy = sy ?? <number>sx;\r\n            sz = sz ?? <number>sx;\r\n        }\r\n        var [x, y, z] = Vector.getxyz(sx, sy, sz);\r\n        return new Vector(this.x * x, this.y * y, this.z * z);\r\n    }\r\n\r\n    add(dx: number, dy: number, dz: number): Vector;\r\n    add(v: Vector): Vector;\r\n    add(dx: number | Vector, dy ?: number, dz ?: number): Vector {\r\n        var [x, y, z] = Vector.getxyz(dx, dy, dz);\r\n        return new Vector(this.x + x, this.y + y, this.z + z);\r\n    }\r\n\r\n    subtract(dx: number, dy: number, dz: number): Vector;\r\n    subtract(v: Vector): Vector;\r\n    subtract(dx: number | Vector, dy ?: number, dz ?: number): Vector {\r\n        var [x, y, z] = Vector.getxyz(dx, dy, dz);\r\n        return new Vector(this.x - x, this.y - y, this.z - z);\r\n    }\r\n\r\n    private static getxyz(x: number | Vector, y?: number, z?: number): [number, number, number] {\r\n        if(isVector(x)) {\r\n            return [x.x, x.y, x.z];\r\n        }\r\n        else {\r\n            return [x, y, z];\r\n        }\r\n    }\r\n}\r\n\r\nfunction isVector(x: number | Vector) : x is Vector {\r\n    return (<any>x).x !== undefined;\r\n}","import { IKeyChange } from './KeyWatcher';\r\n\r\nexport default class KeyState {\r\n    constructor(public keys: string[], public changes: IKeyChange[]) {\r\n\r\n    }\r\n\r\n    public isKeyDown(key: string) {\r\n        return this.keys.indexOf(key) !== -1;\r\n    }\r\n\r\n    public isKeyUp(key: string) {\r\n        return this.keys.indexOf(key) === -1;\r\n    }\r\n}","import KeyState from './KeyState';\r\n\r\nexport interface IKeyChange {\r\n    key: string;\r\n    change: 'press'|'release';\r\n}\r\n\r\nexport default class KeyWatcher {\r\n    downKeys: string[];\r\n    changes: IKeyChange[];\r\n\r\n    constructor(public attachedElement: HTMLElement, private logKeyNames?: boolean) {\r\n        if  (this.logKeyNames === undefined) {\r\n            this.logKeyNames = false;\r\n        }\r\n        attachedElement.addEventListener('keydown', k => this.onKeyDown(k));\r\n        attachedElement.addEventListener('keyup', k => this.onKeyUp(k));\r\n\r\n        this.downKeys = [];\r\n        this.changes = [];\r\n    }\r\n\r\n    private onKeyDown(key: KeyboardEvent) {\r\n        if (this.logKeyNames) {\r\n            // tslint:disable-next-line: no-console\r\n            console.log(key.key);\r\n        }\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        if (idx === -1) {\r\n            this.changes.push({ key: key.key, change: 'press' });\r\n            this.downKeys.push(key.key);\r\n        }\r\n    }\r\n\r\n    private onKeyUp(key: KeyboardEvent) {\r\n        this.changes.push({ key: key.key, change: 'release' });\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        this.downKeys.splice(idx, 1);\r\n    }\r\n\r\n    public Update(): KeyState {\r\n        const storeKeys = this.downKeys;\r\n        const storeChanges = this.changes;\r\n\r\n        this.downKeys = storeKeys.slice();\r\n        this.changes = [];\r\n\r\n        return new KeyState(storeKeys, storeChanges);\r\n    }\r\n}","import KeyWatcher, { IKeyChange } from './KeyWatcher';\r\nimport KeyState from './KeyState';\r\n\r\nexport default class KeyboardManager {\r\n\r\n    watcher: KeyWatcher;\r\n    prvState: KeyState;\r\n    currentState: KeyState;\r\n\r\n    constructor(element: HTMLElement, logKeyNames?: boolean) {\r\n        this.watcher = new KeyWatcher(element, logKeyNames);\r\n        this.prvState = this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public update(): void {\r\n        this.prvState = this.currentState;\r\n        this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public isKeyDown(key: string): boolean {\r\n        return this.currentState.isKeyDown(key);\r\n    }\r\n\r\n    public isKeyUp(key: string): boolean {\r\n        return this.currentState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyPressed(key: string): boolean {\r\n        return this.currentState.isKeyDown(key) && this.prvState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyReleased(key: string): boolean {\r\n        return this.currentState.isKeyUp(key) && this.prvState.isKeyDown(key);\r\n    }\r\n\r\n    public changes(): IKeyChange[] {\r\n        return this.currentState.changes;\r\n    }\r\n}","export type GlslConstant = number | GlslTimeVariable;\r\n\r\nexport function GlslSin(rate: number, min?: number, max?: number): GlslTimeVariable {\r\n    const useMin = min === undefined ? -1 : min;\r\n    const useMax = max === undefined ? 1 : max;\r\n    return new GlslTimeVariable('sin', useMin, useMax, rate);\r\n}\r\n\r\nexport function GlslCos(rate: number, min?: number, max?: number): GlslTimeVariable {\r\n    const useMin = min === undefined ? -1 : min;\r\n    const useMax = max === undefined ? 1 : max;\r\n    return new GlslTimeVariable('cos', useMin, useMax, rate);\r\n}\r\n\r\nexport class GlslTimeVariable {\r\n    constructor (public timeFunc: 'sin' | 'cos', public min: number, public max: number, public rate: number) {\r\n    }\r\n}\r\n\r\nfunction constIsTimeVar(c: GlslConstant): c is GlslTimeVariable {\r\n    return (c as GlslTimeVariable).timeFunc !== undefined;\r\n}\r\n\r\nexport function glslFloatConst(n: GlslConstant): string {\r\n    if (constIsTimeVar(n)) {\r\n        const range = (n.max - n.min);\r\n        const halfRange = range / 2;\r\n        const midp = (n.max + n.min) / 2;\r\n        const rate = `(t/60.0 * ${glslFloatConst(n.rate)})`;\r\n        switch (n.timeFunc) {\r\n            case 'sin': return `sin(${rate} * PI * 2.0) * ${glslFloatConst(halfRange)} + ${glslFloatConst(midp)}`;\r\n            case 'cos': return `cos(${rate} * PI * 2.0) * ${glslFloatConst(halfRange)} + ${glslFloatConst(midp)}`;\r\n        }\r\n    } else {\r\n        const asstr = n.toString();\r\n        if (asstr.indexOf('.') === -1) return asstr + '.0';\r\n        return asstr;\r\n    }\r\n}","import Vector from \"../../common/3d/Vector\";\r\nimport { glslFloatConst, GlslConstant } from \"./GlslValue\";\r\n\r\nexport default interface IDEPrimitive {\r\n    emitGlsl(): string;\r\n}\r\n\r\nexport function glslVec3Const(x: GlslConstant, y: GlslConstant, z: GlslConstant) {\r\n    return 'vec3(' + glslFloatConst(x) + ',' + glslFloatConst(y) + ',' + glslFloatConst(z)+')';\r\n}\r\n\r\nexport function glslUnitVec3Const(x: GlslConstant, y: GlslConstant, z: GlslConstant) {\r\n    return 'normalize(vec3(' + glslFloatConst(x) + ',' + glslFloatConst(y) + ',' + glslFloatConst(z) + '))';\r\n}\r\n\r\nexport class SphereDE implements IDEPrimitive {\r\n    constructor(public radius: number) { }\r\n    emitGlsl() {\r\n        return `return length(p) - ${glslFloatConst(this.radius)};\\r\\n`;\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class BoxDE implements IDEPrimitive {\r\n    constructor(public xlen: number, public ylen: number, public zlen: number) { }\r\n    emitGlsl() {\r\n        return `vec3 q = abs(p) - ${glslVec3Const(this.xlen, this.ylen, this.zlen)};\\r\\nreturn length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);`;\r\n    }\r\n}\r\n\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class BoundingBoxDE implements IDEPrimitive {\r\n    constructor(public xlen: number, public ylen: number, public zlen: number, public segLen: number) { }\r\n    emitGlsl() {\r\n        return `p = abs(p)-${glslVec3Const(this.xlen, this.ylen, this.zlen)};\r\nvec3 q = abs(p+${glslFloatConst(this.segLen)})-${glslFloatConst(this.segLen)};\r\nreturn min(min(\r\n    length(max(vec3(p.x,q.y,q.z),0.0))+min(max(p.x,max(q.y,q.z)),0.0),\r\n    length(max(vec3(q.x,p.y,q.z),0.0))+min(max(q.x,max(p.y,q.z)),0.0)),\r\n    length(max(vec3(q.x,q.y,p.z),0.0))+min(max(q.x,max(q.y,p.z)),0.0));\\r\\n`;\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class MengerSpongeDE implements IDEPrimitive {\r\n    constructor(private scale: number, private c: Vector, private maxIterations: number, private bailoutRange: number) {\r\n\r\n    }\r\n\r\n    emitGlsl() {\r\n        return `\r\nconst float bailout = ${glslFloatConst(this.bailoutRange)};\r\nconst vec3 C = ${glslVec3Const(this.c.x, this.c.y, this.c.z)};\r\nconst float scale = ${glslFloatConst(this.scale)};\r\nconst int MI = ${this.maxIterations};\r\nfloat r = dot(p, p);\r\nint numi = 0;\r\nfor(int i = 0; i < MI; i++){\r\n    numi = i;\r\n    if(r >= bailout) break;\r\n\r\n    // Rotate 1\r\n    \r\n    p = abs(p);\r\n    if(p.x - p.y < 0.0){ float x1=p.y; p.y=p.x; p.x=x1;}\r\n    if(p.x - p.z < 0.0){ float x1=p.z; p.z=p.x; p.x=x1;}\r\n    if(p.y - p.z < 0.0){ float y1=p.z; p.z=p.y; p.y=y1;}\r\n\r\n    // Rotate 2\r\n\r\n    p.xy = scale * p.xy - C.xy * (scale-1.0);\r\n    p.z=scale*p.z;\r\n    if(p.z>0.5*C.z*(scale-1.0)) p.z-=C.z*(scale-1.0);\r\n    \r\n    r = dot(p, p);\r\n}\r\nreturn (length(p)-2.0)*pow(scale,-float(numi));\\r\\n`;\r\n    }\r\n}\r\n\r\n\r\n// tslint:disable-next-line: max-classes-per-file\r\nexport class RotaryMengerSpongeDE implements IDEPrimitive {\r\n    constructor(private scale: number, private c: Vector, private maxIterations: number, private bailoutRange: number, private rRate: number) {\r\n\r\n    }\r\n\r\n    emitGlsl() {\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(this.rRate);\r\n        return `\r\nmat3 mx = mat3(\r\n    cos(${radians}), 0.0, -sin(${radians}),\r\n    0.0, 1.0, 0.0,\r\n    sin(${radians}), 0.0, cos(${radians})\r\n);\r\n\r\nconst float bailout = ${glslFloatConst(this.bailoutRange)};\r\nconst vec3 C = ${glslVec3Const(this.c.x, this.c.y, this.c.z)};\r\nconst float scale = ${glslFloatConst(this.scale)};\r\nconst int MI = ${this.maxIterations};\r\nfloat r = dot(p, p);\r\nint numi = 0;\r\nfor(int i = 0; i < MI; i++){\r\n    numi = i;\r\n    if(r >= bailout) break;\r\n\r\n    // Rotate 1\r\n    p = mx * p;\r\n    \r\n    p = abs(p);\r\n    if(p.x - p.y < 0.0){ float x1=p.y; p.y=p.x; p.x=x1;}\r\n    if(p.x - p.z < 0.0){ float x1=p.z; p.z=p.x; p.x=x1;}\r\n    if(p.y - p.z < 0.0){ float y1=p.z; p.z=p.y; p.y=y1;}\r\n\r\n    // Rotate 2\r\n\r\n    p.xy = scale * p.xy - C.xy * (scale-1.0);\r\n    p.z=scale*p.z;\r\n    if(p.z>0.5*C.z*(scale-1.0)) p.z-=C.z*(scale-1.0);\r\n    \r\n    r = dot(p, p);\r\n}\r\nreturn (length(p)-2.0)*pow(scale,-float(numi));\\r\\n`;\r\n    }\r\n}","import { ResizeCanvas } from '../common/CanvasHelpers';\r\nimport { mat4 } from 'gl-matrix';\r\nimport DistanceEstimateBuilder from './debuilder/DistanceEstimateBuilder';\r\nimport { BoundingBoxDE, SphereDE, BoxDE, MengerSpongeDE, RotaryMengerSpongeDE } from './debuilder/DistanceEstimatePrimitives';\r\nimport KeyboardManager from '../common/input/KeyboardManager';\r\nimport Quaternion from '../common/3d/Quaternion';\r\nimport Vector from '../common/3d/Vector';\r\nimport { GlslSin, GlslCos } from './debuilder/GlslValue';\r\n\r\n// TODO: Use asset loader to load these?\r\n\r\nconst distanceFunc: DistanceEstimateBuilder =\r\n    new DistanceEstimateBuilder(new MengerSpongeDE(3, new Vector(1, 1, 1), 100, 100))\r\n        .symAxis(GlslSin(0.03), GlslCos(0.03), GlslCos(1, -.01, .01))\r\n        .symAxis(-.8, .2, 0)\r\n        .symAxis(.4, 0.6, 0)\r\n        .symAxis(-.4, .6, 0)\r\n        .rXt(0.03)\r\n        .rYt(0.003)\r\n        .rZt(-.0009)\r\n        .translate(GlslSin(0.1, -.4, .4), GlslCos(0.2, -.2, .2), 0)\r\n        ;\r\n\r\nconst dglsl = distanceFunc.emitGlsl();\r\n\r\nconsole.log('DISTF: ');\r\nconsole.log(dglsl);\r\n\r\nconst vertexShaderSource = `\r\nattribute vec4 aVertexPosition;\r\nvoid main() {\r\n  gl_Position = aVertexPosition;\r\n}\r\n`;\r\n\r\nconst fragmentShaderSource = `\r\nprecision mediump float;\r\n#define PI 3.1415926538\r\n\r\nuniform vec2 WindowSize;\r\nuniform vec3 cam_pos;\r\nuniform vec4 cam_orient;\r\nuniform float t;\r\n\r\nconst int MaximumRaySteps = 50;\r\nconst float MinimumDistance = 0.001;\r\nconst float MaxFogDist = 20.0;\r\n\r\nconst float nscale = 0.001;\r\nconst vec3 xdir = vec3(1.0, 0.0, 0.0);\r\nconst vec3 ydir = vec3(0.0, 1.0, 0.0);\r\nconst vec3 zdir = vec3(0.0, 0.0, 1.0);\r\nconst vec3 lightdir = normalize(vec3(1.0, 0.0, -1.0));\r\nconst vec3 lightsrc = lightdir * 10.0;\r\nconst vec3 amblight = vec3(0.1, 0.1, 0.1);\r\nconst vec3 normlight = vec3(1, .95, .9);\r\nconst float ambocc = 0.2;\r\nconst float shadowLightness = .3;\r\n\r\nconst float scale = 3.0;\r\nconst vec3 C = vec3(1, 1, 1);\r\nconst int MI = 100;\r\nconst float bailout = 10.0;\r\n\r\nvec4 qInverse(vec4 q) {\r\n    float denom = dot(q, q);\r\n    return vec4(-q.x / denom, -q.y / denom, -q.z / denom, q.w / denom);\r\n}\r\n\r\nvec4 qMult(vec4 a, vec4 b) {\r\n    vec4 res = vec4(0.0, 0.0, 0.0, 0.0);\r\n    res.x = a.w * b.x + a.x * b.w + a.y * b.z - a.z * b.y;\r\n    res.y = a.w * b.y - a.x * b.z + a.y * b.w + a.z * b.x;\r\n    res.z = a.w * b.z + a.x * b.y - a.y * b.x + a.z * b.w;\r\n    res.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\r\n    return res;\r\n}\r\n\r\nvec4 qTransform(vec4 f, vec4 pt) {\r\n    return qMult(f, qMult(pt, qInverse(f)));\r\n}\r\n\r\n${dglsl}\r\n\r\nvec3 trace(vec3 from, vec3 direction) {\r\n\tfloat totalDistance = 0.0;\r\n    int nsteps;\r\n    bool hit = false;\r\n\tfor (int steps = 0; steps < MaximumRaySteps; steps++) {\r\n        nsteps = steps;\r\n\t\tvec3 p = from + totalDistance * direction;\r\n\t\tfloat distance = dist(p);\r\n\t\ttotalDistance += distance;\r\n        if (distance < MinimumDistance) \r\n        {\r\n            hit = true;\r\n            break;\r\n        }\r\n    }\r\n\treturn vec3(totalDistance, 1.0-float(nsteps)/float(MaximumRaySteps), hit ? 1.0 : 0.0);\r\n}\r\n\r\nfloat derel(float f) {\r\n    return f + 1.0 / 2.0;\r\n}\r\n\r\nvoid main() {\r\n\r\n    float losx = (gl_FragCoord.x / WindowSize.x) * 2.0 - 1.0;\r\n    float losy = (gl_FragCoord.y / WindowSize.y) * 2.0 - 1.0;\r\n    vec3 losFwd = normalize(vec3(losx, losy, 1));\r\n    vec3 dir = qTransform(cam_orient, vec4(losFwd.x, losFwd.y, losFwd.z, 0)).xyz;\r\n\r\n    vec3 colis = trace(cam_pos, dir);\r\n\r\n    if(colis.z == 0.0)\r\n    {\r\n        gl_FragColor = vec4(0, 0, 0, 1.0);\r\n    }\r\n    else\r\n    {\r\n        vec3 pos = cam_pos + colis.x * dir;\r\n        vec3 dlight = 1.0 - amblight;\r\n        vec3 n = normalize(vec3(\r\n            dist(pos+xdir*nscale)-dist(pos-xdir*nscale),\r\n            dist(pos+ydir*nscale)-dist(pos-ydir*nscale),\r\n            dist(pos+zdir*nscale)-dist(pos-zdir*nscale)\r\n        ));\r\n\r\n        vec3 lightCastSrc = pos + n * MinimumDistance * 2.0;\r\n        vec3 lcolis = trace(lightCastSrc, normalize(lightsrc - lightCastSrc));\r\n\r\n        float shadow = 1.0 - lcolis.z;\r\n        shadow = min(shadow + shadowLightness, 1.0);\r\n\r\n        float normalLightAmt = clamp(dot(n, lightdir), 0.0, 1.0);\r\n                        \r\n        float fog = 1.0 - min(1.0, colis.x / MaxFogDist);\r\n        float cplx = colis.y;\r\n\r\n        vec3 color = (amblight + (1.0 - amblight) * normlight * normalLightAmt * (1.0 - ambocc + ambocc * colis.y)) * fog * shadow;\r\n        gl_FragColor = vec4(color.x, color.y, color.z, 1.0);\r\n    }\r\n}\r\n`;\r\n\r\nconst fastCamMove = 0.05;\r\nconst camMove = 0.005;\r\nconst cam = {x: 0, y: 0, z: -2};\r\nlet keys: KeyboardManager;\r\nlet repaintCount = 0;\r\nlet camRotation: Quaternion = new Quaternion(1, 0, 0, 0);\r\n\r\nconst moveKeys: [string, Vector][] = [\r\n    ['w', new Vector(0, 0, 1)],\r\n    ['a', new Vector(-1, 0, 0)],\r\n    ['s', new Vector(0, 0, -1)],\r\n    ['d', new Vector(1, 0, 0)],\r\n    ['q', new Vector(0, 1, 0)],\r\n    ['z', new Vector(0, -1, 0)],\r\n];\r\n\r\nconst camTurnRate = -Math.PI / 120;\r\nconst lookKeys: [string, Vector][] = [\r\n    ['ArrowUp', new Vector(1, 0, 0)],\r\n    ['ArrowDown', new Vector(-1, 0, 0)],\r\n    ['ArrowLeft', new Vector(0, 1, 0)],\r\n    ['ArrowRight', new Vector(0, -1, 0)],\r\n];\r\n\r\nexport default function main() {\r\n    const canvas = document.getElementById('canvas') as HTMLCanvasElement;\r\n    ResizeCanvas(canvas, 800, 600);\r\n    const gl = canvas.getContext('webgl');\r\n\r\n    // Only continue if WebGL is available and working\r\n    if (gl === null) {\r\n        alert('Unable to initialize WebGL. Your browser may not support it.');\r\n        return;\r\n    }\r\n\r\n    // Clear black\r\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n    const shaderProgram = initShaderProgram(gl, vertexShaderSource, fragmentShaderSource);\r\n    // Here's where we call the routine that builds all the\r\n    // objects we'll be drawing.\r\n    const buffers = initBuffers(gl);\r\n\r\n    // Draw the scene\r\n    drawScene(gl, shaderProgram, buffers, canvas);\r\n\r\n    keys = new KeyboardManager(document.body, false);\r\n    renderLoop(gl, shaderProgram, buffers, canvas);\r\n}\r\n\r\nfunction renderLoop(gl: WebGLRenderingContext, program: WebGLProgram, buffers: { position: WebGLBuffer }, canvas: HTMLCanvasElement) {\r\n    keys.update();\r\n    let doRepaint = false;\r\n\r\n    for (const [key, dir] of moveKeys) {\r\n        if (keys.isKeyDown(key)) {\r\n            const speed = keys.isKeyDown('Shift') ? fastCamMove : camMove;\r\n            const rel = camRotation.applyTransform(dir);\r\n            cam.x += rel.x * speed;\r\n            cam.y += rel.y * speed;\r\n            cam.z += rel.z * speed;\r\n            doRepaint = true;\r\n        }\r\n    }\r\n\r\n    for (const [key, axis] of lookKeys) {\r\n        if (keys.isKeyDown(key)) {\r\n            camRotation = Quaternion.multiply(camRotation, Quaternion.axisRotation(axis, camTurnRate));\r\n        }\r\n    }\r\n\r\n    drawScene(gl, program, buffers, canvas);\r\n    requestAnimationFrame(() => renderLoop(gl, program, buffers, canvas));\r\n}\r\n\r\n\r\nfunction drawScene(gl: WebGLRenderingContext, program: WebGLProgram, buffers: { position: WebGLBuffer }, canvas: HTMLCanvasElement) {\r\n    gl.clearColor(0.0, 0.0, 0.0, 1.0);  // Clear to black, fully opaque\r\n    gl.clearDepth(1.0);                 // Clear everything\r\n    gl.enable(gl.DEPTH_TEST);           // Enable depth testing\r\n    gl.depthFunc(gl.LEQUAL);            // Near things obscure far things\r\n\r\n    // Clear the canvas before we start drawing on it.\r\n\r\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n    // Tell WebGL how to pull out the positions from the position\r\n    // buffer into the vertexPosition attribute.\r\n    {\r\n      const numComponents = 2;  // pull out 2 values per iteration\r\n      const type = gl.FLOAT;    // the data in the buffer is 32bit floats\r\n      const normalize = false;  // don't normalize\r\n      const stride = 0;         // how many bytes to get from one set of values to the next\r\n                                // 0 = use type and numComponents above\r\n      const offset = 0;         // how many bytes inside the buffer to start from\r\n      gl.bindBuffer(gl.ARRAY_BUFFER, buffers.position);\r\n      gl.vertexAttribPointer(\r\n            gl.getAttribLocation(program, 'aVertexPosition'),\r\n            numComponents,\r\n            type,\r\n            normalize,\r\n            stride,\r\n            offset);\r\n      gl.enableVertexAttribArray(\r\n        gl.getAttribLocation(program, 'aVertexPosition'));\r\n    }\r\n\r\n    // Tell WebGL to use our program when drawing\r\n\r\n    gl.useProgram(program);\r\n    gl.uniform2fv(gl.getUniformLocation(program, 'WindowSize'), [canvas.width, canvas.height]);\r\n    gl.uniform3fv(gl.getUniformLocation(program, 'cam_pos'), [cam.x, cam.y, cam.z]);\r\n    gl.uniform4fv(gl.getUniformLocation(program, 'cam_orient'), [camRotation.i, camRotation.j, camRotation.k, camRotation.real]);\r\n    gl.uniform1f(gl.getUniformLocation(program, 't'), repaintCount);\r\n    repaintCount = (repaintCount + 1);\r\n    {\r\n      const offset = 0;\r\n      const vertexCount = 4;\r\n      gl.drawArrays(gl.TRIANGLE_STRIP, offset, vertexCount);\r\n    }\r\n  }\r\n\r\nfunction initBuffers(gl: WebGLRenderingContext) {\r\n    // Create a buffer for the square's positions.\r\n    const positionBuffer = gl.createBuffer();\r\n\r\n    // Select the positionBuffer as the one to apply buffer\r\n    // operations to from here out.\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\r\n\r\n    // Now create an array of positions for the square.\r\n    const positions = [\r\n        -1.0,  1.0,\r\n        1.0,  1.0,\r\n       -1.0, -1.0,\r\n        1.0, -1.0,\r\n    ];\r\n\r\n    // Now pass the list of positions into WebGL to build the\r\n    // shape. We do this by creating a Float32Array from the\r\n    // JavaScript array, then use it to fill the current buffer.\r\n    gl.bufferData(gl.ARRAY_BUFFER,\r\n                  new Float32Array(positions),\r\n                  gl.STATIC_DRAW);\r\n\r\n    return {\r\n      position: positionBuffer,\r\n    };\r\n  }\r\n\r\nfunction initShaderProgram(gl: WebGLRenderingContext, vsSource: string, fsSource: string) {\r\n    const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vsSource);\r\n    const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fsSource);\r\n\r\n    // Create the shader program\r\n\r\n    const shaderProgram = gl.createProgram();\r\n    gl.attachShader(shaderProgram, vertexShader);\r\n    gl.attachShader(shaderProgram, fragmentShader);\r\n    gl.linkProgram(shaderProgram);\r\n\r\n    // If creating the shader program failed, alert\r\n\r\n    if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\r\n      alert('Unable to initialize the shader program: ' + gl.getProgramInfoLog(shaderProgram));\r\n      return undefined;\r\n    }\r\n\r\n    return shaderProgram;\r\n  }\r\n\r\n  //\r\n  // creates a shader of the given type, uploads the source and\r\n  // compiles it.\r\n  //\r\nfunction loadShader(gl: WebGLRenderingContext, type: number, source: string) {\r\n    const shader = gl.createShader(type);\r\n\r\n    // Send the source to the shader object\r\n\r\n    gl.shaderSource(shader, source);\r\n\r\n    // Compile the shader program\r\n\r\n    gl.compileShader(shader);\r\n\r\n    // See if it compiled successfully\r\n\r\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\r\n      alert('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader));\r\n      gl.deleteShader(shader);\r\n      return undefined;\r\n    }\r\n\r\n    return shader;\r\n}\r\n","import IDEPrimitive, { glslVec3Const, glslUnitVec3Const } from './DistanceEstimatePrimitives';\r\nimport { GlslConstant, glslFloatConst } from './GlslValue';\r\n\r\nexport default class DistanceEstimateBuilder {\r\n    private glsl: string;\r\n    private nextTempVar = 0;\r\n    constructor(private primitive: IDEPrimitive) {\r\n        this.glsl = 'float dist(vec3 p) {\\r\\n';\r\n    }\r\n\r\n    protected getTempVarName() {\r\n        return 't' + (this.nextTempVar++);\r\n    }\r\n\r\n\r\n    public elongate(x: number, y: number, z: number): DistanceEstimateBuilder {\r\n        this.glsl += `p = p - clamp(p, -${glslVec3Const(x, y, z)}, ${glslVec3Const(x, y, z)} );\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public repeat(xd: number, yd: number, zd: number): DistanceEstimateBuilder {\r\n        const glslc = glslVec3Const(xd, yd, zd);\r\n        this.glsl += `p = mod(p+0.5*${glslc},${glslc})-0.5*${glslc};\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symX(): DistanceEstimateBuilder {\r\n        this.glsl += `p.x = abs(p.x);\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symY(): DistanceEstimateBuilder {\r\n        this.glsl += `p.y = abs(p.y);\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symZ(): DistanceEstimateBuilder {\r\n        this.glsl += `p.z = abs(p.z);\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public symAxis(normalX: GlslConstant, normalY: GlslConstant, normalZ: GlslConstant) {\r\n        const glslc = glslUnitVec3Const(normalX, normalY, normalZ);\r\n        this.glsl += `p -= 2.0 * min(0.00, dot(p, ${glslc})) * ${glslc};\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rXt(rate: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(rate);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            1.0, 0.0, 0.0,\r\n            0.0, cos(${radians}), sin(${radians}),\r\n            0.0, -sin(${radians}), cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rYt(rate: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(rate);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), 0.0, -sin(${radians}),\r\n            0.0, 1.0, 0.0,\r\n            sin(${radians}), 0.0, cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rZt(rate: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = 'PI * t/30.0 * ' + glslFloatConst(rate);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), sin(${radians}), 0.0,\r\n            -sin(${radians}), cos(${radians}), 0.0,\r\n            0.0, 0.0, 1.0\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n\r\n    public rX(rad: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = glslFloatConst(rad);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            1.0, 0.0, 0.0,\r\n            0.0, cos(${radians}), sin(${radians}),\r\n            0.0, -sin(${radians}), cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rY(rad: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = glslFloatConst(rad);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), 0.0, -sin(${radians}),\r\n            0.0, 1.0, 0.0,\r\n            sin(${radians}), 0.0, cos(${radians})\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public rZ(rad: number): DistanceEstimateBuilder {\r\n        const mtx = this.getTempVarName();\r\n        const radians = glslFloatConst(rad);\r\n        this.glsl += `mat3 ${mtx} = mat3(\r\n            cos(${radians}), sin(${radians}), 0.0,\r\n            -sin(${radians}), cos(${radians}), 0.0,\r\n            0.0, 0.0, 1.0\r\n        );\r\n        p = ${mtx} * p;\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public translate(x: GlslConstant, y: GlslConstant, z: GlslConstant): DistanceEstimateBuilder {\r\n        this.glsl += `p = p-vec3(${glslFloatConst(x)},${glslFloatConst(y)},${glslFloatConst(z)});\\r\\n`;\r\n        return this;\r\n    }\r\n\r\n    public customGlsl(glsl: string) {\r\n        this.glsl += glsl;\r\n        return this;\r\n    }\r\n\r\n    public emitGlsl(): string {\r\n        this.glsl += this.primitive.emitGlsl();\r\n        this.glsl += '}';\r\n        return this.glsl;\r\n    }\r\n}","import * as React from 'react';\r\nimport main from '../../../projects/raymarch';\r\n\r\nexport default function RaymarchComponent() {\r\n    React.useEffect(() => main());\r\n    return <div className='conway conway_body full_body'>\r\n        <canvas id='canvas'></canvas>\r\n    </div>;\r\n}","\r\nexport interface ITileInfo {\r\n    tile: [number, number];\r\n    edges: number[];\r\n\r\n    // If omitted, bottom = edges but 0 => 'any'\r\n    bottom?: (number[]|'any')[];\r\n    // If omitted, top = edges but 2 => 'any'\r\n    top?: (number[]|'any')[];\r\n}\r\n\r\nexport function getTop(ti: ITileInfo): (number[]|'any')[] {\r\n    return ti.top ?? ti.edges.map(t => t === 2 ? 'any' : [t]);\r\n}\r\n\r\nexport function getBottom(ti: ITileInfo): (number[]|'any')[] { \r\n    return ti.bottom ?? ti.edges.map(t => t === 0 ? 'any' : [t]);\r\n}\r\n\r\nexport function canStack(bottom: (number[]|'any')[], top: (number[]|'any')[]){\r\n    for(let i = 0; i < bottom.length; i++)\r\n    {\r\n        if(bottom[i] === 'any' || top[i] === 'any') continue;\r\n        if(bottom[i].length === 0 || top[i].length === 0) return false;\r\n        if(!hasIntersection(bottom[i] as number[], top[i] as number[])) return false;\r\n    }\r\n    return true;\r\n}\r\n\r\nfunction hasIntersection(a: number[], b: number[]){\r\n    for(let i = 0; i < a.length; i++)\r\n    {\r\n        if(b.indexOf(a[i]) !== -1) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nconst TileInfos: ITileInfo[] = [\r\n    { \r\n        tile: [0, 0],\r\n        edges: [2, 2, 2, 2]\r\n    },\r\n    { \r\n        tile: [1, 0],\r\n        edges: [1, 0, 1, 0]\r\n    },\r\n    {\r\n        tile: [2, 0],\r\n        edges: [0, 1, 0, 1]\r\n    },/*\r\n    {\r\n        tile: [3, 0],\r\n        edges: [1, 0, 0, 0],\r\n        bottom: [[1, 2], 'any', [1, 2], 'any'],\r\n        top: [[], [], [] , []]\r\n    },\r\n    {\r\n        tile: [4, 0],\r\n        edges: [0, 0, 1, 0],\r\n        bottom: [[1, 2], 'any', [1, 2], 'any'],\r\n        top: [[], [], [] , []]\r\n    },\r\n    {\r\n        tile: [5, 0],\r\n        edges: [0, 1, 0, 0],\r\n        bottom: ['any', [1, 2], 'any', [1, 2]],\r\n        top: [[], [], [] , []]\r\n    },\r\n    {\r\n        tile: [6, 0],\r\n        edges: [0, 0, 0, 1],\r\n        bottom: ['any', [1, 2], 'any', [1, 2]],\r\n        top: [[], [], [] , []]\r\n    },*/\r\n    {\r\n        tile: [7, 0],\r\n        edges: [1, 1, 1, 1]\r\n    },\r\n    {\r\n        tile: [0, 1],\r\n        edges: [1, 1, 0, 1]\r\n    },\r\n    {\r\n        tile: [1, 1],\r\n        edges: [1, 1, 1, 0]\r\n    },\r\n    {\r\n        tile: [2, 1],\r\n        edges: [0, 1, 1, 1]\r\n    },\r\n    {\r\n        tile: [3, 1],\r\n        edges: [1, 0, 1, 1]\r\n    },\r\n    {\r\n        tile: [4, 1],\r\n        edges: [1, 1, 0, 0]\r\n    },\r\n    {\r\n        tile: [5, 1],\r\n        edges: [0, 1, 1, 0]\r\n    },\r\n    {\r\n        tile: [6, 1],\r\n        edges: [0, 0, 1, 1]\r\n    },\r\n    {\r\n        tile: [7, 1],\r\n        edges: [1, 0, 0, 1]\r\n    },\r\n    {\r\n        tile: [0, 2],\r\n        edges: [1, 0, 2, 0]\r\n    },\r\n    {\r\n        tile: [1, 2],\r\n        edges: [0, 1, 0, 2]\r\n    },\r\n    {\r\n        tile: [2, 2],\r\n        edges: [2, 0, 1, 0],\r\n    },\r\n    {\r\n        tile: [3, 2],\r\n        edges: [0, 2, 0, 1],\r\n    },\r\n    { \r\n        tile: [4, 2],\r\n        edges: [1, 0, 1, 0],\r\n        bottom: [[1,2],[1,2],[1,2],[1,2]],\r\n    },\r\n    {\r\n        tile: [5, 2],\r\n        edges: [0, 1, 0, 1],\r\n        bottom: [[1,2],[1,2],[1,2],[1,2]],\r\n    },\r\n    {\r\n        tile: [5, 3],\r\n        edges: [0, 0, 0, 0]\r\n    },\r\n]\r\n\r\n\r\nexport default TileInfos;","import { canStack, getBottom, getTop, ITileInfo } from \"./assets/TileInfo\";\r\n\r\nexport default interface ITileNeighborInfo {\r\n    id: number,\r\n    // x+, y+, x-, y-, z+, z-\r\n    neighbors: number[][],\r\n}\r\n\r\nexport const NeighborDirections = [\r\n    { x: 1, y: 0, z: 0 },\r\n    { x: 0, y: 1, z: 0 },\r\n    { x: -1, y: 0, z: 0 },\r\n    { x: 0, y: -1, z: 0 },\r\n    { x: 0, y: 0, z: 1 },\r\n    { x: 0, y: 0, z: -1 },\r\n]\r\n\r\nexport function GenerateNeighborInfo(tiles: ITileInfo[]) {\r\n    const result: ITileNeighborInfo[] = [];\r\n    tiles.forEach(tile => {\r\n        let neighborInfo: ITileNeighborInfo = {\r\n            id: result.length,\r\n            neighbors: [[], [], [], [], [], []],\r\n        };\r\n\r\n        for(let otherId = 0; otherId < tiles.length; otherId++){\r\n            let otherTile = tiles[otherId];\r\n            for(let dir = 0; dir < 4; dir++) {\r\n                if(otherTile.edges[(dir + 2)%4] === tile.edges[dir])\r\n                {\r\n                    neighborInfo.neighbors[dir].push(otherId);\r\n                }\r\n            }\r\n            if(canStack(getTop(otherTile), getBottom(tile))) {\r\n                neighborInfo.neighbors[4].push(otherId);\r\n            }\r\n            \r\n            if(canStack(getTop(tile), getBottom(otherTile))) {\r\n                neighborInfo.neighbors[5].push(otherId);\r\n            }\r\n        }\r\n\r\n        for(var i = 0; i < neighborInfo.neighbors.length; i++){\r\n            neighborInfo.neighbors[i].sort((a, b) => a - b);\r\n        }\r\n        result.push(neighborInfo);\r\n    });\r\n\r\n    return result;\r\n}","export default __webpack_public_path__ + \"c169d19bb90720608b4e6ba8299edfb4.png\";","import ITileNeighborInfo, { NeighborDirections } from \"./AdjacencyMap\";\r\n\r\nexport type WaveCell = number | number[];\r\nexport type WaveFunction = WaveCell[][][];\r\n\r\nexport function CreateChunk(neighborInfos: ITileNeighborInfo[], xSize: number, ySize: number, zSize: number)\r\n{\r\n    let defaultCell = [];\r\n    for(let i = 0; i < neighborInfos.length; i++) { defaultCell.push(i); }\r\n\r\n    let waveFunction: WaveFunction = [];\r\n    for(let x = 0; x < xSize; x++) {\r\n        let plane = [];\r\n        for(let y = 0; y < ySize; y++) {\r\n            let row = [];\r\n            for(let z = 0; z < zSize; z++) {\r\n                row.push([...defaultCell]);\r\n            }\r\n            plane.push(row);\r\n        }\r\n        waveFunction.push(plane);\r\n    }\r\n    return waveFunction;\r\n}\r\n\r\nexport function GenerateChunk(neighborInfos: ITileNeighborInfo[], xSize: number, ySize: number, zSize: number) {\r\n    let waveFunction = CreateChunk(neighborInfos, xSize, ySize, zSize);\r\n\r\n    while(!Step(neighborInfos, waveFunction)){}\r\n\r\n    return waveFunction as number[][][];\r\n}\r\n\r\nexport function Step(neighborInfos: ITileNeighborInfo[], waveFunction: WaveFunction) {\r\n    let minCount = Infinity;\r\n    let minCells: {x: number, y: number, z: number}[] = [];\r\n    for(let x = 0; x < waveFunction.length; x++) {\r\n        for(let y = 0; y < waveFunction[x].length; y++) {\r\n            for(let z = 0; z < waveFunction[x][y].length; z++) {\r\n                if(!isFinalizedCell(waveFunction[x][y][z])){\r\n                    let count = (waveFunction[x][y][z] as number[]).length;\r\n                    if(count < minCount) {\r\n                        minCount = count;\r\n                        minCells = [{x, y, z}];\r\n                    }\r\n                    else if(count === minCount) {\r\n                        minCells.push({x, y, z});\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if(!isFinite(minCount)) { return true; }\r\n\r\n    let chosenIndex = Math.floor(Math.random() * minCells.length);\r\n    let {x, y, z} = minCells[chosenIndex];\r\n    let waveCell = waveFunction[x][y][z];\r\n    let options = getPossibilities(waveCell);\r\n    let chosen = options[Math.floor(Math.random() * options.length)];\r\n\r\n    waveFunction[x][y][z] = chosen;\r\n\r\n    PropagateChanges(neighborInfos, waveFunction, x, y, z);\r\n    return false;\r\n}\r\n\r\nfunction PropagateChanges(neighborInfos: ITileNeighborInfo[],waveFunction: WaveFunction, x: number, y: number, z: number)\r\n{\r\n    let stack = [{x, y, z}];\r\n    while(stack.length > 0) {\r\n        let {x, y, z} = stack.pop();\r\n        let waveCell = waveFunction[x][y][z];\r\n\r\n        for(let directionIndex = 0; directionIndex < 6; directionIndex++) {\r\n            let direction = NeighborDirections[directionIndex];\r\n            if(x + direction.x < 0 || y + direction.y < 0 || z + direction.z < 0 || x + direction.x >= waveFunction.length || y + direction.y >= waveFunction[x].length || z + direction.z >= waveFunction[x][y].length) {\r\n                continue;\r\n            }\r\n\r\n            let neighborCell = waveFunction[x + direction.x][y + direction.y][z + direction.z];\r\n\r\n            let newNeighbor = tryAdjustNeighbor(neighborInfos, waveCell, neighborCell, directionIndex);\r\n            if(newNeighbor !== null) {\r\n                waveFunction[x + direction.x][y + direction.y][z + direction.z] = newNeighbor;\r\n                stack.push({x: x + direction.x, y: y + direction.y, z: z + direction.z});\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction tryAdjustNeighbor(neighborInfos: ITileNeighborInfo[], cell: WaveCell, neighbor: WaveCell, direction: number): null | WaveCell {\r\n    if(isFinalizedCell(neighbor)) {\r\n        return null;\r\n    }\r\n\r\n    let options: number[] = [];\r\n\r\n    getPossibilities(cell).forEach(self => {\r\n        let neighborInfo = neighborInfos[self];\r\n        let results = neighborInfo.neighbors[direction];\r\n        results.forEach(result => {\r\n            if(options.indexOf(result) === -1) options.push(result);\r\n        });\r\n    });\r\n\r\n    let other = getPossibilities(neighbor);\r\n    let diff = false;\r\n    for(var i = other.length - 1; i >= 0; i--) {\r\n        if(options.indexOf(other[i]) === -1) {\r\n            other.splice(i, 1);\r\n            diff = true;\r\n        }\r\n    }\r\n\r\n    if(diff) {\r\n        if(other.length === 1) {\r\n            return other[0];\r\n        }\r\n        else if(other.length === 0) {\r\n            return options[0];\r\n        }\r\n        else {\r\n            return other;\r\n        }\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\r\n\r\n\r\nfunction getPossibilities(waveCell: WaveCell){\r\n    if(isFinalizedCell(waveCell)) {\r\n        return [waveCell];\r\n    }\r\n    else {\r\n        return waveCell;\r\n    }\r\n}\r\nexport function isFinalizedCell(waveCell: WaveCell): waveCell is number {\r\n    return typeof waveCell === 'number';\r\n}","import AssetLoader from \"../common/assets/AssetLoader\";\r\nimport { SpriteSheet } from \"../common/assets/SpriteSheet\";\r\nimport { NearestNeighborScaling } from \"../common/CanvasHelpers\";\r\nimport NearestNeighborScalingHelper from \"../common/NearestNeighborScalingHelper\";\r\nimport Rect from \"../common/position/Rectangle\";\r\nimport ITileNeighborInfo, { GenerateNeighborInfo } from \"./AdjacencyMap\";\r\nimport tileUrl from './assets/isotiles.png'\r\nimport TileInfos, { ITileInfo } from \"./assets/TileInfo\";\r\nimport { CreateChunk, GenerateChunk, isFinalizedCell, Step, WaveFunction } from \"./Generator\";\r\n\r\nlet spriteSheet: SpriteSheet;\r\n\r\nexport default function Run() {\r\n    const assetLoader = new AssetLoader();\r\n    spriteSheet = new SpriteSheet(32, 32, tileUrl, assetLoader.registerAssetLoadCallback());\r\n\r\n    assetLoader.onAllFinished(() => Start());\r\n}\r\n\r\nfunction Start(){\r\n    console.log(TileInfos);\r\n    const neighbors = GenerateNeighborInfo(TileInfos);\r\n    console.log(neighbors);\r\n\r\n    const canvas = document.getElementById('canvas') as HTMLCanvasElement;\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    let tiles = CreateChunk(neighbors, 26, 26, 1);\r\n\r\n\r\n    let scalingHelper = new NearestNeighborScalingHelper(canvas, ctx, 800, 800, true, undefined);\r\n\r\n    tickLoop(TileInfos, neighbors, spriteSheet, tiles, ctx);\r\n}\r\n\r\nfunction tickLoop(tileInfos: ITileInfo[], neighborInfos: ITileNeighborInfo[], assets: SpriteSheet, cells: WaveFunction, ctx: CanvasRenderingContext2D) {\r\n    Paint(tileInfos, assets, cells, ctx);\r\n\r\n    if(!Step(neighborInfos, cells)){\r\n        requestAnimationFrame(() => tickLoop(tileInfos, neighborInfos, assets, cells, ctx));\r\n    }\r\n}\r\n\r\n\r\nfunction Paint(tileInfos: ITileInfo[], assets: SpriteSheet, cells: WaveFunction, ctx: CanvasRenderingContext2D) {\r\n\r\n    let origin = [400, 800];\r\n\r\n    for(let z = 0; z < cells[0][0].length; z++){\r\n        for(let x = cells.length - 1; x >= 0; x--) {\r\n            for(let y = cells[x].length - 1; y >= 0; y--) {\r\n                if(!isFinalizedCell(cells[x][y][z])){\r\n                    continue;\r\n                }\r\n                let cell = cells[x][y][z] as number;\r\n                let tileInfo = tileInfos[cell];\r\n                let sprite = assets.getSprite(tileInfo.tile[0], tileInfo.tile[1], 32, 32);\r\n\r\n                let tx = (x-y) * 16;\r\n                let ty = -(x+y) * 8 - z*16;\r\n\r\n                sprite.draw(ctx, new Rect(tx + origin[0], ty + origin[1], 32, 32), 0);\r\n            }\r\n        }\r\n    }\r\n}","import * as React from 'react';\r\nimport Run from '../../../projects/wave-collapse';\r\n\r\nexport default function WaveCollapseComponent() {\r\n    React.useEffect(() => Run());\r\n    return <div style={{ top: 0, bottom: 0, left: 0, right: 0, position: 'absolute'}}>\r\n        <canvas id='canvas' style={{ top: 0, bottom: 0, left: 0, right: 0, position: 'absolute'}}></canvas>\r\n    </div>;\r\n}"],"names":["Matrix4","constructor","identity","this","components","transform","p","x","multRow","y","z","w","mult","other","output","row","col","i","colMajor","Array","rowMajor","static","pt","Point3","lengthSq","dot","length","Math","sqrt","clone","normalize","len","div","pxs","iy","iz","splitArgs","add","sub","allowSingle","undefined","Quaternion","real","j","k","inverse","denom","Dot","a","b","axis","radians","cos","sin","applyTransform","point","multiply","inputQ","qOut","toMatrix","mtx","Vector","negate","sx","sy","sz","isVector","getxyz","dx","dy","dz","subtract","KeyState","keys","changes","isKeyDown","key","indexOf","isKeyUp","KeyWatcher","attachedElement","logKeyNames","addEventListener","onKeyDown","onKeyUp","downKeys","console","log","push","change","idx","splice","Update","storeKeys","storeChanges","slice","KeyboardManager","element","watcher","prvState","currentState","update","isKeyPressed","isKeyReleased","GlslSin","rate","min","max","GlslTimeVariable","GlslCos","timeFunc","n","asstr","toString","halfRange","midp","glslVec3Const","dglsl","primitive","nextTempVar","glsl","getTempVarName","elongate","repeat","xd","yd","zd","glslc","symX","symY","symZ","symAxis","normalX","normalY","normalZ","rXt","rYt","rZt","rX","rad","rY","rZ","translate","customGlsl","emitGlsl","scale","c","maxIterations","bailoutRange","fragmentShaderSource","cam","repaintCount","camRotation","moveKeys","camTurnRate","PI","lookKeys","main","canvas","document","getElementById","gl","getContext","alert","clearColor","clear","COLOR_BUFFER_BIT","shaderProgram","vsSource","fsSource","vertexShader","loadShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","initShaderProgram","buffers","positionBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","position","initBuffers","drawScene","body","renderLoop","program","doRepaint","dir","speed","rel","requestAnimationFrame","clearDepth","enable","DEPTH_TEST","depthFunc","LEQUAL","DEPTH_BUFFER_BIT","numComponents","type","FLOAT","stride","offset","vertexAttribPointer","getAttribLocation","enableVertexAttribArray","useProgram","uniform2fv","getUniformLocation","width","height","uniform3fv","uniform4fv","uniform1f","vertexCount","drawArrays","TRIANGLE_STRIP","source","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","deleteShader","RaymarchComponent","className","id","getTop","ti","top","edges","map","t","getBottom","bottom","canStack","hasIntersection","tile","NeighborDirections","tryAdjustNeighbor","neighborInfos","cell","neighbor","direction","isFinalizedCell","options","getPossibilities","forEach","self","neighbors","result","diff","waveCell","spriteSheet","Run","assetLoader","AssetLoader","SpriteSheet","registerAssetLoadCallback","onAllFinished","TileInfo","tiles","neighborInfo","otherId","otherTile","sort","GenerateNeighborInfo","ctx","xSize","ySize","zSize","defaultCell","waveFunction","plane","CreateChunk","NearestNeighborScalingHelper","tickLoop","Start","tileInfos","assets","cells","origin","tileInfo","tx","ty","getSprite","draw","Paint","minCount","Infinity","minCells","count","isFinite","chosenIndex","floor","random","chosen","stack","pop","directionIndex","newNeighbor","PropagateChanges","Step","WaveCollapseComponent","style","left","right"],"sourceRoot":""}