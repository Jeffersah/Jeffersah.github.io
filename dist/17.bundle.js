"use strict";(self.webpackChunktrading_game=self.webpackChunktrading_game||[]).push([[17],{6718:(t,e,i)=>{i.d(e,{Z:()=>r});class s{constructor(t,e){this.keys=t,this.changes=e}isKeyDown(t){return-1!==this.keys.indexOf(t)}isKeyUp(t){return-1===this.keys.indexOf(t)}}class n{constructor(t,e){this.attachedElement=t,this.logKeyNames=e,void 0===this.logKeyNames&&(this.logKeyNames=!1),t.addEventListener("keydown",(t=>this.onKeyDown(t))),t.addEventListener("keyup",(t=>this.onKeyUp(t))),this.downKeys=[],this.changes=[]}onKeyDown(t){this.logKeyNames&&console.log(t.key),-1===this.downKeys.indexOf(t.key)&&(this.changes.push({key:t.key,change:"press"}),this.downKeys.push(t.key))}onKeyUp(t){this.changes.push({key:t.key,change:"release"});const e=this.downKeys.indexOf(t.key);this.downKeys.splice(e,1)}Update(){const t=this.downKeys,e=this.changes;return this.downKeys=t.slice(),this.changes=[],new s(t,e)}}class r{constructor(t,e){this.watcher=new n(t,e),this.prvState=this.currentState=this.watcher.Update()}update(){this.prvState=this.currentState,this.currentState=this.watcher.Update()}isKeyDown(t){return this.currentState.isKeyDown(t)}isKeyUp(t){return this.currentState.isKeyUp(t)}isKeyPressed(t){return this.currentState.isKeyDown(t)&&this.prvState.isKeyUp(t)}isKeyReleased(t){return this.currentState.isKeyUp(t)&&this.prvState.isKeyDown(t)}changes(){return this.currentState.changes}}},615:(t,e,i)=>{i.d(e,{Nm:()=>s,Dz:()=>a,jR:()=>h});var s,n=i(8785);!function(t){t[t.Up=0]="Up",t[t.UpRight=1]="UpRight",t[t.Right=2]="Right",t[t.DownRight=3]="DownRight",t[t.Down=4]="Down",t[t.DownLeft=5]="DownLeft",t[t.Left=6]="Left",t[t.UpLeft=7]="UpLeft"}(s||(s={}));const r=[new n.Z(0,-1),new n.Z(1,-1),new n.Z(1,0),new n.Z(1,1),new n.Z(0,1),new n.Z(-1,1),new n.Z(-1,0),new n.Z(-1,-1)],a=[s.Up,s.UpRight,s.Right,s.DownRight,s.Down,s.DownLeft,s.Left,s.UpLeft];function h(t){return r[t]}s.Up,s.Right,s.Down,s.Left,s.UpRight,s.DownRight,s.DownLeft,s.UpLeft},8785:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e){this.x=t,this.y=e}static zero(){return new s(0,0)}static fromAngle(t,e){return new s(Math.cos(t)*(null!=e?e:1),Math.sin(t)*(null!=e?e:1))}lengthSq(){return s.dot(this,this)}length(){return Math.sqrt(this.lengthSq())}clone(){return new s(this.x,this.y)}negate(){return new s(-this.x,-this.y)}negateInPlace(){return this.x=-this.x,this.y=-this.y,this}static dot(t,e){return t.x*e.x+t.y*e.y}dotWith(t){return s.dot(this,t)}normalize(){let t=this.length();return s.multiply(this,1/t)}direction(){return Math.atan2(this.y,this.x)}truncate(){return new s(Math.trunc(this.x),Math.trunc(this.y))}addWith(t,e){const{x:i,y:s}=n(t,e);return this.x+=i,this.y+=s,this}multWith(t,e){const{x:i,y:s}=function(t,e){return void 0===e?void 0!==t.x?{x:t.x,y:t.y}:{x:t,y:t}:{x:t,y:e}}(t,e);return this.x*=i,this.y*=s,this}subtractWith(t,e){const{x:i,y:s}=n(t,e);return this.x-=i,this.y-=s,this}divideWith(t,e){const{x:i,y:s}=n(t,e);return this.x/=i,this.y/=s,this}equals(t){return this.x===t.x&&this.y===t.y}static add(t,e,i){const{x:r,y:a}=n(e,i);return new s(t.x+r,t.y+a)}static subtract(t,e,i){const{x:r,y:a}=n(e,i);return new s(t.x-r,t.y-a)}static multiply(t,e,i){return void 0!==i?new s(t.x*e,t.y*i):void 0!==e.x?new s(t.x*e.x,t.y*e.y):new s(t.x*e,t.y*e)}static interpolate(t,e,i){return new s(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)}static componentMin(t,e){return t.x<=e.x&&t.y<=e.y?t:e.x<=t.x&&e.y<=t.y?e:new s(Math.min(t.x,e.x),Math.min(t.y,e.y))}static componentMax(t,e){return t.x>=e.x&&t.y>=e.y?t:e.x>=t.x&&e.y>=t.y?e:new s(Math.max(t.x,e.x),Math.max(t.y,e.y))}static Bezier(t,e){return 1===t.length?t[0]:2===t.length?s.add(s.multiply(t[1],e),s.multiply(t[0],1-e)):s.add(s.multiply(s.Bezier(t.slice(1),e),e),s.multiply(s.Bezier(t.slice(0,t.length-1),e),1-e))}rotate(t){const e=Math.atan2(this.y,this.x),i=this.length();return s.fromAngle(e+t,i)}}function n(t,e){return void 0===e?{x:t.x,y:t.y}:{x:t,y:e}}},5907:(t,e,i)=>{i.d(e,{Z:()=>r});var s=i(8785),n=i(615);class r{constructor(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}shift(t,e){return void 0===e?new r(this.x+t.x,this.y+t.y,this.w,this.h):new r(this.x+t,this.y+e,this.w,this.h)}shiftBy(t,e){void 0===e?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e)}edge(t){switch(t){case n.Nm.Up:return this.y;case n.Nm.Down:return this.y+this.h;case n.Nm.Left:return this.x;case n.Nm.Right:return this.x+this.w}}corner(t){switch(t){case n.Nm.UpRight:case n.Nm.DownRight:case n.Nm.DownLeft:case n.Nm.UpLeft:return new s.Z(this.x,this.y)}}equals(t){return t.x===this.x&&t.y===this.y&&t.w===this.w&&t.h===this.h}}},5017:(t,e,i)=>{i.r(e),i.d(e,{default:()=>$});var s=i(7363),n=i(127),r=i(5901),a=i(7604),h=i(6718),o=i(8785);const l=32,c=32,w=new o.Z(16,24),d=352,u=new o.Z(160,160),y=new o.Z(-2,4);var g=i(3486);const p=i.p+"01e11f7981f442c6037827f1760c4c3e.png",m=i.p+"73e309f8aae54c28b86a4cd95da4091d.png";var x=i(5922);class f{constructor(t,e,i){this.source=t,this.sourceBounds=e,this.origin=null!=i?i:new o.Z(0,0)}getSprite(){return this}getPixelSize(){return new o.Z(this.sourceBounds.w,this.sourceBounds.h)}getRenderable(){return this}width(){return this.sourceBounds.w}height(){return this.sourceBounds.h}tick(){return!1}draw(t,e,i){const s=t.getTransform();(0,r.ei)(t,e.x,e.y,this.origin.x,this.origin.y,i),t.drawImage(this.source,this.sourceBounds.x,this.sourceBounds.y,this.sourceBounds.w,this.sourceBounds.h,0,0,e.w,e.h),t.setTransform(s)}}var Z,R=i(5907);class D{constructor(t){this.tiles=new g.V(32,32,p,t.registerAssetLoadCallback()),this.floor_and_digits=new x.Z(m,t.registerAssetLoadCallback())}getDigitSprite(t){return new f(this.floor_and_digits.image,new R.Z(41+7*t,0,7,13))}drawNumber(t,e,i){const s=i.toString().split("").map((t=>parseInt(t)));for(var n=0;n<s.length;n++)this.getDigitSprite(s[n]).draw(t,new R.Z(e.x+7*n,e.y,7,13),0)}}class k{constructor(t,e,i){this.type=t,"primary"===this.type?(this.sprite=new f(e.tiles.image,new R.Z(i.x*l,i.y*c,16,c)),this.iconImage=new f(e.tiles.image,new R.Z(i.x*l+16,i.y*c,16,c))):(this.sprite=new f(e.tiles.image,new R.Z(i.x*l+16,i.y*c,16,c)),this.iconImage=new f(e.tiles.image,new R.Z(i.x*l,i.y*c,16,c)))}}!function(t){t[t.Right=0]="Right",t[t.DownRight=1]="DownRight",t[t.DownLeft=2]="DownLeft",t[t.Left=3]="Left",t[t.UpLeft=4]="UpLeft",t[t.UpRight=5]="UpRight"}(Z||(Z={}));const b=[Z.Right,Z.DownRight,Z.DownLeft,Z.Left,Z.UpLeft,Z.UpRight];class L{static ToPoint(t){switch(t){case Z.Right:return new o.Z(1,0);case Z.DownRight:return new o.Z(0,1);case Z.DownLeft:return new o.Z(-1,1);case Z.Left:return new o.Z(-1,0);case Z.UpLeft:return new o.Z(0,-1);case Z.UpRight:return new o.Z(1,-1)}}static Turn(t,e){return((t+e)%6+6)%6}}function S(t){return o.Z.add(o.Z.multiply(w,t.y),32*t.x+u.x,u.y)}function U(t){if(0===t)return[new o.Z(0,0)];const e=[];let i=new o.Z(0,-t);for(var s=Z.Right;s<=Z.UpRight;s++)for(var n=L.ToPoint(s),r=0;r<t;r++)e.push(i),i=o.Z.add(i,n);return e}class v extends class{constructor(t){this.position=t}TakeDamage(t){}tick(t){}}{constructor(t,e){super(e),this.primary=new k("primary",t,new o.Z(8,1)),this.secondary=new k("secondary",t,new o.Z(10,0)),this.renderable=new f(t.tiles.image,new R.Z(256,0,l,c))}draw(t){const e=S(this.position),i=new R.Z(e.x,e.y,l,c);this.renderable.draw(t,i,0),this.primary.sprite.draw(t,new R.Z(i.x,i.y,i.w/2,i.h),0),this.secondary.sprite.draw(t,new R.Z(i.x+i.w/2,i.y,i.w/2,i.h),0)}}class M{constructor(t,e){this._size=t,this.data=[];let i=2*t-1;for(let s=1-t;s<=t-1;s++){let t=[];for(let n=0;n<i-Math.abs(s);n++)t.push(e);this.data.push(t)}}size(){return this._size}get(t,e){const[i,s]=this.extractInputCoords(t,e);let[n,r]=this.toArrayCoords(i,s);return this.data[r][n]}set(t,e,i){const[s,n]=this.extractInputCoords(e,i),[r,a]=this.toArrayCoords(s,n);this.data[a][r]=t}extractInputCoords(t,e){return"number"==typeof t?[t,e]:void 0!==t.x?[t.x,t.y]:t}getRowLength(t){return 2*this._size-1-Math.abs(t)}isInBounds(t,e){if(e<=-this._size||e>=this._size)return!1;let[i,s]=this.getXRange(e);return t>=i&&t<s}getXRange(t){const e=this.getMinX(t);return[e,e+this.getRowLength(t)]}getMinX(t){const e=this._size-1+t;return-Math.min(e,this._size-1)}iterate(t){for(let e=1-this._size;e<this._size;e++){let[i,s]=this.getXRange(e);for(let n=i;n<s;n++)t(n,e,this.get(n,e))}}toArrayCoords(t,e){const i=this._size-1+e;return[t- -Math.min(i,this._size-1),i]}}class K{constructor(t,e,i,s){this.assets=t,this.enemies=[],this.entities=new M(e,null),this.changeFloor(i,s),this.player=new v(t,y),this.entities.set(this.player,y.x,y.y)}moveEntity(t,e){this.entities.set(null,t.position),this.entities.set(t,e),t.position=e}changeFloor(t,e){this.entities=new M(this.entities.size(),null),e.generateMap(this.assets,t,this),this.currentFloor=t,this.tiles.iterate(((t,e,i)=>{i.AfterWorldLoad(this,new o.Z(t,e))})),this.entities.set(this.player,y)}draw(t,e){new f(this.assets.floor_and_digits.image,new R.Z(0,0,41,13)).draw(t,new R.Z(0,0,41,13),0),this.assets.drawNumber(t,new o.Z(41,0),this.currentFloor),this.tiles.iterate(((e,i,s)=>{s.draw(t,this,new o.Z(e,i))})),this.entities.iterate(((i,s,n)=>{null!=n&&(void 0!==e&&e.includes(n)||n.draw(t))}))}}class _{constructor(t,e){this.source=t,this.delta=e}tick(){return this.source.tick()}draw(t,e,i){this.source.draw(t,new R.Z(e.x+this.delta.x*e.w,e.y+this.delta.y*e.h,e.w*this.delta.w,e.h*this.delta.h),i)}}class T{constructor(t,e){this.renderables=t,this.finishMode=null!=e?e:"any"}tick(){let t=!0,e=!1;for(let i=0;i<this.renderables.length;i++){const s=this.renderables[i].tick();t=t&&s,e=e||s}return"any"===this.finishMode?e:t}draw(t,e,i){for(let s=0;s<this.renderables.length;s++)this.renderables[s].draw(t,e,i)}}class C{constructor(t,e){this.typeId=t,this.isPathable=e}}class z extends C{constructor(t,e,i,s,n){super(t,s),this.bg_renderable=new _(new f(e.tiles.image,new R.Z(352,0,l,c)),new R.Z(0,.75,1,1)),!0===n&&(this.bg_renderable=new T([this.bg_renderable,new f(e.tiles.image,new R.Z(0,0,l,c))])),this.renderable=new f(e.tiles.image,new R.Z(i.x*l,i.y*c,l,c))}AfterWorldLoad(t,e){}draw(t,e,i){let s=S(i);this.bg_renderable.draw(t,new R.Z(s.x,s.y,l,c),0),this.renderable.draw(t,new R.Z(s.x,s.y,l,c),0)}}class I extends z{constructor(t,e){super(I.TileID,t,null!=e?e:new o.Z(0,0),!0,void 0!==e)}OnEntityStep(t){}}I.TileID=0;class A extends z{constructor(t){super(A.TileID,t,new o.Z(5,0),!0,!0)}OnEntityStep(t){}}A.TileID=2;class P{init(t){}tick(t,e){return new H}draw(t,e){e.draw(t)}}const B=[{directions:[Z.UpLeft,Z.UpRight],tileCoords:new o.Z(0,0),tileSlice:new R.Z(0,0,1,.5)},{directions:[Z.DownLeft,Z.DownRight],tileCoords:new o.Z(0,0),tileSlice:new R.Z(0,.5,1,.5)},{directions:[Z.Left,Z.UpLeft],tileCoords:new o.Z(0,1),tileSlice:new R.Z(0,0,.5,.5)},{directions:[Z.Right,Z.UpRight],tileCoords:new o.Z(0,1),tileSlice:new R.Z(.5,0,.5,.5)},{directions:[Z.Left,Z.DownLeft],tileCoords:new o.Z(0,1),tileSlice:new R.Z(0,.5,.5,.5)},{directions:[Z.Right,Z.DownRight],tileCoords:new o.Z(0,1),tileSlice:new R.Z(.5,.5,.5,.5)}];class N extends C{constructor(t,e,i,s){super(t,s),this.spriteSheetPosition=i,this.assets=e,this.bg_renderable=new f(e.tiles.image,new R.Z(352,0,l,c))}AfterWorldLoad(t,e){const i=b.map((i=>{const s=o.Z.add(e,L.ToPoint(i));return!t.tiles.isInBounds(s.x,s.y)||t.tiles.get(e).typeId!==t.tiles.get(s).typeId})),s=B.map((t=>{const e=t.directions.reduceRight(((t,e)=>(t<<1)+(i[e]?1:0)),0),s=new R.Z((t.tileCoords.x+e+t.tileSlice.x+this.spriteSheetPosition.x)*l,(t.tileCoords.y+t.tileSlice.y+this.spriteSheetPosition.y)*c,t.tileSlice.w*l,t.tileSlice.h*c);return new _(new f(this.assets.tiles.image,s),t.tileSlice)}));this.renderable=new T(s,"all")}draw(t,e,i){let s=S(i);this.bg_renderable.draw(t,new R.Z(s.x,s.y+24,l,c),0),this.renderable.draw(t,new R.Z(s.x,s.y,l,c),0)}}class E extends N{constructor(t){super(1,t,new o.Z(0,4),!1)}OnEntityStep(t){t.isFlying||t.TakeDamage(999)}}const F=[new o.Z(6,2),new o.Z(7,2),new o.Z(9,2),new o.Z(7,3),new o.Z(6,3),new o.Z(8,2)];class W{generateMap(t,e,i){i.tiles=new M(6,new I(t));const s=U(2);for(var n=0;n<s.length;n++)i.tiles.set(new E(t),s[n]);const r=U(3);for(n=0;n<r.length;n+=3)i.tiles.set(new E(t),r[n]);const a=U(1).map((t=>o.Z.add(t,y)));for(let e=0;e<a.length;e++)i.tiles.set(new I(t,F[e]),a[e]);i.tiles.set(new A(t),2,-4)}}class q{generateMap(t,e,i){i.tiles=new M(6,new I(t));const s=-5+Math.floor(3*Math.random()),[n,r]=i.tiles.getXRange(s),a=Math.floor(Math.random()*(r-n))+n;i.tiles.set(new A(t),a,s)}}const O=[{range:[0,1],gen:new W},{range:[1,12],gen:new q},{range:[12,13],gen:new class{generateMap(t,e,i){i.tiles=new M(6,new I(t)),i.tiles.set(new A(t),0,0);const s=U(2);for(let e=0;e<s.length;e++)i.tiles.set(new I(t,new o.Z(12,0)),s[e])}}},{range:[13,-1],gen:new q}];class X{constructor(){this.time=0}init(t){}tick(t,e){return this.time++,this.time>=30?new G:this}draw(t,e){e.draw(t),t.fillStyle="#000000",t.globalAlpha=this.time/30,t.fillRect(0,0,d,d),t.globalAlpha=1,e.player.draw(t)}}class G{constructor(){this.time=0}init(t){const e=t.currentFloor+1,i=O.filter((t=>e>=t.range[0]&&(-1===t.range[1]||e<t.range[1])))[0].gen;this.playerStartPoint=t.player.position,t.changeFloor(e,i)}tick(t,e){return this.time++,this.time>=30?(t.player.position=y.clone(),new J):this}draw(t,e){const i=this.time/30,s=o.Z.interpolate(this.playerStartPoint,y,i);e.player.position=s,e.player.draw(t)}}class j{constructor(t,e){this.playerPos=t,this.playerDest=e,this.time=0}init(t){0===t.enemies.length?this.duration=2:this.duration=10}tick(t,e){return this.time++,this.time===this.duration?(t.entities.set(null,this.playerPos),t.entities.set(t.player,this.playerDest),t.player.position=this.playerDest,t.tiles.get(t.player.position).typeId===A.TileID?new X:0===t.enemies.length?new H:new P):this}draw(t,e){const i=this.time/this.duration;e.draw(t,[e.player]),e.player.position=o.Z.interpolate(this.playerPos,this.playerDest,i),e.player.draw(t)}}const V=[{key:"a",dir:Z.Left},{key:"4",dir:Z.Left},{key:"q",dir:Z.UpLeft},{key:"7",dir:Z.UpLeft},{key:"w",dir:Z.UpRight},{key:"9",dir:Z.UpRight},{key:"d",dir:Z.Right},{key:"6",dir:Z.Right},{key:"x",dir:Z.DownRight},{key:"3",dir:Z.DownRight},{key:"z",dir:Z.DownLeft},{key:"1",dir:Z.DownLeft}];class H{init(t){}tick(t,e){const i=this.tryGetDirection(e);if(void 0!==i){const e=o.Z.add(t.player.position,L.ToPoint(i));return t.tiles.isInBounds(e.x,e.y)&&t.tiles.get(e).isPathable?null!==t.entities.get(e)?this:new j(t.player.position,e):this}return this}tryGetDirection(t){for(let e=0;e<V.length;e++)if(t.isKeyPressed(V[e].key))return V[e].dir}draw(t,e){e.draw(t)}}class J{constructor(){this.animationTime=0}init(t){}tick(t,e){return this.animationTime++,this.animationTime>=60?new H:this}draw(t,e){e.draw(t),t.fillStyle="#000000",this.animationTime<=60&&(t.globalAlpha=1-this.animationTime/60,t.fillRect(0,0,d,d),t.globalAlpha=1),e.player.draw(t)}}class Q{constructor(){this.animationTime=0}init(t){}tick(t,e){return this.animationTime++,this.animationTime>=120?new J:this}draw(t,e){e.player.draw(t),t.fillStyle="#000000",this.animationTime<=120&&(t.globalAlpha=1-this.animationTime/120,t.fillRect(0,0,d,d),t.globalAlpha=1)}}function Y(){let t,e,i;const s=new n.Z,o=new D(s);let l,c=new Q;function w(){const i=c.tick(l,e);t.clearRect(0,0,d,d),t.fillStyle="#000000",t.fillRect(0,0,d,d),c.draw(t,l),i!==c&&(c=i,i.init(l)),e.update(),requestAnimationFrame((()=>w()))}return e=new h.Z(document.body),s.onAllFinished((function(){const e=document.getElementById("mainCanvas");t=e.getContext("2d"),i=new a.Z(e,t,d,d,!0,(()=>{})),l=new K(o,6,0,new W),(0,r.Ci)(t),w()})),()=>i.Detatch()}function $(){return s.useEffect((()=>Y())),s.createElement("div",{className:"rpgt rpgt_body full_body center",style:{background:"black"}},s.createElement("canvas",{id:"mainCanvas"}))}}}]);
//# sourceMappingURL=17.bundle.js.map