(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{106:function(t,i,o){"use strict";o.r(i),o.d(i,"default",(function(){return $}));var e,n=o(0),s=o(24),r=o(13),a=o(11),c=o(74);!function(t){t[t.Red=0]="Red",t[t.Green=1]="Green",t[t.Yellow=2]="Yellow",t[t.Blue=3]="Blue",t[t.Gray_Bounce=-1]="Gray_Bounce",t[t.Gray_TurnLeft=-2]="Gray_TurnLeft",t[t.Gray_TurnRight=-3]="Gray_TurnRight"}(e||(e={}));var h,l=e;!function(t){t[t.RR=1]="RR",t[t.RB=2]="RB",t[t.BR=2]="BR",t[t.RL=4]="RL",t[t.LR=4]="LR",t[t.RT=8]="RT",t[t.TR=8]="TR",t[t.BB=16]="BB",t[t.BL=32]="BL",t[t.LB=32]="LB",t[t.BT=64]="BT",t[t.TB=64]="TB",t[t.LL=128]="LL",t[t.LT=256]="LT",t[t.TL=256]="TL",t[t.TT=512]="TT"}(h||(h={}));var d,p=h;!function(t){t[t.Right=0]="Right",t[t.Bottom=1]="Bottom",t[t.Left=2]="Left",t[t.Top=3]="Top"}(d||(d={}));const u=[[p.RR,p.RB,p.RL,p.RT],[p.BR,p.BB,p.BL,p.BT],[p.LR,p.LB,p.LL,p.LT],[p.TR,p.TB,p.TL,p.TT]];var x=d;const y=Math.PI/2;class w{static EquivalentPosition(t){if(void 0!==t)return{position:c.a.add(t.position,w.AnchorToTileMove(t.anchor)),anchor:w.ReverseDirection(t.anchor)}}static AnchorToIndex(t){return t}static AnchorToTileMove(t){switch(t){case d.Right:return new c.a(1,0);case d.Bottom:return new c.a(0,1);case d.Left:return new c.a(-1,0);case d.Top:return new c.a(0,-1);default:throw"Bad Anchor"}}static ReverseDirection(t){return(t+2)%4}static IndexToAnchor(t){switch(t){case 0:return d.Right;case 1:return d.Bottom;case 2:return d.Left;case 3:return d.Top;default:throw"Bad Index"}}static GetAnchorOffset(t){switch(t){case d.Top:return new c.a(.5,0);case d.Bottom:return new c.a(.5,1);case d.Left:return new c.a(0,.5);case d.Right:return new c.a(1,.5);default:throw"Bad Anchor"}}static GetExitRotation(t){switch(t){case d.Top:return 3*y;case d.Bottom:return y;case d.Left:return 2*y;case d.Right:return 0;default:throw"Bad Anchor"}}static GetEntryRotation(t){return w.GetExitRotation(w.ReverseDirection(t))}static GetRealPosition(t,i){var o=c.a.Multiply(t.position,i),e=c.a.Multiply(w.GetAnchorOffset(t.anchor),i);return o.AddWith(e)}static GetMidpoint(t,i){return c.a.Multiply(t.position,i).AddWith(c.a.Multiply(i,.5))}static GetConnection(t,i){return u[t][i]}}w.AllAnchors=[d.Right,d.Bottom,d.Left,d.Top];var g=o(85);const f=new c.a(64,64),m=new c.a(18,18);class v{static Int(t,i){const o=Math.random();return void 0===t&&void 0===i?Math.floor(o*Number.MAX_SAFE_INTEGER):void 0===i?Math.floor(o*t):t+Math.floor(o*(i-t))}}class R{constructor(t,i,o,e){this.color=t,this.sprite=i,this.position=o,this.assets=e,this.nextPosition=void 0,this.parkedAt=void 0,this.parkAnimationComplete=!1,this.hasPlayedCrashAnimation=!1,this.flameRenders=[]}isCrashed(){return void 0!==this.crashedAt}crashHere(t){this.isCrashed()||this.startFlames(),this.crashedAt={position:this.position.position,anchor:t}}crashAt(t){this.isCrashed()||this.startFlames(),this.crashedAt=t}FindOutputForAlwaysTurn(t,i,o,e){if(1===o.length)return o[0];if(0===e){const t=w.ReverseDirection(i);return-1!==o.indexOf(t)?t:i}for(let t=0;t<4;t++){let n=(i+t*e)%4;if(-1!==o.indexOf(n))return n}return i}startFlames(){const t=v.Int(1,4);for(let i=0;i<t;i++){const t={anim:this.assets.fire.play(30,!0),offset:new c.a(v.Int(-6,6)-this.assets.fire.sourceSize.x/2,v.Int(-6,6)-this.assets.fire.sourceSize.y)},i=v.Int(8);for(let o=0;o<i;o++)t.anim.tick();this.flameRenders.push(t)}}EveryTick(){for(const t of this.flameRenders)t.anim.tick()}LogicTick(){this.isCrashed()&&!this.hasPlayedCrashAnimation&&(this.hasPlayedCrashAnimation=!0)}CalculateNextPosition(t){if(this.isCrashed())return void(this.hasPlayedCrashAnimation=!0);if(void 0!==this.parkedAt)return void(this.parkAnimationComplete=!0);const i=t.map[this.position.position.x][this.position.position.y],o=i.definition.connections.allConnections(this.position.anchor),e=this.chooseOutputDirection(t,i,o);if(void 0!==e)return{position:c.a.add(this.position.position,w.AnchorToTileMove(e)),anchor:w.ReverseDirection(e)};i.definition.isStop?(this.parkedAt=this.position.position,this.parkAnimationComplete=!1,Object(a.a)(t.cars,t=>t!==this&&void 0!==t.parkedAt&&t.parkedAt.x===this.position.position.x&&t.parkedAt.y===this.position.position.y)&&this.crashHere(this.position.anchor)):this.crashHere()}chooseOutputDirection(t,i,o){switch(this.color){case l.Gray_Bounce:case l.Gray_TurnLeft:case l.Gray_TurnRight:return 0===o.length?this.position.anchor:this.FindOutputForAlwaysTurn(t,this.position.anchor,o,this.color===l.Gray_Bounce?0:this.color===l.Gray_TurnLeft?1:3);default:if(0===o.length)return;if(1===o.length)return o[0];{let t=i.TryGetSignal(this.position.anchor,this.color);return null!=t&&t!==this.position.anchor?t:-1!==o.indexOf(w.ReverseDirection(this.position.anchor))?w.ReverseDirection(this.position.anchor):void 0}}}draw(t,i,o){var e;const n=w.GetRealPosition(this.position,f),s=w.GetMidpoint(this.position,f),r=w.GetEntryRotation(this.position.anchor);if(this.isCrashed()){let a;a=void 0!==this.nextPosition?this.nextPosition:void 0!==(null===(e=this.crashedAt)||void 0===e?void 0:e.anchor)?this.crashedAt:{position:c.a.add(this.position.position,w.AnchorToTileMove(w.ReverseDirection(this.position.anchor))),anchor:this.position.anchor};const h=void 0===this.crashedAt.anchor?.4:.9,l=this.hasPlayedCrashAnimation?h:i<h?i:h,d=w.GetRealPosition(a,f);let p;p=void 0!==this.parkedAt?s:c.a.Bezier([n,s,d],l),p=p.AddWith(o);const u=w.GetEntryRotation(a.anchor),x=g.a.relativeAngle(r,u);if(this.sprite.draw(t,p,this.sprite.sourceSize,r-x*l),this.hasPlayedCrashAnimation||i>l)for(const i of this.flameRenders)i.anim.draw(t,c.a.add(p,i.offset),i.anim.source.sourceSize)}else if(void 0!==this.nextPosition){const e=w.GetRealPosition(this.nextPosition,f),a=c.a.Bezier([n,s,e],i).AddWith(o),h=w.GetEntryRotation(this.nextPosition.anchor),l=g.a.relativeAngle(r,h);this.sprite.draw(t,a,this.sprite.sourceSize,r-l*i)}else if(void 0!==this.parkedAt)if(this.parkAnimationComplete)this.sprite.draw(t,s,this.sprite.sourceSize,r);else{const e=c.a.Bezier([n,s,s],i).AddWith(o);this.sprite.draw(t,e,this.sprite.sourceSize,r)}}}const T=new c.a(88,88),L=[new c.a(108,88),new c.a(88,108),new c.a(68,88),new c.a(88,68)];new c.a(0,64);class B{constructor(t,i,o,e,n){this.tile=t,this.signal=i,this.assets=o,this.dx=e,this.dy=n,this.selectedColor=l.Red,this.colorButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(0,0),new c.a(63,32)),this.colorButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(0,32),new c.a(63,32)),this.sqButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(63,0),new c.a(16,16)),this.sqButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(63,16),new c.a(16,16)),this.roundButtonUp=this.assets.ctrlPanelElements.getSprite(new c.a(63,32),new c.a(16,16)),this.roundButtonDown=this.assets.ctrlPanelElements.getSprite(new c.a(63,48),new c.a(16,16)),this.arrowIndicators=[];for(let t=0;t<4;t++)this.arrowIndicators.push(this.assets.ctrlPanelElements.getSprite(new c.a(79,16*t),new c.a(16,16)))}tryHandleClick(t,i){if(t<this.dx||i<this.dy||t>this.dx+128||i>this.dy+128)return!1;if(t-=this.dx,i-=this.dy,t<=64){const t=Math.floor(i/32);return this.selectedColor=t,!0}if(i>=64){if(t>=T.x&&i>=T.y&&t<=T.x+16&&i<=T.y+16)this.signal.clearInstructions(this.selectedColor);else{let o;if(t-=64,i-=64,t-=32,i-=32,o=Math.abs(t)>=Math.abs(i)?t<0?x.Left:x.Right:i<0?x.Top:x.Bottom,-1===this.signal.definition.outputDirs.indexOf(o))return!0;this.signal.setInstruction(this.selectedColor,o)}return!0}return!0}draw(t){var i;this.assets.ctrlPanelBackground.image||console.log("ASSETS IMAGE: "+this.assets.ctrlPanelBackground.image),t.drawImage(this.assets.ctrlPanelBackground.image,this.dx,this.dy);for(let i=0;i<4;i++){(this.selectedColor===i?this.colorButtonDown:this.colorButtonUp).draw(t,new c.a(this.dx+1,this.dy+32*i),new c.a(63,32)),this.assets.carImageAtlas.getSprite(new c.a(18*i,0),new c.a(18,18)).draw(t,new c.a(this.dx+1+31.5-8,this.dy+32*i+16-8),new c.a(18,18))}const o=null!==(i=this.signal.getInstruction(this.selectedColor))&&void 0!==i?i:-1;for(let i=0;i<4;i++){(o===i?this.sqButtonDown:this.sqButtonUp).draw(t,new c.a(this.dx+L[i].x,this.dy+L[i].y),new c.a(16,16)),this.arrowIndicators[i].draw(t,new c.a(this.dx+L[i].x,this.dy+L[i].y),new c.a(16,16))}(-1===o?this.roundButtonDown:this.roundButtonUp).draw(t,new c.a(this.dx+T.x,this.dy+T.y),new c.a(16,16)),this.tile.draw_offgrid(t,this.dx+72,this.dy+8,48,this.assets)}}var A=[[p.LR,1023],[p.TB,1023],[p.RB,p.RB|p.LB|p.TR|p.RR|p.BB],[p.RT,p.RT|p.LT|p.RB|p.RR|p.TT],[p.BL,p.BL|p.RB|p.TL|p.BB|p.LL],[p.LT,p.LT|p.RT|p.LB|p.LL|p.TT],[p.RR,0],[p.BB,0],[p.LL,0],[p.TT,0]],S=[[p.LR,p.LR],[p.TB,p.TB],[p.RB,p.RB],[p.RT,p.RT],[p.BL,p.BL],[p.LT,p.LT],[p.RR,0],[p.BB,0],[p.LL,0],[p.TT,0]];const b=[new c.a(1,0),new c.a(0,1),new c.a(-1,0),new c.a(0,-1)];class C{constructor(t){this.definition=t,this.currentSignals=new Map}getInstruction(t){if(this.currentSignals.has(t))return this.currentSignals.get(t)}setInstruction(t,i){this.currentSignals.set(t,i)}clearInstructions(t){null==t?this.currentSignals.clear():this.currentSignals.delete(t)}getRenderPosition(t){return w.GetMidpoint({position:t},f).SubtractWith(3,3).AddWith(this.definition.dx,this.definition.dy)}draw(t,i,o,e){const n=w.GetMidpoint({position:i},f).SubtractWith(3,3);t.drawImage(o,n.x+this.definition.dx,n.y+this.definition.dy);const s=[0,0,0,0];for(var[r,a]of this.currentSignals.entries()){const i=s[a]++,o=b[a],h=c.a.add(n,c.a.Multiply(o,6+3*i)).AddWith(this.definition.dx,this.definition.dy);e.render(t,h.x,h.y,6,6,a,r)}}draw_offgrid(t,i,o,e,n){const s=i.AddWith(c.a.Multiply(o,.5,.5)).SubtractWith(3,3);t.drawImage(e,s.x+this.definition.dx,s.y+this.definition.dy);const r=[0,0,0,0];for(var[a,h]of this.currentSignals.entries()){const i=r[h]++,o=b[h],e=c.a.add(s,c.a.Multiply(o,6+3*i)).AddWith(this.definition.dx,this.definition.dy);n.render(t,e.x,e.y,6,6,h,a)}}}class P{constructor(t,i,o){this.definition=t,this.image=i,this.endpointColor=o,this.signals=[];for(const i of t.signals)this.signals.push(new C(i));this.overdrawAnchors=3===this.definition.tileId?[x.Left,x.Right]:[]}TryGetSignal(t,i){for(const o of this.signals)if(-1!==o.definition.inputDirs.indexOf(t))return o.getInstruction(i)}CheckColisions(t,i){if(void 0===t.nextPosition||void 0===i.nextPosition)return!0;let o=w.GetConnection(t.position.anchor,w.ReverseDirection(t.nextPosition.anchor)),e=w.GetConnection(i.position.anchor,w.ReverseDirection(i.nextPosition.anchor));for(const[t,i]of this.definition.isCrossover?S:A){if(t===o&&(i&e)>0)return!0;if(t===e&&(i&o)>0)return!0}return!1}GetPositionAdjust(t,i,o){if(3===this.definition.tileId&&!(t!==x.Left&&t!==x.Right||i!==x.Left&&i!==x.Right)){let t=2*o;return t>1&&(t=1-t%1),t=Math.pow(t,.5),new c.a(0,5*-t)}return new c.a(0,0)}draw(t,i,o,e){this.image.draw(t,new c.a(64*i,64*o),f);for(const n of this.signals)n.draw(t,new c.a(i,o),e.signalHubImage.image,e.signalArrowsImage);if(this.definition.isStop&&void 0!==this.endpointColor&&null!==this.endpointColor){const n=(64-e.spawnRingSheet.spriteWidth)/2;e.spawnRingSheet.render(t,64*i+n,64*o+n,e.spawnRingSheet.spriteWidth,e.spawnRingSheet.spriteHeight,this.endpointColor,1)}}overdraw(t,i,o,e){3===this.definition.tileId&&e.getTrackSprite(39).draw(t,new c.a(64*i,64*o),f)}draw_offgrid(t,i,o,e,n){this.image.draw(t,new c.a(i,o),new c.a(e,e));for(const s of this.signals)s.draw_offgrid(t,new c.a(i,o),new c.a(e,e),n.signalHubImage.image,n.signalArrowsImage)}}class k{constructor(t){this.connections=[];for(let i=0;i<4;i++){const o=[];for(let e=i;e<4;e++)o.push((1&t)>0),t>>=1;this.connections.push(o)}}connection(t,i,o){const e=w.AnchorToIndex(t),n=w.AnchorToIndex(i),s=Math.min(e,n),r=Math.max(e,n);if(void 0===o)return this.connections[s][r-s];this.connections[s][r-s]=o}allConnections(t){let i=[];for(const o of w.AllAnchors)this.connection(t,o)&&i.push(o);return i}}class M{constructor(t,i,o=!1,e=!1,n=!1){this.tileId=t,this.isStop=e,this.isCrossover=n,this.connections=new k(i),this.signals=[];for(const t of w.AllAnchors){const i=this.connections.allConnections(t);if(i.length>1){let e;o||0===this.signals.length?(e=Object.assign(Object.assign({},E(o,t)),{inputDirs:[],outputDirs:[]}),this.signals.push(e)):e=this.signals[0],e.inputDirs.push(t);for(const t of i)e.outputDirs.push(t)}}}}function E(t,i){if(!t)return{dx:0,dy:0};const o=w.AnchorToTileMove(i).MultWith(16);return{dx:o.x,dy:o.y}}var I=[null,new M(1,p.TB),new M(2,p.LR),new M(3,p.TB|p.LR,!1,!1,!0),new M(4,p.RT),new M(5,p.RB),new M(6,p.LB),new M(7,p.LT),new M(8,p.RT|p.RB,!0),new M(9,p.RB|p.LB,!0),new M(10,p.LT|p.LB,!0),new M(11,p.LT|p.RT,!0),new M(12,p.RT|p.RB|p.TB),new M(13,p.RB|p.LB|p.LR),new M(14,p.LT|p.LB|p.TB),new M(15,p.LT|p.RT|p.LR),new M(16,0,!1,!0),new M(17,0,!1,!0),new M(18,0,!1,!0),new M(19,0,!1,!0),new M(20,p.LT|p.RB),new M(21,p.RT|p.LB),new M(22,p.RB|p.RT|p.LB|p.LT|p.LR|p.TB),new M(23,p.RB|p.RT|p.LB|p.LT,!0),new M(24,p.RR),new M(25,p.BB),new M(26,p.LL),new M(27,p.TT),new M(28,p.RR|p.TT),new M(29,p.BB|p.RR),new M(30,p.LL|p.BB),new M(31,p.TT|p.LL),new M(32,p.RR|p.TT|p.BB),new M(33,p.BB|p.RR|p.LL),new M(34,p.LL|p.BB|p.TT),new M(35,p.TT|p.LL|p.RR),new M(36,p.RR|p.LL),new M(37,p.BB|p.TT),new M(38,p.RR|p.LL|p.BB|p.TT),null,new M(39,p.RT|p.LL,!1,!1,!0),new M(40,p.RB|p.TT,!1,!1,!0),new M(41,p.LB|p.TT,!1,!1,!0),new M(42,p.LT|p.RR,!1,!1,!0),new M(43,p.RT|p.BB,!1,!1,!0),new M(44,p.RB|p.LL,!1,!1,!0),new M(45,p.LB|p.RR,!1,!1,!0),new M(46,p.LT|p.BB,!1,!1,!0),new M(47,p.RT|p.LL|p.BB,!1,!1,!0),new M(48,p.RB|p.TT|p.LL,!1,!1,!0),new M(49,p.LB|p.TT|p.RR,!1,!1,!0),new M(50,p.LT|p.RR|p.BB,!1,!1,!0)];class O{constructor(t,i,o){this.level=t,this.canvas=i,this.assets=o,this.map=[];for(let i=0;i<t.width;i++){let i=[];for(let o=0;o<t.height;o++)i.push(null);this.map.push(i)}let e=new Array(t.mapdata.length);for(const i of t.endpoints)e[i.position.x+i.position.y*t.width]=i.color;for(let i=0;i<t.mapdata.length;i++){let n=i%t.width,s=Math.floor(i/t.width);const r=I[t.mapdata[i]];this.map[n][s]=null===r?null:new P(r,o.getTrackSprite(r.tileId),e[i])}this.ResetLevel()}tryGetOverlay(t,i){const o=new c.a(Math.floor(t.x/64),Math.floor(t.y/64)),e=this.map[o.x][o.y];if(null==e||0===e.signals.length)return;const n=Object(a.c)(e.signals,i=>c.a.subtract(i.getRenderPosition(o),t).LengthSq()),s=new c.a(64*o.x+64,64*o.y);return this.canvas.width/i-s.x<this.assets.ctrlPanelBackground.image.width&&(s.x=64*o.x-this.assets.ctrlPanelBackground.image.width),this.canvas.height/i-s.y<this.assets.ctrlPanelBackground.image.height&&(s.y=this.canvas.height/i-this.assets.ctrlPanelBackground.image.height),new B(e,n,this.assets,s.x,s.y)}ResetLevel(){this.cars=[];for(const t of this.level.spawns)t.color>=0?this.cars.push(new R(t.color,this.assets.carImageAtlas.getSprite(new c.a(18*t.color,0),m,new c.a(.5,.5)),w.EquivalentPosition({position:new c.a(t.position.x,t.position.y),anchor:t.direction}),this.assets)):this.cars.push(new R(t.color,this.assets.carImageAtlas.getSprite(new c.a(18*(3-t.color),0),m,new c.a(.5,.5)),w.EquivalentPosition({position:new c.a(t.position.x,t.position.y),anchor:t.direction}),this.assets));this.updateCars()}updateCars(){for(const t of this.cars)t.LogicTick(),t.isCrashed()||(void 0!==t.nextPosition&&(t.position=t.nextPosition),t.nextPosition=t.CalculateNextPosition(this));for(const[t,i]of Object(a.b)(this.cars,t=>t.position.position,(t,i)=>t.x===i.x&&t.y===i.y))for(let o=0;o<i.length;o++)for(let e=o+1;e<i.length;e++)this.map[t.x][t.y].CheckColisions(i[o],i[e])&&(i[o].crashHere(),i[e].crashHere());for(const t of this.cars){if(void 0===t.nextPosition)continue;const i=w.EquivalentPosition(t.nextPosition);for(const o of this.cars)t!==o&&void 0!==o.nextPosition&&i.anchor===o.nextPosition.anchor&&i.position.Equals(o.nextPosition.position)&&(t.crashAt(t.nextPosition),o.crashAt(o.nextPosition))}}draw(t,i,o){var e,n;for(const t of this.cars)t.EveryTick();for(let t=0;t<this.map.length;t++)for(let o=0;o<this.map[t].length;o++)null!==this.map[t][o]&&this.map[t][o].draw(i,t,o,this.assets);const s=[];for(const t of this.cars){const n=this.map[t.position.position.x][t.position.position.y],r=t.position.anchor,c=null===(e=t.nextPosition)||void 0===e?void 0:e.anchor,h=[t.position,t.nextPosition,w.EquivalentPosition(t.position),w.EquivalentPosition(t.nextPosition)];Object(a.a)(h,t=>void 0!==t&&-1!==this.map[t.position.x][t.position.y].overdrawAnchors.indexOf(t.anchor))?s.push(t):t.draw(i,o,n.GetPositionAdjust(r,c,o))}for(let t=0;t<this.map.length;t++)for(let o=0;o<this.map[t].length;o++)null!==this.map[t][o]&&this.map[t][o].overdraw(i,t,o,this.assets);for(const t of s){const e=this.map[t.position.position.x][t.position.position.y],s=t.position.anchor,r=null===(n=t.nextPosition)||void 0===n?void 0:n.anchor;t.draw(i,o,e.GetPositionAdjust(s,r,o))}}}var D=o(86),G=o.p+"92b0680d8018abdf6ab4dce2cb8e7f4d.png",_=o.p+"40546b074d24707026ba482019c4d3b4.png",z=o.p+"068a4cb9e7cd5cde1c23e8fb17e230c2.png",F=o.p+"12b15dc75181d5095f7bc26eeb5312c5.png",W=o.p+"c8060df9573385c396cd3cb0a91f4424.png",q=o.p+"f50a8f7fc9e146163272568decddbc2a.png",j=o.p+"560f633704b347d793db51e0a3fb7475.png",H=o.p+"41279bc0b13b415202281fa495c04151.png",N=o(82),U=o(37),J=o(25),K=o(92);class Y{constructor(t){this.trackImageAtlas=new N.b(G,t.registerAssetLoadCallback()),this.carImageAtlas=new N.b(_,t.registerAssetLoadCallback()),this.signalArrowsImage=new J.a(6,6,z,t.registerAssetLoadCallback()),this.signalHubImage=new U.a(F,t.registerAssetLoadCallback()),this.ctrlPanelBackground=new U.a(W,t.registerAssetLoadCallback()),this.ctrlPanelElements=new N.b(j,t.registerAssetLoadCallback()),this.spawnRingSheet=new J.a(48,48,H,t.registerAssetLoadCallback()),this.fire=new K.a(new N.b(q,t.registerAssetLoadCallback()),new c.a(0,0),new c.a(8,16),4)}getTrackSprite(t){const i=t%4,o=Math.floor(t/4);return this.trackImageAtlas.getSprite(new c.a(64*i,64*o),f)}}var X=0;class Q{constructor(t){this.canvas=t,this.runnerID=X++,console.log("Create runner "+this.runnerID),Object(r.b)(t,1024,768),this.ctx=t.getContext("2d"),this.ctx.save(),this.repaintTimer=-1,this.interpFrameCount=0,this.isRunning=!1,this.isDestroyed=!1,this.boundEventListener=this.handleMouseEvent.bind(this),this.overlay=void 0,t.addEventListener("click",this.boundEventListener)}handleKeyEvent(t){return"escape"===t.key&&(this.overlay=void 0,!0)}handleMouseEvent(t){var i,o;if(this.isRunning)return;const e=new c.a(t.offsetX/this.canvasScale,t.offsetY/this.canvasScale);null!==(o=null===(i=this.overlay)||void 0===i?void 0:i.tryHandleClick(e.x,e.y))&&void 0!==o&&o||(this.overlay=this.gameState.tryGetOverlay(e,this.canvasScale))}start(){const t=new s.a;this.assets=new Y(t),t.onAllFinished(this.loadComplete.bind(this))}toggleRunning(){this.gameState.ResetLevel(),this.interpFrameCount=0,this.isRunning=!this.isRunning,this.overlay=void 0}loadLevel(t){console.log("LOAD"),this.ctx.restore(),this.ctx.save();const i=64*t.width,o=64*t.height;console.log(2*i+", 1024"),2*i<=1024&&2*o<=1024?(Object(r.b)(this.canvas,2*i,2*o),Object(r.a)(this.ctx),this.ctx.scale(2,2),this.canvasScale=2):(Object(r.b)(this.canvas,i,o),this.canvasScale=1),this.gameState=new O(t,this.canvas,this.assets),this.interpFrameCount=0,this.overlay=void 0}loadComplete(){this.gameState=new O(D[0],this.canvas,this.assets),this.loadLevel(D[0]),this.runTick()}runTick(){this.isDestroyed||(this.tick(),this.draw(),this.repaintTimer=requestAnimationFrame(this.runTick.bind(this)))}tick(){this.isRunning?(this.interpFrameCount++,this.interpFrameCount>=40&&(this.interpFrameCount=0,this.gameState.updateCars())):this.interpFrameCount=0}draw(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.gameState.draw(this.canvas,this.ctx,this.interpFrameCount/40),this.ctx.restore(),void 0!==this.overlay&&this.overlay.draw(this.ctx)}stop(){-1!==this.repaintTimer&&cancelAnimationFrame(this.repaintTimer),this.isDestroyed=!0,this.canvas.removeEventListener("click",this.boundEventListener),console.log("Destroy runner "+this.runnerID)}}var V=o.p+"438abab473a4076d9d4cd251e4a9f56d.png";function Z(t){const i=n.useRef();return n.useEffect(()=>{if(void 0===i.current||void 0===t.previewSheet)return;Object(r.b)(i.current,16*t.level.width,16*t.level.height);const o=i.current.getContext("2d");o.clearRect(0,0,16*t.level.width,16*t.level.height);let e=0;for(var n=0;n<t.level.height;n++)for(var s=0;s<t.level.width;s++){const i=t.level.mapdata[e++],r=Math.floor(i%4),a=Math.floor(i/4);t.previewSheet.render(o,16*s,16*n,16,16,r,a)}},[i.current]),n.createElement("div",{className:"flex row align-center",style:{border:"1px solid black",padding:"0 0 0 8px"},onClick:i=>t.onClick(i.nativeEvent)},n.createElement("span",null,t.level.id,": ",t.level.name),n.createElement("canvas",{ref:i}))}function $(){const t=n.useRef(),i=function(t,i){const[o,e]=Object(n.useState)(void 0);return Object(n.useEffect)(()=>{console.log("Reload item");const i=new s.a,o=t(i.registerAssetLoadCallback());i.onAllFinished(()=>{e(o)})},i),o}(t=>new J.a(16,16,V,t),[]),[o,e]=n.useState(void 0),[r,a]=n.useState(!1);return n.useEffect(()=>{if(void 0===t.current)return;const i=new Q(t.current);return e(i),i.start(),()=>i.stop()},[t.current,i]),void 0===i?n.createElement("div",null,"Loading..."):n.createElement("div",{className:"flex row"},n.createElement("canvas",{ref:t,tabIndex:0,onKeyDown:t=>{var i;32===t.keyCode?(null==o||o.toggleRunning(),t.preventDefault(),t.stopPropagation()):null!==(i=null==o?void 0:o.handleKeyEvent(t.nativeEvent))&&void 0!==i&&i&&(t.preventDefault(),t.stopPropagation())}}),n.createElement("div",{className:"flex col"},n.createElement("button",{onClick:t=>{o&&o.toggleRunning()}},"Start/Reset"),n.createElement("button",{onClick:()=>a(!r)},r?"Hide Level Select":"Show Level Select"),r?D.map(t=>n.createElement(Z,{key:t.id,level:t,previewSheet:i,onClick:i=>{null==o||o.loadLevel(t),i.preventDefault(),i.stopImmediatePropagation()}})):n.createElement(n.Fragment,null)))}},74:function(t,i,o){"use strict";o.d(i,"a",(function(){return e}));class e{constructor(t,i){this.x=t,this.y=i}static zero(){return new e(0,0)}static fromAngle(t,i){return new e(Math.cos(t)*(null!=i?i:1),Math.sin(t)*(null!=i?i:1))}LengthSq(){return e.Dot(this,this)}Length(){return Math.sqrt(this.LengthSq())}Clone(){return new e(this.x,this.y)}Negate(){return new e(-this.x,-this.y)}NegateInPlace(){return this.x=-this.x,this.y=-this.y,this}static Dot(t,i){return t.x*i.x+t.y*i.y}DotWith(t){return e.Dot(this,t)}normalize(){let t=this.Length();return e.Multiply(this,1/t)}Direction(){return Math.atan2(this.y,this.x)}AddWith(t,i){const{x:o,y:e}=n(t,i);return this.x+=o,this.y+=e,this}MultWith(t,i){const{x:o,y:e}=function(t,i){if(void 0===i)return void 0!==t.x?{x:t.x,y:t.y}:{x:t,y:t};return{x:t,y:i}}(t,i);return this.x*=o,this.y*=e,this}SubtractWith(t,i){const{x:o,y:e}=n(t,i);return this.x-=o,this.y-=e,this}DivideWith(t,i){const{x:o,y:e}=n(t,i);return this.x/=o,this.y/=e,this}Equals(t){return this.x===t.x&&this.y===t.y}static add(t,i,o){const{x:s,y:r}=n(i,o);return new e(t.x+s,t.y+r)}static subtract(t,i,o){const{x:s,y:r}=n(i,o);return new e(t.x-s,t.y-r)}static Multiply(t,i,o){return void 0!==o?new e(t.x*i,t.y*o):void 0!==i.x?new e(t.x*i.x,t.y*i.y):new e(t.x*i,t.y*i)}static interpolate(t,i,o){return new e(t.x+(i.x-t.x)*o,t.y+(i.y-t.y)*o)}static componentMin(t,i){return t.x<=i.x&&t.y<=i.y?t:i.x<=t.x&&i.y<=t.y?i:new e(Math.min(t.x,i.x),Math.min(t.y,i.y))}static componentMax(t,i){return t.x>=i.x&&t.y>=i.y?t:i.x>=t.x&&i.y>=t.y?i:new e(Math.max(t.x,i.x),Math.max(t.y,i.y))}static Bezier(t,i){return 1===t.length?t[0]:2===t.length?e.add(e.Multiply(t[1],i),e.Multiply(t[0],1-i)):e.add(e.Multiply(e.Bezier(t.slice(1),i),i),e.Multiply(e.Bezier(t.slice(0,t.length-1),i),1-i))}rotate(t){const i=Math.atan2(this.y,this.x),o=this.Length();return e.fromAngle(i+t,o)}}function n(t,i){return void 0===i?{x:t.x,y:t.y}:{x:t,y:i}}},82:function(t,i,o){"use strict";o.d(i,"b",(function(){return s})),o.d(i,"a",(function(){return r}));var e=o(74),n=o(92);class s{constructor(t,i){this.onload=i,this.image=document.createElement("img"),this.image.src=t,this.image.addEventListener("load",()=>this.loadFinished())}loadFinished(){this.onload()}getSprite(t,i,o,e){return new r(this,t,i,o,e)}getAnimation(t,i,o,e){return new n.a(this,t,i,e,o)}}class r{constructor(t,i,o,n,s){this.atlas=t,this.sourceOffset=i,this.sourceSize=o,this.origin=null!=n?n:new e.a(0,0),this.sourceRotation=null!=s?s:0}draw(t,i,o,e){t.save(),t.translate(i.x,i.y),t.rotate((null!=e?e:0)+this.sourceRotation),t.scale(o.x,o.y),t.translate(-this.origin.x,-this.origin.y),t.drawImage(this.atlas.image,this.sourceOffset.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),t.restore()}}},85:function(t,i,o){"use strict";o.d(i,"a",(function(){return n}));const e=2*Math.PI;class n{static normalize(t){return(t%=e)<0&&(t+=e),t}static relativeNormalize(t){return(t%=e)>Math.PI?t-=e:t<-Math.PI&&(t+=e),t}static relativeAngle(t,i){return n.relativeNormalize(t-i)}}},86:function(t){t.exports=JSON.parse('[{"id":0,"name":"Custom_1","width":8,"height":8,"mapdata":[5,26,16,6,17,5,6,17,8,6,24,23,22,3,20,7,8,7,24,22,15,22,15,6,12,33,6,1,17,4,13,7,12,22,14,12,14,5,15,6,12,22,14,12,14,4,13,7,8,22,10,12,14,5,11,6,4,15,15,15,15,15,2,7],"spawns":[{"position":{"x":2,"y":2},"color":0,"direction":0},{"position":{"x":2,"y":1},"color":3,"direction":0},{"position":{"x":5,"y":3},"color":-1,"direction":0},{"position":{"x":6,"y":4},"color":-1,"direction":0},{"position":{"x":6,"y":5},"color":-1,"direction":2},{"position":{"x":1,"y":3},"color":-1,"direction":1},{"position":{"x":1,"y":3},"color":2,"direction":0},{"position":{"x":1,"y":3},"color":0,"direction":2},{"position":{"x":4,"y":7},"color":-2,"direction":3},{"position":{"x":4,"y":5},"color":-2,"direction":3},{"position":{"x":3,"y":6},"color":-3,"direction":3}],"endpoints":[{"position":{"x":7,"y":0},"color":3},{"position":{"x":2,"y":0},"color":0},{"position":{"x":4,"y":0},"color":2},{"position":{"x":4,"y":3},"color":0}]},{"id":1,"name":"Custom_2","width":8,"height":7,"mapdata":[0,0,25,25,25,25,24,6,5,13,22,22,22,22,13,14,1,1,1,37,1,37,4,7,4,15,22,22,22,22,13,6,0,0,37,1,37,1,1,1,0,16,22,22,22,22,15,7,0,0,27,27,27,27,0,0],"spawns":[{"position":{"x":6,"y":0},"color":0,"direction":0},{"position":{"x":5,"y":2},"color":-1,"direction":3},{"position":{"x":3,"y":2},"color":-1,"direction":3},{"position":{"x":4,"y":1},"color":-1,"direction":1},{"position":{"x":2,"y":0},"color":-1,"direction":1},{"position":{"x":3,"y":2},"color":-1,"direction":1},{"position":{"x":5,"y":2},"color":-1,"direction":1},{"position":{"x":4,"y":4},"color":-1,"direction":1},{"position":{"x":2,"y":5},"color":-1,"direction":1},{"position":{"x":6,"y":4},"color":-2,"direction":1},{"position":{"x":1,"y":2},"color":-2,"direction":3}],"endpoints":[{"position":{"x":1,"y":5},"color":0}]},{"id":2,"name":"Original_1","width":8,"height":6,"mapdata":[5,13,13,2,2,13,13,6,1,27,12,13,9,14,1,1,12,2,23,22,23,22,7,1,1,16,14,1,1,1,24,14,19,25,1,12,3,14,16,14,0,4,15,15,15,15,2,7],"spawns":[{"position":{"x":6,"y":3},"color":3,"direction":0},{"position":{"x":1,"y":4},"color":3,"direction":1},{"position":{"x":1,"y":1},"color":1,"direction":3},{"position":{"x":3,"y":4},"color":-2,"direction":3},{"position":{"x":4,"y":2},"color":-2,"direction":3},{"position":{"x":5,"y":5},"color":-1,"direction":3}],"endpoints":[{"position":{"x":0,"y":4},"color":3},{"position":{"x":1,"y":3},"color":3},{"position":{"x":6,"y":4},"color":1}]},{"id":3,"name":"Original_10","width":8,"height":6,"mapdata":[17,17,17,25,25,25,25,0,12,21,14,12,23,15,23,18,4,22,23,23,15,13,22,26,24,10,12,23,13,21,23,18,24,23,22,14,12,22,23,18,0,4,15,15,15,15,7,0],"spawns":[{"position":{"x":6,"y":0},"color":3,"direction":1},{"position":{"x":0,"y":3},"color":3,"direction":0},{"position":{"x":4,"y":0},"color":1,"direction":1},{"position":{"x":0,"y":4},"color":1,"direction":0},{"position":{"x":5,"y":0},"color":0,"direction":1}],"endpoints":[{"position":{"x":0,"y":0},"color":2},{"position":{"x":1,"y":0},"color":1},{"position":{"x":2,"y":0},"color":3},{"position":{"x":7,"y":3},"color":3},{"position":{"x":7,"y":4},"color":1},{"position":{"x":7,"y":1},"color":0}]},{"id":4,"name":"Original_11","width":8,"height":6,"mapdata":[5,13,13,13,13,2,2,6,1,1,12,23,23,2,13,14,19,1,1,1,12,13,23,10,17,12,23,14,1,37,1,1,1,1,1,4,15,15,23,10,4,15,15,2,2,2,15,7],"spawns":[{"position":{"x":5,"y":3},"color":0,"direction":1},{"position":{"x":5,"y":3},"color":0,"direction":3},{"position":{"x":7,"y":1},"color":-1,"direction":3},{"position":{"x":2,"y":3},"color":-1,"direction":0},{"position":{"x":2,"y":5},"color":-1,"direction":0}],"endpoints":[{"position":{"x":0,"y":2},"color":0},{"position":{"x":0,"y":3},"color":0}]},{"id":5,"name":"Original_2","width":8,"height":6,"mapdata":[5,6,25,25,5,26,0,0,12,14,1,1,1,17,17,17,12,15,15,15,15,15,15,14,12,2,2,2,2,2,2,14,12,2,2,2,2,2,2,14,4,2,2,2,2,2,2,7],"spawns":[{"position":{"x":3,"y":0},"color":0,"direction":1},{"position":{"x":2,"y":0},"color":1,"direction":1},{"position":{"x":5,"y":0},"color":3,"direction":2},{"position":{"x":6,"y":2},"color":-1,"direction":2},{"position":{"x":4,"y":3},"color":-2,"direction":2},{"position":{"x":1,"y":3},"color":-2,"direction":2},{"position":{"x":3,"y":4},"color":-2,"direction":0},{"position":{"x":7,"y":4},"color":-2,"direction":3}],"endpoints":[{"position":{"x":7,"y":1},"color":0},{"position":{"x":6,"y":1},"color":1},{"position":{"x":5,"y":1},"color":3}]},{"id":6,"name":"Original_3","width":8,"height":6,"mapdata":[5,13,13,2,6,0,17,0,1,12,3,2,23,6,1,0,12,7,1,24,14,1,1,17,12,26,1,0,12,22,14,1,19,25,12,2,15,15,14,1,0,4,15,2,2,2,11,7],"spawns":[{"position":{"x":3,"y":2},"color":3,"direction":0},{"position":{"x":1,"y":4},"color":0,"direction":1},{"position":{"x":1,"y":3},"color":2,"direction":2},{"position":{"x":3,"y":0},"color":-2,"direction":2}],"endpoints":[{"position":{"x":0,"y":4},"color":0},{"position":{"x":6,"y":0},"color":2},{"position":{"x":7,"y":2},"color":3}]},{"id":7,"name":"Original_4","width":8,"height":6,"mapdata":[5,2,6,5,13,13,13,6,8,6,19,1,4,15,15,14,8,3,9,14,5,13,13,7,8,23,23,11,14,1,1,25,12,14,1,5,15,7,8,7,4,11,7,4,2,2,7,0],"spawns":[{"position":{"x":7,"y":3},"color":0,"direction":1},{"position":{"x":2,"y":5},"color":-2,"direction":3},{"position":{"x":7,"y":0},"color":-2,"direction":2},{"position":{"x":4,"y":1},"color":-2,"direction":0},{"position":{"x":5,"y":1},"color":-3,"direction":3},{"position":{"x":4,"y":2},"color":-3,"direction":0},{"position":{"x":3,"y":2},"color":-3,"direction":1}],"endpoints":[{"position":{"x":2,"y":1},"color":0}]},{"id":8,"name":"Original_5","width":8,"height":6,"mapdata":[24,2,2,6,5,2,18,0,0,0,0,12,14,0,5,18,16,2,13,14,12,13,7,0,5,2,15,14,12,15,2,18,1,24,13,7,4,13,26,0,19,24,15,2,2,15,26,0],"spawns":[{"position":{"x":0,"y":0},"color":2,"direction":0},{"position":{"x":6,"y":5},"color":2,"direction":2},{"position":{"x":1,"y":5},"color":1,"direction":0},{"position":{"x":1,"y":4},"color":0,"direction":0},{"position":{"x":6,"y":4},"color":3,"direction":2}],"endpoints":[{"position":{"x":0,"y":5},"color":3},{"position":{"x":0,"y":2},"color":2},{"position":{"x":7,"y":3},"color":2},{"position":{"x":6,"y":0},"color":1},{"position":{"x":7,"y":1},"color":0}]},{"id":9,"name":"Original_6","width":8,"height":6,"mapdata":[16,9,2,9,13,2,9,26,5,14,0,1,4,6,1,0,1,8,13,22,2,15,10,0,4,14,1,1,0,0,12,26,0,8,15,22,2,2,10,0,0,19,0,27,0,0,19,0],"spawns":[{"position":{"x":7,"y":0},"color":0,"direction":2},{"position":{"x":7,"y":3},"color":0,"direction":2},{"position":{"x":3,"y":5},"color":0,"direction":3}],"endpoints":[{"position":{"x":1,"y":5},"color":0},{"position":{"x":6,"y":5},"color":0},{"position":{"x":0,"y":0},"color":0}]},{"id":10,"name":"Original_7","width":8,"height":6,"mapdata":[17,17,17,17,17,17,17,17,12,15,22,22,22,22,22,14,1,0,12,23,11,15,22,14,8,13,23,22,13,13,23,34,12,22,22,23,22,22,22,7,27,27,27,27,27,27,27,0],"spawns":[{"position":{"x":6,"y":5},"color":3,"direction":3},{"position":{"x":4,"y":5},"color":3,"direction":3},{"position":{"x":3,"y":5},"color":3,"direction":3},{"position":{"x":5,"y":5},"color":1,"direction":3},{"position":{"x":0,"y":5},"color":1,"direction":3},{"position":{"x":7,"y":3},"color":0,"direction":1},{"position":{"x":2,"y":5},"color":2,"direction":3},{"position":{"x":1,"y":5},"color":2,"direction":3}],"endpoints":[{"position":{"x":0,"y":0},"color":3},{"position":{"x":7,"y":0},"color":3},{"position":{"x":4,"y":0},"color":3},{"position":{"x":6,"y":0},"color":1},{"position":{"x":2,"y":0},"color":1},{"position":{"x":1,"y":0},"color":0},{"position":{"x":3,"y":0},"color":2},{"position":{"x":5,"y":0},"color":2}]},{"id":11,"name":"Original_8","width":8,"height":6,"mapdata":[5,9,6,5,6,16,2,6,12,14,8,20,7,5,6,1,19,1,27,1,25,27,1,1,17,1,5,23,20,2,7,1,1,12,14,12,3,2,6,1,4,15,15,15,15,2,15,7],"spawns":[{"position":{"x":5,"y":2},"color":1,"direction":3},{"position":{"x":2,"y":2},"color":0,"direction":3},{"position":{"x":4,"y":2},"color":3,"direction":1},{"position":{"x":1,"y":2},"color":-1,"direction":3},{"position":{"x":3,"y":4},"color":-3,"direction":1}],"endpoints":[{"position":{"x":0,"y":3},"color":3},{"position":{"x":0,"y":2},"color":1},{"position":{"x":5,"y":0},"color":0}]},{"id":12,"name":"Original_9","width":8,"height":6,"mapdata":[0,24,13,13,2,13,26,0,5,2,22,22,2,3,2,6,4,2,22,3,2,22,6,1,17,5,22,22,2,22,20,7,1,4,22,3,2,3,7,17,4,2,15,7,0,4,2,7],"spawns":[{"position":{"x":6,"y":0},"color":0,"direction":2},{"position":{"x":1,"y":0},"color":1,"direction":0},{"position":{"x":2,"y":1},"color":-1,"direction":2},{"position":{"x":4,"y":1},"color":-1,"direction":2},{"position":{"x":2,"y":2},"color":-1,"direction":0},{"position":{"x":5,"y":2},"color":-1,"direction":0},{"position":{"x":7,"y":2},"color":-1,"direction":3},{"position":{"x":3,"y":3},"color":-1,"direction":2},{"position":{"x":5,"y":3},"color":-1,"direction":2},{"position":{"x":6,"y":3},"color":-1,"direction":0},{"position":{"x":4,"y":4},"color":-1,"direction":0},{"position":{"x":1,"y":4},"color":-1,"direction":0}],"endpoints":[{"position":{"x":7,"y":4},"color":1},{"position":{"x":0,"y":3},"color":0}]}]')},92:function(t,i,o){"use strict";o.d(i,"a",(function(){return n}));var e=o(74);class n{constructor(t,i,o,n,s){this.atlas=t,this.sourceOffset=i,this.sourceSize=o,this.numFrames=n,this.origin=null!=s?s:new e.a(0,0)}draw(t,i,o,e,n){t.save(),t.translate(i.x,i.y),void 0!==n&&t.rotate(n),t.scale(o.x,o.y),t.translate(-this.origin.x,-this.origin.y),t.drawImage(this.atlas.image,this.sourceOffset.x+e*this.sourceSize.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),t.restore()}play(t,i){var o;return void 0!==t.animation?new s(this,t.maxTime,null!==(o=t.loop)&&void 0!==o&&o):new s(this,t,null!=i&&i)}}class s{constructor(t,i,o){this.source=t,this.maxTime=i,this.loop=o,this.currentTime=0}tick(){return this.currentTime++,!(this.currentTime<this.maxTime)&&(this.loop&&(this.currentTime=0),!0)}draw(t,i,o,e){const n=Math.floor(this.currentTime*this.source.numFrames/this.maxTime);this.source.draw(t,i,o,n,e)}}}}]);
//# sourceMappingURL=10.bundle.js.map