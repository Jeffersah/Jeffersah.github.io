"use strict";(self.webpackChunktrading_game=self.webpackChunktrading_game||[]).push([[287],{8785:(e,t,r)=>{r.d(t,{Z:()=>s});class s{constructor(e,t){this.x=e,this.y=t}static zero(){return new s(0,0)}static fromAngle(e,t){return new s(Math.cos(e)*(null!=t?t:1),Math.sin(e)*(null!=t?t:1))}LengthSq(){return s.Dot(this,this)}Length(){return Math.sqrt(this.LengthSq())}Clone(){return new s(this.x,this.y)}Negate(){return new s(-this.x,-this.y)}NegateInPlace(){return this.x=-this.x,this.y=-this.y,this}static Dot(e,t){return e.x*t.x+e.y*t.y}DotWith(e){return s.Dot(this,e)}normalize(){let e=this.Length();return s.Multiply(this,1/e)}Direction(){return Math.atan2(this.y,this.x)}Truncate(){return new s(Math.trunc(this.x),Math.trunc(this.y))}AddWith(e,t){const{x:r,y:s}=n(e,t);return this.x+=r,this.y+=s,this}MultWith(e,t){const{x:r,y:s}=function(e,t){return void 0===t?void 0!==e.x?{x:e.x,y:e.y}:{x:e,y:e}:{x:e,y:t}}(e,t);return this.x*=r,this.y*=s,this}SubtractWith(e,t){const{x:r,y:s}=n(e,t);return this.x-=r,this.y-=s,this}DivideWith(e,t){const{x:r,y:s}=n(e,t);return this.x/=r,this.y/=s,this}Equals(e){return this.x===e.x&&this.y===e.y}static add(e,t,r){const{x:i,y:a}=n(t,r);return new s(e.x+i,e.y+a)}static subtract(e,t,r){const{x:i,y:a}=n(t,r);return new s(e.x-i,e.y-a)}static Multiply(e,t,r){return void 0!==r?new s(e.x*t,e.y*r):void 0!==t.x?new s(e.x*t.x,e.y*t.y):new s(e.x*t,e.y*t)}static interpolate(e,t,r){return new s(e.x+(t.x-e.x)*r,e.y+(t.y-e.y)*r)}static componentMin(e,t){return e.x<=t.x&&e.y<=t.y?e:t.x<=e.x&&t.y<=e.y?t:new s(Math.min(e.x,t.x),Math.min(e.y,t.y))}static componentMax(e,t){return e.x>=t.x&&e.y>=t.y?e:t.x>=e.x&&t.y>=e.y?t:new s(Math.max(e.x,t.x),Math.max(e.y,t.y))}static Bezier(e,t){return 1===e.length?e[0]:2===e.length?s.add(s.Multiply(e[1],t),s.Multiply(e[0],1-t)):s.add(s.Multiply(s.Bezier(e.slice(1),t),t),s.Multiply(s.Bezier(e.slice(0,e.length-1),t),1-t))}rotate(e){const t=Math.atan2(this.y,this.x),r=this.Length();return s.fromAngle(t+e,r)}}function n(e,t){return void 0===t?{x:e.x,y:e.y}:{x:e,y:t}}},9287:(e,t,r)=>{r.r(t),r.d(t,{default:()=>A});var s=r(7363);class n{execute(e,t){let r=e.args[0].read(t);if("string"==typeof r)return r;let s=e.args[1].read(t);if("string"==typeof s)return s;const n=this.calc(r,s);return e.silent||t.cpu.flags.set(n),(3===e.args.length?e.args[2]:e.args[1]).write(n,t)}verify(e,t){return 2===e.args.length?i(e,"read","rw"):3===e.args.length?i(e,"read","read","write"):"Expected Exactly 2 or 3 arguments."}}function i(e,...t){if(t.length!==e.args.length)return`Expected exactly ${t.length} argument(s)`;for(let r=0;r<t.length;r++)switch(t[r]){case"read":if(!e.args[r].IsReadable())return`Argument ${r} is not readable`;break;case"write":if(!e.args[r].IsWriteable())return`Argument ${r} is not writeable`;break;case"rw":if(!e.args[r].IsReadable())return`Argument ${r} is not readable`;if(!e.args[r].IsWriteable())return`Argument ${r} is not writeable`;break;case"jump":if(!e.args[r].IsJumpable())return`Argument ${r} is not a valid jump target`}}const a=[new class{constructor(){this.name="mov"}execute(e,t){let r=e.args[0].read(t);return"string"==typeof r?r:(e.silent||t.cpu.flags.set(r),e.args[1].write(r,t))}verify(e,t){return i(e,"read","write")}},new class{constructor(){this.name="jmp"}execute(e,t){return t.cpu.tryJump(t,e.args[0])}verify(e,t){return e.silent?"JMP does not edit flags and cannot be silent":i(e,"jump")}},new class{constructor(){this.name="nop"}execute(e,t){}verify(e,t){return 0!==e.args.length?"NOP takes no arguments":e.silent?"NOP does not edit flags and cannot be silent":void 0}},new class{constructor(){this.name="tst"}execute(e,t){let r=e.args[0].read(t);if("string"==typeof r)return r;let s=e.args[1].read(t);if("string"==typeof s)return s;t.cpu.flags.set(r-s)}verify(e,t){return e.silent?"TST is only used to edit flags, and so cannot be silenced. Use a NOP instead.":1===e.args.length?i(e,"read"):2===e.args.length?i(e,"read","read"):"Expected 1 or 2 args"}},new class extends n{constructor(){super(...arguments),this.name="add"}calc(e,t){return e+t}},new class extends n{constructor(){super(...arguments),this.name="sub"}calc(e,t){return e-t}},new class extends n{constructor(){super(...arguments),this.name="mul"}calc(e,t){return e*t}},new class extends n{constructor(){super(...arguments),this.name="div"}calc(e,t){return e/t}},new class extends n{constructor(){super(...arguments),this.name="and"}calc(e,t){return e&t}},new class extends n{constructor(){super(...arguments),this.name="bor"}calc(e,t){return e|t}},new class extends n{constructor(){super(...arguments),this.name="xor"}calc(e,t){return e^t}},new class{constructor(){this.name="hlt"}execute(e,t){t.cpu.isHalted=!0}verify(e,t){return 0!==e.args.length?"HLT takes no arguments":e.silent?"HLT does not edit flags and cannot be silent":void 0}}];function o(e){return"string"==typeof e.name?[e.name]:e.name}class l{constructor(e,t,r){this.cpu=e,this.level=t,this.testCase=r,this.allInstructions=l.GetAllInstructions(t),this.cpu.reset()}tick(){return this.cpu.tick(this.allInstructions,this)}static GetAllInstructions(e){const t={};for(const e of a)for(const r of o(e))t[r]=e;for(const r of e.components)for(const e of r.getExtraInstructions())for(const r of o(e))t[r]=e;return t}}var c=r(2925);class u{static isToken(e){return void 0!==e.value||void 0!==e.type}static isBranch(e){return void 0!==e.children}static treeReduce(e,t,r){if(this.isToken(e))return t(e);if(this.isBranch(e)){var s=e.children.map((e=>this.treeReduce(e,t,r)));return r(e,s)}throw"Unknown tree item type?"}}var h,d=r(2401),g=r(6386);class f{constructor(e){this.register=e}jumpTarget(e){return e.cpu.getRegisterValue(this.register,e)}IsReadable(){return!0}IsWriteable(){return!0}IsJumpable(){return!0}write(e,t){return t.cpu.setRegisterValue(e,this.register,t)}read(e){return e.cpu.getRegisterValue(this.register,e)}argType(){return h.Register}verify(e){if(-1===e.registers.indexOf(this.register)&&-1===e.extRegisters.indexOf(this.register))return`Unrecognized register ${this.register}`}}class p{constructor(e,t,r){this.baseRegister=e,this.offsetRegister=t,this.offset=r}IsReadable(){return!0}IsWriteable(){return!0}IsJumpable(){return!1}write(e,t){throw new Error("Method not implemented.")}read(e){throw new Error("Method not implemented.")}argType(){return h.Indexed}verify(e){return void 0!==this.baseRegister&&-1===e.registers.indexOf(this.baseRegister)&&-1===e.extRegisters.indexOf(this.baseRegister)?`Unrecognized register ${this.baseRegister}`:void 0!==this.offsetRegister&&-1===e.registers.indexOf(this.offsetRegister)&&-1===e.extRegisters.indexOf(this.offsetRegister)?`Unrecognized register ${this.offsetRegister}`:void 0}}class m{constructor(e){this.value=e}IsReadable(){return!0}IsWriteable(){return!1}IsJumpable(){return!0}read(e){return this.value}jumpTarget(e){return this.value}argType(){return h.Numerical}verify(e){}}!function(e){e[e.Register=0]="Register",e[e.Indexed=1]="Indexed",e[e.Numerical=2]="Numerical"}(h||(h={}));class v{constructor(e,t,r,s,n){this.instruction=e,this.silent=t,this.reqFlags=r,this.args=s,this.firstToken=n}}class x{constructor(){const e=c.Z.FromGrammarFile("\nroot -> {instrs} $$\n\ninstrs -> {instrs} {lbl_instr}\ninstrs -> {lbl_instr}\n\nlbl_instr -> {instr}\nlbl_instr -> {lbl}\n\n# Need optsemi for comments\nlbl -> <string> : {optsemi}\n\ninstr -> <string> {optsemi}\ninstr -> <string> . {flags} {optsemi}\ninstr -> <string> {arglist} {optsemi}\ninstr -> <string> . {flags} {arglist} {optsemi}\n\noptsemi -> \noptsemi -> ;\n\nflags -> <string>\n\narglist -> {arglist} , {arg}\narglist -> {arg}\n\narg -> {arith}\narg -> @ {arith}\narg -> <string> [ {arith} ]\narg -> <string> [ <string> , {arith} ]\n\narith -> {arith} + {multiplication}\narith -> {arith} - {multiplication}\narith -> {multiplication}\n\nmultiplication -> {multiplication} * {value}\nmultiplication -> {multiplication} / {value}\nmultiplication -> {value}\n\nvalue -> <string>\nvalue -> <number>\nvalue -> ( {arith} )\nvalue -> - {value}\n".split("\n"));this.parser=new d.Z(e,"root"),this.tokenizer=new g.Z}TryParse(e,t,r){let s=e.split("\n");for(let e=s.length-1;e>=0;e--){s[e]=s[e].trim();const t=s[e].indexOf(";");-1!==t&&(0===t?s.splice(e,1):s[e]=s[e].substr(0,t+1))}e=s.join("\n");const n=this.tokenizer.tokenize(e);if(0===n.length)return[];const i=this.parser.parse(n);if(!d.Z.isSuccessfulResponse(i))return i;if(!u.isBranch(i))throw"This will never happen. I hope.";const a=this.getTreeInstructions(i);if(y(a))return a;const[o,l]=a,c=[];for(let e=0;e<o.length;e++){const r=this.parseInstruction(o[e],l,t);if(y(r))return r;c.push(r)}for(let e=0;e<c.length;e++){const s=c[e];if(void 0===r[s.instruction])return{badToken:s.firstToken,errorMessage:"Unrecognized instruction"};const n=r[s.instruction].verify(s,t);if(void 0!==n)return{badToken:s.firstToken,errorMessage:n};for(const e of s.args){const r=e.verify(t);if(void 0!==r)return{badToken:s.firstToken,errorMessage:"Argument error: "+r}}}return c}getTreeInstructions(e){let t=[],r={};const s=[];for(;"instrs"===e.production.name;)s.splice(0,0,e.children[e.children.length-1]),e=e.children[0];s.splice(0,0,e);for(const e of s)if("lbl"===e.children[0].production.name){const s=e.children[0].firstToken();if(void 0!==r[s.value])return{badToken:s,errorMessage:"Duplicate label"};r[s.value]=t.length}else t.push(e.children[0]);return[t,r]}parseInstruction(e,t,r){const s=e.firstToken().value;let n="",i=[];for(const s of e.children)if(u.isBranch(s))if("flags"===s.production.name)n=s.firstToken().value;else if("arglist"===s.production.name){const e=this.parseArgsRecurse(s,t,r);if(y(e))return e;i=e}return new v(s.substr(0,3),4===s.length&&"s"===s[3],n.split(""),i,e.firstToken())}parseArgsRecurse(e,t,r){const s=this.parseSingleArg(e.children[e.children.length-1],t,r);if(y(s))return s;if(1===e.children.length)return[s];const n=this.parseArgsRecurse(e.children[0],t,r);return y(n)||n.push(s),n}parseSingleArg(e,t,r){if(1===e.children.length){const s=this.parseArithOrRegister(e.children[0],t,r);return y(s)?s:"string"==typeof s?new f(s):new m(s)}if(2===e.children.length){const s=this.parseArithOrRegister(e.children[1],t,r);return y(s)?s:"string"==typeof s?new p(s,void 0,void 0):new p(void 0,void 0,s)}if(4===e.children.length){var s=e.children[0].firstToken().value;const n=this.parseArithOrRegister(e.children[2],t,r);return y(n)?n:"string"==typeof n?new p(s,n,void 0):new p(s,void 0,n)}{s=e.children[0].firstToken().value;var n=e.children[2].firstToken().value;const i=this.parseArith(e.children[4],t,r);return y(i)?i:new p(s,n,i)}}parseArithOrRegister(e,t,r){const s=e.allTokens();if(1===s.length){const e=s[0].value;if(-1!==r.registers.indexOf(e)||-1!==r.extRegisters.indexOf(e))return e}return this.parseArith(e,t,r)}parseArith(e,t,r){if(1===e.children.length)return this.parseMult(e.children[0],t,r);const s=this.parseArith(e.children[0],t,r),n=this.parseMult(e.children[2],t,r);return y(s)?s:y(n)?n:"+"===e.children[1].firstToken().value?s+n:s-n}parseMult(e,t,r){if(1===e.children.length)return this.parseValue(e.children[0],t,r);const s=this.parseMult(e.children[0],t,r),n=this.parseValue(e.children[2],t,r);return y(s)?s:y(n)?n:"*"===e.children[1].firstToken().value?s*n:s/n}parseValue(e,t,r){if(1===e.children.length){const r=e.firstToken();if("number"===r.type)return parseInt(r.value);{const e=r.value;return void 0===t[e]?{badToken:r,errorMessage:"Unrecognized label "+e}:t[e]}}if(2===e.children.length){const s=this.parseValue(e.children[1],t,r);return y(s)?s:-s}return this.parseArith(e.children[1],t,r)}}function y(e){return void 0!==e.badToken&&void 0!==e.errorMessage}function b(e){let t="";if(void 0!==(r=e.parseResult).badToken&&void 0!==r.expected)t=`Parse Failure: [${e.parseResult.badToken.lineNumber}:${e.parseResult.badToken.colNumber}]`;else{if(!y(e.parseResult))return s.createElement(s.Fragment,null);t=`Syntax Error: [${e.parseResult.badToken.lineNumber}:${e.parseResult.badToken.colNumber}] ${e.parseResult.errorMessage}`}var r;return s.createElement("div",{style:{position:"absolute",bottom:0,width:"100%",border:"1px solid black",background:"#833"}},t)}function k(e){const[t,r]=s.useState(`; ${e.level.name.toUpperCase()}`),[n,i]=s.useState([]),a=new x;return s.useEffect((()=>{const r=a.TryParse(t,e.level,l.GetAllInstructions(e.level));console.log(r),i(r)}),[t]),s.createElement("div",{className:"fill"},s.createElement("div",{style:{position:"absolute",height:"100%",width:"50%",border:"1px solid black"}},s.createElement("div",{className:"flex row"},s.createElement("button",{onClick:()=>e.closeLevel()},"Quit"),s.createElement("button",{style:{float:"right"}},"Run"),s.createElement("button",{style:{float:"right"}},"Step")),s.createElement("div",{style:{position:"absolute",left:0,bottom:0,right:0,top:"20px"}},s.createElement("textarea",{style:{height:"100%",width:"100%",resize:"vertical"},value:t,onChange:e=>r(e.target.value)})),s.createElement(b,{parseResult:n})),s.createElement("div",{style:{position:"absolute",height:"100%",width:"50%",left:"50%",top:0,border:"1px solid gray",overflowY:"scroll"}}))}var w,R=r(8785);class T{constructor(e){this.maxSize=e,this.renderSize=new R.Z(0,0),this.data=[]}getExtraInstructions(){return[]}reset(){this.data=[]}read(e){return void 0===this.data[e]?0:this.data[e]}write(e,t){this.data[e]=t}tick(){}animTick(){}draw(e){}}!function(e){e[e.Pass=0]="Pass",e[e.Fail=1]="Fail"}(w||(w={}));class M{constructor(e){this.numDisks=e,this.disks=[];const t=[];for(let r=e-1;r>=0;r--)t.push(r);this.disks.push(t),this.disks.push([]),this.disks.push([]),this.armLocation=0,this.armDisk=void 0}getResult(){return 0===this.disks[0].length&&0===this.disks[1].length&&void 0===this.armDisk?w.Pass:w.Fail}extRead(e){switch(e){case"arm":return this.armLocation;case"grab":return void 0===this.armDisk?0:this.armDisk+1;default:return"Unrecognized Register"}}extWrite(e,t){switch(e){case"arm":return t<0||t>=3?"Arm moved out of range!":void(this.armLocation=t);case"grab":if(t<=0){if(void 0===this.armDisk)return;const e=this.armDisk;this.armDisk=void 0;const t=this.disks[this.armLocation];if(0===t.length)t.push(e);else if(t.push(e),t[t.length-1]>t[t.length-2])return w.Fail}else{if(void 0!==this.armDisk)return;0!==this.disks[this.armLocation].length&&(this.armDisk=this.disks[this.armLocation].pop())}default:return"Unrecognized Register"}}tick(){}animTick(){}draw(e){}destroy(){}}const I=[new class{constructor(){this.components=[new T(128)],this.name="Hanoi",this.registers=["a","b","x","y","sp","fp"],this.extRegisters=["arm","grab"],this.hasRenderPane=!0,this.numTestCases=5,this.animFramesPerTick=3}initTestCase(e,t){return new M(e+1)}}];function E(e){return s.createElement("ol",null,I.map((t=>s.createElement("li",{key:t.name},s.createElement("button",{onClick:()=>e.onSelect(t)},t.name)))))}function A(){const[e,t]=s.useState(void 0);return void 0===e?s.createElement(E,{onSelect:t}):s.createElement(k,{level:e,closeLevel:()=>t(void 0)})}}}]);
//# sourceMappingURL=287.bundle.js.map