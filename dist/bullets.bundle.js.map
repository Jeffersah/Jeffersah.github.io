{"version":3,"sources":["webpack:///./src/projects/common/input/KeyState.ts","webpack:///./src/projects/common/input/KeyWatcher.ts","webpack:///./src/projects/common/input/KeyboardManager.ts","webpack:///./src/projects/common/position/Point.ts","webpack:///./src/projects/bullets/const.ts","webpack:///./src/projects/bullets/assets/bullets_entities.png","webpack:///./src/projects/common/position/Angle.ts","webpack:///./src/projects/bullets/Player.ts","webpack:///./src/projects/bullets/index.ts"],"names":["KeyState","keys","changes","key","this","indexOf","attachedElement","logKeyNames","undefined","addEventListener","k","onKeyDown","onKeyUp","downKeys","console","log","push","change","idx","splice","storeKeys","storeChanges","slice","element","watcher","prvState","currentState","Update","isKeyDown","isKeyUp","Point","x","y","Dot","Math","sqrt","LengthSq","p1","p2","other","atan2","nx","ny","a","b","sy","twoPi","PI","Angle","angle","relativeNormalize","PHYS","sprites","position","velocity","angularVelocity","rotation","engineDeflect","tgtDeflect","isEngineOn","min","max","vDirection","diffDir","relativeAngle","diffPerc","friction","abs","MultWith","cos","sin","vTotal","Length","vAngle","Direction","anglePullAmt","AddWith","ctx","save","rotrender","floor","random","render","restore","scalingHelper","Run","assetLoader","AssetLoader","entitySheet","SpriteSheet","registerAssetLoadCallback","onAllFinished","canvas","document","getElementById","getContext","NearestNeighborScalingHelper","KeyboardManager","body","repaintLoop","player","update","tick","fillStyle","fillRect","focusPoint","Add","Multiply","translate","ty","tx","repaint","requestAnimationFrame","onLoadDone"],"mappings":"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","file":"bullets.bundle.js","sourcesContent":["import { IKeyChange } from './KeyWatcher';\r\n\r\nexport default class KeyState {\r\n    constructor(public keys: string[], public changes: IKeyChange[]) {\r\n\r\n    }\r\n\r\n    public isKeyDown(key: string) {\r\n        return this.keys.indexOf(key) !== -1;\r\n    }\r\n\r\n    public isKeyUp(key: string) {\r\n        return this.keys.indexOf(key) === -1;\r\n    }\r\n}","import KeyState from './KeyState';\r\n\r\nexport interface IKeyChange {\r\n    key: string;\r\n    change: 'press'|'release';\r\n}\r\n\r\nexport default class KeyWatcher {\r\n    downKeys: string[];\r\n    changes: IKeyChange[];\r\n\r\n    constructor(public attachedElement: HTMLElement, private logKeyNames?: boolean) {\r\n        if  (this.logKeyNames === undefined) {\r\n            this.logKeyNames = false;\r\n        }\r\n        attachedElement.addEventListener('keydown', k => this.onKeyDown(k));\r\n        attachedElement.addEventListener('keyup', k => this.onKeyUp(k));\r\n\r\n        this.downKeys = [];\r\n        this.changes = [];\r\n    }\r\n\r\n    private onKeyDown(key: KeyboardEvent) {\r\n        if (this.logKeyNames) {\r\n            // tslint:disable-next-line: no-console\r\n            console.log(key.key);\r\n        }\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        if (idx === -1) {\r\n            this.changes.push({ key: key.key, change: 'press' });\r\n            this.downKeys.push(key.key);\r\n        }\r\n    }\r\n\r\n    private onKeyUp(key: KeyboardEvent) {\r\n        this.changes.push({ key: key.key, change: 'release' });\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        this.downKeys.splice(idx, 1);\r\n    }\r\n\r\n    public Update(): KeyState {\r\n        const storeKeys = this.downKeys;\r\n        const storeChanges = this.changes;\r\n\r\n        this.downKeys = storeKeys.slice();\r\n        this.changes = [];\r\n\r\n        return new KeyState(storeKeys, storeChanges);\r\n    }\r\n}","import KeyWatcher, { IKeyChange } from './KeyWatcher';\r\nimport KeyState from './KeyState';\r\n\r\nexport default class KeyboardManager {\r\n\r\n    watcher: KeyWatcher;\r\n    prvState: KeyState;\r\n    currentState: KeyState;\r\n\r\n    constructor(element: HTMLElement, logKeyNames?: boolean) {\r\n        this.watcher = new KeyWatcher(element, logKeyNames);\r\n        this.prvState = this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public update(): void {\r\n        this.prvState = this.currentState;\r\n        this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public isKeyDown(key: string): boolean {\r\n        return this.currentState.isKeyDown(key);\r\n    }\r\n\r\n    public isKeyUp(key: string): boolean {\r\n        return this.currentState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyPressed(key: string): boolean {\r\n        return this.currentState.isKeyDown(key) && this.prvState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyReleased(key: string): boolean {\r\n        return this.currentState.isKeyUp(key) && this.prvState.isKeyDown(key);\r\n    }\r\n\r\n    public changes(): IKeyChange[] {\r\n        return this.currentState.changes;\r\n    }\r\n}","export default class Point {\r\n    constructor(public x: number, public y: number) {\r\n\r\n    }\r\n\r\n    public LengthSq(): number {\r\n        return Point.Dot(this, this);\r\n    }\r\n\r\n    public Length(): number {\r\n        return Math.sqrt(this.LengthSq());\r\n    }\r\n\r\n    public Clone(): Point {\r\n        return new Point(this.x, this.y);\r\n    }\r\n\r\n    public Negate(): Point {\r\n        return new Point(-this.x, -this.y);\r\n    }\r\n\r\n    public NegateInPlace(): this {\r\n        this.x = -this.x;\r\n        this.y = -this.y;\r\n        return this;\r\n    }\r\n\r\n    public static Dot(p1: Point, p2: Point): number {\r\n        return p1.x * p2.x + p1.y * p2.y;\r\n    }\r\n\r\n    public DotWith(other: Point): number {\r\n        return Point.Dot(this, other);\r\n    }\r\n\r\n\r\n    public Direction(): number {\r\n        return Math.atan2(this.y, this.x);\r\n    }\r\n\r\n    public AddWith(x: number, y: number): this;\r\n    public AddWith(other: Point): this;\r\n    public AddWith(other: number|Point, y?: number): this {\r\n        const nx = y === undefined ? (other as Point).x : other as number;\r\n        const ny = y === undefined ? (other as Point).y : y;\r\n        this.x += nx;\r\n        this.y += ny;\r\n        return this;\r\n    }\r\n\r\n    public MultWith(x: number, y: number): this;\r\n    public MultWith(other: Point): this;\r\n    public MultWith(other: number|Point, y?: number): this {\r\n        const nx = y === undefined ? (other as Point).x : other as number;\r\n        const ny = y === undefined ? (other as Point).y : y;\r\n        this.x *= nx;\r\n        this.y *= ny;\r\n        return this;\r\n    }\r\n\r\n    public SubtractWith(x: number, y: number): this;\r\n    public SubtractWith(other: Point): this;\r\n    public SubtractWith(other: number|Point, y?: number): this {\r\n        const nx = y === undefined ? (other as Point).x : other as number;\r\n        const ny = y === undefined ? (other as Point).y : y;\r\n        this.x -= nx;\r\n        this.y -= ny;\r\n        return this;\r\n    }\r\n\r\n    public DivideWith(x: number, y: number): this;\r\n    public DivideWith(other: Point): this;\r\n    public DivideWith(other: number|Point, y?: number): this {\r\n        const nx = y === undefined ? (other as Point).x : other as number;\r\n        const ny = y === undefined ? (other as Point).y : y;\r\n        this.x /= nx;\r\n        this.y /= ny;\r\n        return this;\r\n    }\r\n\r\n    public Equals(other: Point): boolean {\r\n        return this.x === other.x && this.y === other.y;\r\n    }\r\n\r\n    static Add(a: Point, b: Point): Point {\r\n        return new Point(a.x + b.x, a.y + b.y);\r\n    }\r\n\r\n    static Multiply(a: Point, s: number, sy?: number): Point;\r\n    static Multiply(a: Point, b: Point): Point;\r\n    static Multiply(a: Point, b: Point|number, sy ?: number): Point {\r\n        if (sy !== undefined) {\r\n            return new Point(a.x * (b as number), a.y * sy);\r\n        }\r\n        else if ((b as any).x !== undefined) {\r\n            return new Point(a.x * (b as Point).x, a.y * (b as Point).y);\r\n        } else {\r\n            return new Point(a.x * (b as number), a.y * (b as number));\r\n        }\r\n    }\r\n}","export default {\r\n    Width: 1000,\r\n    Height: 800\r\n};","export default __webpack_public_path__ + \"12a4e8650485f6c9e051cf30dfcfc746.png\";","const twoPi = Math.PI * 2;\r\n\r\nexport default class Angle {\r\n    static normalize(angle: number): number {\r\n        angle = angle % twoPi;\r\n        if (angle < 0) angle += twoPi;\r\n        return angle;\r\n    }\r\n\r\n    static relativeNormalize(angle: number): number {\r\n        angle = angle % twoPi;\r\n        if (angle > Math.PI) {\r\n            angle -= twoPi;\r\n        } else if(angle < - Math.PI) {\r\n            angle += twoPi;\r\n        }\r\n        return angle;\r\n    }\r\n\r\n    static relativeAngle(a: number, b: number) {\r\n        return Angle.relativeNormalize(a - b);\r\n    }\r\n}","import Point from '../common/position/Point';\r\nimport { SpriteSheet } from '../common/assets/SpriteSheet';\r\nimport ImageLoader from '../common/assets/ImageLoader';\r\nimport { RotTransformCanvas } from '../common/CanvasHelpers';\r\nimport KeyboardManager from '../common/input/KeyboardManager';\r\nimport Angle from '../common/position/Angle';\r\n\r\nconst PHYS = {\r\n    acceleration: 0.2,\r\n    maxvelocity: 20,\r\n    vFricMin: 0.998,\r\n    vFricMax: 0.99,\r\n\r\n    engineAdjSpeed: 0.06,\r\n\r\n    turnBaseAccel: 0.002,\r\n    turnEngineMaxAccel: 0.004,\r\n    turnFric: 0.98,\r\n    turnPullMax: 0.003,\r\n    turnPullMaxV: 120,\r\n};\r\n\r\nexport default class Player {\r\n    position: Point;\r\n    velocity: Point;\r\n    angularVelocity: number;\r\n    rotation: number;\r\n\r\n    private isEngineOn: boolean;\r\n    private engineDeflect: number;\r\n    private tgtDeflect: number;\r\n\r\n    constructor(private sprites: SpriteSheet) {\r\n        this.position = new Point(0, 0);\r\n        this.velocity = new Point(0, 0);\r\n        this.angularVelocity = 0;\r\n        this.rotation = 0;\r\n        this.engineDeflect = 0;\r\n        this.tgtDeflect = 0;\r\n    }\r\n\r\n    tick(keys: KeyboardManager) {\r\n        if (keys.isKeyDown('w')) {\r\n            this.isEngineOn = true;\r\n        } else {\r\n            this.isEngineOn = false;\r\n        }\r\n\r\n        if (keys.isKeyDown('a')) {\r\n            this.tgtDeflect = 1;\r\n        } else if (keys.isKeyDown('d')) {\r\n            this.tgtDeflect = -1;\r\n        } else {\r\n            this.tgtDeflect = 0;\r\n        }\r\n\r\n        if (this.tgtDeflect >= this.engineDeflect) {\r\n            this.engineDeflect = Math.min(this.engineDeflect + PHYS.engineAdjSpeed, this.tgtDeflect);\r\n        } else {\r\n            this.engineDeflect = Math.max(this.engineDeflect - PHYS.engineAdjSpeed, this.tgtDeflect);\r\n        }\r\n\r\n        const vDirection = Math.atan2(this.velocity.y, this.velocity.x);\r\n        const diffDir = Angle.relativeAngle(this.rotation, vDirection);\r\n        const diffPerc = diffDir / Math.PI;\r\n\r\n        this.angularVelocity *= PHYS.turnFric;\r\n        this.angularVelocity -= this.tgtDeflect * PHYS.turnBaseAccel + this.engineDeflect * PHYS.turnEngineMaxAccel * (this.isEngineOn ? 1 : 0);\r\n\r\n        this.rotation += this.angularVelocity;\r\n\r\n        const friction = (1 - Math.abs(diffPerc)) * PHYS.vFricMin + (Math.abs(diffPerc)) * PHYS.vFricMax;\r\n        this.velocity.MultWith(friction, friction);\r\n\r\n        if (this.isEngineOn) {\r\n            this.velocity.x += PHYS.acceleration * Math.cos(this.rotation);\r\n            this.velocity.y += PHYS.acceleration * Math.sin(this.rotation);\r\n        }\r\n\r\n        let vTotal = this.velocity.Length();\r\n        let vAngle = this.velocity.Direction();\r\n\r\n        if (vTotal >= PHYS.maxvelocity) {\r\n            vTotal = PHYS.maxvelocity;\r\n        }\r\n\r\n        let anglePullAmt = Math.sin(diffDir);\r\n        anglePullAmt *= Math.min(vTotal / PHYS.turnPullMaxV, 1);\r\n        anglePullAmt *= PHYS.turnPullMax;\r\n\r\n        vAngle += anglePullAmt;\r\n        this.velocity.x = Math.cos(vAngle) * vTotal;\r\n        this.velocity.y = Math.sin(vAngle) * vTotal;\r\n\r\n\r\n        this.position.AddWith(this.velocity);\r\n    }\r\n\r\n    render(ctx: CanvasRenderingContext2D) {\r\n        ctx.save();\r\n        RotTransformCanvas(ctx, this.position.x, this.position.y, 4, 8, this.rotation + Math.PI / 2);\r\n        if (this.isEngineOn) {\r\n            this.sprites.rotrender(ctx, 4, 11, 8, 16, Math.floor(4 * Math.random()), 1, this.engineDeflect * Math.PI / 4, 4, 2);\r\n        }\r\n        if (this.tgtDeflect > 0) {\r\n            // Render spin flame\r\n            this.sprites.rotrender(ctx, 7, 4, 8, 16, Math.floor(Math.random() * 2), 2, 0, 3, 4);\r\n        }\r\n        else if (this.tgtDeflect < 0) {\r\n            // Render spin flame\r\n            this.sprites.rotrender(ctx, 1, 4, 8, 16, 2 + Math.floor(Math.random() * 2), 2, 0, 6, 4);\r\n        }\r\n        this.sprites.render(ctx, 0, 0, 8, 16, 0, 0);\r\n        ctx.restore();\r\n    }\r\n}","import AssetLoader from '../common/assets/AssetLoader';\r\nimport Const from './const';\r\nimport NearestNeighborScalingHelper from '../common/NearestNeighborScalingHelper';\r\nimport { NearestNeighborScaling, RotTransformCanvas } from '../common/CanvasHelpers';\r\nimport { SpriteSheet } from '../common/assets/SpriteSheet';\r\nimport entitySheetUrl from './assets/bullets_entities.png';\r\nimport playerUrl from './assets/bullets_ship.png';\r\nimport ImageLoader from '../common/assets/ImageLoader';\r\nimport Player from './Player';\r\nimport KeyboardManager from '../common/input/KeyboardManager';\r\nimport KeyState from '../common/input/KeyState';\r\nimport Point from '../common/position/Point';\r\n\r\nlet scalingHelper: NearestNeighborScalingHelper;\r\n\r\nexport default function Run() {\r\n    const assetLoader = new AssetLoader();\r\n    const entitySheet = new SpriteSheet(8, 16, entitySheetUrl, assetLoader.registerAssetLoadCallback());\r\n\r\n    assetLoader.onAllFinished(() => onLoadDone(entitySheet));\r\n}\r\n\r\nfunction onLoadDone(entitySheet: SpriteSheet) {\r\n    const canvas = document.getElementById('canvas') as HTMLCanvasElement;\r\n    const ctx = canvas.getContext('2d');\r\n    scalingHelper = new NearestNeighborScalingHelper(canvas, ctx, Const.Width, Const.Height, true, () => { return; });\r\n    NearestNeighborScaling(ctx);\r\n\r\n    const keys = new KeyboardManager(document.body, false);\r\n    const player = new Player(entitySheet);\r\n\r\n    repaintLoop(player, keys, canvas, ctx);\r\n}\r\n\r\nfunction repaintLoop(player: Player, keys: KeyboardManager, canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) {\r\n    keys.update();\r\n    player.tick(keys);\r\n    repaint(player, canvas, ctx);\r\n    requestAnimationFrame(() => repaintLoop(player, keys, canvas, ctx));\r\n}\r\n\r\nfunction repaint(player: Player, canvas: HTMLCanvasElement, ctx: CanvasRenderingContext2D) {\r\n    NearestNeighborScaling(ctx);\r\n    ctx.fillStyle = 'black';\r\n    ctx.fillRect(0, 0, Const.Width, Const.Height);\r\n    ctx.save();\r\n\r\n    const focusPoint = Point.Add(player.position, Point.Multiply(player.velocity, 10));\r\n\r\n    ctx.translate(-(focusPoint.x - Const.Width / 2), -(focusPoint.y - Const.Height / 2));\r\n    ctx.fillStyle = 'gray';\r\n\r\n    const bg_line_size = 400;\r\n\r\n    // Render some bg lines so we can see motion\r\n    for (let ty = Math.floor((focusPoint.y - Const.Height / 2) / bg_line_size) * bg_line_size; ty <= Math.floor((focusPoint.y + Const.Height / 2) / bg_line_size) * bg_line_size; ty += bg_line_size) {\r\n        ctx.fillRect(focusPoint.x - Const.Width / 2, ty, Const.Width, 3);\r\n    }\r\n\r\n    for (let tx = Math.floor((focusPoint.x - Const.Width / 2) / bg_line_size) * bg_line_size; tx <= Math.floor((focusPoint.x + Const.Width / 2) / bg_line_size) * bg_line_size; tx += bg_line_size) {\r\n        ctx.fillRect(tx, focusPoint.y - Const.Height / 2, 3, Const.Height);\r\n    }\r\n\r\n    player.render(ctx);\r\n    ctx.restore();\r\n}"],"sourceRoot":""}