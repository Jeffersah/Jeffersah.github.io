{"version":3,"file":"hoplite.bundle.js","mappings":"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","sources":["webpack://trading-game/./src/projects/common-assets/ascii.png","webpack://trading-game/./src/projects/common/Color.ts","webpack://trading-game/./src/projects/common/input/KeyState.ts","webpack://trading-game/./src/projects/common/input/KeyWatcher.ts","webpack://trading-game/./src/projects/common/input/KeyboardManager.ts","webpack://trading-game/./src/projects/common/interpolation/Interpolated.ts","webpack://trading-game/./src/projects/common/interpolation/InterpolationFunction.ts","webpack://trading-game/./src/projects/common/interpolation/Keyframes.ts","webpack://trading-game/./src/projects/hoplite/Constants.ts","webpack://trading-game/./src/projects/hoplite/assets/hoplite_tiles.png","webpack://trading-game/./src/projects/hoplite/assets/hoplite_features.png","webpack://trading-game/./src/projects/hoplite/assets/floor_and_digits.png","webpack://trading-game/./src/projects/hoplite/assets/hoplite_enemies.png","webpack://trading-game/./src/projects/hoplite/assets/hp.png","webpack://trading-game/./src/projects/hoplite/assets/hoplite_impacts.png","webpack://trading-game/./src/projects/hoplite/assets/lava_layers.png","webpack://trading-game/./src/projects/hoplite/assets/shopUI.png","webpack://trading-game/./src/projects/hoplite/assets/hoplite_weapons.png","webpack://trading-game/./src/projects/common-assets/ascii_6x8.png","webpack://trading-game/./src/projects/hoplite/Direction.ts","webpack://trading-game/./src/projects/hoplite/Hex.ts","webpack://trading-game/./src/projects/hoplite/HpRenderer.ts","webpack://trading-game/./src/projects/common/rendering/SpriteAnimation.ts","webpack://trading-game/./src/projects/hoplite/animation/EntityMoveAnimation.ts","webpack://trading-game/./src/projects/hoplite/animation/RenderableAnimation.ts","webpack://trading-game/./src/projects/hoplite/animation/SequentialAnimation.ts","webpack://trading-game/./src/projects/hoplite/animation/ProjectileAnimation.ts","webpack://trading-game/./src/projects/hoplite/attackInfos/AttackInfo.ts","webpack://trading-game/./src/projects/hoplite/Entity.ts","webpack://trading-game/./src/projects/hoplite/entities/Enemy.ts","webpack://trading-game/./src/projects/hoplite/entities/Zombie.ts","webpack://trading-game/./src/projects/common/rendering/DeltaRenderable.ts","webpack://trading-game/./src/projects/common/rendering/StackRenderable.ts","webpack://trading-game/./src/projects/hoplite/tiles/HexCell.ts","webpack://trading-game/./src/projects/hoplite/tiles/MultiPartCell.ts","webpack://trading-game/./src/projects/hoplite/animation/DelayAnimation.ts","webpack://trading-game/./src/projects/hoplite/animation/ParallelAnimation.ts","webpack://trading-game/./src/projects/hoplite/attackInfos/TileAttackInfo.ts","webpack://trading-game/./src/projects/hoplite/tiles/Lava.ts","webpack://trading-game/./src/projects/hoplite/entities/Archer.ts","webpack://trading-game/./src/projects/hoplite/entities/Mage.ts","webpack://trading-game/./src/projects/hoplite/attackInfos/RadialAreaAttackInfo.ts","webpack://trading-game/./src/projects/hoplite/entities/Giant.ts","webpack://trading-game/./src/projects/common/rendering/OffsetRenderable.ts","webpack://trading-game/./src/projects/hoplite/entities/StoneEye.ts","webpack://trading-game/./src/projects/hoplite/features/IFeature.ts","webpack://trading-game/./src/projects/hoplite/features/LifeGem.ts","webpack://trading-game/./src/projects/hoplite/tiles/Floor.ts","webpack://trading-game/./src/projects/hoplite/HexArray.ts","webpack://trading-game/./src/projects/hoplite/DjikstraPath.ts","webpack://trading-game/./src/projects/hoplite/mapGen/MapGenCommon.ts","webpack://trading-game/./src/projects/hoplite/features/Shrine.ts","webpack://trading-game/./src/projects/hoplite/phases/ShopPhase.ts","webpack://trading-game/./src/projects/hoplite/features/Shop.ts","webpack://trading-game/./src/projects/hoplite/shopItems/WeaponSaleItem.ts","webpack://trading-game/./src/projects/hoplite/shopItems/FullHealItem.ts","webpack://trading-game/./src/projects/hoplite/attackInfos/SpawnEnemyAttackInfo.ts","webpack://trading-game/./src/projects/hoplite/entities/BlueBurstDisc.ts","webpack://trading-game/./src/projects/hoplite/entities/BlueMage.ts","webpack://trading-game/./src/projects/hoplite/tiles/Trap.ts","webpack://trading-game/./src/projects/hoplite/entities/Spider.ts","webpack://trading-game/./src/projects/hoplite/weapons/PlayerWeapon.ts","webpack://trading-game/./src/projects/hoplite/weapons/SimpleWeapon.ts","webpack://trading-game/./src/projects/hoplite/weapons/Sword.ts","webpack://trading-game/./src/projects/hoplite/weapons/Spear.ts","webpack://trading-game/./src/projects/hoplite/weapons/Hammer.ts","webpack://trading-game/./src/projects/hoplite/weapons/Dagger.ts","webpack://trading-game/./src/projects/hoplite/weapons/Kunai.ts","webpack://trading-game/./src/projects/hoplite/weapons/Caltrops.ts","webpack://trading-game/./src/projects/hoplite/mapGen/StandardMapGen.ts","webpack://trading-game/./src/projects/hoplite/mapGen/DepthsMapGen.ts","webpack://trading-game/./src/projects/hoplite/features/Portal.ts","webpack://trading-game/./src/projects/common/MathHelpers.ts","webpack://trading-game/./src/projects/hoplite/mapGen/FloorZeroGen.ts","webpack://trading-game/./src/projects/hoplite/mapGen/IMapGen.ts","webpack://trading-game/./src/projects/hoplite/mapGen/Floor12Gen.ts","webpack://trading-game/./src/projects/hoplite/mapGen/Depths1MapGen.ts","webpack://trading-game/./src/projects/hoplite/phases/AnimationPhase.ts","webpack://trading-game/./src/projects/hoplite/phases/AttackResolutionPhase.ts","webpack://trading-game/./src/projects/hoplite/phases/PhaseBuilder.ts","webpack://trading-game/./src/projects/hoplite/phases/AfterMovePhase.ts","webpack://trading-game/./src/projects/hoplite/phases/PlayerMoveAnimPhase.ts","webpack://trading-game/./src/projects/hoplite/phases/EnemyAttackPhase.ts","webpack://trading-game/./src/projects/hoplite/phases/EnemyMovePhase.ts","webpack://trading-game/./src/projects/hoplite/phases/PlayerTurnGamePhase.ts","webpack://trading-game/./src/projects/hoplite/phases/EntryAnimationPhase.ts","webpack://trading-game/./src/projects/hoplite/phases/FloorTransitionPhase.ts","webpack://trading-game/./src/projects/hoplite/features/Stairs.ts","webpack://trading-game/./src/projects/hoplite/entities/StoneDisc.ts","webpack://trading-game/./src/projects/hoplite/Assets.ts","webpack://trading-game/./src/projects/hoplite/assets/IAssetSheet.ts","webpack://trading-game/./src/projects/hoplite/entities/Player.ts","webpack://trading-game/./src/projects/hoplite/GameState.ts","webpack://trading-game/./src/projects/hoplite/phases/GameStartAnimationPhase.ts","webpack://trading-game/./src/projects/common/input/MouseWatcher.ts","webpack://trading-game/./src/projects/common/input/MouseManager.ts","webpack://trading-game/./src/projects/hoplite/index.ts","webpack://trading-game/./src/views/projects/hoplite/HopliteComponent.tsx"],"sourcesContent":["export default __webpack_public_path__ + \"d9a19c5129d77f766d26840b9e76c785.png\";","export class Color {\r\n    private rgb?: { r: number, g: number, b: number };\r\n    private hsv?: { h: number, s: number, v: number };\r\n\r\n    constructor(vals: {r: number, g: number, b: number}|{h: number, s: number, v: number}) {\r\n        if ((vals as any).h || (vals as any).s || (vals as any).v) {\r\n            this.hsv = vals as any;\r\n            this.rgb = undefined;\r\n        }\r\n        else  {\r\n            this.rgb = vals as any;\r\n            this.hsv = undefined;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generate an RGB color\r\n     * @param r Red component [0, 1]\r\n     * @param g Green component [0, 1]\r\n     * @param b Blue component [0, 1]\r\n     */\r\n    public static rgb(r: number, g: number, b: number): Color {\r\n        return new Color({ r, g, b });\r\n    }\r\n\r\n    /**\r\n     * Generate an HSV color\r\n     * @param r Hue component [0, 1]\r\n     * @param g Saturation component [0, 1]\r\n     * @param b Value component [0, 1]\r\n     */\r\n    public static hsv(h: number, s: number, v: number): Color {\r\n        return new Color({ h, s, v });\r\n    }\r\n\r\n    public r(): number;\r\n    public r(v: number): void;\r\n    public r(v?: number): number|void {\r\n        this.reqRgb();\r\n        if (v !== undefined) {\r\n            this.rgb.r = v;\r\n            this.hsv = undefined;\r\n        } else {\r\n            return this.rgb.r;\r\n        }\r\n    }\r\n\r\n    public g(): number;\r\n    public g(v: number): void;\r\n    public g(v?: number): number|void {\r\n        this.reqRgb();\r\n        if (v !== undefined) {\r\n            this.rgb.g = v;\r\n            this.hsv = undefined;\r\n        } else {\r\n            return this.rgb.g;\r\n        }\r\n    }\r\n\r\n    public b(): number;\r\n    public b(v: number): void;\r\n    public b(v?: number): number|void {\r\n        this.reqRgb();\r\n        if (v !== undefined) {\r\n            this.rgb.b = v;\r\n            this.hsv = undefined;\r\n        } else {\r\n            return this.rgb.b;\r\n        }\r\n    }\r\n\r\n    public h(): number;\r\n    public h(v: number): void;\r\n    public h(v?: number): number|void {\r\n        this.reqHsv();\r\n        if (v !== undefined) {\r\n            this.hsv.h = v;\r\n            this.hsv = undefined;\r\n        } else {\r\n            return this.hsv.h;\r\n        }\r\n    }\r\n\r\n    public s(): number;\r\n    public s(v: number): void;\r\n    public s(v?: number): number|void {\r\n        this.reqHsv();\r\n        if (v !== undefined) {\r\n            this.hsv.s = v;\r\n            this.hsv = undefined;\r\n        } else {\r\n            return this.hsv.s;\r\n        }\r\n    }\r\n\r\n    public v(): number;\r\n    public v(v: number): void;\r\n    public v(v?: number): number|void {\r\n        this.reqHsv();\r\n        if (v !== undefined) {\r\n            this.hsv.v = v;\r\n            this.hsv = undefined;\r\n        } else {\r\n            return this.hsv.v;\r\n        }\r\n    }\r\n\r\n    private componentToRgb(n: number) {\r\n        const k = (n + this.hsv.h * 6) % 6;\r\n        return this.hsv.v - this.hsv.v * this.hsv.s * Math.max(Math.min(k, 4 - k, 1), 0);\r\n    }\r\n\r\n\r\n    private reqRgb() {\r\n        if (this.rgb === undefined) {\r\n            this.calcRgb();\r\n        }\r\n    }\r\n    private calcRgb() {\r\n        this.rgb = {\r\n            r: this.componentToRgb(5),\r\n            g: this.componentToRgb(3),\r\n            b: this.componentToRgb(1),\r\n        };\r\n    }\r\n\r\n    private reqHsv() {\r\n        if (this.hsv === undefined) {\r\n            this.calcHsv();\r\n        }\r\n    }\r\n    private calcHsv() {\r\n        const {r, g, b} = this.rgb;\r\n        const mx = Math.max(r, g, b);\r\n        const mn = Math.min(r, g, b);\r\n        let h = mx === mn ? 0\r\n            : mx === r ? (g - b) / (mx - mn)\r\n            : mx === g ? 2 + (b - r) / (mx - mn)\r\n            : 4 + (r - g) / (mx - mn);\r\n        h /= 6;\r\n        while (h < 0) {\r\n            h++;\r\n        }\r\n        this.hsv = {\r\n            h,\r\n            s: mx === mn ? 0 : (mx - mn) / mx,\r\n            v: mx\r\n        };\r\n    }\r\n\r\n    public toString(): string {\r\n        this.reqRgb();\r\n        return 'rgb(' + this.toByte(this.rgb.r) + ', ' + this.toByte(this.rgb.g) + ', ' + this.toByte(this.rgb.b) + ')';\r\n    }\r\n\r\n    private toByte(component: number) {\r\n        return Math.floor(component * 255);\r\n    }\r\n}","import { IKeyChange } from './KeyWatcher';\r\n\r\nexport default class KeyState {\r\n    constructor(public keys: string[], public changes: IKeyChange[]) {\r\n\r\n    }\r\n\r\n    public isKeyDown(key: string) {\r\n        return this.keys.indexOf(key) !== -1;\r\n    }\r\n\r\n    public isKeyUp(key: string) {\r\n        return this.keys.indexOf(key) === -1;\r\n    }\r\n}","import KeyState from './KeyState';\r\n\r\nexport interface IKeyChange {\r\n    key: string;\r\n    change: 'press'|'release';\r\n}\r\n\r\nexport default class KeyWatcher {\r\n    downKeys: string[];\r\n    changes: IKeyChange[];\r\n\r\n    constructor(public attachedElement: HTMLElement, private logKeyNames?: boolean) {\r\n        if  (this.logKeyNames === undefined) {\r\n            this.logKeyNames = false;\r\n        }\r\n        attachedElement.addEventListener('keydown', k => this.onKeyDown(k));\r\n        attachedElement.addEventListener('keyup', k => this.onKeyUp(k));\r\n\r\n        this.downKeys = [];\r\n        this.changes = [];\r\n    }\r\n\r\n    private onKeyDown(key: KeyboardEvent) {\r\n        if (this.logKeyNames) {\r\n            // tslint:disable-next-line: no-console\r\n            console.log(key.key);\r\n        }\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        if (idx === -1) {\r\n            this.changes.push({ key: key.key, change: 'press' });\r\n            this.downKeys.push(key.key);\r\n        }\r\n    }\r\n\r\n    private onKeyUp(key: KeyboardEvent) {\r\n        this.changes.push({ key: key.key, change: 'release' });\r\n        const idx = this.downKeys.indexOf(key.key);\r\n        this.downKeys.splice(idx, 1);\r\n    }\r\n\r\n    public Update(): KeyState {\r\n        const storeKeys = this.downKeys;\r\n        const storeChanges = this.changes;\r\n\r\n        this.downKeys = storeKeys.slice();\r\n        this.changes = [];\r\n\r\n        return new KeyState(storeKeys, storeChanges);\r\n    }\r\n}","import KeyWatcher, { IKeyChange } from './KeyWatcher';\r\nimport KeyState from './KeyState';\r\n\r\nexport default class KeyboardManager {\r\n\r\n    watcher: KeyWatcher;\r\n    prvState: KeyState;\r\n    currentState: KeyState;\r\n\r\n    constructor(element: HTMLElement, logKeyNames?: boolean) {\r\n        this.watcher = new KeyWatcher(element, logKeyNames);\r\n        this.prvState = this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public update(): void {\r\n        this.prvState = this.currentState;\r\n        this.currentState = this.watcher.Update();\r\n    }\r\n\r\n    public isKeyDown(key: string): boolean {\r\n        return this.currentState.isKeyDown(key);\r\n    }\r\n\r\n    public isKeyUp(key: string): boolean {\r\n        return this.currentState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyPressed(key: string): boolean {\r\n        return this.currentState.isKeyDown(key) && this.prvState.isKeyUp(key);\r\n    }\r\n\r\n    public isKeyReleased(key: string): boolean {\r\n        return this.currentState.isKeyUp(key) && this.prvState.isKeyDown(key);\r\n    }\r\n\r\n    public changes(): IKeyChange[] {\r\n        return this.currentState.changes;\r\n    }\r\n}","import { TimingFunction } from \"./TimingFunction\";\r\nimport { EvenlySpacedKeyframes, Keyframes } from './Keyframes';\r\nimport { InterpolationFunction } from \"./InterpolationFunction\";\r\n\r\nexport class Interpolated<T> {\r\n    constructor(public range: Keyframes<T>, public timingFunction: TimingFunction) {\r\n\r\n    }\r\n\r\n    public static linear<T>(interpolator: InterpolationFunction<T>, ...args: T[]) {\r\n        return new Interpolated<T>(EvenlySpacedKeyframes<T>(interpolator, ...args), (t: number) => t);\r\n    }\r\n}\r\n\r\nexport class InterpolationTimer {\r\n    public elapsedTime: number;\r\n    constructor(public totalTime: number) {\r\n        this.elapsedTime = 0;\r\n    }\r\n    tick(): boolean {\r\n        this.elapsedTime ++;\r\n        return this.elapsedTime >= this.totalTime;\r\n    }\r\n    sample<T>(animation: Interpolated<T>) {\r\n        return animation.range.sample(animation.timingFunction(this.elapsedTime / this.totalTime));\r\n    }\r\n}\r\n\r\nexport class LinkedInterpolation<T> {\r\n    constructor(public timer: InterpolationTimer, public interp: Interpolated<T>) {\r\n\r\n    }\r\n\r\n    sample(): T {\r\n        return this.timer.sample(this.interp);\r\n    }\r\n}","import { Color } from \"../Color\";\r\n\r\nexport type InterpolationFunction<T> = (start: T, end: T, percentage: number) => T;\r\n\r\nexport const numberInterpolator: InterpolationFunction<number> = (a, b, p) => a + (b-a)*p;\r\n\r\nexport const fastColorInterpolator: InterpolationFunction<Color> = (a,b,p) => \r\n    Color.rgb(\r\n        numberInterpolator(a.r(), b.r(), p),\r\n        numberInterpolator(a.g(), b.g(), p),\r\n        numberInterpolator(a.b(), b.b(), p));\r\n\r\n        \r\nexport const trueColorInterpolator: InterpolationFunction<Color> = (a,b,p) => \r\n    Color.rgb(\r\n        Math.sqrt(numberInterpolator(a.r() * a.r(), b.r() * b.r(), p)),\r\n        Math.sqrt(numberInterpolator(a.g() * a.g(), b.g() * b.g(), p)),\r\n        Math.sqrt(numberInterpolator(a.b() * a.b(), b.b() * b.b(), p)));\r\n\r\n        \r\nexport const hsvColorInterpolator: InterpolationFunction<Color> = (a,b,p) => \r\n    Color.hsv(\r\n        numberInterpolator(a.h(), b.h(), p),\r\n        numberInterpolator(a.s(), b.s(), p),\r\n        numberInterpolator(a.v(), b.v(), p));","import { Color } from \"../Color\";\r\nimport { fastColorInterpolator, InterpolationFunction, numberInterpolator } from \"./InterpolationFunction\";\r\n\r\nexport function EvenlySpacedKeyframes<T>(...args: T[]): Keyframes<T>;\r\nexport function EvenlySpacedKeyframes<T>(interpolator: InterpolationFunction<T>, ...args: T[]): Keyframes<T>;\r\nexport function EvenlySpacedKeyframes<T>(interpolator?: InterpolationFunction<T>, ...args: T[]): Keyframes<T> {\r\n    if(typeof(interpolator) !== 'function') {\r\n        args.splice(0, 0, <T><any>interpolator);\r\n        interpolator = undefined;\r\n    }\r\n\r\n    let numFrames = args.length - 1;\r\n    let percPer = 1 / numFrames;\r\n    let keyframes = new Keyframes<T>(args[0], interpolator);\r\n    for(let i = 1; i < args.length; i++) {\r\n        keyframes.addKeyFrame(percPer * i, args[i]);\r\n    }\r\n    return keyframes;\r\n}\r\n\r\nexport class Keyframes<T> \r\n{\r\n    private interpolator: InterpolationFunction<T>;\r\n    private keys: {time: number, value: T}[];\r\n\r\n    constructor(start: T, interpolator?: InterpolationFunction<T>)\r\n    {\r\n        if(interpolator === undefined) {\r\n            if(typeof(start) === \"number\") {\r\n                this.interpolator = <any>numberInterpolator;\r\n            } else if((<Color><unknown>start).r !== undefined) {\r\n                // Assume this is color\r\n                this.interpolator = <any>fastColorInterpolator;\r\n            }\r\n            else {\r\n                throw 'No default interpolator found';\r\n            }\r\n        } else {\r\n            this.interpolator = interpolator;\r\n        }\r\n        this.keys = [{time: 0, value: start}];\r\n    }\r\n\r\n    public addKeyFrame(time: number, value: T) {\r\n        for(let i = 0; i < this.keys.length; i++)\r\n        {\r\n            if(time < this.keys[i].time) {\r\n                this.keys.splice(i, 0, {time, value});\r\n                return;\r\n            }\r\n        }\r\n        this.keys.push({time, value});\r\n    }\r\n\r\n    public sample(p: number): T {\r\n        if(this.keys.length === 1) return this.keys[0].value;\r\n\r\n        var keyIndex = 0;\r\n        while(this.keys[keyIndex + 1].time < p && keyIndex + 2 < this.keys.length) {\r\n            keyIndex ++;\r\n        }\r\n\r\n        let sampleRange = this.keys[keyIndex + 1].time - this.keys[keyIndex].time;\r\n        let samplePerc = (p - this.keys[keyIndex].time) / sampleRange;\r\n\r\n        return this.interpolator(this.keys[keyIndex].value, this.keys[keyIndex + 1].value, samplePerc);\r\n    }\r\n}","import Point from \"../common/position/Point\";\r\n\r\nexport const TILE_WIDTH = 32;\r\nexport const TILE_HEIGHT = 32;\r\nexport const PIX_PER_CELL_X = 32;\r\nexport const PIX_PER_CELL_Y = new Point(16, 24);\r\n\r\nexport const TILE_SIZE = new Point(TILE_WIDTH, TILE_HEIGHT);\r\nexport const HALF_TILE_SIZE = new Point(TILE_WIDTH / 2, TILE_HEIGHT / 2);\r\n\r\nexport const MAP_SIZE = 7;\r\nexport const MAP_PIXEL_SIZE = (MAP_SIZE*2 - 1)*PIX_PER_CELL_X;\r\n\r\nexport const MAP_CENTER_POSITION = new Point(MAP_PIXEL_SIZE/2 - TILE_WIDTH / 2, MAP_PIXEL_SIZE/2 - TILE_HEIGHT / 2);\r\n\r\nexport const PLAYER_START_POSITION = new Point(-2, 4);","export default __webpack_public_path__ + \"bbf8a045bebfe2eac617ebbf02e24769.png\";","export default __webpack_public_path__ + \"b1ad2b17beecab6f53f7b70fab951c0e.png\";","export default __webpack_public_path__ + \"b5124a83d98bc334e6e3de5f7e27e05f.png\";","export default __webpack_public_path__ + \"92efb3d656356bbd02c1f86bf78275d7.png\";","export default __webpack_public_path__ + \"b78374db2fae35ea358c6a9e2b27ccd6.png\";","export default __webpack_public_path__ + \"6c72c5024765beedd162e66308ac2e23.png\";","export default __webpack_public_path__ + \"03a3f451813fb76552aa69688d48cdef.png\";","export default __webpack_public_path__ + \"c2ee93d666dd13067fc8adea399b804c.png\";","export default __webpack_public_path__ + \"e0a2f6d93614a82e9ed3897bd04abb85.png\";","export default __webpack_public_path__ + \"e7f4f4d72842e51e822a7c73f3b7a715.png\";","import Point from \"../common/position/Point\";\r\nimport { HexLength } from \"./Hex\";\r\n\r\nexport enum Direction {\r\n    Right = 0,\r\n    DownRight = 1,\r\n    DownLeft = 2,\r\n    Left = 3,\r\n    UpLeft = 4,\r\n    UpRight = 5\r\n}\r\n\r\nexport const AllDirections: Direction[] = [\r\n    Direction.Right,\r\n    Direction.DownRight,\r\n    Direction.DownLeft,\r\n    Direction.Left,\r\n    Direction.UpLeft,\r\n    Direction.UpRight\r\n];\r\n\r\nexport class DirectionHelper {\r\n\r\n    public static ToAngle(direction: Direction): number {\r\n        return ((Math.PI * direction) / 3) - (Math.PI / 2);\r\n    }\r\n\r\n    public static ToPoint(direction: Direction): Point {\r\n        switch (direction) {\r\n            case Direction.Right: return new Point(1, 0);\r\n            case Direction.DownRight: return new Point(0, 1);\r\n            case Direction.DownLeft: return new Point(-1, 1);\r\n            case Direction.Left: return new Point(-1, 0);\r\n            case Direction.UpLeft: return new Point(0, -1);\r\n            case Direction.UpRight: return new Point(1, -1);\r\n        }\r\n    }\r\n\r\n    public static FromPoint(pt: Point): Direction {\r\n        if(pt.x > 0 && pt.y === 0) return Direction.Right;\r\n        if(pt.x < 0 && pt.y === 0) return Direction.Left;\r\n        if(pt.x === 0 && pt.y > 0) return Direction.DownRight;\r\n        if(pt.x === 0 && pt.y < 0) return Direction.UpLeft;\r\n        if(pt.x > 0 && pt.x === -pt.y) return Direction.UpRight;\r\n        if(pt.x < 0 && pt.x === -pt.y) return Direction.DownLeft;\r\n        return undefined;\r\n    }\r\n\r\n    public static TryGetDirectionAndDistance(ray: Point): { direction: Direction, distance: number } | undefined {\r\n        if(ray.x === 0 || ray.y === 0 || ray.x === -ray.y) {\r\n            return { direction: this.FromPoint(new Point(Math.sign(ray.x), Math.sign(ray.y))), distance: HexLength(ray)};\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public static Turn(direction: Direction, amount: number): Direction {\r\n        const result = (direction + amount)%6;\r\n        return (result + 6) % 6;\r\n    }\r\n}","import Point from \"../common/position/Point\";\r\nimport { MAP_CENTER_POSITION, PIX_PER_CELL_X, PIX_PER_CELL_Y } from \"./Constants\";\r\nimport { Direction, DirectionHelper } from \"./Direction\";\r\n\r\nexport function TurnRight(pt: Point, amt?: number) {\r\n    for(let i = 0; i < (amt ?? 1); i++){\r\n        pt = new Point(-pt.y, pt.x + pt.y);\r\n    }\r\n    return pt;\r\n}\r\n\r\nexport function TurnLeft(pt: Point, amt?: number) {\r\n    for(let i = 0; i < (amt ?? 1); i++){\r\n        pt = new Point(pt.x + pt.y, -pt.x);\r\n    }\r\n    return pt;\r\n}\r\n\r\n// px = 16 * t.y + t.x * 32 + c.x\r\n// py = 24 * t.y + c.y\r\nexport function HexToPixel(point: Point) {\r\n    return Point.add(\r\n        Point.multiply(PIX_PER_CELL_Y, point.y), \r\n        point.x * PIX_PER_CELL_X + MAP_CENTER_POSITION.x, MAP_CENTER_POSITION.y);\r\n}\r\n\r\n// (px - c.x - 16 ty) / 32 = t.x\r\n// (py - c.y) / 24 = t.y\r\nexport function PixelToHex(point: Point) {\r\n    const tile_y = Math.floor((point.y - MAP_CENTER_POSITION.y) / PIX_PER_CELL_Y.y);\r\n    const tile_x = Math.floor((point.x - MAP_CENTER_POSITION.x - PIX_PER_CELL_Y.x * tile_y) / PIX_PER_CELL_X);\r\n    return new Point(tile_x, tile_y);\r\n}\r\n\r\nexport function HexLength(point: Point): number {\r\n    if(Math.sign(point.x) === - Math.sign(point.y)) {\r\n        return Math.max(Math.abs(point.x), Math.abs(point.y));\r\n    }\r\n    else {\r\n        return Math.abs(point.x) + Math.abs(point.y);\r\n    }\r\n}\r\n\r\nexport function IsStraightLine(ray: Point): boolean {\r\n    if(ray.x === 0 || ray.y === 0 || ray.x === -ray.y) return true;\r\n    return false;\r\n}\r\n\r\nexport function GetRing(radius: number) {\r\n    if(radius === 0) return [new Point(0,0)];\r\n\r\n    const result: Point[] = [];\r\n    let pos = new Point(0, -radius);\r\n    \r\n    for(var direction = Direction.Right; direction <= Direction.UpRight; direction++) {\r\n        var dir = DirectionHelper.ToPoint(direction);\r\n        for(var len = 0; len < radius; len++){\r\n            result.push(pos);\r\n            pos = Point.add(pos, dir);\r\n        }\r\n    }\r\n\r\n    return result;\r\n}","import ImageLoader from \"../common/assets/ImageLoader\";\r\nimport Point from \"../common/position/Point\";\r\nimport Rect from \"../common/position/Rectangle\";\r\nimport Sprite from \"../common/rendering/Sprite\";\r\nimport { HexToPixel } from \"./Hex\";\r\n\r\nconst originDelta = new Point(8, 26);\r\n\r\nconst deltaX = 3;\r\nconst deltaY = -2;\r\n\r\nconst maxTilesPerRow = 5;\r\n\r\nexport default class HpRenderer {\r\n    private emptyHpImage: Sprite;\r\n    private redHpImage: Sprite;\r\n    private yellowHpImage: Sprite;\r\n    private blueHpImage: Sprite;\r\n    constructor(image: ImageLoader) {\r\n        this.emptyHpImage = new Sprite(image.image, new Rect(0, 0, 4, 5));\r\n        this.redHpImage = new Sprite(image.image, new Rect(3, 0, 4, 5));\r\n        this.yellowHpImage = new Sprite(image.image, new Rect(6, 0, 4, 5));\r\n        this.blueHpImage = new Sprite(image.image, new Rect(9, 0, 4, 5));\r\n    }\r\n\r\n    public draw(ctx:CanvasRenderingContext2D, pos: Point, hp: number, maxHp: number) {\r\n        const rows = Math.ceil(maxHp / maxTilesPerRow);\r\n        let lastRowLength = maxHp % maxTilesPerRow;\r\n        if(lastRowLength === 0) { lastRowLength = maxTilesPerRow; }\r\n\r\n        const fullImage = hp <= maxHp / 4 ? this.redHpImage : hp <= maxHp / 2 ? this.yellowHpImage : this.blueHpImage;\r\n        const emptyImage = this.emptyHpImage;\r\n\r\n        let originPoint = Point.add(HexToPixel(pos), originDelta);\r\n\r\n        for(let row = 0; row < rows - 1; row++) {\r\n            const dy = (rows - row - 1) * deltaY;\r\n            for(let col = 0; col < maxTilesPerRow; col++) {\r\n                let image = hp <= 0 ? emptyImage : fullImage;\r\n                hp--;\r\n                image.draw(ctx, new Rect(originPoint.x + col * deltaX, originPoint.y + dy, 4, 5), 0);\r\n            }\r\n        }\r\n\r\n        // last row\r\n        const lastRowDx = (maxTilesPerRow - lastRowLength) * deltaX / 2;\r\n        for(let col = 0; col < lastRowLength; col++){\r\n            let image = hp <= 0 ? emptyImage : fullImage;\r\n            hp--;\r\n            image.draw(ctx, new Rect(originPoint.x + col * deltaX + lastRowDx, originPoint.y , 4, 5), 0);\r\n        }\r\n    }\r\n}","import Rect from \"../position/Rectangle\";\r\nimport Point from \"../position/Point\";\r\nimport IRenderable, { ISimpleRenderable } from \"./IRenderable\";\r\nimport IRenderableSource from \"./IRenderableSource\";\r\nimport Sprite from \"./Sprite\";\r\n\r\nexport class SpriteAnimation implements IRenderableSource {\r\n    constructor(\r\n        public source: CanvasImageSource,\r\n        public firstFrame: Rect, \r\n        public origin: Point,\r\n        public frameAdvance: Point,\r\n        public numFrames: number,\r\n        public duration: number,\r\n        public loop: boolean) {\r\n\r\n    }\r\n\r\n    getPixelSize(): Point {\r\n        return new Point(this.firstFrame.w, this.firstFrame.y);\r\n    }\r\n\r\n    getRenderable(): IRenderable {\r\n        return new SpriteAnimationInstance(this, this.loop);\r\n    }\r\n\r\n    getSprite(frameNumber: number): Sprite {\r\n        const frame = new Rect(\r\n            this.firstFrame.x + (frameNumber * this.frameAdvance.x),\r\n            this.firstFrame.y + (frameNumber * this.frameAdvance.y),\r\n            this.firstFrame.w,\r\n            this.firstFrame.h\r\n        );\r\n        return new Sprite(this.source, frame, this.origin);\r\n    }\r\n}\r\n\r\nexport class SpriteAnimationInstance implements ISimpleRenderable, IRenderable {\r\n\r\n    private duration: number;\r\n    private currentTick: number;\r\n\r\n    constructor(public source: SpriteAnimation, public loop: boolean, private overrideDuration?: number) {\r\n        this.duration = overrideDuration ?? source.duration;\r\n        this.currentTick = 0;\r\n    }\r\n\r\n    tick(): boolean {\r\n        this.currentTick++;\r\n        if(this.currentTick === this.duration) {\r\n            if(this.loop) this.currentTick = 0;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    getSprite(): Sprite {\r\n        const frameNumber = (this.currentTick * this.source.numFrames) / this.duration;\r\n        return this.source.getSprite(Math.floor(frameNumber));\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, position: Rect, rotation: number): void {\r\n        this.getSprite().draw(ctx, position, rotation);\r\n    }\r\n}\r\n\r\n\r\nexport class DelaySpriteAnimationInstance implements ISimpleRenderable, IRenderable {\r\n\r\n    private duration: number;\r\n    private currentTick: number;\r\n\r\n    constructor(public source: SpriteAnimationInstance, delayDuration: number) {\r\n        this.duration = delayDuration;\r\n        this.currentTick = 0;\r\n    }\r\n\r\n    tick(): boolean {\r\n        if(this.currentTick >= this.duration){\r\n            return this.source.tick();\r\n        }\r\n        else{\r\n            this.currentTick++;\r\n            return false;\r\n        }\r\n    }\r\n\r\n    getSprite(): Sprite {\r\n        return this.source.getSprite();\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, position: Rect, rotation: number): void {\r\n        this.getSprite().draw(ctx, position, rotation);\r\n    }\r\n}","import { Interpolated, InterpolationTimer, LinkedInterpolation } from \"../../common/interpolation/Interpolated\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Entity from \"../Entity\";\r\nimport IAnimation from \"./IAnimation\";\r\n\r\nexport default class EntityMoveAnimation implements IAnimation {\r\n    private timer: InterpolationTimer;\r\n    constructor(private entity: Entity, private motion: Interpolated<Point>, private target: Point, private duration: number) {\r\n        this.timer = new InterpolationTimer(duration);\r\n    }\r\n\r\n    tick(): boolean{ \r\n        if(this.timer.tick()) {\r\n            this.entity.position = this.target;\r\n            return true;\r\n        }\r\n        this.entity.position = this.timer.sample(this.motion);\r\n        return false;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        // The gamestate drawing will draw this entity. No need to draw it twice.\r\n        // this.entity.draw(ctx);\r\n    }\r\n}","import Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IAnimation from \"./IAnimation\";\r\n\r\nexport default class RenderableAnimation implements IAnimation {\r\n    private rotation: number;\r\n    constructor(private renderable: IRenderable, private bounds: Rect, rotation?: number, private fixedDuraiton?: number) {\r\n        this.rotation = rotation ?? 0;\r\n    }\r\n\r\n    tick(): boolean {\r\n        if(this.fixedDuraiton !== undefined) {\r\n            this.fixedDuraiton--;\r\n            if(this.fixedDuraiton === -1) return true;\r\n            this.renderable.tick();\r\n            return false;\r\n        }\r\n        return this.renderable.tick();\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        this.renderable.draw(ctx, this.bounds, this.rotation);\r\n    }\r\n}","import IAnimation from \"./IAnimation\";\r\n\r\nexport default class SequentialAnimation implements IAnimation {\r\n    constructor(private steps: IAnimation[]) {\r\n\r\n    }\r\n\r\n    tick(): boolean {\r\n        if(this.steps.length === 0) return true;\r\n        \r\n        while(this.steps[0].tick()){\r\n            this.steps.shift();\r\n            if(this.steps.length === 0) return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        this.steps[0].draw(ctx);\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport { HexToPixel } from \"../Hex\";\r\nimport IAnimation from \"./IAnimation\";\r\nimport RenderableAnimation from \"./RenderableAnimation\";\r\nimport SequentialAnimation from \"./SequentialAnimation\";\r\nimport * as C from '../Constants';\r\n\r\nexport default class ProjectileAnimation implements IAnimation {\r\n\r\n    private angle: number;\r\n    private time: number;\r\n    constructor(private renderable: IRenderable, private size: Point, private fromPixel: Point, private toPixel: Point, private duration: number) {\r\n        this.angle = Math.atan2(toPixel.y - fromPixel.y, toPixel.x - fromPixel.x);\r\n        this.time = 0;\r\n    }\r\n\r\n    tick(): boolean {\r\n        this.time++;\r\n        return this.time >= this.duration;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        const position = Point.interpolate(this.fromPixel, this.toPixel, this.time / this.duration);\r\n        const destination = new Rect(position.x, position.y, this.size.x, this.size.y);\r\n        this.renderable.draw(ctx, destination, this.angle);\r\n    }\r\n}\r\n\r\nexport function CreateProjectileAnimation(projectile: Sprite, fromHex: Point, toHex: Point, duration: number, onImpact: IRenderableSource): IAnimation {\r\n    const destPt = HexToPixel(toHex);\r\n    const projAnimation = new ProjectileAnimation(projectile, projectile.getPixelSize(), Point.add(HexToPixel(fromHex), C.HALF_TILE_SIZE), Point.add(destPt, C.HALF_TILE_SIZE), duration);\r\n    if(onImpact !== null) {\r\n        const impactAnimation = new RenderableAnimation(onImpact.getRenderable(), new Rect(destPt.x, destPt.y, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n        return new SequentialAnimation([projAnimation, impactAnimation]);\r\n    }\r\n    return projAnimation;\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport EntityMoveAnimation from \"../animation/EntityMoveAnimation\";\r\nimport IAnimation from \"../animation/IAnimation\";\r\nimport RenderableAnimation from \"../animation/RenderableAnimation\";\r\nimport Entity from \"../Entity\";\r\nimport * as C from \"../Constants\";\r\nimport { HexLength, HexToPixel } from \"../Hex\";\r\nimport { Interpolated, InterpolationTimer, LinkedInterpolation } from \"../../common/interpolation/Interpolated\";\r\nimport { CreateProjectileAnimation } from \"../animation/ProjectileAnimation\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport IAttackInfo, { IAttackDamageInfo } from \"./IAttackInfo\";\r\nimport GameState from \"../GameState\";\r\n\r\nconst BUMP_ANIMATION_TIME = 10;\r\nconst PROJECTILE_TIME = 6;\r\n\r\nexport default class AttackInfo implements IAttackInfo {\r\n    public startPoint: Point;\r\n    constructor(public attacker: Entity, public target: Point, public affectedTiles: Point[], public damage: number, public bumpAnimation: boolean, public impactAnimation: IRenderableSource, public projectile: Sprite, public ignoreEnemies?: boolean, public ignorePlayer?: boolean) {\r\n        this.startPoint = attacker.position;\r\n    }\r\n\r\n    static basicAttack(attacker: Entity, target: Entity, damage: number) {\r\n        return new AttackInfo(attacker, target.position, [target.position], damage, true, null, null);\r\n    }\r\n\r\n    static animationAttack(attacker: Entity, target: Entity, damage: number, impactAnimation: IRenderableSource, bumpAnimation?: boolean) {\r\n        return new AttackInfo(attacker, target.position, [target.position], damage, bumpAnimation??false, impactAnimation, null);\r\n    }\r\n\r\n    static projectileAttack(attacker:Entity, target: Entity, damage: number, projectile: Sprite, impactAnimation?: IRenderableSource) {\r\n        return new AttackInfo(attacker, target.position, [target.position], damage, false, impactAnimation ?? null, projectile);\r\n    }\r\n    \r\n    getAffectedTiles(state: GameState): IAttackDamageInfo[] {\r\n        return [{damage: this.damage, positions: this.affectedTiles, ignorePlayer: this.ignorePlayer, ignoreEnemies: this.ignoreEnemies}];\r\n    }\r\n\r\n    toAnimations():IAnimation[] {\r\n        let animations:IAnimation[] = [];\r\n        if(this.bumpAnimation) {\r\n            animations.push(new EntityMoveAnimation(\r\n                this.attacker, \r\n                Interpolated.linear<Point>(Point.interpolate, \r\n                    this.attacker.position, \r\n                    Point.interpolate(this.attacker.position, this.target, 1/2), \r\n                    this.attacker.position), \r\n                this.attacker.position, \r\n                BUMP_ANIMATION_TIME * HexLength(Point.subtract(this.startPoint, this.target))));\r\n        }\r\n        if(this.projectile) {\r\n            const time = PROJECTILE_TIME * HexLength(Point.subtract(this.startPoint, this.target));\r\n            return [CreateProjectileAnimation(this.projectile, this.startPoint, this.target, time, this.impactAnimation)];\r\n        }\r\n        if(this.impactAnimation) {\r\n            const pixTarget = HexToPixel(this.target);\r\n            animations.push(new RenderableAnimation(this.impactAnimation.getRenderable(), new Rect(pixTarget.x, pixTarget.y, C.TILE_WIDTH, C.TILE_HEIGHT)));\r\n        }\r\n        return animations;\r\n    }\r\n\r\n    applyExtraEffects(state: GameState): void {\r\n    }\r\n}","import Point from \"../common/position/Point\";\r\nimport Rect from \"../common/position/Rectangle\";\r\nimport IRenderable from \"../common/rendering/IRenderable\";\r\nimport { HexToPixel } from \"./Hex\";\r\nimport * as C from './Constants';\r\nimport Player from \"./entities/Player\";\r\n\r\nexport default abstract class Entity {\r\n    isFlying: boolean;\r\n    maxHp: number;\r\n    hp: number;\r\n    position: Point;\r\n\r\n    constructor(position: Point) {\r\n        this.position = position;\r\n    }\r\n\r\n    abstract draw(ctx: CanvasRenderingContext2D): void;\r\n\r\n    static IsPlayer(entity: Entity): entity is Player {\r\n        return (entity as Player).primary !== undefined;\r\n    }\r\n}\r\n\r\nexport abstract class SimpleEnemy extends Entity {\r\n    abstract getRenderable() : IRenderable;\r\n    override draw(ctx: CanvasRenderingContext2D): void {\r\n        const target = HexToPixel(this.position);\r\n        const rect = new Rect(target.x, target.y, C.TILE_WIDTH, C.TILE_HEIGHT);\r\n        this.getRenderable().draw(ctx, rect, 0);\r\n    } \r\n}","import Point from \"../../common/position/Point\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport { SimpleEnemy } from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\n\r\nexport default abstract class Enemy extends SimpleEnemy {\r\n\r\n    goldValue: number;\r\n    lastAttacks: IAttackInfo[];\r\n\r\n    abstract getAttacks(state: GameState): IAttackInfo[];\r\n    abstract getMove(state: GameState, attack: IAttackInfo[], disallow: Point[]): Point;\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nexport default class Zombie extends Enemy {\r\n    static sprite: IRenderable;\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Zombie.sprite = assets.getAsset('zombie').getRenderable();\r\n    }\r\n\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 1;\r\n        this.isFlying = false;\r\n        \r\n        this.goldValue = 1;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, this.position));\r\n        if(len === 1) {\r\n            return [AttackInfo.basicAttack(this, state.player, 1)];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        if(attack.length > 0) {\r\n            // Don't move if you've attacked.\r\n            return this.position;\r\n        }\r\n\r\n        const possibleMoves = GetRing(1).map(rp => Point.add(this.position, rp));\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], false)) \r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const len = HexLength(ray);\r\n            if(len < minMoveDist) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        if(minMoves.length === 0) return this.position;\r\n        return minMoves[Math.floor(Math.random() * minMoves.length)];\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        return Zombie.sprite;\r\n    }\r\n}","import { Interpolated, InterpolationTimer } from \"../interpolation/Interpolated\";\r\nimport Point from \"../position/Point\";\r\nimport Rectangle from \"../position/Rectangle\";\r\nimport IRenderable from \"./IRenderable\";\r\nimport IRenderableSource from \"./IRenderableSource\";\r\n\r\nexport class DeltaRenderable implements IRenderable {\r\n    constructor(private source: IRenderable, public delta: Rectangle) {\r\n    }\r\n\r\n    tick(): boolean {\r\n        return this.source.tick();\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, position: Rectangle, rotation: number): void {\r\n        this.source.draw(ctx, new Rectangle(position.x + this.delta.x * position.w, position.y + this.delta.y * position.h, position.w * this.delta.w, position.h * this.delta.h), rotation);\r\n    }\r\n}","import Rectangle from \"../position/Rectangle\";\r\nimport IRenderable from \"./IRenderable\";\r\n\r\nexport class StackRenderable implements IRenderable {\r\n\r\n    public finishMode: 'any'|'all';\r\n\r\n    constructor(public renderables: IRenderable[], renderableFinishMode?: 'any'|'all') {\r\n        this.finishMode = renderableFinishMode ?? 'any';\r\n    }\r\n\r\n    tick(): boolean {\r\n        let allFinished = true;\r\n        let anyFinished = false;\r\n        for(let i = 0; i < this.renderables.length; i++) {\r\n            const f = this.renderables[i].tick();\r\n            allFinished = allFinished && f;\r\n            anyFinished = anyFinished || f;\r\n        }\r\n        return this.finishMode === 'any' ? anyFinished : allFinished;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, position: Rectangle, rotation: number): void {\r\n        for(let i = 0; i < this.renderables.length; i++) {\r\n            this.renderables[i].draw(ctx, position, rotation);\r\n        }\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Assets from \"../Assets\";\r\nimport Entity from \"../Entity\";\r\nimport * as C from \"../Constants\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport GameState from \"../GameState\";\r\nimport { HexToPixel } from \"../Hex\";\r\nimport { DeltaRenderable } from \"../../common/rendering/DeltaRenderable\";\r\nimport { StackRenderable } from \"../../common/rendering/StackRenderable\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\n\r\nexport default abstract class HexCell {\r\n    isPathable: boolean;\r\n    typeId: number;\r\n\r\n    constructor(typeId: number, pathable: boolean){\r\n        this.typeId = typeId;\r\n        this.isPathable = pathable;\r\n    }\r\n\r\n    AfterPlayerTurn(state: GameState, x: number, y: number): IAttackInfo[] { return []; }\r\n    AfterEnemyTurn(state: GameState, x: number, y: number): IAttackInfo[] { return []; }\r\n\r\n    abstract OnEntityStep(entity: Entity): void;\r\n    abstract AfterWorldLoad(world: GameState, pt: Point): void;\r\n    abstract draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void;\r\n}\r\n\r\nexport abstract class SimpleCell extends HexCell{\r\n\r\n    protected renderable: IRenderable;\r\n    private bg_renderable: IRenderable;\r\n\r\n    constructor(typeId: number, assets: Assets, spriteSheetPosition: Point, isPathable: boolean, includeDefaultRenderable?: boolean){\r\n        super(typeId, isPathable);\r\n\r\n        this.bg_renderable = \r\n            new DeltaRenderable(\r\n                new Sprite(assets.tiles.image, new Rect(11 * C.TILE_WIDTH, 0, C.TILE_WIDTH, C.TILE_HEIGHT)),\r\n                new Rect(0, .75, 1, 1)\r\n            );\r\n\r\n        if(includeDefaultRenderable === true) {\r\n            this.bg_renderable = new StackRenderable(\r\n                [this.bg_renderable, new Sprite(assets.tiles.image, new Rect(0, 0, C.TILE_WIDTH, C.TILE_HEIGHT))]\r\n            );\r\n        }\r\n        this.renderable = new Sprite(assets.tiles.image, new Rect(spriteSheetPosition.x * C.TILE_WIDTH, spriteSheetPosition.y * C.TILE_HEIGHT, C.TILE_WIDTH, C.TILE_HEIGHT));\r\n    }\r\n\r\n    override AfterWorldLoad(world: GameState, pt: Point): void {\r\n        \r\n    }\r\n\r\n    override draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void {\r\n        let target = HexToPixel(pt);\r\n\r\n        this.bg_renderable.draw(ctx, new Rect(target.x, target.y, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n        this.renderable.draw(ctx, new Rect(target.x, target.y, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Assets from \"../Assets\";\r\nimport * as C from \"../Constants\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport GameState from \"../GameState\";\r\nimport { HexToPixel } from \"../Hex\";\r\nimport HexCell from \"./HexCell\";\r\nimport { AllDirections, Direction, DirectionHelper } from \"../Direction\";\r\nimport { StackRenderable } from \"../../common/rendering/StackRenderable\";\r\nimport { DeltaRenderable } from \"../../common/rendering/DeltaRenderable\";\r\n\r\ninterface ITilePart {\r\n    directions: Direction[];\r\n    tileCoords: Point;\r\n    tileSlice: Rect;\r\n}\r\n\r\nconst tileParts: ITilePart[] = [\r\n    {\r\n        // Top of Tile\r\n        directions: [Direction.UpLeft, Direction.UpRight],\r\n        tileCoords: new Point(0, 0),\r\n        tileSlice: new Rect(0, 0, 1, 0.5),\r\n    },\r\n    {\r\n        // Bottom of Tile\r\n        directions: [Direction.DownLeft, Direction.DownRight],\r\n        tileCoords: new Point(0, 0),\r\n        tileSlice: new Rect(0, 0.5, 1, 0.5),\r\n    }, \r\n    {\r\n        // TopLeft of Tile\r\n        directions: [Direction.Left, Direction.UpLeft],\r\n        tileCoords: new Point(0, 1),\r\n        tileSlice: new Rect(0, 0, 0.5, 0.5),\r\n    },\r\n    {\r\n        // TopRight of Tile\r\n        directions: [Direction.Right, Direction.UpRight],\r\n        tileCoords: new Point(0, 1),\r\n        tileSlice: new Rect( 0.5, 0, 0.5, 0.5),\r\n    },\r\n    {\r\n        // BottomLeft of Tile\r\n        directions: [Direction.Left, Direction.DownLeft],\r\n        tileCoords: new Point(0, 1),\r\n        tileSlice: new Rect(0, 0.5, 0.5, 0.5),\r\n    },\r\n    {\r\n        // BottomRight of Tile\r\n        directions: [Direction.Right, Direction.DownRight],\r\n        tileCoords: new Point(0, 1),\r\n        tileSlice: new Rect(0.5, 0.5, 0.5, 0.5),\r\n    }\r\n]\r\n\r\nexport function StitchTileParts(source: CanvasImageSource, tx: number, ty: number, tw: number, th: number, isEdge: (dir: Direction) => boolean){\r\n    const adjacencyMap = AllDirections.map(isEdge);\r\n\r\n    const images = tileParts.map(part => {\r\n        const index = part.directions.reduceRight((acc, dir) => (acc << 1) + (adjacencyMap[dir] ? 1 : 0), 0);\r\n        const sourceBounds = new Rect(\r\n            (part.tileCoords.x + index + part.tileSlice.x + tx) * tw,\r\n            (part.tileCoords.y + part.tileSlice.y + ty) * th,\r\n            (part.tileSlice.w) * tw,\r\n            (part.tileSlice.h) * th\r\n        );\r\n        return new DeltaRenderable(\r\n            new Sprite(source, sourceBounds),\r\n            part.tileSlice\r\n        );\r\n    });\r\n\r\n    return new StackRenderable(\r\n        images,\r\n        'all'\r\n    );\r\n}\r\n\r\nexport default abstract class MultiPartCell extends HexCell {\r\n    private renderable: IRenderable;\r\n    private bg_renderable: IRenderable;\r\n    private assets: Assets;\r\n\r\n    constructor(typeId: number, assets: Assets, private spriteSheetPosition: Point, isPathable: boolean){\r\n        super(typeId, isPathable);\r\n\r\n        this.assets = assets;\r\n        this.bg_renderable = new Sprite(assets.tiles.image, new Rect(11 * C.TILE_WIDTH, 0, C.TILE_WIDTH, C.TILE_HEIGHT));\r\n    }\r\n\r\n    override AfterWorldLoad(world: GameState, pt: Point): void {\r\n        this.renderable = StitchTileParts(this.assets.tiles.image, this.spriteSheetPosition.x, this.spriteSheetPosition.y, C.TILE_WIDTH, C.TILE_HEIGHT, (d:Direction) => {\r\n            const hexPt = Point.add(pt, DirectionHelper.ToPoint(d));\r\n            if(world.tiles.isInBounds(hexPt.x, hexPt.y)) {\r\n                return world.tiles.get(pt).typeId !== world.tiles.get(hexPt).typeId;\r\n            }\r\n            else {\r\n                return true;\r\n            }\r\n        });\r\n    }\r\n\r\n    override draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void {\r\n        let target = HexToPixel(pt);\r\n\r\n        this.bg_renderable.draw(ctx, new Rect(target.x, target.y + 24, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n        this.renderable.draw(ctx, new Rect(target.x, target.y, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n    }\r\n}","import IAnimation from \"./IAnimation\";\r\n\r\nexport default class DelayAnimation implements IAnimation {\r\n\r\n    constructor(private inner: IAnimation, private delay: number) {\r\n\r\n    }\r\n\r\n    tick(): boolean {\r\n        if(this.delay === 0) return this.inner.tick();\r\n        else {\r\n            this.delay --;\r\n            return false;\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        if(this.delay === 0) {\r\n            return this.inner.draw(ctx);\r\n        }\r\n    }\r\n\r\n}","import IAnimation from \"./IAnimation\";\r\n\r\nexport default class ParallelAnimation implements IAnimation {\r\n    constructor(private steps: IAnimation[]) {\r\n\r\n    }\r\n\r\n    tick(): boolean {\r\n        for(let i = this.steps.length - 1; i >= 0; i--) {\r\n            if(this.steps[i].tick()) {\r\n                this.steps.splice(i, 1);\r\n            }\r\n        }\r\n        return this.steps.length === 0;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        for(const step of this.steps) {\r\n            step.draw(ctx);\r\n        }\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport DelayAnimation from \"../animation/DelayAnimation\";\r\nimport IAnimation from \"../animation/IAnimation\";\r\nimport ParallelAnimation from \"../animation/ParallelAnimation\";\r\nimport RenderableAnimation from \"../animation/RenderableAnimation\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength, HexToPixel } from \"../Hex\";\r\nimport IAttackInfo, { IAttackDamageInfo } from \"./IAttackInfo\";\r\nimport * as C from '../Constants';\r\n\r\nexport default class TileAttackInfo implements IAttackInfo {\r\n    constructor(private point: Point, private infos: IAttackDamageInfo[], private delayPerDist: number, private animationSource: IRenderableSource) {\r\n        \r\n    }\r\n\r\n    getAffectedTiles(state: GameState): IAttackDamageInfo[] {\r\n        return this.infos;\r\n    }\r\n\r\n    toAnimations(state: GameState): IAnimation[] {\r\n        const innerAnimations: IAnimation[] = [];\r\n        const allPts = this.infos.reduce((acc, info) => acc.concat(info.positions), []);\r\n\r\n        return [\r\n            new ParallelAnimation(\r\n                allPts.map(pt => {\r\n                    const dist = HexLength(Point.subtract(pt, this.point));\r\n                    const delay = this.delayPerDist * dist;\r\n                    const pix = HexToPixel(pt);\r\n                    return new DelayAnimation(\r\n                        new RenderableAnimation(\r\n                            this.animationSource.getRenderable(),\r\n                            new Rect(pix.x, pix.y, C.TILE_WIDTH, C.TILE_HEIGHT)), \r\n                        delay);\r\n                })\r\n            )\r\n        ];\r\n    }\r\n    \r\n    applyExtraEffects(state: GameState): void {\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport { StackRenderable } from \"../../common/rendering/StackRenderable\";\r\nimport Assets from \"../Assets\";\r\nimport { Direction, DirectionHelper } from \"../Direction\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport HexCell from \"./HexCell\";\r\nimport MultiPartCell, { StitchTileParts } from \"./MultiPartCell\";\r\nimport * as C from \"../Constants\";\r\nimport { HexToPixel } from \"../Hex\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport TileAttackInfo from \"../attackInfos/TileAttackInfo\";\r\n\r\nexport default class Lava extends HexCell {\r\n    public static TypeID = 1;\r\n\r\n    private lavaStatic: IRenderable;\r\n    private lavaOverlay: IRenderable;\r\n\r\n    private bg_renderable: IRenderable;\r\n    private assets: Assets;\r\n\r\n    constructor(assets: Assets) {\r\n        super(Lava.TypeID, false);\r\n        this.assets = assets;\r\n        \r\n        this.bg_renderable = new Sprite(assets.tiles.image, new Rect(11 * C.TILE_WIDTH, 0, C.TILE_WIDTH, C.TILE_HEIGHT));\r\n    }\r\n\r\n    override AfterEnemyTurn(state: GameState, x: number, y: number): IAttackInfo[] {\r\n        const steppingEnemy = state.enemies.find(e => e.position.x == x && e.position.y == y);\r\n        if(steppingEnemy !== undefined && !steppingEnemy.isFlying){\r\n            return [\r\n                new TileAttackInfo(new Point(x, y), [{ damage: 999, positions: [new Point(x,y)] }], 0, this.assets.getImpactAnimation(2))\r\n            ]\r\n        }\r\n        return [];\r\n    }\r\n\r\n    OnEntityStep(entity: Entity): void {\r\n    }\r\n\r\n    override AfterWorldLoad(world: GameState, pt: Point): void {\r\n        this.lavaStatic = StitchTileParts(this.assets.lavaLayers.image, 0, 0, C.TILE_WIDTH, C.TILE_HEIGHT, (d:Direction) => {\r\n            const hexPt = Point.add(pt, DirectionHelper.ToPoint(d));\r\n            if(world.tiles.isInBounds(hexPt.x, hexPt.y)) {\r\n                return world.tiles.get(pt).typeId !== world.tiles.get(hexPt).typeId;\r\n            }\r\n            else {\r\n                return true;\r\n            }\r\n        });\r\n\r\n        this.lavaOverlay = StitchTileParts(this.assets.lavaLayers.image, 0, 2, C.TILE_WIDTH, C.TILE_HEIGHT, (d:Direction) => {\r\n            const hexPt = Point.add(pt, DirectionHelper.ToPoint(d));\r\n            if(world.tiles.isInBounds(hexPt.x, hexPt.y)) {\r\n                return world.tiles.get(pt).typeId !== world.tiles.get(hexPt).typeId;\r\n            }\r\n            else {\r\n                return true;\r\n            }\r\n        });\r\n    }\r\n\r\n    override draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void {\r\n        let target = HexToPixel(pt);\r\n\r\n        this.bg_renderable.draw(ctx, new Rect(target.x, target.y + 24, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n        this.lavaStatic.draw(ctx, new Rect(target.x, target.y, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n\r\n        let overlayWaver = Math.round(Math.sin(world.renderTickNumber / 15 + pt.x/2) * 1.5);\r\n        this.lavaOverlay.draw(ctx, new Rect(target.x, target.y + overlayWaver, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport { Direction, DirectionHelper } from \"../Direction\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Lava from \"../tiles/Lava\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nconst MAX_RANGE = 5;\r\n\r\nexport default class Archer extends Enemy {\r\n    static sprite: IRenderable;\r\n    static fearsprite: IRenderable;\r\n    static projectileSprite: Sprite;\r\n    static impactAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Archer.sprite = assets.getAsset('archer') as Sprite;\r\n        Archer.fearsprite = assets.getAsset('archer_afraid') as Sprite;\r\n        Archer.projectileSprite = assets.getAsset('projectile_arrow') as Sprite;\r\n        Archer.impactAnimation = assets.getAsset('impact_point');\r\n    }\r\n\r\n\r\n    isAfraid: boolean;\r\n\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 1;\r\n        this.isFlying = false;\r\n        this.isAfraid = false;\r\n        \r\n        this.goldValue = 3;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n\r\n        if(this.isAfraid) return []; // Don't attack after being afraid.\r\n\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, this.position));\r\n        if(len > 1 && len <= MAX_RANGE) {\r\n            let ray = Point.subtract(playerLocation, this.position);\r\n            if(ray.x === 0 || ray.y === 0 || ray.x === -ray.y) {\r\n                let delta = new Point(Math.sign(ray.x), Math.sign(ray.y));\r\n                let nextPt = Point.add(delta, this.position);\r\n                while(!nextPt.equals(playerLocation)) {\r\n                    if(state.entityAt(nextPt) !== undefined) {\r\n                        return []; // Can't shoot through entities\r\n                    }\r\n                    nextPt = Point.add(delta, nextPt);\r\n                }\r\n                return [AttackInfo.projectileAttack(this, state.player, 1, Archer.projectileSprite, Archer.impactAnimation)];\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        if(attack.length > 0) {\r\n            // Don't move if you've attacked.\r\n            this.isAfraid = false;\r\n            return this.position;\r\n        }\r\n\r\n        let deltaPlayer = Point.subtract(state.player.position, this.position);\r\n        // IF the player is one hex away, the archer will become \"Afraid\" and run directly away.\r\n        // If they can't move away, they won't move. This makes them easier to catch.\r\n        // You can also scare them into lava, which is unhealthy.\r\n        if(HexLength(deltaPlayer) === 1) {\r\n            this.isAfraid = true;\r\n            \r\n            let targetPosition = Point.subtract(this.position, deltaPlayer);\r\n            const tile = state.tiles.isInBounds(targetPosition.x, targetPosition.y) ? state.tiles.get(targetPosition) : undefined;\r\n            if(tile === undefined || targetPosition.equals(state.player.position)) { \r\n                return this.position; \r\n            }\r\n            if(!tile.isPathable && tile.typeId !== Lava.TypeID) {\r\n                 // If the tile isn't pathable don't move\r\n                 // We DO allow archers to run into lava if they're afraid.\r\n                return this.position;\r\n            }\r\n            if(disallowed.some(p => p.equals(targetPosition))) {\r\n                return this.position;\r\n            }\r\n\r\n            return targetPosition;\r\n        } else {\r\n            this.isAfraid = false;\r\n        }\r\n\r\n        const possibleMoves = GetRing(1).map(rp => Point.add(this.position, rp));\r\n        possibleMoves.push(this.position);\r\n\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        let hasAttackOpportunity = false;\r\n\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], false)) \r\n                continue;\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const dirAndDist = DirectionHelper.TryGetDirectionAndDistance(ray);\r\n            const couldAttack = dirAndDist !== undefined && dirAndDist.distance <= MAX_RANGE;\r\n\r\n            const len = HexLength(ray);\r\n            if(len === 1) {\r\n                continue; // Dont move within 1 of the player if you can avoid it.\r\n            }\r\n            else if(couldAttack && !hasAttackOpportunity) {\r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n                hasAttackOpportunity = true;\r\n            }\r\n            else if(len < minMoveDist && (!hasAttackOpportunity || couldAttack)) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist && (!hasAttackOpportunity || couldAttack)) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        if(minMoves.length === 0) return this.position;\r\n        return minMoves[Math.floor(Math.random() * minMoves.length)];\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        if(this.isAfraid) {\r\n            return Archer.fearsprite;\r\n        }\r\n        return Archer.sprite;\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nconst MAX_RANGE = 3;\r\n\r\nexport default class Mage extends Enemy {\r\n    static sprite: IRenderable;\r\n    static cooldownsprite: IRenderable;\r\n    static projectileSprite: Sprite;\r\n    static impactAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Mage.sprite = assets.getAsset('mage') as Sprite;\r\n\r\n        Mage.cooldownsprite = assets.getAsset('mage_cooldown') as Sprite;\r\n\r\n        Mage.projectileSprite = assets.getAsset('projectile_fire') as Sprite;\r\n\r\n        Mage.impactAnimation = assets.getAsset('impact_fire');\r\n    }\r\n\r\n    attackOnCooldown: boolean;\r\n\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 1;\r\n        this.isFlying = false;\r\n\r\n        this.goldValue = 5;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        if(this.attackOnCooldown){\r\n            return [];\r\n        }\r\n\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, this.position));\r\n        if(len <= MAX_RANGE) {\r\n            let ray = Point.subtract(playerLocation, this.position);\r\n            if(ray.x === 0 || ray.y === 0 || ray.x === -ray.y) {\r\n                let delta = new Point(Math.sign(ray.x), Math.sign(ray.y));\r\n                let nextPt = Point.add(delta, this.position);\r\n                while(!nextPt.equals(playerLocation)) {\r\n                    if(state.entityAt(nextPt) !== undefined) {\r\n                        return []; // Can't shoot through entities\r\n                    }\r\n                    nextPt = Point.add(delta, nextPt);\r\n                }\r\n                this.attackOnCooldown = true;\r\n                return [AttackInfo.projectileAttack(this, state.player, 1, Mage.projectileSprite, Mage.impactAnimation)];\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        if(attack.length > 0) {\r\n            // Don't move if you've attacked.\r\n            return this.position;\r\n        }\r\n\r\n        if(this.attackOnCooldown) {\r\n            // Don't move if you're on cooldown\r\n            this.attackOnCooldown = false;\r\n            return this.position;\r\n        }\r\n\r\n        const possibleMoves = GetRing(1).map(rp => Point.add(this.position, rp));\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], false)) \r\n                continue;\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const len = HexLength(ray);\r\n            // // Mages COULD be smarter by trying to avoid ending up directly next to the player, but doing so makes them a little bit too strong.\r\n            // if(len === 1) {\r\n            //     continue;\r\n            // }\r\n            if(len < minMoveDist) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        if(minMoves.length === 0) return this.position;\r\n        return minMoves[Math.floor(Math.random() * minMoves.length)];\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        if(this.attackOnCooldown) return Mage.cooldownsprite;\r\n        return Mage.sprite;\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport DelayAnimation from \"../animation/DelayAnimation\";\r\nimport IAnimation from \"../animation/IAnimation\";\r\nimport ParallelAnimation from \"../animation/ParallelAnimation\";\r\nimport RenderableAnimation from \"../animation/RenderableAnimation\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexToPixel } from \"../Hex\";\r\nimport IAttackInfo, { IAttackDamageInfo } from \"./IAttackInfo\";\r\nimport * as C from '../Constants';\r\n\r\nexport default class RadialAreaAttackInfo implements IAttackInfo {\r\n    constructor(private point: Point, private rings: {radius: number, damage: number}[], private delayPerRadius: number, private animationSource: IRenderableSource, public ignoreEnemies?: boolean, public ignorePlayer?: boolean) {\r\n        \r\n    }\r\n\r\n    getAffectedTiles(state: GameState): IAttackDamageInfo[] {\r\n        return this.rings.map(ring => {\r\n            return {\r\n                damage: ring.damage,\r\n                positions: GetRing(ring.radius).map(p => Point.add(p, this.point)).filter(pt => state.tiles.isInBounds(pt.x, pt.y)),\r\n                ignoreEnemies: this.ignoreEnemies,\r\n                ignorePlayer: this.ignorePlayer\r\n            };\r\n        });\r\n    }\r\n\r\n    toAnimations(state: GameState): IAnimation[] {\r\n        const innerAnimations: IAnimation[] = [];\r\n        for(const ring of this.rings) {\r\n            const points = GetRing(ring.radius).map(p => Point.add(p, this.point)).filter(pt => state.tiles.isInBounds(pt.x, pt.y))\r\n            innerAnimations.push(\r\n                new DelayAnimation(new ParallelAnimation(\r\n                    points.map(point => new RenderableAnimation(this.animationSource.getRenderable(), new Rect(HexToPixel(point).x, HexToPixel(point).y, C.TILE_WIDTH, C.TILE_HEIGHT))),\r\n                ), ring.radius * this.delayPerRadius)\r\n            );\r\n        }\r\n\r\n        return [new ParallelAnimation(innerAnimations)];\r\n    }\r\n    \r\n    applyExtraEffects(state: GameState): void {\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport { DeltaRenderable } from \"../../common/rendering/DeltaRenderable\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport RadialAreaAttackInfo from \"../attackInfos/RadialAreaAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nexport default class Giant extends Enemy {\r\n    static renderable: IRenderable;\r\n    static bigAttackPrepImage: IRenderable;\r\n    static radialSmashAnimation: IRenderableSource;\r\n\r\n    static turnSequence: ('move'|'skip'|'smashPrep'|'smash')[] = [\r\n        'move', 'move', 'skip', 'move', 'smashPrep', 'smash'\r\n    ];\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Giant.renderable = new DeltaRenderable(assets.getAsset('giant') as Sprite, new Rect(0, -1, 1, 2));\r\n\r\n        Giant.bigAttackPrepImage = new DeltaRenderable(assets.getAsset('giant_prep') as Sprite, new Rect(0, -1, 1, 2));\r\n\r\n        this.radialSmashAnimation = assets.getAsset('impact_dirt');\r\n    }\r\n\r\n    turnSequenceIndex: number;\r\n    lastTurn: ('move'|'skip'|'smashPrep'|'smash');\r\n\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 12;\r\n        this.isFlying = false;\r\n        this.turnSequenceIndex = Math.floor(Math.random() * Giant.turnSequence.length);\r\n        this.lastTurn = Giant.turnSequence[this.turnSequenceIndex === 0 ? Giant.turnSequence.length - 1 : this.turnSequenceIndex - 1];\r\n\r\n        this.goldValue = 15;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        const turn = Giant.turnSequence[this.turnSequenceIndex];\r\n        switch(turn) {\r\n            case 'move':\r\n                const playerLocation = state.player.position;\r\n                const len = HexLength(Point.subtract(playerLocation, this.position));\r\n                if(len === 1) {\r\n                    return [AttackInfo.basicAttack(this, state.player, 3)];\r\n                }\r\n                return [];\r\n            case 'skip':\r\n            case 'smashPrep':\r\n                return [];\r\n            case 'smash':\r\n                return [new RadialAreaAttackInfo(this.position, [{radius: 1, damage: 3}, {radius: 2, damage: 1}], 8, Giant.radialSmashAnimation, true)];\r\n            default: return [];\r\n        }\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        const turn = Giant.turnSequence[this.turnSequenceIndex];\r\n        this.turnSequenceIndex = (this.turnSequenceIndex + 1) % Giant.turnSequence.length;\r\n        this.lastTurn = turn;\r\n\r\n        switch(turn) {\r\n            case 'move':\r\n                if(attack.length > 0) return this.position;\r\n                return this.internalGetMove(state, disallowed);\r\n            case 'smash':\r\n                // The giant is allowed to move immediately after the smash attack.\r\n                return this.internalGetMove(state, disallowed);\r\n            default:\r\n                return this.position;\r\n        }\r\n\r\n    }\r\n\r\n    private internalGetMove(state: GameState, disallowed: Point[]): Point {\r\n        const possibleMoves = GetRing(1).map(rp => Point.add(this.position, rp));\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], false)) \r\n                continue;\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const len = HexLength(ray);\r\n            if(len < minMoveDist) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        if(minMoves.length === 0) return this.position;\r\n        return minMoves[Math.floor(Math.random() * minMoves.length)];\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        return this.lastTurn === 'smashPrep' ? Giant.bigAttackPrepImage : Giant.renderable;\r\n    }\r\n}","import Point from \"../position/Point\";\r\nimport Rectangle from \"../position/Rectangle\";\r\nimport IRenderable from \"./IRenderable\";\r\n\r\nexport default class OffsetRenderable implements IRenderable {\r\n\r\n    constructor(private source: IRenderable, public offset: Point, public rotation?: number) {\r\n    }\r\n\r\n    tick(): boolean {\r\n        return this.source.tick();\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, position: Rectangle, rotation: number): void {\r\n        this.source.draw(ctx, position.shift(this.offset.x, this.offset.y), rotation + (this?.rotation ?? 0));\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport OffsetRenderable from '../../common/rendering/OffsetRenderable';\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport TileAttackInfo from \"../attackInfos/TileAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport { Direction, DirectionHelper } from \"../Direction\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nconst MAX_RANGE = 5;\r\n\r\nexport default class StoneEye extends Enemy {\r\n    static sprites: IRenderable[];\r\n    static readySprite: IRenderable;\r\n    static impactAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        StoneEye.sprites = [\r\n            assets.getAsset('stone_eye_0').getRenderable(),\r\n            assets.getAsset('stone_eye_1').getRenderable(),\r\n            assets.getAsset('stone_eye_2').getRenderable()\r\n        ]\r\n        StoneEye.readySprite = assets.getAsset('stone_eye_ready').getRenderable()\r\n\r\n        StoneEye.impactAnimation = assets.getAsset('impact_fire');\r\n    }\r\n\r\n    prepFire: Direction|undefined;\r\n    randart: number;\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 3;\r\n        this.isFlying = true;\r\n        this.prepFire = undefined;\r\n\r\n        this.goldValue = 5;\r\n        this.randart = 0;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        if(this.prepFire !== undefined) {\r\n            const points: Point[] = [];\r\n            const delta = DirectionHelper.ToPoint(this.prepFire);\r\n            let pt = Point.add(this.position, delta);\r\n            for(let i = 0; i < MAX_RANGE && state.tiles.isInBounds(pt.x, pt.y); i++) {\r\n                points.push(pt);\r\n                pt = Point.add(pt, delta);\r\n            }\r\n            this.prepFire = undefined;\r\n            return [new TileAttackInfo(this.position, [{damage: 1, positions: points}], 4, StoneEye.impactAnimation)];\r\n        }\r\n\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, this.position));\r\n        if(len <= MAX_RANGE) {\r\n            let ray = Point.subtract(playerLocation, this.position);\r\n            this.prepFire = DirectionHelper.FromPoint(ray);\r\n        }\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n\r\n        this.randart = Math.floor(Math.random() * StoneEye.sprites.length);\r\n\r\n        if(attack.length > 0 || (this.prepFire !== undefined)) {\r\n            // Don't move if you've attacked.\r\n            return this.position;\r\n        }\r\n\r\n        const possibleMoves = GetRing(1).map(rp => Point.add(this.position, rp));\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], true)) \r\n                continue;\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const len = HexLength(ray);\r\n            if(len === 1) {\r\n                continue; // Dont move within 1 of the player if you can avoid it.\r\n            }\r\n            if(len < minMoveDist) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        // Don't retreat\r\n        if(minMoveDist > HexLength(Point.subtract(state.player.position, this.position))) {\r\n            return this.position;\r\n        }\r\n\r\n        if(minMoves.length === 0) return this.position;\r\n        const moveTarget = minMoves[Math.floor(Math.random() * minMoves.length)];\r\n        \r\n\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, moveTarget));\r\n        if(len <= MAX_RANGE) {\r\n            let ray = Point.subtract(playerLocation, moveTarget);\r\n            this.prepFire = DirectionHelper.FromPoint(ray);\r\n        }\r\n        return moveTarget;\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        if(this.prepFire !== undefined) {\r\n            return new OffsetRenderable(StoneEye.readySprite, new Point(C.TILE_WIDTH/2, C.TILE_HEIGHT/2), DirectionHelper.ToAngle(this.prepFire));\r\n        }\r\n\r\n        // The origin of the eye sprite is the center (to support rotation), so we need to offset it\r\n        return new OffsetRenderable(StoneEye.sprites[this.randart], new Point(C.TILE_WIDTH/2, C.TILE_HEIGHT/2));\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport GameState from \"../GameState\";\r\nimport { HexToPixel } from \"../Hex\";\r\nimport IGamePhase from \"../phases/IGamePhase\";\r\nimport * as C from '../Constants';\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\n\r\nexport default interface IFeature {\r\n    name: string;\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState)=>IGamePhase): undefined | ((gs: GameState)=>IGamePhase);\r\n    afterEnemyTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState)=>IGamePhase): undefined | ((gs: GameState)=>IGamePhase);\r\n\r\n    draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void;\r\n}\r\n\r\nexport class SimpleFeature implements IFeature {\r\n\r\n    constructor(protected sprite: IRenderable, public name: string) {\r\n    }\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        return undefined;\r\n    }\r\n\r\n    afterEnemyTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        return undefined;\r\n    }\r\n    \r\n    draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void {\r\n        const tgt = HexToPixel(pt);\r\n        this.sprite.draw(ctx, new Rect(tgt.x, tgt.y, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../assets\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"../phases/IGamePhase\";\r\nimport IFeature, { SimpleFeature } from \"./IFeature\";\r\nimport * as C from '../Constants';\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport { DelaySpriteAnimationInstance, SpriteAnimationInstance } from \"../../common/rendering/SpriteAnimation\";\r\n\r\nexport default class LifeGem extends SimpleFeature {\r\n    static sprite: Sprite;\r\n    static brokenSprite: Sprite;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        LifeGem.sprite = assets.getAsset('life_gem') as Sprite;\r\n        LifeGem.brokenSprite = assets.getAsset('life_gem_broken') as Sprite;\r\n    }\r\n\r\n    isBroken: boolean;\r\n\r\n    constructor() { \r\n        super(LifeGem.sprite, 'LifeGem');\r\n        this.isBroken = false;\r\n    }\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        if(x === state.player.position.x && y === state.player.position.y && !this.isBroken) {\r\n            this.isBroken = true;\r\n            state.brokenGems[state.currentFloor] = true;\r\n            state.player.hp += 1;\r\n            state.player.maxHp += 1;\r\n            this.sprite = LifeGem.brokenSprite;\r\n        }\r\n        return nextPhase;\r\n    }\r\n}\r\n\r\nexport class RunicLifeGem extends SimpleFeature {\r\n    static sprite: Sprite;\r\n    static brokenSprite: Sprite;\r\n    static flashAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        RunicLifeGem.sprite = assets.getAsset('life_gem_runes') as Sprite;\r\n        RunicLifeGem.brokenSprite = assets.getAsset('life_gem_broken_runes') as Sprite;\r\n        RunicLifeGem.flashAnimation = assets.getAsset('life_gem_flash_animation');\r\n    }\r\n\r\n    hasFlashed: boolean;\r\n\r\n    constructor(public isBroken: boolean, public index: number) { \r\n        super(isBroken ? RunicLifeGem.brokenSprite : RunicLifeGem.sprite, 'RunicLifeGem');\r\n    }\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        if(!this.hasFlashed && state.enemies.length === 0 && !this.isBroken){\r\n            this.sprite = new DelaySpriteAnimationInstance(RunicLifeGem.flashAnimation.getRenderable() as SpriteAnimationInstance, this.index * 12);\r\n            this.hasFlashed = true;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void {\r\n        if(this.sprite.tick()){\r\n            this.sprite = this.isBroken ? RunicLifeGem.brokenSprite : RunicLifeGem.sprite;\r\n        }\r\n        super.draw(ctx, world, pt);\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Assets from \"../Assets\";\r\nimport Entity from \"../Entity\";\r\nimport { SimpleCell } from \"./HexCell\";\r\n\r\nexport default class Floor extends SimpleCell {\r\n    public static TypeID = 0;\r\n\r\n    constructor(assets: Assets, customSprite?: Point) {\r\n        super(Floor.TypeID, assets, customSprite ?? new Point(0, 0), true, customSprite !== undefined);\r\n    }\r\n\r\n    OnEntityStep(entity: Entity): void {\r\n    }\r\n}\r\n","import Point from \"../common/position/Point\";\r\n\r\nexport default class HexArray<T> {\r\n    private data: T[][];\r\n    private _size: number;\r\n\r\n    constructor(size: number, defaultValue: T) {\r\n        this._size = size;\r\n        this.data = [];\r\n        let midRowLength = size*2 - 1;\r\n        for(let dy = -size+1; dy <= size-1; dy++){\r\n            let row: T[] = [];\r\n            for(let dx = 0; dx < midRowLength - Math.abs(dy); dx++){\r\n                row.push(defaultValue);\r\n            }\r\n            this.data.push(row);\r\n        }\r\n    }\r\n\r\n    public size() {\r\n        return this._size;\r\n    }\r\n\r\n    public get(x: number, y: number): T;\r\n    public get(pt: Point): T;\r\n    public get(pt: [number, number]): T;\r\n    public get(xp: number|Point|[number, number], yp?: number): T {\r\n        const [x, y] = this.extractInputCoords(xp, yp);\r\n        let [dx, row] = this.toArrayCoords(x, y);\r\n        return this.data[row][dx];\r\n    }\r\n\r\n    public set(value: T, x: number, y: number): void;\r\n    public set(value: T, pt: Point): void;\r\n    public set(value: T, pt: [number, number]): void;\r\n    public set(value: T, xp: number|Point|[number, number], yp?: number): void {\r\n        const [x, y] = this.extractInputCoords(xp, yp);\r\n        const [dx, row] = this.toArrayCoords(x, y);\r\n        this.data[row][dx] = value;\r\n    }\r\n\r\n    private extractInputCoords(xp: number|Point|[number, number], y?: number): [number, number] {\r\n        if(typeof xp === \"number\"){\r\n            return [xp as number, y];\r\n        }\r\n        else if ((xp as Point).x !== undefined) {\r\n            return [(xp as Point).x, (xp as Point).y];\r\n        }\r\n        else {\r\n            return xp as [number, number];\r\n        }\r\n    }\r\n\r\n    public getRowLength(y: number): number {\r\n        return this._size * 2 - 1 - Math.abs(y);\r\n    }\r\n\r\n    public isInBounds(x: number, y: number): boolean {\r\n        if(y <= -this._size || y >= this._size) {\r\n            return false;\r\n        }\r\n        let [xMin, xMax] = this.getXRange(y);\r\n        return x >= xMin && x < xMax;\r\n    }\r\n\r\n    public getXRange(y: number): [number, number] {\r\n        const minX = this.getMinX(y);\r\n        const len = this.getRowLength(y);\r\n        return [minX, minX + len];\r\n    }\r\n\r\n    public getMinX(y: number): number {\r\n        const row = this._size - 1 + y;\r\n        return -Math.min(row, this._size - 1);\r\n    }\r\n\r\n    public iterate(func: (x: number, y: number, value: T) => void) {\r\n        for(let y = -this._size+1; y < this._size; y++) {\r\n            let [xMin, xMax] = this.getXRange(y);\r\n            for(let x = xMin; x < xMax; x++) {\r\n                func(x, y, this.get(x, y));\r\n            }\r\n        }\r\n    }\r\n\r\n    private toArrayCoords(x: number, y: number): [number, number] {\r\n        const row = this._size - 1 + y;\r\n        const firstX = -Math.min(row, this._size - 1);\r\n        const dx = x - firstX;\r\n\r\n        return [dx, row];\r\n    }\r\n}","import Point from \"../common/position/Point\";\r\n\r\n\r\ninterface IPathfinderNode {\r\n    position: Point;\r\n    parent: IPathfinderNode | undefined;\r\n    cost: number;\r\n}\r\n\r\nfunction toPath(node: IPathfinderNode): Point[] {\r\n    if(node.parent === null) return [node.position];\r\n    const parentPath = toPath(node.parent);\r\n    parentPath.push(node.position);\r\n    return parentPath;\r\n}\r\n\r\n// TODO: This is a quick and dirty Djikstra implementation with a ton of room for optimization.\r\n//       Currently, bot the closed and open sets are unsorted arrays, which means each dequeue takes O(n) time and each neighbor check takes O(n) time.\r\nexport default function DjikstraPath(start: Point, isEnd: (pt: Point) => boolean, getNeighbors: (from: Point) => { to: Point, cost: number }[]): Point[] {\r\n    const closedSet: IPathfinderNode[] = [];\r\n    const openSet: IPathfinderNode[] = [{ position: start, parent: null, cost: 0 }];\r\n\r\n    while (openSet.length > 0) {\r\n        const minIndex = openSet.reduce((min, cur, i) => cur.cost < openSet[min].cost ? i : min, 0);\r\n        const current = openSet.splice(minIndex, 1)[0];\r\n        closedSet.push(current);\r\n\r\n        if(isEnd(current.position)) {\r\n            return toPath(current);\r\n        }\r\n\r\n        for(const neighbor of getNeighbors(current.position)) {\r\n            const neighborNode = { position: neighbor.to, parent: current, cost: current.cost + neighbor.cost };\r\n            if(closedSet.find(c => c.position.equals(neighborNode.position))) continue;\r\n            const open = openSet.findIndex(c => c.position.equals(neighborNode.position));\r\n            if(open === -1) {\r\n                openSet.push(neighborNode);\r\n            }\r\n            else if(openSet[open].cost > neighborNode.cost) {\r\n                openSet[open] = neighborNode;\r\n            }\r\n        }\r\n    }\r\n\r\n    return null; // No path!\r\n}","import DjikstraPath from \"../DjikstraPath\";\r\nimport GameState from \"../GameState\";\r\nimport * as C from \"../Constants\";\r\nimport Floor from \"../tiles/Floor\";\r\nimport Point from \"../../common/position/Point\";\r\nimport { AllDirections, DirectionHelper } from \"../Direction\";\r\nimport Assets from \"../Assets\";\r\nimport HexCell from \"../tiles/HexCell\";\r\n\r\nexport function AssurePathTo(state: GameState, assets: Assets, predicate:(pt: Point, tile: HexCell)=>boolean, checkEnd: (isValidEnd: Point) => boolean, pathLengthNoise?: number) {\r\n    function getNeighbors(point: Point):{to: Point, cost: number}[] {\r\n        const neighbors = [];\r\n        for(const dir of AllDirections) {\r\n            const destPt = Point.add(point, DirectionHelper.ToPoint(dir));\r\n            if(state.tiles.isInBounds(destPt.x, destPt.y) && predicate(destPt, state.tiles.get(destPt))) {\r\n                neighbors.push({to: destPt, cost: state.tiles.get(destPt).isPathable ? 1 - (Math.random() * (pathLengthNoise??0)) : 99 });\r\n            }\r\n        }\r\n        return neighbors;\r\n    }\r\n\r\n    const pathToEnd = DjikstraPath(C.PLAYER_START_POSITION, checkEnd, getNeighbors);\r\n    for(const pt of pathToEnd) {\r\n        if(!state.tiles.get(pt).isPathable) {\r\n            state.tiles.set(new Floor(assets), pt);\r\n        }\r\n    }\r\n}\r\n\r\nexport function AssurePathToEnd(state: GameState, assets: Assets, pathLengthNoise?: number) {\r\n    return AssurePathTo(state, assets, pt => state.features.get(pt)?.name !== 'LifeGem', (pt) => state.features.get(pt)?.name === 'Stairs', pathLengthNoise);\r\n}","import Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../assets\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"../phases/IGamePhase\";\r\nimport { SimpleFeature } from \"./IFeature\";\r\n\r\nexport default class Shrine extends SimpleFeature {\r\n    static sprite: Sprite;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Shrine.sprite = assets.getAsset('shrine') as Sprite;\r\n    }\r\n\r\n    isUsed: boolean;\r\n\r\n    constructor() { \r\n        super(Shrine.sprite, 'Shrine');\r\n        this.isUsed = false;\r\n    }\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        if(x === state.player.position.x && y === state.player.position.y && !this.isUsed) {\r\n            this.isUsed = true;\r\n            state.player.hp = state.player.maxHp;\r\n        }\r\n        return nextPhase;\r\n    }\r\n}","import KeyboardManager from \"../../common/input/KeyboardManager\";\r\nimport MouseManager from \"../../common/input/MouseManager\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport * as C from '../Constants';\r\nimport ISaleItem from \"../shopItems/ISaleItem\";\r\nimport { fullHealth } from \"../../dndmech/SymbolDefinitions\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\n\r\nconst downKeys = ['x', '2', 's', 'ArrowDown'];\r\nconst upKeys = ['w', '8', 'ArrowUp'];\r\n\r\nconst selectKeys = ['Enter', ' '];\r\n\r\nexport default class ShopPhase implements IGamePhase {\r\n\r\n    static shopItemSprite: Sprite;\r\n    static shopItemSelectedSprite: Sprite;\r\n    static shopItemNoMoney: Sprite;\r\n\r\n    static closeButton: Sprite;\r\n    static closeButtonSelected: Sprite;\r\n    static assets: Assets;\r\n\r\n    static onAssetsLoaded(assets: Assets): void {\r\n        ShopPhase.assets = assets;\r\n        ShopPhase.shopItemSprite = assets.getAsset('shop_entry') as Sprite;\r\n        ShopPhase.shopItemSelectedSprite = assets.getAsset('shop_entry_selected') as Sprite;\r\n        ShopPhase.shopItemNoMoney = assets.getAsset('shop_entry_nomoney') as Sprite;\r\n        \r\n        ShopPhase.closeButton = assets.getAsset('close_button') as Sprite;\r\n        ShopPhase.closeButtonSelected = assets.getAsset('close_button_selected') as Sprite;\r\n    }\r\n\r\n    selectedItem: number;\r\n    displayOffset: Point;\r\n    wrappedTexts: string[][];\r\n\r\n    constructor(public items: ISaleItem[], private nextState: (gs: GameState) => IGamePhase)\r\n    {\r\n        this.selectedItem = 0;\r\n        const fullHeight = items.length * ShopPhase.shopItemSprite.height() + ShopPhase.closeButton.height();\r\n\r\n        this.displayOffset = new Point(\r\n            C.MAP_PIXEL_SIZE / 2 - ShopPhase.shopItemSprite.width() / 2,\r\n            C.MAP_PIXEL_SIZE / 2 - fullHeight / 2\r\n        );\r\n\r\n        this.wrappedTexts = items.map(item => item === undefined ? [] : wrapText(item.description, 38));\r\n    }\r\n    \r\n    init(state: GameState): void {\r\n        this.selectedItem = 0;\r\n    }\r\n\r\n    tick(state: GameState, keys: KeyboardManager, mouse: MouseManager): IGamePhase {\r\n\r\n        if(downKeys.some(key => keys.isKeyPressed(key))) {\r\n            this.selectedItem = Math.min(this.selectedItem + 1, this.items.length);\r\n        }\r\n\r\n        if(upKeys.some(key => keys.isKeyPressed(key))) {\r\n            this.selectedItem = Math.max(this.selectedItem - 1, 0);\r\n        }\r\n        \r\n        if(selectKeys.some(key => keys.isKeyPressed(key))) {\r\n            const item = this.getSelectedItem();\r\n            if(item === undefined) {\r\n                return this.nextState(state);\r\n            }\r\n            else if(item.price <= state.gold) {\r\n                state.gold -= item.price;\r\n                this.items[this.selectedItem] = undefined;\r\n                const result = item.onBuy(state, state.player);\r\n                if((result as any)?.replaceItem !== undefined) {\r\n                    this.items[this.selectedItem] = (result as any)?.replaceItem;\r\n                    this.wrappedTexts[this.selectedItem] = wrapText(this.items[this.selectedItem].description, 38);\r\n                }\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    getSelectedItem() {\r\n        if(this.selectedItem === this.items.length) return undefined;\r\n        return this.items[this.selectedItem];\r\n    }\r\n    \r\n    draw(ctx: CanvasRenderingContext2D, state: GameState): void {\r\n        state.draw(ctx);\r\n\r\n        ctx.globalAlpha = 0.5;\r\n        ctx.fillStyle = 'black';\r\n        ctx.fillRect(0, 0, C.MAP_PIXEL_SIZE, C.MAP_PIXEL_SIZE);\r\n        ctx.globalAlpha = 1;\r\n\r\n        for(let i = 0; i < this.items.length; i++) {\r\n            this.drawShopItem(\r\n                ctx, \r\n                state, \r\n                this.items[i], i === this.selectedItem, \r\n                this.displayOffset.x, \r\n                this.displayOffset.y + i * ShopPhase.shopItemSprite.height(),\r\n                this.wrappedTexts[i]);\r\n        }\r\n        const closeButtonSprite = this.selectedItem === this.items.length ? ShopPhase.closeButtonSelected : ShopPhase.closeButton;\r\n\r\n        closeButtonSprite.draw(ctx, new Rect(\r\n            this.displayOffset.x + ShopPhase.shopItemSprite.width() - closeButtonSprite.width(),\r\n            this.displayOffset.y + this.items.length * ShopPhase.shopItemSprite.height(), \r\n            closeButtonSprite.width(), \r\n            closeButtonSprite.height()\r\n        ), 0);\r\n    }\r\n\r\n    drawShopItem(ctx: CanvasRenderingContext2D, state:GameState, item: ISaleItem, selected: boolean, x: number, y: number, description: string[]) {\r\n        const bgSprite = !selected ? \r\n                ShopPhase.shopItemSprite : \r\n                item === undefined || item.price <= state.gold ? \r\n                    ShopPhase.shopItemSelectedSprite : \r\n                    ShopPhase.shopItemNoMoney;\r\n\r\n        bgSprite.draw(ctx, new Rect(x, y, bgSprite.width(), bgSprite.height()), 0);\r\n\r\n        if(item !== undefined) {\r\n            item.icon.draw(ctx, new Rect(x + 2, y + 2, 32, 48), 0);\r\n            ShopPhase.assets.drawString(ctx, new Point(x + 38, y), item.name);\r\n\r\n            ShopPhase.assets.drawSmallString(ctx, new Point(x + 223, y + 3), '$' + item.price);\r\n\r\n            for(let i = 0; i < 4 && i < description.length; i++){\r\n                ShopPhase.assets.drawSmallString(ctx, new Point(x + 38, y + 15 + 8 * i), description[i]);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction wrapText(text: string, maxLength: number): string[]{\r\n    const words = text.split(' ');\r\n    const lines: string[] = [];\r\n    let currentLine = '';\r\n\r\n    for(const word of words) {\r\n        if(currentLine.length + word.length + 1 > maxLength) {\r\n            lines.push(currentLine);\r\n            currentLine = word + ' ';\r\n        }\r\n        else {\r\n            currentLine += word + ' ';\r\n        }\r\n    }\r\n    lines.push(currentLine);\r\n\r\n    return lines;\r\n}","import Point from \"../../common/position/Point\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../assets\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"../phases/IGamePhase\";\r\nimport IFeature, { SimpleFeature } from \"./IFeature\";\r\nimport * as C from '../Constants';\r\nimport FloorTransitionPhase from \"../phases/FloorTransitionPhase\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport ISaleItem from \"../shopItems/ISaleItem\";\r\nimport ShopPhase from \"../phases/ShopPhase\";\r\n\r\nexport default class Shop extends SimpleFeature {\r\n    static sprite: Sprite;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Shop.sprite = assets.getAsset('shop') as Sprite;\r\n    }\r\n\r\n    constructor(private items: ISaleItem[]) { \r\n        super(Shop.sprite, 'Shop');\r\n    }\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        if(x === state.player.position.x && y === state.player.position.y) {\r\n            return _ => {\r\n                return new ShopPhase(this.items, nextPhase);\r\n            };\r\n        }\r\n        return undefined;\r\n    }\r\n}","import IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Player from \"../entities/Player\";\r\nimport GameState from \"../GameState\";\r\nimport PlayerWeapon from \"../weapons/PlayerWeapon\";\r\nimport ISaleItem from \"./ISaleItem\";\r\n\r\nexport default class WeaponSaleItem implements ISaleItem {\r\n    \r\n    name: string;\r\n    description: string;\r\n    icon: IRenderable;\r\n\r\n    constructor(public weapon: PlayerWeapon, public price: number) \r\n    {\r\n        this.name = weapon.name;\r\n        this.description = weapon.description;\r\n        this.icon = weapon.shopImage;\r\n    }\r\n\r\n    onBuy(state: GameState, player: Player): { replaceItem?: ISaleItem }  {\r\n        if(this.weapon.type === 'primary') {\r\n            const oldPrimary = player.primary;\r\n            player.primary = this.weapon;\r\n            return { replaceItem: new WeaponSaleItem(oldPrimary, 0) };\r\n        }\r\n        else { \r\n            const oldSecondary = player.secondary;\r\n            player.secondary = this.weapon;\r\n            return { replaceItem: new WeaponSaleItem(oldSecondary, 0) };\r\n        }\r\n    }\r\n}","import IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Assets from \"../assets\";\r\nimport Player from \"../entities/Player\";\r\nimport GameState from \"../GameState\";\r\nimport PlayerWeapon from \"../weapons/PlayerWeapon\";\r\nimport ISaleItem from \"./ISaleItem\";\r\n\r\nexport default class FullHealItem implements ISaleItem {\r\n    \r\n    name: string;\r\n    description: string;\r\n    icon: IRenderable;\r\n\r\n    constructor(public price: number, assets: Assets) \r\n    {\r\n        this.name = 'HP + 1';\r\n        this.description = 'Heal to full health, and increase your max HP by 1';\r\n        this.icon = assets.getAsset('shop_heart+1_icon').getRenderable();\r\n    }\r\n\r\n    onBuy(state: GameState, player: Player): void {\r\n        player.maxHp ++;\r\n        player.hp = player.maxHp;\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport DelayAnimation from \"../animation/DelayAnimation\";\r\nimport IAnimation from \"../animation/IAnimation\";\r\nimport ParallelAnimation from \"../animation/ParallelAnimation\";\r\nimport RenderableAnimation from \"../animation/RenderableAnimation\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength, HexToPixel } from \"../Hex\";\r\nimport IAttackInfo, { IAttackDamageInfo } from \"./IAttackInfo\";\r\nimport * as C from '../Constants';\r\nimport Enemy from \"../entities/Enemy\";\r\n\r\nexport default class SpawnEnemyAttackInfo implements IAttackInfo {\r\n    constructor(private point: Point, private enemy: Enemy, private animationSource?: IRenderableSource) {\r\n        \r\n    }\r\n\r\n    getAffectedTiles(state: GameState): IAttackDamageInfo[] {\r\n        return [];\r\n    }\r\n\r\n    toAnimations(state: GameState): IAnimation[] {\r\n        if(this.animationSource !== undefined) {\r\n            const tgt = HexToPixel(this.point);\r\n            return [\r\n                new RenderableAnimation(\r\n                    this.animationSource.getRenderable(),\r\n                    new Rect(tgt.x, tgt.y, C.TILE_WIDTH, C.TILE_HEIGHT)\r\n                )\r\n            ];\r\n        }\r\n\r\n        return [];\r\n    }\r\n    \r\n    applyExtraEffects(state: GameState): void {\r\n        if(state.entityAt(this.point) === undefined) {\r\n            this.enemy.position = this.point;\r\n            state.enemies.push(this.enemy);\r\n        }\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport OffsetRenderable from '../../common/rendering/OffsetRenderable';\r\nimport Assets from \"../Assets\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport RadialAreaAttackInfo from \"../attackInfos/RadialAreaAttackInfo\";\r\nimport TileAttackInfo from \"../attackInfos/TileAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport { AllDirections, Direction, DirectionHelper } from \"../Direction\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nexport default class BlueBurstDisc extends Enemy {\r\n    static sprite: IRenderable;\r\n    static explodingSprite: IRenderable;\r\n    static impactAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        BlueBurstDisc.sprite = assets.getAsset('blue_sphere').getRenderable();\r\n        BlueBurstDisc.explodingSprite = assets.getAsset('blue_sphere_exploding').getRenderable();\r\n        BlueBurstDisc.impactAnimation = assets.getAsset('impact_blue_magic');\r\n    }\r\n\r\n    isExploding: boolean;\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 2;\r\n        this.isFlying = true;\r\n        this.isExploding = false;\r\n\r\n        this.goldValue = 0;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        if(this.isExploding) {\r\n            this.hp = 0\r\n            return [new RadialAreaAttackInfo(this.position, [{radius: 1, damage: 2}], 8, BlueBurstDisc.impactAnimation, true)];\r\n        }\r\n\r\n        this.isExploding = true;\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        return this.position;\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        if(this.isExploding) {\r\n            return BlueBurstDisc.explodingSprite;\r\n        }\r\n        return BlueBurstDisc.sprite;\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport SpawnEnemyAttackInfo from \"../attackInfos/SpawnEnemyAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport BlueBurstDisc from \"./BlueBurstDisc\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nconst MAX_RANGE = 5;\r\n\r\nexport default class BlueMage extends Enemy {\r\n    static sprite: IRenderable;\r\n    static cooldownsprite: IRenderable;\r\n    static projectileSprite: Sprite;\r\n    static spawnAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        BlueMage.sprite = assets.getAsset('blue_mage') as Sprite;\r\n        BlueMage.cooldownsprite = assets.getAsset('blue_mage_cooldown') as Sprite;\r\n        BlueMage.spawnAnimation = assets.getAsset('impact_blue_magic_backwards') as Sprite;\r\n    }\r\n\r\n    attackOnCooldown: boolean;\r\n\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 3;\r\n        this.isFlying = false;\r\n\r\n        this.goldValue = 5;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        if(this.attackOnCooldown){\r\n            return [];\r\n        }\r\n\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, this.position));\r\n        if(len <= MAX_RANGE) {\r\n            let ring = GetRing(1);\r\n\r\n            ring = ring.map(pt => Point.add(playerLocation, pt)).filter(pt => state.isValidMove(pt, true));\r\n\r\n            const tgt = ring[Math.floor(Math.random() * ring.length)];\r\n            this.attackOnCooldown = true;\r\n            return [\r\n                new SpawnEnemyAttackInfo(tgt, new BlueBurstDisc(tgt), BlueMage.spawnAnimation)\r\n            ];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        if(attack.length > 0) {\r\n            // Don't move if you've attacked.\r\n            return this.position;\r\n        }\r\n\r\n        if(this.attackOnCooldown) {\r\n            // Don't move if you're on cooldown\r\n            this.attackOnCooldown = false;\r\n            return this.position;\r\n        }\r\n\r\n        const possibleMoves = GetRing(1).map(rp => Point.add(this.position, rp));\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], false)) \r\n                continue;\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const len = HexLength(ray);\r\n            if(len === 1) {\r\n                continue;\r\n            }\r\n            if(len < minMoveDist) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        if(minMoves.length === 0) return this.position;\r\n        return minMoves[Math.floor(Math.random() * minMoves.length)];\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        if(this.attackOnCooldown) return BlueMage.cooldownsprite;\r\n        return BlueMage.sprite;\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport Entity from \"../Entity\";\r\nimport { SimpleCell } from \"./HexCell\";\r\nimport * as C from '../Constants';\r\nimport GameState from \"../GameState\";\r\nimport TileAttackInfo from \"../attackInfos/TileAttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\n\r\nexport type TrapDamage = 1|3|5;\r\nconst trapSprites: { [key in TrapDamage]: Point } = {\r\n    1: new Point(0, 6),\r\n    3: new Point(0, 7),\r\n    5: new Point(0, 8)\r\n}\r\nconst trapCooldown: { [key in TrapDamage]: number } = {\r\n    1: 0,\r\n    3: 1,\r\n    5: 2\r\n}\r\n\r\nexport default class Trap extends SimpleCell {\r\n    public static TypeID = 5;\r\n\r\n    public damage: TrapDamage;\r\n    public state: 'wait'|'prep'|'fire' = 'wait';\r\n    private cooldown = 0;\r\n    private assets: Assets;\r\n\r\n    constructor(assets: Assets, damage: TrapDamage) {\r\n        super(Trap.TypeID, assets, trapSprites[damage], true, false);\r\n        this.assets = assets;\r\n        this.damage = damage;\r\n        this.state = 'wait';\r\n        this.cooldown = trapCooldown[damage];\r\n    }\r\n\r\n    override OnEntityStep(entity: Entity): void {\r\n        if(this.state === 'wait') {\r\n            const spritePos = trapSprites[this.damage];\r\n            super.renderable = new Sprite(this.assets.tiles.image, new Rect((spritePos.x+1) * C.TILE_WIDTH, spritePos.y * C.TILE_HEIGHT, C.TILE_WIDTH, C.TILE_HEIGHT));\r\n        }\r\n    }\r\n\r\n    override AfterEnemyTurn(state: GameState, x: number, y: number): IAttackInfo[] {\r\n        if(this.state === 'wait'){\r\n            const entityHere = state.entityAt(new Point(x, y));\r\n            if(entityHere !== undefined) {\r\n                this.state = 'prep';\r\n            }\r\n        }\r\n        \r\n        if(this.state === 'prep' && this.cooldown === 0) {\r\n            this.state = 'fire';\r\n            const spritePos = trapSprites[this.damage];\r\n            super.renderable = new Sprite(this.assets.tiles.image, new Rect((spritePos.x+2) * C.TILE_WIDTH, spritePos.y * C.TILE_HEIGHT, C.TILE_WIDTH, C.TILE_HEIGHT));\r\n            const entityHere = state.entityAt(new Point(x, y));\r\n            if(entityHere !== undefined) {\r\n                return [\r\n                    new TileAttackInfo(new Point(x, y), [{ damage: this.damage, positions: [new Point(x,y)] }], 0, this.assets.getImpactAnimation(1))\r\n                ]\r\n            }\r\n        }\r\n        else if(this.state === 'prep') { this.cooldown --; }\r\n        return [];\r\n    }\r\n}\r\n","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nexport default class Spider extends Enemy {\r\n    static sprite: IRenderable;\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Spider.sprite = assets.getAsset('spider').getRenderable();\r\n    }\r\n\r\n    wasNextToPlayer = false;\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 1;\r\n        this.isFlying = false;\r\n        this.goldValue = 3;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, this.position));\r\n        if(len === 1) {\r\n            return [AttackInfo.basicAttack(this, state.player, 1)];\r\n        }\r\n        if(len === 2 && this.wasNextToPlayer) {\r\n            this.wasNextToPlayer = false;\r\n            return [AttackInfo.basicAttack(this, state.player, 1)];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        const possibleMoves = GetRing(2).map(rp => Point.add(this.position, rp));\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], false)) \r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const len = HexLength(ray);\r\n            if(len < minMoveDist) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        const dest = minMoves.length === 0 ? this.position : minMoves[Math.floor(Math.random() * minMoves.length)];\r\n        if(HexLength(Point.subtract(state.player.position, dest)) === 1) {\r\n            this.wasNextToPlayer = true;\r\n        }\r\n        else {\r\n            this.wasNextToPlayer = false;\r\n        }\r\n        return dest;\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        return Spider.sprite;\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport * as C from '../Constants';\r\nimport Player from \"../entities/Player\";\r\nimport GameState from \"../GameState\";\r\n\r\nexport default abstract class PlayerWeapon {\r\n    public name: string;\r\n    public description: string;\r\n    public iconImage: IRenderable;\r\n    public sprite: IRenderable;\r\n    public shopImage: IRenderable;\r\n\r\n    constructor(public type: 'primary'|'secondary', assets: Assets, artTile: Point) {\r\n        if(this.type === 'primary') {\r\n            this.sprite = new Sprite(\r\n                assets.weapons.image, \r\n                new Rect(artTile.x * C.TILE_WIDTH, artTile.y * C.TILE_HEIGHT, C.TILE_WIDTH / 2, C.TILE_HEIGHT));\r\n\r\n            this.iconImage = new Sprite(\r\n                assets.weapons.image, \r\n                new Rect(artTile.x * C.TILE_WIDTH + C.TILE_WIDTH / 2, artTile.y * C.TILE_HEIGHT, C.TILE_WIDTH / 2, C.TILE_HEIGHT));\r\n        }\r\n        else {\r\n            this.sprite = new Sprite(\r\n                assets.weapons.image, \r\n                new Rect(artTile.x * C.TILE_WIDTH + C.TILE_WIDTH / 2, artTile.y * C.TILE_HEIGHT, C.TILE_WIDTH / 2, C.TILE_HEIGHT));\r\n\r\n            this.iconImage = new Sprite(\r\n                assets.weapons.image, \r\n                new Rect(artTile.x * C.TILE_WIDTH, artTile.y * C.TILE_HEIGHT, C.TILE_WIDTH / 2, C.TILE_HEIGHT));\r\n        }\r\n\r\n        this.shopImage = new Sprite(\r\n            assets.weapons.image,\r\n            new Rect(artTile.x * C.TILE_WIDTH, artTile.y * (C.TILE_HEIGHT*1.5) + C.TILE_HEIGHT * 2, C.TILE_WIDTH, C.TILE_HEIGHT * 1.5)\r\n        );\r\n    }\r\n    abstract enableAdditionalMoves(state: GameState, player: Player): {dest: Point, forceMove: Point}[];\r\n    abstract getBeforeMoveAttacks(state: GameState, player: Player, moveFrom: Point, moveTo: Point): AttackInfo[];\r\n    abstract getAfterMoveAttacks(state: GameState, player: Player, moveFrom: Point, moveTo: Point): AttackInfo[];\r\n}\r\n","import Point from \"../../common/position/Point\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport Player from \"../entities/Player\";\r\nimport GameState from \"../GameState\";\r\nimport { HexLength, TurnLeft, TurnRight } from \"../Hex\";\r\nimport PlayerWeapon from \"./PlayerWeapon\";\r\n\r\ninterface ISimpleAttack { onMove: Point, pattern: WeaponPattern[], attack: (state: GameState, player:Player, target: Point) => AttackInfo | undefined}\r\n\r\ntype WeaponPattern = Point | { empty: Point[], target: Point };\r\n\r\nfunction patternIsPoint(pattern: WeaponPattern): pattern is Point {\r\n    return (pattern as Point).x !== undefined;\r\n}\r\n\r\nexport default class SimpleWeapon extends PlayerWeapon{\r\n    private attacks: ISimpleAttack[];\r\n    constructor(type: 'primary'|'secondary', assets: Assets, artTile: Point, private beforeMove: boolean, ...simpleAttacks: ISimpleAttack[]) {\r\n        super(type, assets, artTile);\r\n        this.attacks = simpleAttacks;\r\n    }\r\n\r\n    private getAttacks(state:GameState, player: Player, moveFrom: Point, moveTo: Point): AttackInfo[] {\r\n        const attacks: AttackInfo[] = [];\r\n        const moveDelta = Point.subtract(moveTo, moveFrom);\r\n        for(const attack of this.attacks) {\r\n            if(HexLength(moveDelta) !== HexLength(attack.onMove)) continue;\r\n            const rot = SimpleWeapon.getRotation(moveDelta, attack.onMove);\r\n            if(rot === undefined) continue;\r\n            for(const pattern of attack.pattern) {\r\n                const requireEmpty = patternIsPoint(pattern) ? [] : pattern.empty;\r\n\r\n                const target = Point.add(moveFrom, TurnLeft(patternIsPoint(pattern) ? pattern : pattern.target, rot));\r\n                const isEmptyRequirementFulfilled = requireEmpty.every(p => state.entityAt(Point.add(moveFrom, TurnLeft(p, rot))) === undefined);\r\n                if(requireEmpty.length === 0 || isEmptyRequirementFulfilled) {\r\n                    const attackInfo = attack.attack(state, player, target);\r\n                    if(attackInfo !== undefined) attacks.push(attackInfo);\r\n                }\r\n            }\r\n        }\r\n        return attacks;\r\n    }\r\n\r\n    override enableAdditionalMoves(state: GameState, player: Player): {dest: Point, forceMove: Point}[] {\r\n        return [];\r\n    }\r\n\r\n    getBeforeMoveAttacks(state: GameState, player: Player, moveFrom: Point, moveTo: Point): AttackInfo[] {\r\n        if(this.beforeMove) return this.getAttacks(state, player, moveFrom, moveTo);\r\n        return [];\r\n    }\r\n    \r\n    getAfterMoveAttacks(state: GameState, player: Player, moveFrom: Point, moveTo: Point): AttackInfo[] {\r\n        if(this.beforeMove) return [];\r\n        return this.getAttacks(state, player, moveFrom, moveTo);\r\n    }\r\n\r\n    static getRotation(delta: Point, target: Point) {\r\n        for(let i = 0; i < 6; i++) {\r\n            if(delta.equals(target)) return i;\r\n            delta = TurnRight(delta);\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n}","import { timeStamp } from \"console\";\r\nimport Point from \"../../common/position/Point\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport Player from \"../entities/Player\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport SimpleWeapon from \"./SimpleWeapon\";\r\n\r\nexport default class Sword extends SimpleWeapon {\r\n\r\n    impactAnimation: IRenderableSource;\r\n\r\n    constructor(assets: Assets) {\r\n        super('primary', assets, new Point(0, 0), true,\r\n        {\r\n            onMove: new Point(1, 0),\r\n            pattern: [new Point(0, -1), new Point(1, -1), new Point(-1, 1), new Point(0, 1)],\r\n            attack: (s,p,t) => this.getAttack(s,p,t)\r\n        });\r\n\r\n        this.impactAnimation = assets.getImpactAnimation(0);\r\n\r\n        this.name = 'Sword';\r\n        this.description = 'A versatile weapon which strikes all adjacent enemies (except those directly behind you) when you move.'\r\n    }\r\n\r\n    getAttack(state: GameState, player: Player, target: Point): AttackInfo | undefined {\r\n        const e = state.entityAt(target);\r\n        if(e === undefined || Entity.IsPlayer(e)) return undefined;\r\n        return AttackInfo.animationAttack(player, e, 1, this.impactAnimation, false);\r\n    }\r\n}","import { timeStamp } from \"console\";\r\nimport Point from \"../../common/position/Point\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport Player from \"../entities/Player\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport SimpleWeapon from \"./SimpleWeapon\";\r\n\r\nexport default class Spear extends SimpleWeapon {\r\n\r\n    impactAnimation: IRenderableSource;\r\n\r\n    constructor(assets: Assets) {\r\n        super('primary', assets, new Point(1, 0), false,\r\n        {\r\n            onMove: new Point(1, 0),\r\n            pattern: [new Point(2, 0)],\r\n            attack: (s,p,t) => this.getAttack(s,p,t)\r\n        });\r\n\r\n        this.impactAnimation = assets.getImpactAnimation(1);\r\n\r\n        this.name = 'Spear';\r\n        this.description = 'A primary weapon which strikes enemies two spaces away when you step towards them';\r\n    }\r\n\r\n    getAttack(state: GameState, player: Player, target: Point): AttackInfo | undefined {\r\n        const e = state.entityAt(target);\r\n        if(e === undefined || Entity.IsPlayer(e)) return undefined;\r\n        return AttackInfo.animationAttack(player, e, 2, this.impactAnimation, true);\r\n    }\r\n}","import { timeStamp } from \"console\";\r\nimport Point from \"../../common/position/Point\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport Player from \"../entities/Player\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength, TurnLeft } from \"../Hex\";\r\nimport PlayerWeapon from \"./PlayerWeapon\";\r\nimport SimpleWeapon from \"./SimpleWeapon\";\r\n\r\nexport default class Hammer extends PlayerWeapon {\r\n    impactAnimation: IRenderableSource;\r\n\r\n    constructor(assets: Assets) {\r\n        super('primary', assets, new Point(2, 0));\r\n\r\n        this.impactAnimation = assets.getImpactAnimation(0);\r\n\r\n        this.name = 'Hammer';\r\n        this.description = 'A primary weapon which allows you to attack an enemy by walking into them, dealing damage to them and adjacent enemies.';\r\n    }\r\n\r\n    override enableAdditionalMoves(state: GameState, player: Player): {dest: Point, forceMove: Point}[] {\r\n        const directAttacks = [];\r\n        for(const dir of GetRing(1)) {\r\n            const dest = Point.add(dir, player.position);\r\n            if(!state.tiles.isInBounds(dest.x, dest.y) || !state.tiles.get(dest).isPathable) continue;\r\n            const entity = state.entityAt(dest);\r\n            if(entity !== undefined && !Entity.IsPlayer(entity)) {\r\n                directAttacks.push(dest);\r\n            }\r\n        }\r\n        return directAttacks.map(pt => ({ dest: pt, forceMove: player.position }));\r\n    }\r\n\r\n    getBeforeMoveAttacks(state: GameState, player: Player, moveFrom: Point, moveTo: Point): AttackInfo[] {\r\n        const targetEntity = state.entityAt(moveTo);\r\n        if(targetEntity === undefined || Entity.IsPlayer(targetEntity)) return [];\r\n        const ray = Point.subtract(moveTo, moveFrom);\r\n        if(HexLength(ray) !== 1) return [];\r\n        const rot = SimpleWeapon.getRotation(ray, new Point(1, 0));\r\n        const secondaryTargets = [new Point(0, 1), new Point(1, -1)];\r\n\r\n        const secondaryAttacks = secondaryTargets.map(target => {\r\n            const realTarget = Point.add(TurnLeft(target, rot), moveFrom);\r\n            const e = state.entityAt(realTarget);\r\n            if(e === undefined) return undefined;\r\n            return AttackInfo.animationAttack(player, e, 2, this.impactAnimation, false);\r\n        }).filter(a => a !== undefined);\r\n\r\n        return [\r\n            AttackInfo.animationAttack(player, targetEntity, 2, this.impactAnimation, true),\r\n            ...secondaryAttacks\r\n        ]\r\n    }\r\n\r\n    getAfterMoveAttacks(state: GameState, player: Player, moveFrom: Point, moveTo: Point): AttackInfo[] {\r\n        return [];\r\n    }\r\n\r\n    getAttack(state: GameState, player: Player, target: Point): AttackInfo | undefined {\r\n        const e = state.entityAt(target);\r\n        if(e === undefined || Entity.IsPlayer(e)) return undefined;\r\n        return AttackInfo.animationAttack(player, e, 2, this.impactAnimation, false);\r\n    }\r\n}","import { timeStamp } from \"console\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport Player from \"../entities/Player\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport SimpleWeapon from \"./SimpleWeapon\";\r\n\r\nexport default class Dagger extends SimpleWeapon {\r\n    constructor(assets: Assets) {\r\n        super('secondary', assets, new Point(0, 1), true,\r\n        {\r\n            onMove: new Point(1, 0),\r\n            pattern: [new Point(1, -1), new Point(0, 1)],\r\n            attack: (s,p,t) => this.getAttack(s,p,t)\r\n        });\r\n\r\n        this.name = 'Dagger';\r\n        this.description = 'A secondary weapon which attacks enemies forward-left and forward-right of you when you move.'\r\n    }\r\n\r\n    getAttack(state: GameState, player: Player, target: Point): AttackInfo | undefined {\r\n        const e = state.entityAt(target);\r\n        if(e === undefined || Entity.IsPlayer(e)) return undefined;\r\n        return AttackInfo.basicAttack(player, e, 1);\r\n    }\r\n}","import { timeStamp } from \"console\";\r\nimport Point from \"../../common/position/Point\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport Player from \"../entities/Player\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport SimpleWeapon from \"./SimpleWeapon\";\r\n\r\nexport default class Kunai extends SimpleWeapon {\r\n    projectile: Sprite;\r\n    constructor(assets: Assets) {\r\n        super('secondary', assets, new Point(1, 1), true,\r\n        {\r\n            onMove: new Point(1, 0),\r\n            pattern: [ \r\n                { empty: [new Point(1, -1)], target: new Point(2, -2) }, \r\n                { empty: [new Point(0, 1)], target: new Point(0, 2) }\r\n            ],\r\n            attack: (s,p,t) => this.getAttack(s,p,t)\r\n        });\r\n\r\n        this.name = 'Kunai';\r\n        this.projectile = assets.getAsset('projectile_kunai') as Sprite;\r\n        this.description = 'A ranged secondary weapon which attacks enemies forward-left and forward-right of you two spaces away when you move'\r\n    }\r\n\r\n    getAttack(state: GameState, player: Player, target: Point): AttackInfo | undefined {\r\n        const e = state.entityAt(target);\r\n        if(e === undefined || Entity.IsPlayer(e)) return undefined;\r\n        return AttackInfo.projectileAttack(player, e, 1, this.projectile);\r\n    }\r\n}","import { timeStamp } from \"console\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport Player from \"../entities/Player\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport SimpleWeapon from \"./SimpleWeapon\";\r\n\r\nexport default class Caltrops extends SimpleWeapon {\r\n    projectile: Sprite;\r\n    constructor(assets: Assets) {\r\n        super('secondary', assets, new Point(2, 1), true,\r\n        {\r\n            onMove: new Point(1, 0),\r\n            pattern: [\r\n                new Point(-1, 0), \r\n                { empty: [new Point(-1, 0)], target: new Point(-2, 0) }\r\n            ],\r\n            attack: (s,p,t) => this.getAttack(s,p,t)\r\n        });\r\n\r\n        this.name = 'Caltrops';\r\n        this.projectile = assets.getAsset('projectile_kunai') as Sprite;\r\n        this.description = 'A secondary weapon which attacks behind you up to 2 spaces away'\r\n    }\r\n\r\n    getAttack(state: GameState, player: Player, target: Point): AttackInfo | undefined {\r\n        const e = state.entityAt(target);\r\n        if(e === undefined || Entity.IsPlayer(e)) return undefined;\r\n        return AttackInfo.projectileAttack(player, e, 1, this.projectile);\r\n    }\r\n}","import GameState from \"../GameState\";\r\nimport IMapGen from \"./IMapGen\";\r\nimport * as C from \"../Constants\";\r\nimport HexCell from \"../tiles/HexCell\";\r\nimport Floor from \"../tiles/Floor\";\r\nimport HexArray from \"../HexArray\";\r\nimport Assets from \"../Assets\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Zombie from \"../entities/Zombie\";\r\nimport Archer from \"../entities/Archer\";\r\nimport Mage from \"../entities/Mage\";\r\nimport Lava from \"../tiles/Lava\";\r\nimport { AllDirections, DirectionHelper } from \"../Direction\";\r\nimport { AssurePathTo, AssurePathToEnd } from \"./MapGenCommon\";\r\nimport StoneEye from \"../entities/StoneEye\";\r\nimport Trap, { TrapDamage } from \"../tiles/Trap\";\r\nimport IFeature from \"../features/IFeature\";\r\nimport Stairs from \"../features/Stairs\";\r\nimport LifeGem from \"../features/LifeGem\";\r\nimport Shrine from \"../features/Shrine\";\r\nimport Spider from \"../entities/Spider\";\r\nimport Shop from \"../features/Shop\";\r\nimport ISaleItem from \"../shopItems/ISaleItem\";\r\nimport Sword from \"../weapons/Sword\";\r\nimport Spear from \"../weapons/Spear\";\r\nimport Hammer from \"../weapons/Hammer\";\r\nimport Dagger from \"../weapons/Dagger\";\r\nimport Kunai from \"../weapons/Kunai\";\r\nimport WeaponSaleItem from \"../shopItems/WeaponSaleItem\";\r\nimport FullHealItem from \"../shopItems/FullHealItem\";\r\nimport Caltrops from \"../weapons/Caltrops\";\r\n\r\nexport const allPrimaryWeapons = [\r\n    { cost: 50, generateItem: (assets: Assets) => new Sword(assets) },\r\n    { cost: 50, generateItem: (assets: Assets) => new Spear(assets) },\r\n    { cost: 50, generateItem: (assets: Assets) => new Hammer(assets) },\r\n]\r\n\r\nexport const allSecondaryWeapons = [\r\n    { cost: 10, generateItem: (assets: Assets) => new Dagger(assets) },\r\n    { cost: 20, generateItem: (assets: Assets) => new Kunai(assets) },\r\n    { cost: 20, generateItem: (assets: Assets) => new Caltrops(assets) },\r\n]\r\n\r\nexport default class StandardMapGen implements IMapGen {\r\n    generateMap(assets: Assets, floor: number, state: GameState): void {\r\n        state.tiles = new HexArray<HexCell>(C.MAP_SIZE, new Floor(assets));\r\n        state.features = new HexArray<IFeature>(C.MAP_SIZE, undefined);\r\n        \r\n        state.enemies = [];\r\n\r\n        let leftLavaY = Math.floor(Math.random() * (C.MAP_SIZE - 2)) * (Math.random() >= 0.5 ? 1 : -1);\r\n        let leftLavaX = state.tiles.getMinX(leftLavaY);\r\n\r\n        this.genLava(assets, state, new Point(leftLavaX, leftLavaY), Math.floor(Math.random() * 12) + 4);\r\n\r\n        let rightLavaY = Math.floor(Math.random() * (C.MAP_SIZE - 2)) * (Math.random() >= 0.5 ? 1 : -1);\r\n        let rightLavaX = state.tiles.getXRange(rightLavaY)[1]-1;\r\n\r\n        this.genLava(assets, state, new Point(rightLavaX, rightLavaY), Math.floor(Math.random() * 12) + 4);\r\n\r\n        const downStairY = -C.MAP_SIZE + 1 + Math.floor(Math.random() * 3);\r\n        const [xMin, xMax] = state.tiles.getXRange(downStairY);\r\n        const downStairX = Math.floor(Math.random() * (xMax - xMin)) + xMin;\r\n        state.features.set(new Stairs(), downStairX, downStairY);\r\n\r\n        const gemPositions = state.getCells((_, tile, feat) => tile.typeId === Floor.TypeID && feat === undefined);\r\n        const gemPos = gemPositions[Math.floor(Math.random() * gemPositions.length)];\r\n        state.features.set(new LifeGem(), gemPos.x, gemPos.y);\r\n\r\n        if(floor % 3 === 0 || floor === 11) {\r\n            const shrinePositions = state.getCells((_, tile, feat) => tile.typeId === Floor.TypeID && feat === undefined);\r\n            const shrinePosition = shrinePositions[Math.floor(Math.random() * shrinePositions.length)];\r\n            state.features.set(new Shrine(), shrinePosition.x, shrinePosition.y);\r\n        }\r\n        \r\n        if(floor % 4 === 0 || floor === 11) {\r\n            const shopPositions = state.getCells((_, tile, feat) => tile.typeId === Floor.TypeID && feat === undefined);\r\n            const shopPosition = shopPositions[Math.floor(Math.random() * shopPositions.length)];\r\n            const primary = allPrimaryWeapons[Math.floor(Math.random() * allPrimaryWeapons.length)];\r\n            const secondary = allSecondaryWeapons[Math.floor(Math.random() * allSecondaryWeapons.length)];\r\n            const shopItems: ISaleItem[] = [\r\n                new WeaponSaleItem(primary.generateItem(assets), primary.cost),\r\n                new WeaponSaleItem(secondary.generateItem(assets), secondary.cost),\r\n                new FullHealItem(100, assets)\r\n            ];\r\n            state.features.set(new Shop(shopItems), shopPosition.x, shopPosition.y);\r\n        }\r\n\r\n        // Replaces lava with floor to ensure there's a path from the start to the end.\r\n        AssurePathToEnd(state, assets, 1);\r\n\r\n        let validEnemySpawns: Point[] = [];\r\n        for(let y = -C.MAP_SIZE + 1; y <= 1; y++) {\r\n            const [xMin, xMax] = state.tiles.getXRange(y);\r\n            for(let x = xMin; x < xMax; x++) {\r\n                if(state.tiles.get(x, y).typeId === Floor.TypeID) {\r\n                    validEnemySpawns.push(new Point(x, y));\r\n                }\r\n            }\r\n        }\r\n\r\n        for(let i = 0; i < Math.min(12, floor); i++) {\r\n            let spawnId = Math.floor(Math.random() * validEnemySpawns.length);\r\n            const [pos] = validEnemySpawns.splice(spawnId, 1);\r\n            const entity = (Math.random() < 0.85) ? new Zombie(pos) : new Spider(pos);\r\n            state.enemies.push(entity);\r\n        }\r\n\r\n        for(let i = 0; i < Math.min(6, (floor - 3) / 3); i++) {\r\n            let spawnId = Math.floor(Math.random() * validEnemySpawns.length);\r\n            const [pos] = validEnemySpawns.splice(spawnId, 1);\r\n            const archer = new Archer(pos);\r\n            state.enemies.push(archer);\r\n        }\r\n        \r\n        for(let i = 0; i < Math.min(3, (floor - 5) / 3); i++) {\r\n            let spawnId = Math.floor(Math.random() * validEnemySpawns.length);\r\n            const [pos] = validEnemySpawns.splice(spawnId, 1);\r\n            const enemy = (Math.random() < 0.2) ? new StoneEye(pos) : new Mage(pos);\r\n            state.enemies.push(enemy);\r\n        }\r\n        \r\n        // Don't spawn enemies where they can't get to you: Forge a path. (unless they're flying)\r\n        for(const enemy of state.enemies) {\r\n            if(enemy.isFlying) continue;\r\n            AssurePathTo(state, assets, _ => true, (pt)=>pt.equals(enemy.position), 0.3);\r\n        }\r\n\r\n        let floorPositions: Point[] = [];\r\n        state.tiles.iterate((x, y, c) => {\r\n            if(c.typeId === Floor.TypeID && state.features.get(x, y) === undefined) {\r\n                floorPositions.push(new Point(x, y));\r\n            }\r\n        });\r\n\r\n        for(let i = 0; i < 3 + Math.min(3, (floor - 4) / 4); i++) {\r\n            let replaceFloor = floorPositions.splice(Math.floor(Math.random() * floorPositions.length), 1)[0];\r\n            state.tiles.set(new Trap(assets, [1,3,5][Math.floor(Math.random() * 3)] as TrapDamage), replaceFloor.x, replaceFloor.y);\r\n        }\r\n\r\n    }\r\n\r\n    genLava(assets: Assets, state: GameState, pt: Point, len: number) {\r\n        state.tiles.set(new Lava(assets), pt);\r\n        if(len <= 1) return;\r\n\r\n        const validRiverDirections = AllDirections.filter(dir => {\r\n            // Check if this is a valid continuation for the lava river\r\n            const dest = Point.add(pt, DirectionHelper.ToPoint(dir));\r\n            if(!state.tiles.isInBounds(dest.x, dest.y) || state.tiles.get(dest).typeId !== Floor.TypeID || dest.equals(C.PLAYER_START_POSITION)) \r\n                return false;\r\n            return true;\r\n        });\r\n\r\n        if(validRiverDirections.length === 0) return;\r\n        const dir = validRiverDirections[Math.floor(Math.random() * validRiverDirections.length)];\r\n        this.genLava(assets, state, Point.add(pt, DirectionHelper.ToPoint(dir)), len - 1);\r\n    }\r\n}","import GameState from \"../GameState\";\r\nimport IMapGen from \"./IMapGen\";\r\nimport * as C from \"../Constants\";\r\nimport HexCell from \"../tiles/HexCell\";\r\nimport Floor from \"../tiles/Floor\";\r\nimport HexArray from \"../HexArray\";\r\nimport Assets from \"../Assets\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Zombie from \"../entities/Zombie\";\r\nimport Archer from \"../entities/Archer\";\r\nimport Mage from \"../entities/Mage\";\r\nimport Lava from \"../tiles/Lava\";\r\nimport { AllDirections, DirectionHelper } from \"../Direction\";\r\nimport { AssurePathTo, AssurePathToEnd } from \"./MapGenCommon\";\r\nimport StoneEye from \"../entities/StoneEye\";\r\nimport Trap, { TrapDamage } from \"../tiles/Trap\";\r\nimport IFeature from \"../features/IFeature\";\r\nimport Stairs from \"../features/Stairs\";\r\nimport LifeGem from \"../features/LifeGem\";\r\nimport Shrine from \"../features/Shrine\";\r\nimport Spider from \"../entities/Spider\";\r\nimport Shop from \"../features/Shop\";\r\nimport ISaleItem from \"../shopItems/ISaleItem\";\r\nimport Sword from \"../weapons/Sword\";\r\nimport Spear from \"../weapons/Spear\";\r\nimport Hammer from \"../weapons/Hammer\";\r\nimport Dagger from \"../weapons/Dagger\";\r\nimport Kunai from \"../weapons/Kunai\";\r\nimport WeaponSaleItem from \"../shopItems/WeaponSaleItem\";\r\nimport FullHealItem from \"../shopItems/FullHealItem\";\r\n\r\nconst allPrimaryWeapons = [\r\n    { cost: 50, generateItem: (assets: Assets) => new Sword(assets) },\r\n    { cost: 50, generateItem: (assets: Assets) => new Spear(assets) },\r\n    { cost: 50, generateItem: (assets: Assets) => new Hammer(assets) },\r\n]\r\n\r\nconst allSecondaryWeapons = [\r\n    { cost: 10, generateItem: (assets: Assets) => new Dagger(assets) },\r\n    { cost: 20, generateItem: (assets: Assets) => new Kunai(assets) },\r\n]\r\n\r\nexport default class DepthsMapGen implements IMapGen {\r\n    generateMap(assets: Assets, floor: number, state: GameState): void {\r\n        state.tiles = new HexArray<HexCell>(C.MAP_SIZE, new Floor(assets));\r\n        state.features = new HexArray<IFeature>(C.MAP_SIZE, undefined);\r\n        state.regionId = 1;\r\n        \r\n        state.enemies = [];\r\n\r\n        let leftLavaY = Math.floor(Math.random() * (C.MAP_SIZE - 2)) * (Math.random() >= 0.5 ? 1 : -1);\r\n        let leftLavaX = state.tiles.getMinX(leftLavaY);\r\n\r\n        this.genLava(assets, state, new Point(leftLavaX, leftLavaY), Math.floor(Math.random() * 12) + 4);\r\n\r\n        let rightLavaY = Math.floor(Math.random() * (C.MAP_SIZE - 2)) * (Math.random() >= 0.5 ? 1 : -1);\r\n        let rightLavaX = state.tiles.getXRange(rightLavaY)[1]-1;\r\n\r\n        this.genLava(assets, state, new Point(rightLavaX, rightLavaY), Math.floor(Math.random() * 12) + 4);\r\n\r\n        const downStairY = -C.MAP_SIZE + 1 + Math.floor(Math.random() * 3);\r\n        const [xMin, xMax] = state.tiles.getXRange(downStairY);\r\n        const downStairX = Math.floor(Math.random() * (xMax - xMin)) + xMin;\r\n        state.features.set(new Stairs(), downStairX, downStairY);\r\n\r\n        if(floor % 3 === 0 || floor === 11) {\r\n            const shrinePositions = state.getCells((_, tile, feat) => tile.typeId === Floor.TypeID && feat === undefined);\r\n            const shrinePosition = shrinePositions[Math.floor(Math.random() * shrinePositions.length)];\r\n            state.features.set(new Shrine(), shrinePosition.x, shrinePosition.y);\r\n        }\r\n        \r\n        if(floor % 4 === 0 || floor === 11) {\r\n            const shopPositions = state.getCells((_, tile, feat) => tile.typeId === Floor.TypeID && feat === undefined);\r\n            const shopPosition = shopPositions[Math.floor(Math.random() * shopPositions.length)];\r\n            const primary = allPrimaryWeapons[Math.floor(Math.random() * allPrimaryWeapons.length)];\r\n            const secondary = allSecondaryWeapons[Math.floor(Math.random() * allSecondaryWeapons.length)];\r\n            const shopItems: ISaleItem[] = [\r\n                new WeaponSaleItem(primary.generateItem(assets), primary.cost),\r\n                new WeaponSaleItem(secondary.generateItem(assets), secondary.cost),\r\n                new FullHealItem(100, assets)\r\n            ];\r\n            state.features.set(new Shop(shopItems), shopPosition.x, shopPosition.y);\r\n        }\r\n\r\n        // Replaces lava with floor to ensure there's a path from the start to the end.\r\n        AssurePathToEnd(state, assets, 1);\r\n\r\n        let validEnemySpawns: Point[] = [];\r\n        for(let y = -C.MAP_SIZE + 1; y <= 1; y++) {\r\n            const [xMin, xMax] = state.tiles.getXRange(y);\r\n            for(let x = xMin; x < xMax; x++) {\r\n                if(state.tiles.get(x, y).typeId === Floor.TypeID) {\r\n                    validEnemySpawns.push(new Point(x, y));\r\n                }\r\n            }\r\n        }\r\n\r\n        for(let i = 0; i < Math.min(8, floor); i++) {\r\n            let spawnId = Math.floor(Math.random() * validEnemySpawns.length);\r\n            const [pos] = validEnemySpawns.splice(spawnId, 1);\r\n            const entity = (Math.random() < 0.85) ? new Zombie(pos) : new Spider(pos);\r\n            state.enemies.push(entity);\r\n        }\r\n        \r\n        \r\n        // Don't spawn enemies where they can't get to you: Forge a path. (unless they're flying)\r\n        for(const enemy of state.enemies) {\r\n            if(enemy.isFlying) continue;\r\n            AssurePathTo(state, assets, _ => true, (pt)=>pt.equals(enemy.position), 0.3);\r\n        }\r\n\r\n        let floorPositions: Point[] = [];\r\n        state.tiles.iterate((x, y, c) => {\r\n            if(c.typeId === Floor.TypeID && state.features.get(x, y) === undefined) {\r\n                floorPositions.push(new Point(x, y));\r\n            }\r\n        });\r\n\r\n        for(let i = 0; i < 3 + Math.min(3, (floor - 4) / 4); i++) {\r\n            let replaceFloor = floorPositions.splice(Math.floor(Math.random() * floorPositions.length), 1)[0];\r\n            state.tiles.set(new Trap(assets, [1,3,5][Math.floor(Math.random() * 3)] as TrapDamage), replaceFloor.x, replaceFloor.y);\r\n        }\r\n\r\n    }\r\n\r\n    genLava(assets: Assets, state: GameState, pt: Point, len: number) {\r\n        state.tiles.set(new Lava(assets), pt);\r\n        if(len <= 1) return;\r\n\r\n        const validRiverDirections = AllDirections.filter(dir => {\r\n            // Check if this is a valid continuation for the lava river\r\n            const dest = Point.add(pt, DirectionHelper.ToPoint(dir));\r\n            if(!state.tiles.isInBounds(dest.x, dest.y) || state.tiles.get(dest).typeId !== Floor.TypeID || dest.equals(C.PLAYER_START_POSITION)) \r\n                return false;\r\n            return true;\r\n        });\r\n\r\n        if(validRiverDirections.length === 0) return;\r\n        const dir = validRiverDirections[Math.floor(Math.random() * validRiverDirections.length)];\r\n        this.genLava(assets, state, Point.add(pt, DirectionHelper.ToPoint(dir)), len - 1);\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../assets\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"../phases/IGamePhase\";\r\nimport IFeature, { SimpleFeature } from \"./IFeature\";\r\nimport * as C from '../Constants';\r\nimport FloorTransitionPhase from \"../phases/FloorTransitionPhase\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport { HexToPixel } from \"../Hex\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\n\r\nexport default class Portal implements IFeature {\r\n    static closedSprite: Sprite;\r\n    static openSprites: Sprite[];\r\n    static openAnimation: IRenderable;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Portal.closedSprite = assets.getAsset('portal_closed') as Sprite;\r\n        Portal.openSprites = [];\r\n        let sprite: IRenderableSource;\r\n        for(let i = 0; (sprite = assets.getAsset('portal_open_' + i, true)) !== undefined; i++) {\r\n            this.openSprites.push(sprite as Sprite);\r\n        }\r\n\r\n        Portal.openAnimation = assets.getAsset('portal_open_anim').getRenderable();\r\n    }\r\n    \r\n    isOpen: boolean;\r\n    name: string;\r\n\r\n    constructor() { \r\n        this.isOpen = false;\r\n        this.name = 'Portal';\r\n    }\r\n\r\n    afterEnemyTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        return undefined;\r\n    }\r\n    \r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        if(state.enemies.length === 0 && !this.isOpen) {\r\n            this.isOpen = true;\r\n        }\r\n\r\n        if(x === state.player.position.x && y === state.player.position.y && this.isOpen) {\r\n            // TODO: GAME OVER\r\n            return () => new FloorTransitionPhase();\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    \r\n    draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void {\r\n        const tgt = HexToPixel(pt);\r\n        const dest = new Rect(tgt.x, tgt.y, C.TILE_WIDTH, C.TILE_HEIGHT);\r\n        if(this.isOpen){\r\n            Portal.openAnimation.tick();\r\n            Portal.openAnimation.draw(ctx, dest, 0);\r\n        }\r\n        else{\r\n            Portal.closedSprite.draw(ctx, dest, 0);\r\n        }\r\n    }\r\n}","export default class MathHelpers {\r\n    static wrap(value: number, modulo: number) {\r\n        value = value % modulo;\r\n        if(value < 0) value += modulo;\r\n        return value;\r\n    }\r\n}","import GameState from \"../GameState\";\r\nimport IMapGen from \"./IMapGen\";\r\nimport * as C from \"../Constants\";\r\nimport HexCell from \"../tiles/HexCell\";\r\nimport Floor from \"../tiles/Floor\";\r\nimport HexArray from \"../HexArray\";\r\nimport Assets from \"../Assets\";\r\nimport { GetRing } from \"../Hex\";\r\nimport Lava from \"../tiles/Lava\";\r\nimport Point from \"../../common/position/Point\";\r\nimport IFeature from \"../features/IFeature\";\r\nimport Stairs from \"../features/Stairs\";\r\nimport BlueMage from \"../entities/BlueMage\";\r\n\r\nconst playerMoveTileArts = [\r\n    new Point(6,2),\r\n    new Point(7,2),\r\n    new Point(9,2),\r\n    new Point(7,3),\r\n    new Point(6,3),\r\n    new Point(8,2),\r\n];\r\n\r\nexport default class FloorZeroGen implements IMapGen {\r\n    generateMap(assets: Assets, floor: number, state: GameState): void {\r\n        state.tiles = new HexArray<HexCell>(C.MAP_SIZE, new Floor(assets));\r\n        state.features = new HexArray<IFeature>(C.MAP_SIZE, undefined);\r\n        \r\n        const ring = GetRing(2);\r\n        for(var i = 0; i < ring.length; i++) {\r\n            state.tiles.set(new Lava(assets), ring[i]);\r\n        }\r\n\r\n        const ring2 = GetRing(3);\r\n        for(var i = 0; i < ring2.length; i += 3) {\r\n            state.tiles.set(new Lava(assets), ring2[i]);\r\n        }\r\n\r\n        const playerRing = GetRing(1).map(p => Point.add(p, C.PLAYER_START_POSITION));\r\n        for(let i = 0; i < playerRing.length; i++) {\r\n            state.tiles.set(\r\n                new Floor(assets, playerMoveTileArts[i]),\r\n                playerRing[i]\r\n            )\r\n        }\r\n        \r\n        state.features.set(new Stairs(), 2, -4);\r\n    }\r\n}","import Assets from \"../Assets\";\r\nimport GameState from \"../GameState\";\r\nimport Depths1MapGen from \"./Depths1MapGen\";\r\nimport DepthsMapGen from \"./DepthsMapGen\";\r\nimport Floor12Gen from \"./Floor12Gen\";\r\nimport FloorZeroGen from \"./FloorZeroGen\";\r\nimport StandardMapGen from \"./StandardMapGen\";\r\n\r\nexport default interface IMapGen {\r\n    generateMap(assets: Assets, floor: number, state: GameState): void;\r\n}\r\n\r\nexport const MapGenerators: {range: [number, number], gen: IMapGen}[] = [\r\n    {range: [0,1], gen: new FloorZeroGen()},\r\n    {range: [1,12], gen: new StandardMapGen()},\r\n    {range: [12,13], gen: new Floor12Gen()},\r\n    {range: [13,14], gen: new Depths1MapGen()},\r\n    {range: [14,-1], gen: new DepthsMapGen()}\r\n]","import GameState from \"../GameState\";\r\nimport IMapGen from \"./IMapGen\";\r\nimport * as C from \"../Constants\";\r\nimport HexCell from \"../tiles/HexCell\";\r\nimport Floor from \"../tiles/Floor\";\r\nimport HexArray from \"../HexArray\";\r\nimport Assets from \"../Assets\";\r\nimport { GetRing } from \"../Hex\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Giant from \"../entities/Giant\";\r\nimport Archer from \"../entities/Archer\";\r\nimport StoneEye from \"../entities/StoneEye\";\r\nimport Lava from \"../tiles/Lava\";\r\nimport IFeature from \"../features/IFeature\";\r\nimport Stairs, { LockedStairs } from \"../features/Stairs\";\r\nimport { RunicLifeGem } from \"../features/LifeGem\";\r\nimport Portal from \"../features/Portal\";\r\nimport MathHelpers from \"../../common/MathHelpers\";\r\n\r\nexport default class Floor12Gen implements IMapGen {\r\n    generateMap(assets: Assets, floor: number, state: GameState): void {\r\n        state.tiles = new HexArray<HexCell>(C.MAP_SIZE, new Floor(assets));\r\n        state.features = new HexArray<IFeature>(C.MAP_SIZE, undefined);\r\n        state.features.set(new LockedStairs(), 0, 0);\r\n\r\n        const ring = GetRing(4);\r\n        for (let i = 0; i < ring.length/2-1; i++) {\r\n            const floor = i + 1;\r\n\r\n            const ringIndex = MathHelpers.wrap((i-4) * 2, ring.length);\r\n\r\n            state.features.set(new RunicLifeGem(state.brokenGems[floor] === undefined ? false : state.brokenGems[floor], floor), ring[ringIndex].x, ring[ringIndex].y);\r\n        }\r\n\r\n        state.features.set(new Portal(), -2, 4);\r\n\r\n        state.tiles.set(new Lava(assets), new Point(5, -1));\r\n        state.tiles.set(new Lava(assets), new Point(5, 0));\r\n        state.tiles.set(new Lava(assets), new Point(4, 1));\r\n        state.tiles.set(new Lava(assets), new Point(-4, -1));\r\n        state.tiles.set(new Lava(assets), new Point(-5, 0));\r\n        state.tiles.set(new Lava(assets), new Point(-5, 1));\r\n\r\n        state.enemies.push(new Giant(new Point(0, 0)));\r\n        state.enemies.push(new StoneEye(new Point(0, -2)));\r\n        state.enemies.push(new StoneEye(new Point(2, -2)));\r\n        state.enemies.push(new StoneEye(new Point(2, 0)));\r\n        state.enemies.push(new StoneEye(new Point(-2, 0)));\r\n    }\r\n}","import GameState from \"../GameState\";\r\nimport IMapGen from \"./IMapGen\";\r\nimport * as C from \"../Constants\";\r\nimport HexCell from \"../tiles/HexCell\";\r\nimport Floor from \"../tiles/Floor\";\r\nimport HexArray from \"../HexArray\";\r\nimport Assets from \"../Assets\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Zombie from \"../entities/Zombie\";\r\nimport Archer from \"../entities/Archer\";\r\nimport Mage from \"../entities/Mage\";\r\nimport Lava from \"../tiles/Lava\";\r\nimport { AllDirections, DirectionHelper } from \"../Direction\";\r\nimport { AssurePathTo, AssurePathToEnd } from \"./MapGenCommon\";\r\nimport StoneEye from \"../entities/StoneEye\";\r\nimport Trap, { TrapDamage } from \"../tiles/Trap\";\r\nimport IFeature from \"../features/IFeature\";\r\nimport Stairs from \"../features/Stairs\";\r\nimport LifeGem from \"../features/LifeGem\";\r\nimport Shrine from \"../features/Shrine\";\r\nimport Spider from \"../entities/Spider\";\r\nimport Shop from \"../features/Shop\";\r\nimport ISaleItem from \"../shopItems/ISaleItem\";\r\nimport Sword from \"../weapons/Sword\";\r\nimport Spear from \"../weapons/Spear\";\r\nimport Hammer from \"../weapons/Hammer\";\r\nimport Dagger from \"../weapons/Dagger\";\r\nimport Kunai from \"../weapons/Kunai\";\r\nimport WeaponSaleItem from \"../shopItems/WeaponSaleItem\";\r\nimport FullHealItem from \"../shopItems/FullHealItem\";\r\nimport BlueMage from \"../entities/BlueMage\";\r\nimport { allPrimaryWeapons, allSecondaryWeapons } from \"./StandardMapGen\";\r\n\r\nexport default class Depths1MapGen implements IMapGen {\r\n    generateMap(assets: Assets, floor: number, state: GameState): void {\r\n        state.tiles = new HexArray<HexCell>(C.MAP_SIZE, new Floor(assets));\r\n        state.features = new HexArray<IFeature>(C.MAP_SIZE, undefined);\r\n        state.regionId = 1;\r\n        \r\n        state.enemies = [];\r\n\r\n        let leftLavaY = Math.floor(Math.random() * (C.MAP_SIZE - 2)) * (Math.random() >= 0.5 ? 1 : -1);\r\n        let leftLavaX = state.tiles.getMinX(leftLavaY);\r\n\r\n        this.genLava(assets, state, new Point(leftLavaX, leftLavaY), Math.floor(Math.random() * 12) + 4);\r\n\r\n        let rightLavaY = Math.floor(Math.random() * (C.MAP_SIZE - 2)) * (Math.random() >= 0.5 ? 1 : -1);\r\n        let rightLavaX = state.tiles.getXRange(rightLavaY)[1]-1;\r\n\r\n        this.genLava(assets, state, new Point(rightLavaX, rightLavaY), Math.floor(Math.random() * 12) + 4);\r\n\r\n        const downStairY = -C.MAP_SIZE + 1 + Math.floor(Math.random() * 3);\r\n        const [xMin, xMax] = state.tiles.getXRange(downStairY);\r\n        const downStairX = Math.floor(Math.random() * (xMax - xMin)) + xMin;\r\n        state.features.set(new Stairs(), downStairX, downStairY);\r\n\r\n        const shrinePositions = state.getCells((_, tile, feat) => tile.typeId === Floor.TypeID && feat === undefined);\r\n        const shrinePosition = shrinePositions[Math.floor(Math.random() * shrinePositions.length)];\r\n        state.features.set(new Shrine(), shrinePosition.x, shrinePosition.y);\r\n        \r\n        const shopPositions = state.getCells((_, tile, feat) => tile.typeId === Floor.TypeID && feat === undefined);\r\n        const shopPosition = shopPositions[Math.floor(Math.random() * shopPositions.length)];\r\n        const shopItems: ISaleItem[] = [\r\n            ...allPrimaryWeapons.map(primary => new WeaponSaleItem(primary.generateItem(assets), primary.cost)),\r\n            ...allSecondaryWeapons.map(secondary => new WeaponSaleItem(secondary.generateItem(assets), secondary.cost)),\r\n            new FullHealItem(100, assets)\r\n        ];\r\n        state.features.set(new Shop(shopItems), shopPosition.x, shopPosition.y);\r\n\r\n        // Replaces lava with floor to ensure there's a path from the start to the end.\r\n        AssurePathToEnd(state, assets, 1);\r\n\r\n        let validEnemySpawns: Point[] = [];\r\n        for(let y = -C.MAP_SIZE + 1; y <= 1; y++) {\r\n            const [xMin, xMax] = state.tiles.getXRange(y);\r\n            for(let x = xMin; x < xMax; x++) {\r\n                if(state.tiles.get(x, y).typeId === Floor.TypeID) {\r\n                    validEnemySpawns.push(new Point(x, y));\r\n                }\r\n            }\r\n        }\r\n\r\n        for(let i = 0; i < 3; i++) {\r\n            let spawnId = Math.floor(Math.random() * validEnemySpawns.length);\r\n            const [pos] = validEnemySpawns.splice(spawnId, 1);\r\n            const entity = new BlueMage(pos);\r\n            state.enemies.push(entity);\r\n        }\r\n        \r\n        \r\n        // Don't spawn enemies where they can't get to you: Forge a path. (unless they're flying)\r\n        for(const enemy of state.enemies) {\r\n            if(enemy.isFlying) continue;\r\n            AssurePathTo(state, assets, _ => true, (pt)=>pt.equals(enemy.position), 0.3);\r\n        }\r\n\r\n        let floorPositions: Point[] = [];\r\n        state.tiles.iterate((x, y, c) => {\r\n            if(c.typeId === Floor.TypeID && state.features.get(x, y) === undefined) {\r\n                floorPositions.push(new Point(x, y));\r\n            }\r\n        });\r\n    }\r\n\r\n    genLava(assets: Assets, state: GameState, pt: Point, len: number) {\r\n        state.tiles.set(new Lava(assets), pt);\r\n        if(len <= 1) return;\r\n\r\n        const validRiverDirections = AllDirections.filter(dir => {\r\n            // Check if this is a valid continuation for the lava river\r\n            const dest = Point.add(pt, DirectionHelper.ToPoint(dir));\r\n            if(!state.tiles.isInBounds(dest.x, dest.y) || state.tiles.get(dest).typeId !== Floor.TypeID || dest.equals(C.PLAYER_START_POSITION)) \r\n                return false;\r\n            return true;\r\n        });\r\n\r\n        if(validRiverDirections.length === 0) return;\r\n        const dir = validRiverDirections[Math.floor(Math.random() * validRiverDirections.length)];\r\n        this.genLava(assets, state, Point.add(pt, DirectionHelper.ToPoint(dir)), len - 1);\r\n    }\r\n}","import KeyboardManager from \"../../common/input/KeyboardManager\";\r\nimport IAnimation from \"../animation/IAnimation\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"./IGamePhase\";\r\n\r\nexport default class AnimationPhase implements IGamePhase {\r\n\r\n    constructor(private animations: IAnimation[], private onFinish: (gs: GameState) => IGamePhase) {\r\n    }\r\n\r\n    init(state: GameState): void {\r\n        \r\n    }\r\n\r\n    tick(state: GameState, keys: KeyboardManager): IGamePhase {\r\n        for(let i = this.animations.length - 1; i >= 0; i--) {\r\n            if(this.animations[i].tick()) {\r\n                this.animations.splice(i, 1);\r\n            }\r\n        }\r\n        if(this.animations.length === 0) {\r\n            return this.onFinish(state);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, state: GameState): void {\r\n        state.draw(ctx);\r\n        for(const animation of this.animations) { \r\n            animation.draw(ctx);\r\n        }\r\n    }\r\n}","import AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport Entity from \"../Entity\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"./IGamePhase\";\r\n\r\nexport default function AttackResolutionPhase(state: GameState, attacks: IAttackInfo[], nextPhase: (state: GameState) => IGamePhase) : IGamePhase {\r\n    for(const attack of attacks) {\r\n        const damageGroups = attack.getAffectedTiles(state);\r\n        for(const damageGroup of damageGroups) {\r\n            for(const pt of damageGroup.positions) {\r\n                const entity = state.entityAt(pt);\r\n                if(entity === undefined || (Entity.IsPlayer(entity) && damageGroup.ignorePlayer) || (!Entity.IsPlayer(entity) && damageGroup.ignoreEnemies)) continue;\r\n                entity.hp -= damageGroup.damage;\r\n            }\r\n        }\r\n    }\r\n    for(const attack of attacks) {\r\n        attack.applyExtraEffects(state);\r\n    }\r\n\r\n    let goldValues = state.enemies.filter(e => e.hp <= 0).map(e => e.goldValue);\r\n    if(goldValues.length > 0) {\r\n        state.gold += goldValues.reduce((a, b) => a + b, 0) * goldValues.length;\r\n    }\r\n\r\n    state.enemies = state.enemies.filter(e => e.hp > 0);\r\n    if(state.player.hp <= 0) {\r\n        // TODO: GAME OVER\r\n    }\r\n    return nextPhase(state);\r\n}","import IAnimation from \"../animation/IAnimation\";\r\nimport SequentialAnimation from \"../animation/SequentialAnimation\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport GameState from \"../GameState\";\r\nimport AnimationPhase from \"./AnimationPhase\";\r\nimport AttackResolutionPhase from \"./AttackResolutionPhase\";\r\nimport IGamePhase from \"./IGamePhase\";\r\n\r\nexport default class PhaseBuilder {\r\n    public static New() {\r\n        return new PhaseBuilder();\r\n    }\r\n\r\n    private chain: ((gs: GameState, next:(gs: GameState)=>IGamePhase) => IGamePhase)[];\r\n\r\n    constructor(){\r\n        this.chain = [];\r\n    }\r\n\r\n    public thenAnimate(animations: IAnimation[]): PhaseBuilder {\r\n        this.chain.push((_, next) => \r\n            new AnimationPhase(animations, next)\r\n        );\r\n        return this;\r\n    }\r\n\r\n    public thenResolve(attacks: IAttackInfo[]): PhaseBuilder {\r\n        this.chain.push((gs, next) =>\r\n            AttackResolutionPhase(gs, attacks, next)\r\n        );\r\n        return this;\r\n    }\r\n\r\n    public thenAnimateAndResolve(attacks: IAttackInfo[]) {\r\n        this.chain.push((gs, next) => {\r\n            const animations = attacks.map(atk => new SequentialAnimation(atk.toAnimations(gs)));\r\n            return new AnimationPhase(animations, () => AttackResolutionPhase(gs, attacks, next));\r\n        })\r\n        return this;\r\n    }\r\n\r\n    public then(next: ((gs: GameState, next:(gs: GameState)=>IGamePhase) => IGamePhase)) {\r\n        this.chain.push(next);\r\n        return this;\r\n    }\r\n\r\n    public finally(lastStep: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        return this.chain.reduceRight((nextfn:((gs:GameState)=>IGamePhase), current) => (gs => current(gs, nextfn)), lastStep);\r\n    }\r\n}","import SequentialAnimation from \"../animation/SequentialAnimation\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport GameState from \"../GameState\";\r\nimport AnimationPhase from \"./AnimationPhase\";\r\nimport AttackResolutionPhase from \"./AttackResolutionPhase\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport PhaseBuilder from \"./PhaseBuilder\";\r\n\r\nexport default function AfterMovePhase(state: GameState, isPlayerTurn: boolean, next: (state: GameState) => IGamePhase): IGamePhase {\r\n    let allAttacks: IAttackInfo[] = []\r\n    if(isPlayerTurn) {\r\n        state.tiles.iterate((x, y, c) => {\r\n            const attacks = c.AfterPlayerTurn(state, x, y);\r\n            if(attacks !== undefined && attacks.length > 0) {\r\n                allAttacks.push(...attacks);\r\n            }\r\n        });\r\n    }\r\n    else {\r\n        state.tiles.iterate((x, y, c) => {\r\n            const attacks = c.AfterEnemyTurn(state, x, y);\r\n            if(attacks !== undefined && attacks.length > 0) {\r\n                allAttacks.push(...attacks);\r\n            }\r\n        });\r\n    }\r\n\r\n    \r\n    var phaseBuilder = PhaseBuilder.New();\r\n    if(allAttacks.length > 0) {\r\n        phaseBuilder = phaseBuilder.thenAnimateAndResolve(allAttacks);\r\n    }\r\n\r\n    return phaseBuilder.finally(gs => AfterMovePhase_Features(gs, isPlayerTurn, next))(state);\r\n}\r\n\r\n\r\nfunction AfterMovePhase_Features(state: GameState, isPlayerTurn: boolean, next: (state: GameState) => IGamePhase): IGamePhase {\r\n    if(isPlayerTurn) {\r\n        state.features.iterate((x, y, c) => {\r\n            const newNext = c?.afterPlayerTurn(state, x, y, next);\r\n            if(newNext !== undefined) next = newNext;\r\n        });\r\n    }\r\n    else {\r\n        state.features.iterate((x, y, c) => {\r\n            const newNext = c?.afterEnemyTurn(state, x, y, next);\r\n            if(newNext !== undefined) next = newNext;\r\n        });\r\n    }\r\n\r\n    return next(state);\r\n}","import KeyboardManager from \"../../common/input/KeyboardManager\";\r\nimport { Interpolated } from \"../../common/interpolation/Interpolated\";\r\nimport Point from \"../../common/position/Point\";\r\nimport EntityMoveAnimation from \"../animation/EntityMoveAnimation\";\r\nimport ParallelAnimation from \"../animation/ParallelAnimation\";\r\nimport SequentialAnimation from \"../animation/SequentialAnimation\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport { Direction, DirectionHelper } from \"../Direction\";\r\nimport GameState from \"../GameState\";\r\nimport { HexToPixel, PixelToHex } from \"../Hex\";\r\nimport HexCell from \"../tiles/HexCell\";\r\nimport AnimationPhase from \"./AnimationPhase\";\r\nimport AttackResolutionPhase from \"./AttackResolutionPhase\";\r\nimport EnemyAttackPhase from \"./EnemyAttackPhase\";\r\nimport FloorTransitionPhase from \"./FloorTransitionPhase\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport PlayerTurnGamePhase from \"./PlayerTurnGamePhase\";\r\nimport AfterMovePhase from \"./AfterMovePhase\";\r\n\r\n\r\nexport default function PlayerMoveAnimPhase(state: GameState, from: Point, to: Point, forceMotion: Point):IGamePhase {\r\n    const onFinish = (gs: GameState) => {\r\n        if(!forceMotion.equals(from)) {\r\n            gs.tiles.get(forceMotion).OnEntityStep(gs.player);\r\n        }\r\n\r\n        if(gs.enemies.length === 0) {\r\n            return AfterMovePhase(gs, true, (gs) => AfterMovePhase(gs, false, () => new PlayerTurnGamePhase()));\r\n        }\r\n        \r\n        else return AfterMovePhase(gs, true, (gs) => EnemyAttackPhase(gs));\r\n    }\r\n\r\n    const postMoveAttacks: (gs:GameState)=>IGamePhase = (gs: GameState) => {\r\n        const attacks = [\r\n            ...state.player.primary.getAfterMoveAttacks(state, state.player, from, to),\r\n            ...state.player.secondary.getAfterMoveAttacks(state, state.player, from, to)\r\n        ];\r\n        if(attacks.length === 0) return onFinish(gs);\r\n        const animation = new SequentialAnimation(attacks.map(attack => new ParallelAnimation(attack.toAnimations())));\r\n        return new AnimationPhase([animation], state => AttackResolutionPhase(state, attacks, onFinish));\r\n    };\r\n\r\n    const playerMove = (state: GameState) => {\r\n        if(!state.isValidMove(forceMotion, false)) {\r\n            return postMoveAttacks(state);\r\n        }\r\n        return new AnimationPhase(\r\n            [new EntityMoveAnimation(state.player, Interpolated.linear<Point>(Point.interpolate, from, forceMotion), forceMotion, state.enemies.length === 0 ? 2 : 10)],\r\n            postMoveAttacks\r\n        );\r\n    };\r\n\r\n    if(state.enemies.length === 0) {\r\n        return playerMove(state);\r\n    }\r\n    if(state.enemies.length > 0) {\r\n        const attacks = [\r\n            ...state.player.primary.getBeforeMoveAttacks(state, state.player, from, to),\r\n            ...state.player.secondary.getBeforeMoveAttacks(state, state.player, from, to)\r\n        ];\r\n        if(attacks.length === 0) return playerMove(state);\r\n        const animation = new SequentialAnimation(attacks.map(attack => new ParallelAnimation(attack.toAnimations())));\r\n        return new AnimationPhase([animation], state => AttackResolutionPhase(state, attacks, playerMove));\r\n    }\r\n} ","import KeyboardManager from \"../../common/input/KeyboardManager\";\r\nimport Point from \"../../common/position/Point\";\r\nimport ParallelAnimation from \"../animation/ParallelAnimation\";\r\nimport SequentialAnimation from \"../animation/SequentialAnimation\";\r\nimport AttackInfo from \"../attackInfos/AttackInfo\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport { Direction, DirectionHelper } from \"../Direction\";\r\nimport GameState from \"../GameState\";\r\nimport AnimationPhase from \"./AnimationPhase\";\r\nimport AttackResolutionPhase from \"./AttackResolutionPhase\";\r\nimport EnemyMovePhase from \"./EnemyMovePhase\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport PhaseBuilder from \"./PhaseBuilder\";\r\n\r\nexport default function EnemyAttackPhase(state: GameState):IGamePhase {\r\n    const enemyAttacks: IAttackInfo[][] = []\r\n    for(let i = 0; i < state.enemies.length; i++) {\r\n        state.enemies[i].lastAttacks = state.enemies[i].getAttacks(state);\r\n        enemyAttacks.push(state.enemies[i].lastAttacks);\r\n    }\r\n\r\n    var phaseBuilder = PhaseBuilder.New();\r\n\r\n    if(enemyAttacks.some(e => e.length > 0)) {\r\n        const animations = enemyAttacks.map(attackSet => new SequentialAnimation(attackSet.map(attack => new ParallelAnimation(attack.toAnimations(state)))));\r\n        phaseBuilder = phaseBuilder\r\n            .thenAnimate(animations)\r\n            .thenResolve(enemyAttacks.reduce((acc, c) => acc.concat(c), []));\r\n    }\r\n\r\n    return phaseBuilder.finally(gs => EnemyMovePhase(gs))(state);\r\n}","import { Interpolated } from \"../../common/interpolation/Interpolated\";\r\nimport Point from \"../../common/position/Point\";\r\nimport EntityMoveAnimation from \"../animation/EntityMoveAnimation\";\r\nimport IAnimation from \"../animation/IAnimation\";\r\nimport GameState from \"../GameState\";\r\nimport AfterMovePhase from \"./AfterMovePhase\";\r\nimport AnimationPhase from \"./AnimationPhase\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport PhaseBuilder from \"./PhaseBuilder\";\r\nimport PlayerTurnGamePhase from \"./PlayerTurnGamePhase\";\r\n\r\nconst duration = 20;\r\n\r\nexport default function EnemyMovePhase(state: GameState): IGamePhase {\r\n    const disallowed: Point[] = state.enemies.map(e => e.position);\r\n    const animations: IAnimation[] = [];\r\n    const stepped: boolean[] = [];\r\n    for(let i = 0; i < state.enemies.length; i++) { \r\n        const destination = state.enemies[i].getMove(state, state.enemies[i].lastAttacks, disallowed);\r\n        if(!destination.equals(state.enemies[i].position)) {\r\n            animations.push(new EntityMoveAnimation(state.enemies[i], Interpolated.linear<Point>(Point.interpolate, state.enemies[i].position, destination), destination, duration));\r\n            const rm = disallowed.findIndex(p => p.equals(state.enemies[i].position));\r\n            disallowed.splice(rm, 1, destination);\r\n            stepped.push(true);\r\n        }\r\n        else {\r\n            stepped.push(false);\r\n        }\r\n    }\r\n\r\n    return PhaseBuilder.New()\r\n        .thenAnimate(animations)\r\n        .finally(gs => AfterEnemyMovePhase(gs, stepped))\r\n        (state);\r\n}\r\n\r\nfunction AfterEnemyMovePhase(state: GameState, didMove: boolean[]): IGamePhase {\r\n    // Resolve who stepped where\r\n    for(let i = 0; i < didMove.length; i++){\r\n        if(didMove[i]){\r\n            const enemy = state.enemies[i];\r\n            const cell = state.tiles.get(enemy.position);\r\n            cell.OnEntityStep(enemy);\r\n        }\r\n    }\r\n\r\n    return AfterMovePhase(state, false, () => new PlayerTurnGamePhase());\r\n}","import KeyboardManager from \"../../common/input/KeyboardManager\";\r\nimport MouseManager from \"../../common/input/MouseManager\";\r\nimport Point from \"../../common/position/Point\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../Assets\";\r\nimport { Direction, DirectionHelper } from \"../Direction\";\r\nimport GameState from \"../GameState\";\r\nimport { HexLength, HexToPixel, PixelToHex } from \"../Hex\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport PlayerMoveAnimPhase from \"./PlayerMoveAnimPhase\";\r\nimport * as C from '../Constants';\r\nimport HopliteProgram from \"..\";\r\n\r\ntype Move = Direction | 6 | undefined;\r\n\r\nconst dirKeys = [\r\n    { key: 'a', dir: Direction.Left },\r\n    { key: '4', dir: Direction.Left },\r\n    \r\n    { key: 'q', dir: Direction.UpLeft },\r\n    { key: '7', dir: Direction.UpLeft },\r\n\r\n    { key: 'w', dir: Direction.UpRight },\r\n    { key: '9', dir: Direction.UpRight },\r\n\r\n    { key: 'd', dir: Direction.Right },\r\n    { key: '6', dir: Direction.Right },\r\n\r\n    { key: 'x', dir: Direction.DownRight },\r\n    { key: '3', dir: Direction.DownRight },\r\n\r\n    { key: 'z', dir: Direction.DownLeft },\r\n    { key: '1', dir: Direction.DownLeft },\r\n\r\n    { key: 's', dir: 6 },\r\n    { key: '5', dir: 6 },\r\n]\r\n\r\nexport default class PlayerTurnGamePhase implements IGamePhase {\r\n\r\n    static cellHighlightSprite: Sprite;\r\n    static onAssetsLoaded(assets: Assets): void {\r\n        this.cellHighlightSprite = assets.getAsset('select_blue') as Sprite;\r\n    }\r\n\r\n    mouseTile: Point;\r\n\r\n    init(state: GameState): void {\r\n        this.mouseTile = undefined;\r\n    }\r\n\r\n    tick(state: GameState, keys: KeyboardManager, mouse: MouseManager): IGamePhase {\r\n        const dir = this.tryGetDirection(state, keys, mouse);\r\n        if(dir !== undefined) {\r\n            const destination = dir === 6 ? state.player.position : Point.add(state.player.position, DirectionHelper.ToPoint(dir));\r\n            const additionalMoves = [...state.player.primary.enableAdditionalMoves(state, state.player), ...state.player.secondary.enableAdditionalMoves(state, state.player)];\r\n\r\n            if(!state.isValidMoveIgnorePlayer(destination, false)) {\r\n                const specialMove = additionalMoves.find(move => move.dest.equals(destination));\r\n                if(specialMove !== undefined){\r\n                    return PlayerMoveAnimPhase(state, state.player.position, destination, specialMove.forceMove);\r\n                }\r\n                return this;\r\n            }\r\n\r\n            return PlayerMoveAnimPhase(state, state.player.position, destination, destination);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    tryGetDirection(state:GameState, keys: KeyboardManager, mouse: MouseManager): Move {\r\n        for(let i = 0; i < dirKeys.length; i++) {\r\n            if(keys.isKeyPressed(dirKeys[i].key)) {\r\n                return dirKeys[i].dir;\r\n            }\r\n        }\r\n\r\n        const mouseClick = mouse.tryGetClick(0);\r\n        if(mouseClick !== undefined) {\r\n            this.mouseTile = PixelToHex(HopliteProgram.scaleHelper.ScreenToPixel(mouseClick.position));\r\n\r\n            if(HexLength(Point.subtract(this.mouseTile, state.player.position)) <= 1) {\r\n                if(this.mouseTile.equals(state.player.position)) return 6;\r\n                else return DirectionHelper.FromPoint(Point.subtract(this.mouseTile, state.player.position));\r\n            }\r\n        }\r\n\r\n        return undefined;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, state: GameState): void {\r\n        state.draw(ctx);\r\n\r\n        if(this.mouseTile !== undefined) {\r\n            const tgt = HexToPixel(this.mouseTile);\r\n            PlayerTurnGamePhase.cellHighlightSprite.draw(ctx, new Rect(tgt.x, tgt.y, C.TILE_WIDTH, C.TILE_HEIGHT), 0);\r\n        }\r\n    }\r\n}","import GameState from \"../GameState\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport * as C from '../Constants';\r\nimport PlayerTurnGamePhase from \"./PlayerTurnGamePhase\";\r\nimport KeyboardManager from \"../../common/input/KeyboardManager\";\r\n\r\nconst ENTRY_ANIMATION_TIME = 60;\r\n\r\nexport default class EntryAnimationPhase implements IGamePhase {\r\n    animationTime = 0;\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    init(state:GameState){}\r\n\r\n    tick(state: GameState, keys: KeyboardManager): IGamePhase {\r\n        this.animationTime++;\r\n        if(this.animationTime >= ENTRY_ANIMATION_TIME) { \r\n            return new PlayerTurnGamePhase();\r\n        }\r\n        else {\r\n            return this;\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, state: GameState): void {\r\n        state.draw(ctx);\r\n        ctx.fillStyle = '#000000';\r\n        if(this.animationTime <= ENTRY_ANIMATION_TIME) {\r\n            ctx.globalAlpha = 1 - this.animationTime / ENTRY_ANIMATION_TIME;\r\n            ctx.fillRect( 0, 0, C.MAP_PIXEL_SIZE, C.MAP_PIXEL_SIZE);\r\n            ctx.globalAlpha = 1;\r\n        }\r\n        state.player.draw(ctx);\r\n    }\r\n}","import KeyboardManager from \"../../common/input/KeyboardManager\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport * as C from '../Constants';\r\nimport { MapGenerators } from \"../mapGen/IMapGen\";\r\nimport EntryAnimationPhase from \"./EntryAnimationPhase\";\r\nimport Point from \"../../common/position/Point\";\r\n\r\nconst FADE_OUT_ANIM_TIME = 30;\r\nconst PLAYER_MOVE_TIME = 30;\r\n\r\nexport default class FloorTransitionPhase implements IGamePhase {\r\n\r\n    time = 0;\r\n\r\n    init(state: GameState): void {\r\n    }\r\n\r\n    tick(state: GameState, keys: KeyboardManager): IGamePhase {\r\n        this.time++;\r\n        if (this.time >= FADE_OUT_ANIM_TIME) {\r\n            return new FloorTransitionPlayerMovePhase();\r\n        } else {\r\n            return this;\r\n        }\r\n\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, state: GameState): void {\r\n        state.draw(ctx);\r\n        ctx.fillStyle = '#000000';\r\n        ctx.globalAlpha = this.time / FADE_OUT_ANIM_TIME;\r\n        ctx.fillRect(0, 0, C.MAP_PIXEL_SIZE, C.MAP_PIXEL_SIZE);\r\n        ctx.globalAlpha = 1;\r\n        state.player.draw(ctx);\r\n    }\r\n\r\n}\r\n\r\nclass FloorTransitionPlayerMovePhase implements IGamePhase {\r\n\r\n    time = 0;\r\n    playerStartPoint: Point;\r\n\r\n    init(state: GameState): void {\r\n        const floor = state.currentFloor + 1;\r\n        const generator = MapGenerators.filter(g => floor >= g.range[0] && (g.range[1] === -1 || floor < g.range[1]))[0].gen;\r\n        this.playerStartPoint = state.player.position;\r\n        state.changeFloor(floor, generator);\r\n    }\r\n\r\n    tick(state: GameState, keys: KeyboardManager): IGamePhase {\r\n        this.time++;\r\n        if (this.time >= PLAYER_MOVE_TIME) {\r\n            state.player.position = C.PLAYER_START_POSITION.clone();\r\n            return new EntryAnimationPhase();\r\n        } else {\r\n            return this;\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, state: GameState): void {\r\n        const lerp = this.time / PLAYER_MOVE_TIME;\r\n        const tgt = Point.interpolate(this.playerStartPoint, C.PLAYER_START_POSITION, lerp);\r\n        state.player.position = tgt;\r\n        state.player.draw(ctx);\r\n    }\r\n\r\n}","import Point from \"../../common/position/Point\";\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Assets from \"../assets\";\r\nimport GameState from \"../GameState\";\r\nimport IGamePhase from \"../phases/IGamePhase\";\r\nimport IFeature, { SimpleFeature } from \"./IFeature\";\r\nimport * as C from '../Constants';\r\nimport FloorTransitionPhase from \"../phases/FloorTransitionPhase\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\n\r\nexport default class Stairs extends SimpleFeature {\r\n    static sprite: Sprite;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        Stairs.sprite = assets.getAsset('down_stairs') as Sprite;\r\n    }\r\n\r\n    constructor() { \r\n        super(Stairs.sprite, 'Stairs');\r\n    }\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        if(x === state.player.position.x && y === state.player.position.y) {\r\n            return () => new FloorTransitionPhase();\r\n        }\r\n        return undefined;\r\n    }\r\n}\r\n\r\nexport class LockedStairs extends SimpleFeature {\r\n    static sprite: Sprite;\r\n    static unlockAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        LockedStairs.sprite = assets.getAsset('down_stairs_locked') as Sprite;\r\n        LockedStairs.unlockAnimation = assets.getAsset('down_stairs_unlock_animation');\r\n    }\r\n\r\n    hasPlayedAnimation: boolean;\r\n    isPlayingAnimation: boolean;\r\n\r\n    constructor() { \r\n        super(LockedStairs.sprite, 'LockedStairs');\r\n        this.hasPlayedAnimation = this.isPlayingAnimation = false;\r\n    }\r\n\r\n    afterPlayerTurn(state: GameState, x: number, y: number, nextPhase: (gs: GameState) => IGamePhase): (gs: GameState) => IGamePhase {\r\n        if(state.enemies.length === 0 && Object.keys(state.brokenGems).length === 0 && !this.isPlayingAnimation) {\r\n            this.isPlayingAnimation = true;\r\n            this.sprite = LockedStairs.unlockAnimation.getRenderable();\r\n        }\r\n        else if(this.hasPlayedAnimation && x === state.player.position.x && y === state.player.position.y){\r\n            return () => new FloorTransitionPhase();\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, world: GameState, pt: Point): void {\r\n        if(this.sprite.tick()) {\r\n            this.hasPlayedAnimation = true;\r\n            this.sprite = Stairs.sprite;\r\n        }\r\n        super.draw(ctx, world, pt);\r\n    }\r\n}","import Point from \"../../common/position/Point\";\r\nimport IRenderable from \"../../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../../common/rendering/IRenderableSource\";\r\nimport OffsetRenderable from '../../common/rendering/OffsetRenderable';\r\nimport Assets from \"../Assets\";\r\nimport IAttackInfo from \"../attackInfos/IAttackInfo\";\r\nimport TileAttackInfo from \"../attackInfos/TileAttackInfo\";\r\nimport * as C from \"../Constants\";\r\nimport { AllDirections, Direction, DirectionHelper } from \"../Direction\";\r\nimport GameState from \"../GameState\";\r\nimport { GetRing, HexLength } from \"../Hex\";\r\nimport Enemy from \"./Enemy\";\r\n\r\nconst MAX_RANGE = 5;\r\n\r\nexport default class StoneDisc extends Enemy {\r\n    static sprite: IRenderable;\r\n    static readySprite: IRenderable;\r\n    static impactAnimation: IRenderableSource;\r\n\r\n    static onAssetsLoaded(assets:Assets) {\r\n        StoneDisc.sprite = assets.getAsset('stone_disc').getRenderable();\r\n        StoneDisc.readySprite = assets.getAsset('stone_disc_ready').getRenderable();\r\n        StoneDisc.impactAnimation = assets.getAsset('impact_fire');\r\n    }\r\n\r\n    isReadyToFire: boolean;\r\n    constructor(position: Point) {\r\n        super(position);\r\n        this.hp = this.maxHp = 5;\r\n        this.isFlying = true;\r\n        this.isReadyToFire = false;\r\n\r\n        this.goldValue = 8;\r\n    }\r\n\r\n    getAttacks(state: GameState): IAttackInfo[] {\r\n        if(this.isReadyToFire) {\r\n            const points: Point[] = [];\r\n            for(const dir of AllDirections){\r\n                const delta = DirectionHelper.ToPoint(dir);\r\n                let pt = Point.add(this.position, delta);\r\n                for(let i = 0; i < MAX_RANGE && state.tiles.isInBounds(pt.x, pt.y); i++) {\r\n                    points.push(pt);\r\n                    pt = Point.add(pt, delta);\r\n                }\r\n            }\r\n            this.isReadyToFire = false;\r\n            return [new TileAttackInfo(this.position, [{damage: 1, positions: points}], 4, StoneDisc.impactAnimation)];\r\n        }\r\n\r\n        const playerLocation = state.player.position;\r\n        const len = HexLength(Point.subtract(playerLocation, this.position));\r\n        if(len <= MAX_RANGE) {\r\n            let ray = DirectionHelper.FromPoint(Point.subtract(playerLocation, this.position));\r\n            if(ray !== undefined) this.isReadyToFire = true;\r\n        }\r\n        return [];\r\n    }\r\n\r\n    getMove(state: GameState, attack: IAttackInfo[], disallowed: Point[]): Point {\r\n        if(attack.length > 0 || this.isReadyToFire) {\r\n            // Don't move if you've attacked.\r\n            return this.position;\r\n        }\r\n\r\n        const possibleMoves = GetRing(1).map(rp => Point.add(this.position, rp));\r\n        let minMoves: Point[] = [];\r\n        let minMoveDist = 99;\r\n        for(let i = 0; i < possibleMoves.length; i++) {\r\n            if(!state.isValidMoveIgnoreEnemies(possibleMoves[i], true)) \r\n                continue;\r\n            if(disallowed.some(p => p.equals(possibleMoves[i])))\r\n                continue;\r\n\r\n            const ray = Point.subtract(state.player.position, possibleMoves[i]);\r\n            const len = HexLength(ray);\r\n            if(len === 1) {\r\n                continue; // Dont move within 1 of the player if you can avoid it.\r\n            }\r\n            if(len < minMoveDist) { \r\n                minMoveDist = len;\r\n                minMoves = [possibleMoves[i]];\r\n            }\r\n            else if(len === minMoveDist) {\r\n                minMoves.push(possibleMoves[i]);\r\n            }\r\n        }\r\n\r\n        // Don't retreat\r\n        if(minMoveDist > HexLength(Point.subtract(state.player.position, this.position))) {\r\n            return this.position;\r\n        }\r\n\r\n        if(minMoves.length === 0) return this.position;\r\n        return minMoves[Math.floor(Math.random() * minMoves.length)];\r\n    }\r\n\r\n    override getRenderable(): IRenderable {\r\n        if(this.isReadyToFire) {\r\n            return StoneDisc.readySprite;\r\n        }\r\n        return StoneDisc.sprite;\r\n    }\r\n}","import AssetLoader from \"../common/assets/AssetLoader\";\r\nimport { SpriteSheet } from \"../common/assets/SpriteSheet\";\r\nimport hoplite_tiles_url from './assets/hoplite_tiles.png';\r\nimport features_url from './assets/hoplite_features.png';\r\nimport floor_digits_url from './assets/floor_and_digits.png';\r\nimport enemies_url from './assets/hoplite_enemies.png';\r\nimport hp_image_url from './assets/hp.png';\r\nimport impact_url from './assets/hoplite_impacts.png';\r\nimport lavaLayers_url from './assets/lava_layers.png';\r\nimport shop_url from './assets/shopUI.png';\r\nimport weapon_url from './assets/hoplite_weapons.png';\r\nimport ascii_url from '../common-assets/ascii.png';\r\nimport ascii_sm_url from '../common-assets/ascii_6x8.png';\r\nimport ImageLoader from \"../common/assets/ImageLoader\";\r\nimport Sprite from \"../common/rendering/Sprite\";\r\nimport Rect from \"../common/position/Rectangle\";\r\nimport Point from \"../common/position/Point\";\r\nimport HpRenderer from \"./HpRenderer\";\r\nimport { SpriteAnimation } from \"../common/rendering/SpriteAnimation\";\r\nimport Zombie from \"./entities/Zombie\";\r\nimport Archer from \"./entities/Archer\";\r\nimport Mage from \"./entities/Mage\";\r\nimport Giant from \"./entities/Giant\";\r\nimport StoneEye from \"./entities/StoneEye\";\r\nimport LifeGem, { RunicLifeGem } from \"./features/LifeGem\";\r\nimport Stairs, { LockedStairs } from \"./features/Stairs\";\r\nimport Shrine from \"./features/Shrine\";\r\nimport { IAssetSheet, IsAnimationAsset } from \"./assets/IAssetSheet\";\r\nimport IRenderable from \"../common/rendering/IRenderable\";\r\nimport IRenderableSource from \"../common/rendering/IRenderableSource\";\r\nimport * as C from './Constants';\r\nimport Spider from \"./entities/Spider\";\r\nimport PlayerTurnGamePhase from \"./phases/PlayerTurnGamePhase\";\r\nimport Portal from \"./features/Portal\";\r\nimport StoneDisc from \"./entities/StoneDisc\";\r\nimport BlueMage from \"./entities/BlueMage\";\r\nimport BlueBurstDisc from \"./entities/BlueBurstDisc\";\r\nimport ShopPhase from \"./phases/ShopPhase\";\r\nimport Shop from \"./features/Shop\";\r\n\r\n\r\n\r\nexport default class Assets {\r\n\r\n    tiles: SpriteSheet;\r\n    enemies: SpriteSheet;\r\n    features: SpriteSheet;\r\n    lavaLayers: SpriteSheet;\r\n    floor_and_digits: ImageLoader;\r\n    hpImage: ImageLoader;\r\n    hpRenderer: HpRenderer;\r\n    impacts: ImageLoader;\r\n    assetSheet: IAssetSheet;\r\n    weapons: ImageLoader;\r\n    shopUI: ImageLoader;\r\n    \r\n    ascii: SpriteSheet;\r\n    asciiSmall: SpriteSheet;\r\n\r\n    assetFilesByName: {[key: string]: CanvasImageSource} = {};\r\n\r\n    constructor(loader: AssetLoader) {\r\n        this.tiles = new SpriteSheet(32, 32, hoplite_tiles_url, loader.registerAssetLoadCallback());\r\n        this.enemies = new SpriteSheet(32, 32, enemies_url, loader.registerAssetLoadCallback());\r\n        this.features = new SpriteSheet(32, 32, features_url, loader.registerAssetLoadCallback());\r\n        this.floor_and_digits = new ImageLoader(floor_digits_url, loader.registerAssetLoadCallback());\r\n        this.hpImage = new ImageLoader(hp_image_url, loader.registerAssetLoadCallback());\r\n        this.impacts = new ImageLoader(impact_url, loader.registerAssetLoadCallback());\r\n        this.lavaLayers = new SpriteSheet(32, 32, lavaLayers_url, loader.registerAssetLoadCallback());\r\n        this.weapons = new ImageLoader(weapon_url, loader.registerAssetLoadCallback());\r\n        this.shopUI = new ImageLoader(shop_url, loader.registerAssetLoadCallback());\r\n        this.ascii = new SpriteSheet(8, 16, ascii_url, loader.registerAssetLoadCallback());\r\n        this.asciiSmall = new SpriteSheet(6, 8, ascii_sm_url, loader.registerAssetLoadCallback());\r\n\r\n        const jsonCallback = loader.registerAssetLoadCallback();\r\n        import(\r\n            /* webpackChunkName: \"hoplite-asset-definitions\" */\r\n            './assets/AssetSheet.json'\r\n        ).then(value => {\r\n            console.log(value.default);\r\n            this.assetSheet = value.default as any as IAssetSheet;\r\n            jsonCallback();\r\n        });\r\n    }\r\n\r\n    getImpactAnimation(row: number) {\r\n        return new SpriteAnimation(this.impacts.image, new Rect(0, row * 32, 32, 32), new Point(0, 0), new Point(32, 0), 8, 16, false);\r\n    }\r\n\r\n    onLoadFinished(){\r\n        this.hpRenderer = new HpRenderer(this.hpImage);\r\n        this.assetFilesByName = {\r\n            'hoplite_tiles': this.tiles.image,\r\n            'hoplite_impacts': this.impacts.image,\r\n            'floor_and_digits': this.floor_and_digits.image,\r\n            'hp': this.hpImage.image,\r\n            'lava_layers': this.lavaLayers.image,\r\n            'features': this.features.image,\r\n            'enemies': this.enemies.image,\r\n            'weapons': this.weapons.image,\r\n            'shop_ui': this.shopUI.image,\r\n        }\r\n        \r\n        PlayerTurnGamePhase.onAssetsLoaded(this);\r\n        ShopPhase.onAssetsLoaded(this);\r\n\r\n        Zombie.onAssetsLoaded(this);\r\n        Archer.onAssetsLoaded(this);\r\n        Mage.onAssetsLoaded(this);\r\n        Giant.onAssetsLoaded(this);\r\n        StoneEye.onAssetsLoaded(this);\r\n        Spider.onAssetsLoaded(this);\r\n        StoneDisc.onAssetsLoaded(this);\r\n        BlueMage.onAssetsLoaded(this);\r\n        BlueBurstDisc.onAssetsLoaded(this);\r\n\r\n        LifeGem.onAssetsLoaded(this);\r\n        Stairs.onAssetsLoaded(this);\r\n        Shrine.onAssetsLoaded(this);\r\n        RunicLifeGem.onAssetsLoaded(this);\r\n        LockedStairs.onAssetsLoaded(this);\r\n        Portal.onAssetsLoaded(this);\r\n        Shop.onAssetsLoaded(this);\r\n    }\r\n\r\n    getAsset(name: string, suppressErrors?: boolean): IRenderableSource {\r\n        const definition = this.assetSheet[name];\r\n        if(definition === undefined) {\r\n            if(!suppressErrors)\r\n                console.error('Asset not found: ' + name);\r\n            return undefined;\r\n        }\r\n        else {\r\n            var file = this.assetFilesByName[definition.file];\r\n            if(file === undefined){ \r\n                if(!suppressErrors)\r\n                    console.error('Asset ' + name + ' references missing file: ' + definition.file);\r\n                return undefined;\r\n            }\r\n            const units = definition.units ?? 'tiles';\r\n            const scaleFactor = units === 'tiles' ? C.TILE_WIDTH : 1;\r\n\r\n            const x = definition.pos[0];\r\n            const y = definition.pos[1];\r\n            const w = definition.size === undefined ? 1 : definition.size[0];\r\n            const h = definition.size === undefined ? 1 : definition.size[1];\r\n            const origin_x = definition.origin === undefined ? 0 : definition.origin[0];\r\n            const origin_y = definition.origin === undefined ? 0 : definition.origin[1];\r\n\r\n            if(IsAnimationAsset(definition)) {\r\n                const advx = definition.advance === undefined ? 1: definition.advance[0];\r\n                const advy = definition.advance === undefined ? 0: definition.advance[1];\r\n                return new SpriteAnimation(\r\n                    file,\r\n                    new Rect(x * scaleFactor, y * scaleFactor, w * scaleFactor, h * scaleFactor),\r\n                    new Point(origin_x, origin_y),\r\n                    new Point(advx * w * scaleFactor, advy * h * scaleFactor),\r\n                    definition.numFrames,\r\n                    definition.duration,\r\n                    definition.loop === undefined ? false : definition.loop\r\n                );\r\n            }\r\n            else {\r\n                const units = definition.units ?? 'tiles';\r\n                const scaleFactor = units === 'tiles' ? C.TILE_WIDTH : 1;\r\n\r\n                const x = definition.pos[0];\r\n                const y = definition.pos[1];\r\n                const w = definition.size === undefined ? 1 : definition.size[0];\r\n                const h = definition.size === undefined ? 1 : definition.size[1];\r\n\r\n                return new Sprite(file, new Rect(x * scaleFactor, y * scaleFactor, w * scaleFactor, h * scaleFactor), new Point(origin_x, origin_y));\r\n            }\r\n        }\r\n    }\r\n\r\n    getDigitSprite(digit: number, digitRow ?: number):Sprite {\r\n        return new Sprite(this.floor_and_digits.image, new Rect(41 + 7 * digit, (digitRow ?? 0) * 13, 7, 13));\r\n    }\r\n\r\n    drawNumber(ctx: CanvasRenderingContext2D, position: Point, value: number, digitRow ?: number) {\r\n        const digits = value.toString().split('').map(s => parseInt(s));\r\n        for(var i = 0; i < digits.length; i++) {\r\n            this.getDigitSprite(digits[i], digitRow).draw(ctx, new Rect(position.x + i * 7, position.y, 7, 13), 0);\r\n        }\r\n    }\r\n\r\n    drawString(ctx: CanvasRenderingContext2D, position: Point, text: string){\r\n        for(var i = 0; i < text.length; i++) {\r\n            const charCode = text.charCodeAt(i);\r\n            const sprite = this.ascii.getSprite(charCode % 16, Math.floor(charCode / 16), 8, 16);\r\n            sprite.draw(ctx, new Rect(position.x + i * 8, position.y, 8, 16), 0);\r\n        }\r\n    }\r\n    \r\n    drawSmallString(ctx: CanvasRenderingContext2D, position: Point, text: string){\r\n        for(var i = 0; i < text.length; i++) {\r\n            const charCode = text.charCodeAt(i);\r\n            const sprite = this.asciiSmall.getSprite(charCode % 16, Math.floor(charCode / 16), 6, 8);\r\n            sprite.draw(ctx, new Rect(position.x + i * 6, position.y, 6, 8), 0);\r\n        }\r\n    }\r\n}","export interface IAssetSheet {\r\n    [key: string]: ISpriteAsset | IAnimationAsset;\r\n}\r\n\r\nexport interface ISpriteAsset {\r\n    file: string,\r\n    \r\n    origin?: [number, number],\r\n\r\n    units?: 'tiles' | 'pixels',\r\n    pos: [number, number],\r\n    size?: [number, number]\r\n}\r\n\r\nexport interface IAnimationAsset {\r\n    file: string,\r\n    pos: [number, number],\r\n    numFrames: number,\r\n    duration: number,\r\n    units?: 'tiles' | 'pixels',\r\n    size?: [number, number],\r\n    advance?: [number, number],\r\n    origin?: [number, number],\r\n    loop?: boolean\r\n}\r\n\r\nexport function IsAnimationAsset(asset: ISpriteAsset | IAnimationAsset): asset is IAnimationAsset {\r\n    return (asset as any).numFrames !== undefined;\r\n}","import Point from \"../../common/position/Point\";\r\nimport Assets from \"../Assets\";\r\nimport Entity from \"../Entity\";\r\nimport PlayerWeapon from \"../weapons/PlayerWeapon\";\r\nimport * as C from '../Constants';\r\nimport Sprite from \"../../common/rendering/Sprite\";\r\nimport Rect from \"../../common/position/Rectangle\";\r\nimport { HexToPixel } from \"../Hex\";\r\nimport Sword from \"../weapons/Sword\";\r\nimport Dagger from \"../weapons/Dagger\";\r\nimport HpRenderer from \"../HpRenderer\";\r\nimport Kunai from \"../weapons/Kunai\";\r\nimport Caltrops from \"../weapons/Caltrops\";\r\n\r\nexport default class Player extends Entity {\r\n\r\n    public primary: PlayerWeapon;\r\n    public secondary: PlayerWeapon;\r\n    private renderable: Sprite;\r\n    private hpRenderer: HpRenderer;\r\n\r\n    constructor(assets: Assets, pos: Point) {\r\n        super(pos);\r\n\r\n        this.hpRenderer = assets.hpRenderer;\r\n\r\n        this.maxHp = this.hp = 3;\r\n\r\n        this.primary = new Sword(assets);\r\n        this.secondary = new Dagger(assets);\r\n\r\n        this.renderable = assets.getAsset('player') as Sprite;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D): void {\r\n        const target = HexToPixel(this.position);\r\n        const rect = new Rect(target.x, target.y, C.TILE_WIDTH, C.TILE_HEIGHT);\r\n\r\n        this.renderable.draw(ctx, rect, 0);\r\n        this.primary.sprite.draw(ctx, new Rect(rect.x, rect.y, rect.w / 2, rect.h), 0);\r\n        this.secondary.sprite.draw(ctx, new Rect(rect.x +rect.w / 2, rect.y, rect.w / 2, rect.h), 0);\r\n\r\n        this.hpRenderer.draw(ctx, this.position, this.hp, this.maxHp);\r\n    }\r\n}","import Point from \"../common/position/Point\";\r\nimport Assets from \"./Assets\";\r\nimport Player from \"./entities/Player\";\r\nimport HexArray from \"./HexArray\";\r\nimport HexCell from \"./tiles/HexCell\";\r\nimport IMapGen from \"./mapGen/IMapGen\";\r\nimport * as C from \"./Constants\";\r\nimport Entity from \"./Entity\";\r\nimport { HexToPixel } from \"./Hex\";\r\nimport Rect from \"../common/position/Rectangle\";\r\nimport Sprite from \"../common/rendering/Sprite\";\r\nimport Enemy from \"./entities/Enemy\";\r\nimport IFeature from \"./features/IFeature\";\r\nimport Cell from \"../rpgt/world/Cell\";\r\n\r\nconst regions = [\r\n    { region: 0, from: 0, to: 13 },\r\n    { region: 1, from: 13, to: -1 },\r\n]\r\n\r\nexport default class GameState {\r\n\r\n    public player: Player;\r\n    public enemies: Enemy[] = [];\r\n\r\n    public tiles: HexArray<HexCell>;\r\n    public features: HexArray<IFeature | undefined>;\r\n    public currentFloor: number;\r\n    public displayFloor: number;\r\n    public regionId: number;\r\n\r\n    public gold: number;\r\n\r\n    public renderTickNumber: number;\r\n\r\n    public brokenGems: {[floor: number]: boolean} = {};\r\n    \r\n    constructor(private assets: Assets, size: number, floorNum: number, generator: IMapGen) {\r\n        this.changeFloor(floorNum, generator);\r\n        this.regionId = 0;\r\n\r\n        this.player = new Player(assets, C.PLAYER_START_POSITION);\r\n        this.gold = 0;\r\n\r\n        this.renderTickNumber = 0;\r\n    }\r\n\r\n    entityAt(to: Point) {\r\n        return [this.player, ...this.enemies].find(e => e.position.equals(to));\r\n    }\r\n\r\n    isValidMove(to: Point, flying: boolean) {\r\n        const isValidTile = this.tiles.isInBounds(to.x, to.y) && \r\n            (this.tiles.get(to).isPathable || flying);\r\n        if(!isValidTile) return false;\r\n        if(to.equals(this.player.position)) return false;\r\n        return !this.enemies.some(e => e.position.equals(to));\r\n    }\r\n\r\n    isValidMoveIgnorePlayer(to: Point, flying: boolean) {\r\n        const isValidTile = this.tiles.isInBounds(to.x, to.y) && \r\n            (this.tiles.get(to).isPathable || flying);\r\n        if(!isValidTile) return false;\r\n        return !this.enemies.some(e => e.position.equals(to));\r\n    }\r\n\r\n    isValidMoveIgnoreEnemies(to: Point, flying: boolean) {\r\n        const isValidTile = this.tiles.isInBounds(to.x, to.y) && \r\n            (this.tiles.get(to).isPathable || flying);\r\n        if(!isValidTile) return false;\r\n        return !to.equals(this.player.position);\r\n    }\r\n\r\n    changeFloor(floorNum: number, generator: IMapGen) {\r\n        this.enemies = [];\r\n        generator.generateMap(this.assets, floorNum, this);\r\n        this.currentFloor = floorNum;\r\n        this.setCorrectRegion();\r\n        this.tiles.iterate((x, y, tile) =>{\r\n            tile.AfterWorldLoad(this, new Point(x, y));\r\n        });\r\n    }\r\n\r\n    private setCorrectRegion(){\r\n        for(const region of regions) {\r\n            if(this.currentFloor >= region.from && (this.currentFloor < region.to || region.to === -1 )) {\r\n                this.regionId = region.region;\r\n                this.displayFloor = this.currentFloor - region.from + 1;\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    getCells(predicate: (point: Point, tile: HexCell, feature: IFeature) => boolean) {\r\n        let results: Point[] = [];\r\n        this.tiles.iterate((x, y, cell) => {\r\n            const pt = new Point(x,y);\r\n            const feature = this.features.get(pt);\r\n            if(predicate(pt, cell, feature)) {\r\n                results.push(pt);\r\n            }\r\n        });\r\n        return results;\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, excludeEntities?: Entity[]) {\r\n        new Sprite(this.assets.floor_and_digits.image, new Rect(0, 13*this.regionId, 41, 13)).draw(ctx, new Rect(0, 0, 41, 13), 0);\r\n        this.assets.drawNumber(ctx, new Point(42, 0), this.displayFloor, this.regionId);\r\n\r\n        new Sprite(this.assets.floor_and_digits.image, new Rect(0, 13*3, 41, 13)).draw(ctx, new Rect(0, 14, 41, 13), 0);\r\n        this.assets.drawNumber(ctx, new Point(42, 14), this.gold, 3);\r\n\r\n        this.tiles.iterate((x, y, cell) => {\r\n            cell.draw(ctx, this, new Point(x, y));\r\n        });\r\n        \r\n        this.features.iterate((x, y, feat) => {\r\n            feat?.draw(ctx, this, new Point(x, y));\r\n        });\r\n\r\n        [this.player, ...this.enemies].forEach(entity => {\r\n            if(excludeEntities && excludeEntities.includes(entity)) {\r\n                return;\r\n            }\r\n            entity.draw(ctx);\r\n            if(entity.hp != entity.maxHp){\r\n                this.assets.hpRenderer.draw(ctx, entity.position, entity.hp, entity.maxHp);\r\n            }\r\n        });\r\n\r\n        this.renderTickNumber ++;\r\n    }\r\n}","import GameState from \"../GameState\";\r\nimport IGamePhase from \"./IGamePhase\";\r\nimport * as C from '../Constants';\r\nimport PlayerTurnGamePhase from \"./PlayerTurnGamePhase\";\r\nimport EntryAnimationPhase from \"./EntryAnimationPhase\";\r\nimport KeyboardManager from \"../../common/input/KeyboardManager\";\r\n\r\nconst ENTRY_ANIMATION_TIME = 120;\r\n\r\nexport default class GameStartAnimationPhase implements IGamePhase {\r\n    animationTime = 0;\r\n\r\n    constructor() {\r\n\r\n    }\r\n    \r\n    init(state:GameState){}\r\n\r\n    tick(state: GameState, keys: KeyboardManager): IGamePhase {\r\n        this.animationTime++;\r\n        if(this.animationTime >= ENTRY_ANIMATION_TIME) { \r\n            return new EntryAnimationPhase();\r\n        }\r\n        else {\r\n            return this;\r\n        }\r\n    }\r\n\r\n    draw(ctx: CanvasRenderingContext2D, state: GameState): void {\r\n        state.player.draw(ctx);\r\n        ctx.fillStyle = '#000000';\r\n        if(this.animationTime <= ENTRY_ANIMATION_TIME) {\r\n            ctx.globalAlpha = 1 - this.animationTime / ENTRY_ANIMATION_TIME;\r\n            ctx.fillRect( 0, 0, C.MAP_PIXEL_SIZE, C.MAP_PIXEL_SIZE);\r\n            ctx.globalAlpha = 1;\r\n        }\r\n    }\r\n}","import Point from '../position/Point';\r\n\r\nexport interface IMouseState {\r\n    button: number;\r\n    eventType: 'down' | 'up' | 'click' | 'drag' | 'drag_end';\r\n}\r\n\r\nexport interface IMouseClick extends IMouseState{\r\n    position: Point;\r\n    eventType: 'down' | 'up' | 'click';\r\n}\r\n\r\nexport interface IMouseDrag extends IMouseState{\r\n    startPosition: Point;\r\n    endPosition: Point;\r\n    eventType: 'drag' | 'drag_end';\r\n}\r\n\r\nexport default class MouseWatcher {\r\n\r\n    public position: Point;\r\n    public clickEvents: {[key: number]: {at: Point, isDrag: boolean}} = {};\r\n\r\n    private outputEvents: IMouseState[] = [];\r\n\r\n    constructor(public attachedElement: HTMLElement, private dragThreshold: number = 5) {\r\n\r\n        attachedElement.addEventListener('mouseenter', ev => this.onMouseEnter(ev));\r\n        attachedElement.addEventListener('mousemove', ev => this.onMouseMove(ev));\r\n        attachedElement.addEventListener('mouseleave', ev => this.onMouseLeave(ev));\r\n        \r\n        attachedElement.addEventListener('mousedown', ev => this.onMouseDown(ev));\r\n        attachedElement.addEventListener('mouseup', ev => this.onMouseUp(ev));\r\n    }\r\n\r\n    \r\n    private onMouseEnter(ev: MouseEvent) {\r\n        this.position = new Point(ev.offsetX, ev.offsetY);\r\n    }\r\n    \r\n    private onMouseLeave(ev: MouseEvent) {\r\n        this.position = undefined;\r\n    }\r\n\r\n    private onMouseMove(ev: MouseEvent) {\r\n        this.position = new Point(ev.offsetX, ev.offsetY);\r\n        for(const key in this.clickEvents) {\r\n            const keyevent = this.clickEvents[key];\r\n            if(keyevent.isDrag || Point.subtract(this.position, keyevent.at).lengthSq() >= this.dragThreshold * this.dragThreshold) {\r\n                this.clickEvents[key].isDrag = true;\r\n                \r\n                this.outputEvents.push(<IMouseDrag>{ button: ev.button, startPosition: keyevent.at, endPosition: this.position, eventType: 'drag' });\r\n            }\r\n        }\r\n    }\r\n    \r\n    private onMouseDown(ev: MouseEvent) {\r\n        const position = new Point(ev.offsetX, ev.offsetY);\r\n        this.clickEvents[ev.button] = { at: position, isDrag: false };\r\n        this.outputEvents.push(<IMouseClick>{ button: ev.button, position, eventType: 'down' });\r\n    }\r\n    \r\n    private onMouseUp(ev: MouseEvent) {\r\n        this.position = new Point(ev.offsetX, ev.offsetY);\r\n        const event = this.clickEvents[ev.button];\r\n        if(event) {\r\n            this.outputEvents.push(<IMouseClick>{ button: ev.button, position: event.at, eventType: 'up' });\r\n            if(event.isDrag) {\r\n                this.outputEvents.push(<IMouseDrag>{ button: ev.button, startPosition: event.at, endPosition: this.position, eventType: 'drag_end' });\r\n            }\r\n            else {\r\n                this.outputEvents.push(<IMouseClick>{ button: ev.button, position: event.at, eventType: 'click' });\r\n            }\r\n        }\r\n        delete this.clickEvents[ev.button];\r\n    }\r\n\r\n    public update() {\r\n        const store = this.outputEvents;\r\n        this.outputEvents = [];\r\n        return store;\r\n    }\r\n}","import MouseWatcher, { IMouseClick, IMouseDrag, IMouseState } from './MouseWatcher';\r\nimport Point from '../position/Point';\r\n\r\nexport default class MouseManager {\r\n\r\n    watcher: MouseWatcher;\r\n    public updates: IMouseState[];\r\n\r\n    constructor(element: HTMLElement) {\r\n        this.watcher = new MouseWatcher(element);\r\n        this.updates = [];\r\n    }\r\n\r\n    public update(): void {\r\n        this.updates = this.watcher.update();\r\n    }\r\n\r\n\r\n    public position() : undefined | Point {\r\n        return this.watcher.position;\r\n    }\r\n\r\n    public isButtonDown(button: number) {\r\n        return this.watcher.clickEvents[button] !== undefined;\r\n    }\r\n\r\n    public isButtonUp(button: number) {\r\n        return !this.isButtonDown(button);\r\n    }\r\n\r\n    /** Returns true iff the provided button was pressed this frame */\r\n    public isButtonPressed(button: number) {\r\n        return this.updates.some(update => update.button === button && update.eventType === 'down');\r\n    }\r\n    \r\n    /** Returns true iff the provided button was released this frame */\r\n    public isButtonReleased(button: number) {\r\n        return this.updates.some(update => update.button === button && update.eventType === 'up');\r\n    }\r\n    \r\n    /** Returns true iff the provided button was released this frame and was not dragged */\r\n    public isButtonClicked(button: number) {\r\n        return this.updates.some(update => update.button === button && update.eventType === 'click');\r\n    }\r\n    \r\n    /** Returns true iff the provided button was released this frame and was dragged */\r\n    public isButtonDragEnd(button: number) {\r\n        return this.updates.some(update => update.button === button && update.eventType === 'drag_end');\r\n    }\r\n\r\n    public tryGetDrag(button: number) {\r\n        const drags = this.updates.filter(update => update.button === button && (update.eventType === 'drag' || update.eventType === 'drag_end'));\r\n        if(drags.length === 0) { return undefined; }\r\n        return drags[0] as IMouseDrag;\r\n    }\r\n\r\n    public tryGetClick(button: number) {\r\n        const clicks = this.updates.filter(update => update.button === button && update.eventType === 'click');\r\n        if(clicks.length === 0) { return undefined; }\r\n        return clicks[0] as IMouseClick;\r\n    }\r\n}","import AssetLoader from '../common/assets/AssetLoader';\r\nimport { SpriteSheet } from '../common/assets/SpriteSheet';\r\nimport { NearestNeighborScaling, ResizeCanvas } from '../common/CanvasHelpers';\r\nimport NearestNeighborScalingHelper from '../common/NearestNeighborScalingHelper';\r\nimport KeyboardManager from '../common/input/KeyboardManager';\r\nimport Point from '../common/position/Point';\r\nimport { TILES_HIGH } from '../rpgt/Constants';\r\nimport * as C from \"./Constants\";\r\nimport Assets from './Assets';\r\nimport GameState from './GameState';\r\nimport StandardMapGen from './mapGen/StandardMapGen';\r\nimport EntryAnimationPhase from './phases/EntryAnimationPhase';\r\nimport IGamePhase from './phases/IGamePhase';\r\nimport GameStartAnimationPhase from './phases/GameStartAnimationPhase';\r\nimport FloorZeroGen from './mapGen/FloorZeroGen';\r\nimport Zombie from './entities/Zombie';\r\nimport Floor12Gen from './mapGen/Floor12Gen';\r\nimport MouseManager from '../common/input/MouseManager';\r\nimport ShopPhase from './phases/ShopPhase';\r\nimport WeaponSaleItem from './shopItems/WeaponSaleItem';\r\nimport Sword from './weapons/Sword';\r\nimport Dagger from './weapons/Dagger';\r\nimport Kunai from './weapons/Kunai';\r\n\r\nlet scaleHelper: NearestNeighborScalingHelper;\r\n\r\nexport default class HopliteProgram {\r\n    static keys: KeyboardManager;\r\n    static mouse: MouseManager;\r\n    static scaleHelper: NearestNeighborScalingHelper;\r\n\r\n    public static run(): (()=>void) {\r\n        let ctx: CanvasRenderingContext2D;\r\n        \r\n        const assetLoader = new AssetLoader();\r\n        const assets = new Assets(assetLoader);\r\n\r\n        let state: GameState;\r\n        let currentPhase: IGamePhase = new GameStartAnimationPhase();\r\n\r\n        HopliteProgram.keys = new KeyboardManager(document.body);\r\n        assetLoader.onAllFinished(assetLoadDone);\r\n        \r\n        function assetLoadDone() {\r\n            assets.onLoadFinished();\r\n            \r\n            const canvas = document.getElementById('mainCanvas') as HTMLCanvasElement;\r\n            ctx = canvas.getContext('2d');\r\n            HopliteProgram.mouse = new MouseManager(canvas);\r\n            HopliteProgram.scaleHelper = new NearestNeighborScalingHelper(\r\n                canvas, \r\n                ctx, \r\n                C.MAP_PIXEL_SIZE, \r\n                C.MAP_PIXEL_SIZE, \r\n                true, \r\n                () => { return; }\r\n            );\r\n\r\n            state = new GameState(assets, C.MAP_SIZE, 0, new FloorZeroGen());\r\n\r\n            NearestNeighborScaling(ctx);\r\n            tick();\r\n        }\r\n        \r\n        function tick() {\r\n            HopliteProgram.scaleHelper.TryRescale();\r\n            NearestNeighborScaling(ctx);\r\n            HopliteProgram.mouse.update();\r\n\r\n            const nextPhase = currentPhase.tick(state, HopliteProgram.keys, HopliteProgram.mouse);\r\n\r\n            ctx.clearRect(0, 0, C.MAP_PIXEL_SIZE, C.MAP_PIXEL_SIZE);\r\n            ctx.fillStyle = '#000000';\r\n            ctx.fillRect(0, 0, C.MAP_PIXEL_SIZE, C.MAP_PIXEL_SIZE);\r\n\r\n            currentPhase.draw(ctx, state);\r\n\r\n            if(nextPhase !== currentPhase) {\r\n                currentPhase = nextPhase;\r\n                nextPhase.init(state);\r\n            }\r\n\r\n            HopliteProgram.keys.update();\r\n            requestAnimationFrame(() => tick());\r\n        }\r\n\r\n        return (() => HopliteProgram.scaleHelper.Detatch());\r\n    }\r\n}","import * as React from 'react';\r\nimport HopliteProgram from '../../../projects/hoplite/index';\r\n\r\nexport default function HopliteComponent() {\r\n    React.useEffect(()=>HopliteProgram.run());\r\n    return <div className='rpgt rpgt_body full_body center' style={{background: \"black\"}}>\r\n        <canvas id=\"mainCanvas\"></canvas>\r\n    </div>;\r\n}\r\n"],"names":["Color","constructor","vals","h","s","v","this","hsv","rgb","undefined","static","r","g","b","reqRgb","reqHsv","componentToRgb","n","k","Math","max","min","calcRgb","calcHsv","mx","mn","toString","toByte","component","floor","KeyState","keys","changes","isKeyDown","key","indexOf","isKeyUp","KeyWatcher","attachedElement","logKeyNames","addEventListener","onKeyDown","onKeyUp","downKeys","console","log","push","change","idx","splice","Update","storeKeys","storeChanges","slice","KeyboardManager","element","watcher","prvState","currentState","update","isKeyPressed","isKeyReleased","Interpolated","range","timingFunction","interpolator","args","t","InterpolationTimer","totalTime","elapsedTime","tick","sample","animation","numberInterpolator","a","p","fastColorInterpolator","EvenlySpacedKeyframes","percPer","length","keyframes","Keyframes","i","addKeyFrame","start","time","value","keyIndex","sampleRange","samplePerc","TILE_WIDTH","TILE_HEIGHT","PIX_PER_CELL_Y","HALF_TILE_SIZE","MAP_PIXEL_SIZE","MAP_CENTER_POSITION","PLAYER_START_POSITION","Direction","AllDirections","Right","DownRight","DownLeft","Left","UpLeft","UpRight","direction","PI","pt","x","y","ray","FromPoint","sign","distance","HexLength","amount","TurnRight","amt","TurnLeft","point","abs","GetRing","radius","result","pos","dir","len","originDelta","HpRenderer","image","emptyHpImage","redHpImage","yellowHpImage","blueHpImage","draw","ctx","hp","maxHp","rows","ceil","lastRowLength","fullImage","emptyImage","originPoint","row","dy","col","lastRowDx","SpriteAnimation","source","firstFrame","origin","frameAdvance","numFrames","duration","loop","getPixelSize","w","getRenderable","SpriteAnimationInstance","getSprite","frameNumber","frame","overrideDuration","currentTick","position","rotation","DelaySpriteAnimationInstance","delayDuration","EntityMoveAnimation","entity","motion","target","timer","RenderableAnimation","renderable","bounds","fixedDuraiton","SequentialAnimation","steps","shift","ProjectileAnimation","size","fromPixel","toPixel","angle","atan2","destination","CreateProjectileAnimation","projectile","fromHex","toHex","onImpact","destPt","projAnimation","impactAnimation","AttackInfo","attacker","affectedTiles","damage","bumpAnimation","ignoreEnemies","ignorePlayer","startPoint","getAffectedTiles","state","positions","toAnimations","animations","pixTarget","applyExtraEffects","Entity","primary","SimpleEnemy","rect","Enemy","Zombie","super","isFlying","goldValue","assets","sprite","getAsset","getAttacks","playerLocation","player","basicAttack","getMove","attack","disallowed","possibleMoves","map","rp","minMoves","minMoveDist","some","equals","isValidMoveIgnoreEnemies","random","DeltaRenderable","delta","Rectangle","StackRenderable","renderables","renderableFinishMode","finishMode","allFinished","anyFinished","f","typeId","pathable","isPathable","AfterPlayerTurn","AfterEnemyTurn","SimpleCell","spriteSheetPosition","includeDefaultRenderable","bg_renderable","tiles","AfterWorldLoad","world","tileParts","directions","tileCoords","tileSlice","StitchTileParts","tx","ty","tw","th","isEdge","adjacencyMap","images","part","index","reduceRight","acc","sourceBounds","DelayAnimation","inner","delay","ParallelAnimation","step","TileAttackInfo","infos","delayPerDist","animationSource","allPts","reduce","info","concat","dist","pix","Lava","TypeID","steppingEnemy","enemies","find","e","getImpactAnimation","OnEntityStep","lavaStatic","lavaLayers","d","hexPt","isInBounds","get","lavaOverlay","overlayWaver","round","sin","renderTickNumber","Archer","isAfraid","fearsprite","projectileSprite","nextPt","entityAt","projectileAttack","deltaPlayer","targetPosition","tile","hasAttackOpportunity","dirAndDist","couldAttack","Mage","cooldownsprite","attackOnCooldown","RadialAreaAttackInfo","rings","delayPerRadius","ring","filter","innerAnimations","points","Giant","turnSequenceIndex","turnSequence","lastTurn","bigAttackPrepImage","radialSmashAnimation","turn","internalGetMove","OffsetRenderable","offset","StoneEye","prepFire","randart","sprites","readySprite","moveTarget","SimpleFeature","name","afterPlayerTurn","nextPhase","afterEnemyTurn","tgt","LifeGem","isBroken","brokenSprite","brokenGems","currentFloor","RunicLifeGem","flashAnimation","hasFlashed","Floor","customSprite","HexArray","defaultValue","_size","data","midRowLength","dx","xp","yp","extractInputCoords","toArrayCoords","set","getRowLength","xMin","xMax","getXRange","minX","getMinX","iterate","func","toPath","node","parent","parentPath","AssurePathTo","predicate","checkEnd","pathLengthNoise","pathToEnd","isEnd","getNeighbors","closedSet","openSet","cost","minIndex","cur","current","neighbor","neighborNode","to","c","open","findIndex","DjikstraPath","neighbors","AssurePathToEnd","features","Shrine","isUsed","upKeys","selectKeys","ShopPhase","items","nextState","selectedItem","fullHeight","shopItemSprite","height","closeButton","displayOffset","width","wrappedTexts","item","wrapText","description","shopItemSelectedSprite","shopItemNoMoney","closeButtonSelected","init","mouse","getSelectedItem","price","gold","onBuy","replaceItem","globalAlpha","fillStyle","fillRect","drawShopItem","closeButtonSprite","selected","bgSprite","icon","drawString","drawSmallString","text","maxLength","words","split","lines","currentLine","word","Shop","_","WeaponSaleItem","weapon","shopImage","type","oldPrimary","oldSecondary","secondary","FullHealItem","SpawnEnemyAttackInfo","enemy","BlueBurstDisc","isExploding","explodingSprite","BlueMage","spawnAnimation","isValidMove","trapSprites","trapCooldown","Trap","cooldown","spritePos","Spider","wasNextToPlayer","dest","PlayerWeapon","artTile","weapons","iconImage","patternIsPoint","pattern","SimpleWeapon","beforeMove","simpleAttacks","attacks","moveFrom","moveTo","moveDelta","onMove","rot","getRotation","requireEmpty","empty","isEmptyRequirementFulfilled","every","attackInfo","enableAdditionalMoves","getBeforeMoveAttacks","getAfterMoveAttacks","Sword","getAttack","IsPlayer","animationAttack","Spear","Hammer","directAttacks","forceMove","targetEntity","secondaryAttacks","realTarget","Dagger","Kunai","Caltrops","allPrimaryWeapons","generateItem","allSecondaryWeapons","Portal","isOpen","closedSprite","openSprites","openAnimation","FloorTransitionPhase","MathHelpers","modulo","playerMoveTileArts","FloorZeroGen","generateMap","ring2","playerRing","Stairs","MapGenerators","gen","leftLavaY","leftLavaX","genLava","rightLavaY","rightLavaX","downStairY","downStairX","gemPositions","getCells","feat","gemPos","shrinePositions","shrinePosition","shopPositions","shopPosition","shopItems","validEnemySpawns","spawnId","archer","floorPositions","replaceFloor","validRiverDirections","LockedStairs","ringIndex","wrap","regionId","AnimationPhase","onFinish","AttackResolutionPhase","damageGroups","damageGroup","goldValues","PhaseBuilder","chain","thenAnimate","next","thenResolve","gs","thenAnimateAndResolve","atk","then","finally","lastStep","nextfn","AfterMovePhase","isPlayerTurn","allAttacks","phaseBuilder","New","newNext","AfterMovePhase_Features","PlayerMoveAnimPhase","from","forceMotion","PlayerTurnGamePhase","enemyAttacks","lastAttacks","attackSet","stepped","rm","didMove","AfterEnemyMovePhase","EnemyMovePhase","EnemyAttackPhase","postMoveAttacks","playerMove","dirKeys","cellHighlightSprite","mouseTile","tryGetDirection","additionalMoves","isValidMoveIgnorePlayer","specialMove","move","mouseClick","tryGetClick","tile_y","tile_x","PixelToHex","HopliteProgram","scaleHelper","ScreenToPixel","EntryAnimationPhase","animationTime","FloorTransitionPlayerMovePhase","generator","playerStartPoint","changeFloor","lerp","hasPlayedAnimation","isPlayingAnimation","unlockAnimation","Object","StoneDisc","isReadyToFire","Assets","loader","assetFilesByName","SpriteSheet","hoplite_tiles","registerAssetLoadCallback","floor_and_digits","ImageLoader","hpImage","impacts","shopUI","ascii","asciiSmall","jsonCallback","default","assetSheet","onLoadFinished","hpRenderer","onAssetsLoaded","suppressErrors","definition","file","error","scaleFactor","units","origin_x","origin_y","advx","advance","advy","getDigitSprite","digit","digitRow","drawNumber","digits","parseInt","charCode","charCodeAt","Player","regions","region","GameState","floorNum","flying","setCorrectRegion","displayFloor","results","cell","feature","excludeEntities","forEach","includes","GameStartAnimationPhase","MouseWatcher","dragThreshold","clickEvents","outputEvents","ev","onMouseEnter","onMouseMove","onMouseLeave","onMouseDown","onMouseUp","offsetX","offsetY","keyevent","isDrag","at","lengthSq","button","startPosition","endPosition","eventType","event","store","MouseManager","updates","isButtonDown","isButtonUp","isButtonPressed","isButtonReleased","isButtonClicked","isButtonDragEnd","tryGetDrag","drags","clicks","assetLoader","AssetLoader","currentPhase","TryRescale","clearRect","requestAnimationFrame","document","body","onAllFinished","canvas","getElementById","getContext","NearestNeighborScalingHelper","Detatch","HopliteComponent","className","style","background","id"],"sourceRoot":""}