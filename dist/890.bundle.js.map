{"version":3,"file":"890.bundle.js","mappings":"4HAAe,MAAMA,EAMjBC,YAAmBC,EAAkBC,GAAlB,KAAAD,EAAAA,EAAkB,KAAAC,EAAAA,EAJrC,cACI,OAAO,IAAIH,EAAM,EAAE,GAOhB,iBAAiBI,EAAeC,GACnC,OAAO,IAAIL,EAAMM,KAAKC,IAAIH,IAAUC,MAAAA,EAAAA,EAAY,GAAIC,KAAKE,IAAIJ,IAAUC,MAAAA,EAAAA,EAAY,IAGhFI,WACH,OAAOT,EAAMU,IAAIC,KAAMA,MAGpBC,SACH,OAAON,KAAKO,KAAKF,KAAKF,YAGnBK,QACH,OAAO,IAAId,EAAMW,KAAKT,EAAGS,KAAKR,GAG3BY,SACH,OAAO,IAAIf,GAAOW,KAAKT,GAAIS,KAAKR,GAG7Ba,gBAGH,OAFAL,KAAKT,GAAKS,KAAKT,EACfS,KAAKR,GAAKQ,KAAKR,EACRQ,KAGJ,WAAWM,EAAWC,GACzB,OAAOD,EAAGf,EAAIgB,EAAGhB,EAAIe,EAAGd,EAAIe,EAAGf,EAG5BgB,QAAQC,GACX,OAAOpB,EAAMU,IAAIC,KAAMS,GAGpBC,YACH,IAAIC,EAAMX,KAAKC,SACf,OAAOZ,EAAMuB,SAASZ,KAAM,EAAIW,GAG7BE,YACH,OAAOlB,KAAKmB,MAAMd,KAAKR,EAAGQ,KAAKT,GAK5BwB,QAAQN,EAAqBjB,GAChC,MAAOD,EAAGyB,EAAIxB,EAAGyB,GAAMC,EAAUT,EAAOjB,GAGxC,OAFAQ,KAAKT,GAAKyB,EACVhB,KAAKR,GAAKyB,EACHjB,KAMJmB,SAASV,EAAqBjB,GACjC,MAAOD,EAAGyB,EAAIxB,EAAGyB,GA4FzB,SAA2B1B,EAAiBC,GACxC,YAAS4B,IAAN5B,OAEuB4B,IAAlB7B,EAAYA,EACL,CAAEA,EAAWA,EAAGA,EAAGC,EAAWD,EAAGC,GAErC,CAAED,EAAGA,EAAaC,EAAGD,GAEzB,CAACA,EAAWA,EAAGC,EAAAA,GApGK6B,CAAkBZ,EAAOjB,GAGhD,OAFAQ,KAAKT,GAAKyB,EACVhB,KAAKR,GAAKyB,EACHjB,KAKJsB,aAAab,EAAqBjB,GACrC,MAAOD,EAAGyB,EAAIxB,EAAGyB,GAAMC,EAAUT,EAAOjB,GAGxC,OAFAQ,KAAKT,GAAKyB,EACVhB,KAAKR,GAAKyB,EACHjB,KAKJuB,WAAWd,EAAqBjB,GACnC,MAAOD,EAAGyB,EAAIxB,EAAGyB,GAAMC,EAAUT,EAAOjB,GAGxC,OAFAQ,KAAKT,GAAKyB,EACVhB,KAAKR,GAAKyB,EACHjB,KAGJwB,OAAOf,GACV,OAAOT,KAAKT,IAAMkB,EAAMlB,GAAKS,KAAKR,IAAMiB,EAAMjB,EAMlD,WAAWiC,EAAYhB,EAAqBjB,GACxC,MAAOD,EAAGyB,EAAIxB,EAAGyB,GAAMC,EAAUT,EAAOjB,GACxC,OAAO,IAAIH,EAAMoC,EAAIlC,EAAIyB,EAAIS,EAAIjC,EAAIyB,GAKzC,gBAAgBQ,EAAYhB,EAAqBjB,GAC7C,MAAOD,EAAGyB,EAAIxB,EAAGyB,GAAMC,EAAUT,EAAOjB,GACxC,OAAO,IAAIH,EAAMoC,EAAIlC,EAAIyB,EAAIS,EAAIjC,EAAIyB,GAKzC,gBAAgBS,EAAUC,EAAiBC,GACvC,YAAWR,IAAPQ,EACO,IAAIvC,EAAMqC,EAAEnC,EAAKoC,EAAcD,EAAElC,EAAIoC,QAEtBR,IAAhBO,EAAUpC,EACT,IAAIF,EAAMqC,EAAEnC,EAAKoC,EAAYpC,EAAGmC,EAAElC,EAAKmC,EAAYnC,GAEnD,IAAIH,EAAMqC,EAAEnC,EAAKoC,EAAcD,EAAElC,EAAKmC,GAIrD,mBAAmBD,EAAUC,EAAUE,GACnC,OAAO,IAAIxC,EAAMqC,EAAEnC,GAAKoC,EAAEpC,EAAImC,EAAEnC,GAAKsC,EAAGH,EAAElC,GAAKmC,EAAEnC,EAAIkC,EAAElC,GAAKqC,GAGhE,oBAAoBH,EAAUC,GAC1B,OAAGD,EAAEnC,GAAKoC,EAAEpC,GAAKmC,EAAElC,GAAKmC,EAAEnC,EAAUkC,EACjCC,EAAEpC,GAAKmC,EAAEnC,GAAKoC,EAAEnC,GAAKkC,EAAElC,EAAUmC,EAC7B,IAAItC,EAAMM,KAAKmC,IAAIJ,EAAEnC,EAAGoC,EAAEpC,GAAII,KAAKmC,IAAIJ,EAAElC,EAAGmC,EAAEnC,IAGzD,oBAAoBkC,EAAUC,GAC1B,OAAGD,EAAEnC,GAAKoC,EAAEpC,GAAKmC,EAAElC,GAAKmC,EAAEnC,EAAUkC,EACjCC,EAAEpC,GAAKmC,EAAEnC,GAAKoC,EAAEnC,GAAKkC,EAAElC,EAAUmC,EAC7B,IAAItC,EAAMM,KAAKoC,IAAIL,EAAEnC,EAAGoC,EAAEpC,GAAII,KAAKoC,IAAIL,EAAElC,EAAGmC,EAAEnC,IAGzD,cAAcwC,EAAcC,GACxB,OAAkB,IAAfD,EAAIE,OAAqBF,EAAI,GACT,IAAfA,EAAIE,OAAqB7C,EAAM8C,IAAI9C,EAAMuB,SAASoB,EAAI,GAAIC,GAAI5C,EAAMuB,SAASoB,EAAI,GAAI,EAAEC,IACxF5C,EAAM8C,IACT9C,EAAMuB,SAASvB,EAAM+C,OAAOJ,EAAIK,MAAM,GAAIJ,GAAIA,GAC9C5C,EAAMuB,SAASvB,EAAM+C,OAAOJ,EAAIK,MAAM,EAAGL,EAAIE,OAAS,GAAID,GAAI,EAAEA,IAGxEK,OAAOC,GACH,MAAM9C,EAAQE,KAAKmB,MAAMd,KAAKR,EAAGQ,KAAKT,GAChCoB,EAAMX,KAAKC,SACjB,OAAOZ,EAAMmD,UAAU/C,EAAQ8C,EAAO5B,IAI9C,SAASO,EAAU3B,EAAiBC,GAChC,YAAS4B,IAAN5B,EAAwB,CAAED,EAAWA,EAAGA,EAAGC,EAAWD,EAAGC,GACrD,CAACD,EAAWA,EAAGC,EAAAA,K,qEC1H1B,SAASiD,EAAanC,EAAcC,GAChC,IAAI,MAAMmC,KAAQpC,EAAGqC,SACjB,IAAI,MAAMC,KAAQrC,EAAGoC,SACjB,GAAGE,EAAiBH,EAAME,GAAO,OAAO,EAGhD,OAAO,EAIX,SAASC,EAAiBvC,EAAawC,GACnC,IAAI,IAAIC,EAAI,EAAGA,EAAIzC,EAAG4B,OAAQa,IAAK,CAC/B,IAAIC,EAAO,CAAC1C,EAAGyC,GAAIzC,GAAIyC,EAAE,GAAGzC,EAAG4B,SAC/B,IAAI,IAAIe,EAAI,EAAGA,EAAIH,EAAIZ,OAAQe,IAAK,CAChC,IAAIC,EAAY,CAACJ,EAAIG,GAAIH,GAAKG,EAAE,GAAGH,EAAIZ,SACvC,GAAG7C,EAAA,WAAe6D,EAAU,GAAIF,EAAK,IAAIlD,WANlC,GAOAT,EAAA,WAAe6D,EAAU,GAAIF,EAAK,IAAIlD,WAPtC,EAQH,OAAO,EAEX,GAAGT,EAAA,WAAe6D,EAAU,GAAIF,EAAK,IAAIlD,WAVlC,GAWAT,EAAA,WAAe6D,EAAU,GAAIF,EAAK,IAAIlD,WAXtC,EAYH,OAAO,GAGnB,OAAO,EAGJ,MAAMqD,EAWT7D,YAAY8D,EAAaC,G,MACrBrD,KAAKsD,UAAY,GACjBtD,KAAK2C,SAAW,GAChB3C,KAAKuD,MAAQF,EAAKE,MAClBvD,KAAKwD,OAAoB,QAAX,EAAAH,EAAKG,cAAM,SACzBxD,KAAKyD,KAAOJ,EAAKI,KACjBzD,KAAK0D,KAAON,EACZpD,KAAK2D,KAAON,EAAKM,KACjB3D,KAAK4D,QAAUP,EAAKQ,KAEpB,IAAIC,EAAUT,EAAKQ,KAAKE,MAAM,KAC1BC,EAA2B,IAC3BC,GAAuB,EACvBC,EAAmB,GACvB,IAAI,IAAIC,KAAaL,EACjB,OAAOK,GACH,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACDH,EAAU,IACVC,EAAcE,EAAUC,eAAiBD,EACzC,MACJ,IAAK,IACL,IAAK,IACDH,EAAU,IACVC,EAAcE,EAAUC,eAAiBD,EACzC,MACJ,IAAK,IACL,IAAK,IACDH,EAAU,IACVC,EAAcE,EAAUC,eAAiBD,EACzC,MACJ,IAAK,IACL,IAAK,IACDnE,KAAK2C,SAAS0B,KAAKH,GACnBA,EAAU,GACV,MACJ,QACI,IAAII,EAA4B,IAAnBJ,EAAQhC,OACU,IAAzBlC,KAAK2C,SAAST,OAAe,IAAI7C,EAAA,EAAM,EAAE,GAAKW,KAAK2C,SAAS3C,KAAK2C,SAAST,OAAS,GAAGlC,KAAK2C,SAAS3C,KAAK2C,SAAST,OAAS,GAAGA,OAAS,GACvIgC,EAAQA,EAAQhC,OAAS,GAE3BqC,EAAKJ,EAAUJ,MAAM,KAErBS,EAAqB,MAAZR,EACP,IAAI3E,EAAA,EAAMoF,WAAWF,EAAG,IAAKE,WAAWF,EAAG,KAC/B,MAAZP,EACA,IAAI3E,EAAA,EAAMoF,WAAWF,EAAG,IAAKN,EAAc,EAAIK,EAAO9E,GACtD,IAAIH,EAAA,EAAM4E,EAAc,EAAIK,EAAO/E,EAAGkF,WAAWF,EAAG,MAEvDG,MAAMF,EAAOjF,IAAMmF,MAAMF,EAAOhF,KAE/BmF,QAAQC,IAAIxB,EAAM,kBAAoBe,GAG1CD,EAAQG,KACJJ,EAAc5E,EAAA,MAAUiF,EAAQE,GAAUA,GAKpC,IAAnBN,EAAQhC,QAAclC,KAAK2C,SAAS0B,KAAKH,GAE5C,IAAIW,EAAO,EACPC,EAAO,KACPC,EAAO,EACPC,EAAO,KACX,IAAI,MAAMC,KAAQjF,KAAK2C,SACnB,IAAI,MAAM4B,KAAMU,EACTV,EAAGhF,EAAIuF,IAAMA,EAAOP,EAAGhF,GACvBgF,EAAG/E,EAAIwF,IAAMA,EAAOT,EAAG/E,GACvB+E,EAAGhF,EAAIsF,IAAMA,EAAON,EAAGhF,GACvBgF,EAAG/E,EAAIuF,IAAMA,EAAOR,EAAG/E,GAGlCQ,KAAKkF,SAAW,IAAI7F,EAAA,GAAOyF,EAAOD,GAAQ,GAAIG,EAAOD,GAAQ,I,4p+FC9I/DI,EAAM,IDAG,MAGX7F,YAAY8F,G,QACRpF,KAAKqF,UAAY,GAEjB,IAAI,IAAIjC,KAAOkC,OAAOC,KAAKH,GAAU,CACjC,IAAI/B,EAAO+B,EAAQhC,GACnBpD,KAAKqF,UAAUjC,GAAO,IAAID,EAASC,EAAKC,GAG5C,IAAI,IAAID,KAAOkC,OAAOC,KAAKvF,KAAKqF,WAAW,CACvC,IAAIG,EAAWxF,KAAKqF,UAAUjC,GAC9B,GAAqB,eAAlBoC,EAAS/B,KACZ,IAAI,IAAIgC,KAAQH,OAAOC,KAAKvF,KAAKqF,WAAW,CACxC,IAAI5E,EAAQT,KAAKqF,UAAUI,GACxBhF,GAAS+E,GAA2B,eAAf/E,EAAMgD,QACoC,KAAX,QAAnD,EAA8B,QAA9B,EAAA2B,EAAQI,EAAS9B,MAAMgC,eAAO,eAAEC,QAAQlF,EAAMiD,aAAK,SAAG,IAAajB,EAAa+C,EAAU/E,MAC1F+E,EAASlC,UAAUe,KAAK5D,GACxBA,EAAM6C,UAAUe,KAAKmB,GACH,QAAf/E,EAAMgD,MAAoC,SAAlB+B,EAAS/B,OAAiB+B,EAAS/B,KAAO,SACnD,SAAfhD,EAAMgD,MAAqC,QAAlB+B,EAAS/B,OAAgBhD,EAAMgD,KAAO,cCrBlE,GAEL,SAASmC,IACpB,MAAOC,EAAaC,GAAgB,gBAAiC1E,GAErE,OAAO,uBAAK2E,UAAU,gCAClB,uBAAKC,QAAQ,gBAAgBC,KAAK,QAC7BX,OAAOC,KAAKJ,EAAIE,WAAWF,KAAI/B,IAE5B,IAAIoC,EAAWL,EAAIE,UAAUjC,GAC7B,OAAO,qBAAGA,IAAKA,GACX,wBACI6C,KACI7C,IAAQyC,EAAc,UACL,cAAjBL,EAAS/B,KAAuB,OACf,SAAjB+B,EAAS/B,KAAkB,UACV,QAAjB+B,EAAS/B,KAAiB,UAAY,UAC1CyC,OAAO,QACPC,EAAGX,EAAS5B,QACZwC,QAAS,IAAIN,EAAa1C,KAE9B,wBAAMiD,SAAS,KAAKJ,KAAK,QAAQ1G,EAAGiG,EAASN,SAAS3F,EAAGC,EAAGgG,EAASN,SAAS1F,EAAG8G,MAAO,CAAEC,cAAe,SAAWf,EAAS7B,UAGrI,yBACK2B,OAAOC,KAAKJ,EAAIE,WAAWF,KAAI/B,IAC5B,IAAIoC,EAAWL,EAAIE,UAAUjC,GACzBoD,EAAShB,EAASN,SACtB,OAAO,qBAAG9B,IAAKA,GACVoC,EAASlC,UAAU6B,KAAIsB,GACpB,wBAAMrD,IAAKoC,EAAS7B,KAAO,IAAM8C,EAAE9C,KAAM+C,GAAIF,EAAOjH,EAAGoH,GAAIH,EAAOhH,EAAGoH,GAAIH,EAAEvB,SAAS3F,EAAGsH,GAAIJ,EAAEvB,SAAS1F,EAAG0G,OAAO","sources":["webpack://trading-game/./src/projects/common/position/Point.ts","webpack://trading-game/./src/projects/diplo/Map.ts","webpack://trading-game/./src/views/projects/diplo/DiploComponent.tsx"],"sourcesContent":["export default class Point {\r\n\r\n    static zero(): Point  {\r\n        return new Point(0,0);\r\n    }\r\n\r\n    constructor(public x: number, public y: number) {\r\n\r\n    }\r\n\r\n    public static fromAngle(angle: number, distance?: number) : Point {\r\n        return new Point(Math.cos(angle) * (distance ?? 1), Math.sin(angle) * (distance ?? 1));\r\n    }\r\n\r\n    public LengthSq(): number {\r\n        return Point.Dot(this, this);\r\n    }\r\n\r\n    public Length(): number {\r\n        return Math.sqrt(this.LengthSq());\r\n    }\r\n\r\n    public Clone(): Point {\r\n        return new Point(this.x, this.y);\r\n    }\r\n\r\n    public Negate(): Point {\r\n        return new Point(-this.x, -this.y);\r\n    }\r\n\r\n    public NegateInPlace(): this {\r\n        this.x = -this.x;\r\n        this.y = -this.y;\r\n        return this;\r\n    }\r\n\r\n    public static Dot(p1: Point, p2: Point): number {\r\n        return p1.x * p2.x + p1.y * p2.y;\r\n    }\r\n\r\n    public DotWith(other: Point): number {\r\n        return Point.Dot(this, other);\r\n    }\r\n\r\n    public normalize(): Point {\r\n        let len = this.Length();\r\n        return Point.Multiply(this, 1 / len);\r\n    }\r\n\r\n    public Direction(): number {\r\n        return Math.atan2(this.y, this.x);\r\n    }\r\n\r\n    public AddWith(x: number, y: number): this;\r\n    public AddWith(other: Point): this;\r\n    public AddWith(other: number|Point, y?: number): this {\r\n        const {x: nx, y: ny} = splitArgs(other, y);\r\n        this.x += nx;\r\n        this.y += ny;\r\n        return this;\r\n    }\r\n\r\n    public MultWith(s: number): this;\r\n    public MultWith(x: number, y: number): this;\r\n    public MultWith(other: Point): this;\r\n    public MultWith(other: number|Point, y?: number): this {\r\n        const {x: nx, y: ny} = splitArgsOrSingle(other, y);\r\n        this.x *= nx;\r\n        this.y *= ny;\r\n        return this;\r\n    }\r\n\r\n    public SubtractWith(x: number, y: number): this;\r\n    public SubtractWith(other: Point): this;\r\n    public SubtractWith(other: number|Point, y?: number): this {\r\n        const {x: nx, y: ny} = splitArgs(other, y);\r\n        this.x -= nx;\r\n        this.y -= ny;\r\n        return this;\r\n    }\r\n\r\n    public DivideWith(x: number, y: number): this;\r\n    public DivideWith(other: Point): this;\r\n    public DivideWith(other: number|Point, y?: number): this {\r\n        const {x: nx, y: ny} = splitArgs(other, y);\r\n        this.x /= nx;\r\n        this.y /= ny;\r\n        return this;\r\n    }\r\n\r\n    public Equals(other: Point): boolean {\r\n        return this.x === other.x && this.y === other.y;\r\n    }\r\n\r\n    \r\n    static add(src: Point, x: number, y: number): Point;\r\n    static add(src: Point, other: Point): Point;\r\n    static add(src: Point, other: number|Point, y?: number): Point {\r\n        const {x: nx, y: ny} = splitArgs(other, y);\r\n        return new Point(src.x + nx, src.y + ny);\r\n    }\r\n\r\n    static subtract(src: Point, x: number, y: number): Point;\r\n    static subtract(src: Point, other: Point): Point;\r\n    static subtract(src: Point, other: number|Point, y?: number): Point {\r\n        const {x: nx, y: ny} = splitArgs(other, y);\r\n        return new Point(src.x - nx, src.y - ny);\r\n    }\r\n\r\n    static Multiply(a: Point, s: number, sy?: number): Point;\r\n    static Multiply(a: Point, b: Point): Point;\r\n    static Multiply(a: Point, b: Point|number, sy ?: number): Point {\r\n        if (sy !== undefined) {\r\n            return new Point(a.x * (b as number), a.y * sy);\r\n        }\r\n        else if ((b as any).x !== undefined) {\r\n            return new Point(a.x * (b as Point).x, a.y * (b as Point).y);\r\n        } else {\r\n            return new Point(a.x * (b as number), a.y * (b as number));\r\n        }\r\n    }\r\n\r\n    static interpolate(a: Point, b: Point, p: number): Point {\r\n        return new Point(a.x + (b.x - a.x) * p, a.y + (b.y - a.y) * p);\r\n    }\r\n\r\n    static componentMin(a: Point, b: Point): Point {\r\n        if(a.x <= b.x && a.y <= b.y) return a;\r\n        if(b.x <= a.x && b.y <= a.y) return b;\r\n        return new Point(Math.min(a.x, b.x), Math.min(a.y, b.y));\r\n    }\r\n    \r\n    static componentMax(a: Point, b: Point): Point {\r\n        if(a.x >= b.x && a.y >= b.y) return a;\r\n        if(b.x >= a.x && b.y >= a.y) return b;\r\n        return new Point(Math.max(a.x, b.x), Math.max(a.y, b.y));\r\n    }\r\n\r\n    static Bezier(pts: Point[], t: number): Point {\r\n        if(pts.length === 1) return pts[0];\r\n        else if(pts.length === 2) return Point.add(Point.Multiply(pts[1], t), Point.Multiply(pts[0], 1-t));\r\n        return Point.add(\r\n            Point.Multiply(Point.Bezier(pts.slice(1), t), t),\r\n            Point.Multiply(Point.Bezier(pts.slice(0, pts.length - 1), t), 1-t));\r\n    }\r\n\r\n    rotate(theta: number): Point {\r\n        const angle = Math.atan2(this.y, this.x);\r\n        const len = this.Length();\r\n        return Point.fromAngle(angle + theta, len);\r\n    }\r\n}\r\n\r\nfunction splitArgs(x: Point|number, y ?: number): {x: number, y: number} {\r\n    if(y === undefined) return { x: (<Point>x).x, y: (<Point>x).y };\r\n    return {x: <number>x, y};\r\n}\r\n\r\nfunction splitArgsOrSingle(x: Point|number, y ?: number): {x: number, y: number} {\r\n    if(y === undefined)\r\n    {\r\n        if((x as Point).x !== undefined) {\r\n            return { x: (<Point>x).x, y: (<Point>x).y };\r\n        }\r\n        return { x: x as number, y: x as number };\r\n    } \r\n    return {x: <number>x, y};\r\n}","import { findMax, flatMap } from \"../../LinqLike\";\r\nimport Point from \"../common/position/Point\";\r\nimport IMapDataJson, { IProvinceJson } from \"./assets/IMapDataJson\";\r\nimport { FactionType, ProvinceType } from \"./Enums\";\r\n\r\nexport default class Map {\r\n    provinces: { [key: string]: Province };\r\n\r\n    constructor(mapJson: IMapDataJson) {\r\n        this.provinces = {};\r\n\r\n        for(let key of Object.keys(mapJson)) {\r\n            let json = mapJson[key];\r\n            this.provinces[key] = new Province(key, json);\r\n        }\r\n\r\n        for(let key of Object.keys(this.provinces)){\r\n            let province = this.provinces[key];\r\n            if(province.type === 'impassable') continue;\r\n            for(let key2 of Object.keys(this.provinces)){\r\n                let other = this.provinces[key2];\r\n                if(other == province || other.type === 'impassable') continue;\r\n                if((mapJson[province.name].connect?.indexOf(other.name)??-1) !== -1 || areNeighbors(province, other)) {\r\n                    province.neighbors.push(other);\r\n                    other.neighbors.push(province);\r\n                    if(other.type === 'sea' && province.type === 'land') province.type = 'coast';\r\n                    if(other.type === 'land' && province.type === 'sea') other.type = 'coast';\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction areNeighbors(p1: Province, p2: Province): boolean {\r\n    for(const pol1 of p1.polygons) {\r\n        for(const pol2 of p2.polygons) {\r\n            if(arePolysTouching(pol1, pol2)) return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nconst ADJ_THRESH = 4;\r\nfunction arePolysTouching(p1: Point[], pt2: Point[]): boolean {\r\n    for(let i = 0; i < p1.length; i++) {\r\n        let line = [p1[i], p1[(i+1)%p1.length]];\r\n        for(let j = 0; j < pt2.length; j++) {\r\n            let otherLine = [pt2[j], pt2[(j+1)%pt2.length]];\r\n            if(Point.subtract(otherLine[0], line[0]).LengthSq() < ADJ_THRESH\r\n                && Point.subtract(otherLine[1], line[1]).LengthSq() < ADJ_THRESH)\r\n                return true;\r\n                \r\n            if(Point.subtract(otherLine[1], line[0]).LengthSq() < ADJ_THRESH\r\n                && Point.subtract(otherLine[0], line[1]).LengthSq() < ADJ_THRESH)\r\n                return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nexport class Province {\r\n    name: string;\r\n    abbr: string;\r\n    type: ProvinceType;\r\n    supply: boolean;\r\n    owner?: FactionType;\r\n    polygons: Point[][];\r\n    svgData: string;\r\n    neighbors: Province[];\r\n    midpoint: Point;\r\n\r\n    constructor(key: string, json: IProvinceJson) {\r\n        this.neighbors = [];\r\n        this.polygons = [];\r\n        this.owner = json.owner;\r\n        this.supply = json.supply ?? false;\r\n        this.type = json.type;\r\n        this.name = key;\r\n        this.abbr = json.abbr;\r\n        this.svgData = json.data;\r\n\r\n        let svgPath = json.data.split(' ');\r\n        let svgMode: 'm' | 'v' | 'h' = 'm';\r\n        let svgRelative: boolean = false;\r\n        let polygon: Point[] = [];\r\n        for(let component of svgPath) {\r\n            switch(component) {\r\n                case 'm':\r\n                case 'l':\r\n                case 'M':\r\n                case 'L':\r\n                    svgMode = 'm';\r\n                    svgRelative = component.toUpperCase() != component;\r\n                    break;\r\n                case 'v':\r\n                case 'V':\r\n                    svgMode = 'v';\r\n                    svgRelative = component.toUpperCase() != component;\r\n                    break;\r\n                case 'h':\r\n                case 'H':\r\n                    svgMode = 'h';\r\n                    svgRelative = component.toUpperCase() != component;\r\n                    break;\r\n                case 'z':\r\n                case 'Z':\r\n                    this.polygons.push(polygon);\r\n                    polygon = [];\r\n                    break;\r\n                default:\r\n                    var lastPt = polygon.length === 0 \r\n                        ? this.polygons.length === 0 ? new Point(0,0) : this.polygons[this.polygons.length - 1][this.polygons[this.polygons.length - 1].length - 1]\r\n                        : polygon[polygon.length - 1];\r\n\r\n                    var pt = component.split(',');\r\n\r\n                    var parsed = svgMode === 'm' \r\n                        ? new Point(parseFloat(pt[0]), parseFloat(pt[1]))\r\n                        : svgMode === 'h'\r\n                        ? new Point(parseFloat(pt[0]), svgRelative ? 0 : lastPt.y)\r\n                        : new Point(svgRelative ? 0 : lastPt.x, parseFloat(pt[0]));\r\n\r\n                    if(isNaN(parsed.x) || isNaN(parsed.y))\r\n                    {\r\n                        console.log(key + ' parse FAILED: ' + component);\r\n                    }\r\n\r\n                    polygon.push(\r\n                        svgRelative ? Point.add(lastPt, parsed) : parsed\r\n                    );\r\n                    break;\r\n            }\r\n        }\r\n        if(polygon.length !== 0) this.polygons.push(polygon);\r\n        \r\n        let maxX = 0;\r\n        let minX = 1024;\r\n        let maxY = 0; \r\n        let minY = 1024;\r\n        for(const poly of this.polygons) {\r\n            for(const pt of poly) {\r\n                if(pt.x < minX) minX = pt.x;\r\n                if(pt.y < minY) minY = pt.y;\r\n                if(pt.x > maxX) maxX = pt.x;\r\n                if(pt.y > maxY) maxY = pt.y;\r\n            }\r\n        }\r\n        this.midpoint = new Point((minX + maxX) / 2, (minY + maxY) / 2);\r\n    }\r\n}","import * as React from 'react';\r\nimport Map from '../../../projects/diplo/Map';\r\nimport mapJson from '../../../projects/diplo/assets/map.json';\r\nimport IMapDataJson from '../../../projects/diplo/assets/IMapDataJson';\r\n\r\nconst map = new Map(mapJson as IMapDataJson);\r\n\r\nexport default function DiploComponent() {\r\n    const [selProvince, setSelection] = React.useState<string|undefined>(undefined);\r\n\r\n    return <div className='conway conway_body full_body'>\r\n        <svg viewBox='0 0 1024 1024' fill='#888'>\r\n            {Object.keys(map.provinces).map(key => \r\n            {\r\n                let province = map.provinces[key];\r\n                return <g key={key}>\r\n                    <path \r\n                        fill={\r\n                            key === selProvince ? '#ffff00' :\r\n                            province.type == 'impassable' ? '#888' :\r\n                            province.type == 'coast' ? '#00aa00' :\r\n                            province.type == 'land' ? '#00ff00' : '#0000ff'} \r\n                        stroke='black'\r\n                        d={province.svgData}\r\n                        onClick={()=>setSelection(key)}\r\n                    />\r\n                    <text fontSize='10' fill='black' x={province.midpoint.x} y={province.midpoint.y} style={{ pointerEvents: 'none' }}>{province.abbr}</text>\r\n                </g>;\r\n            })}\r\n            <g>\r\n                {Object.keys(map.provinces).map(key => {\r\n                    let province = map.provinces[key];\r\n                    let fromPt = province.midpoint;\r\n                    return <g key={key}>\r\n                        {province.neighbors.map(n => \r\n                            <line key={province.abbr + '-' + n.abbr} x1={fromPt.x} y1={fromPt.y} x2={n.midpoint.x} y2={n.midpoint.y} stroke='red' />)}\r\n                    </g>\r\n                })}\r\n            </g>\r\n        </svg>\r\n    </div>;\r\n}"],"names":["Point","constructor","x","y","angle","distance","Math","cos","sin","LengthSq","Dot","this","Length","sqrt","Clone","Negate","NegateInPlace","p1","p2","DotWith","other","normalize","len","Multiply","Direction","atan2","AddWith","nx","ny","splitArgs","MultWith","undefined","splitArgsOrSingle","SubtractWith","DivideWith","Equals","src","a","b","sy","p","min","max","pts","t","length","add","Bezier","slice","rotate","theta","fromAngle","areNeighbors","pol1","polygons","pol2","arePolysTouching","pt2","i","line","j","otherLine","Province","key","json","neighbors","owner","supply","type","name","abbr","svgData","data","svgPath","split","svgMode","svgRelative","polygon","component","toUpperCase","push","lastPt","pt","parsed","parseFloat","isNaN","console","log","maxX","minX","maxY","minY","poly","midpoint","map","mapJson","provinces","Object","keys","province","key2","connect","indexOf","DiploComponent","selProvince","setSelection","className","viewBox","fill","stroke","d","onClick","fontSize","style","pointerEvents","fromPt","n","x1","y1","x2","y2"],"sourceRoot":""}