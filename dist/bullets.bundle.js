"use strict";(self.webpackChunktrading_game=self.webpackChunktrading_game||[]).push([[179],{7172:(t,i,e)=>{e.r(i),e.d(i,{default:()=>ht});var s=e(127);const n=1e3,r=800;var o=e(7604),h=e(5901),a=e(3486);const l=e.p+"12a4e8650485f6c9e051cf30dfcfc746.png",c=e.p+"099f5ee348a27002555007bd55523f94.png",u=e.p+"4491ebbcec40a56c8cb02c9b36b8f12a.png";var g=e(8785),d=e(2909);class p{constructor(t){this.sprites=t,this.position=new g.Z(0,0),this.velocity=new g.Z(0,0),this.angularVelocity=0,this.rotation=0,this.engineDeflect=0,this.tgtDeflect=0}tick(t){t.isKeyDown("w")?this.isEngineOn=!0:this.isEngineOn=!1,t.isKeyDown("a")?this.tgtDeflect=1:t.isKeyDown("d")?this.tgtDeflect=-1:this.tgtDeflect=0,this.tgtDeflect>=this.engineDeflect?this.engineDeflect=Math.min(this.engineDeflect+.06,this.tgtDeflect):this.engineDeflect=Math.max(this.engineDeflect-.06,this.tgtDeflect);const i=Math.atan2(this.velocity.y,this.velocity.x),e=d.Z.relativeAngle(this.rotation,i),s=e/Math.PI;this.angularVelocity*=.98,this.angularVelocity-=.002*this.tgtDeflect+.004*this.engineDeflect*(this.isEngineOn?1:0),this.rotation+=this.angularVelocity;const n=.998*(1-Math.abs(s))+.99*Math.abs(s);this.velocity.multWith(n,n),this.isEngineOn&&(this.velocity.x+=.2*Math.cos(this.rotation),this.velocity.y+=.2*Math.sin(this.rotation));let r=this.velocity.length(),o=this.velocity.direction();r>=20&&(r=20);let h=Math.sin(e);h*=Math.min(r/120,1),h*=.003,o+=h,this.velocity.x=Math.cos(o)*r,this.velocity.y=Math.sin(o)*r,this.position.addWith(this.velocity)}render(t){t.save(),(0,h.ei)(t,this.position.x,this.position.y,4,8,this.rotation+Math.PI/2),this.isEngineOn&&this.sprites.rotrender(t,4,11,8,16,Math.floor(4*Math.random()),1,this.engineDeflect*Math.PI/4,4,2),this.tgtDeflect>0?this.sprites.rotrender(t,7,4,8,16,Math.floor(2*Math.random()),2,0,3,4):this.tgtDeflect<0&&this.sprites.rotrender(t,1,4,8,16,2+Math.floor(2*Math.random()),2,0,6,4),this.sprites.render(t,0,0,8,16,0,0),t.restore()}}var f,m=e(6718);!function(t){t[t.ally=0]="ally",t[t.enemy=1]="enemy",t[t.neutral=2]="neutral"}(f||(f={}));class y{constructor(t,i){this.keys=i,this.Player=t,this.Entities={},this.Entities[f.neutral]=[],this.Entities[f.ally]=[],this.Entities[f.enemy]=[],this.Effects=[]}tick(){this.keys.update();for(let t=this.Effects.length-1;t>=0;t--)this.Effects[t].tick()&&this.Effects.splice(t,1);this.updateEntities(this.Entities[f.neutral]),this.updateEntities(this.Entities[f.ally]),this.updateEntities(this.Entities[f.enemy])}updateEntities(t){for(let i=t.length-1;i>=0;i--)t[i].tick(this.keys,this)||t.splice(i,1)}draw(t){this.drawEntities(t,this.Entities[f.neutral]),this.drawEntities(t,this.Entities[f.ally]),this.drawEntities(t,this.Entities[f.enemy]);for(let i=0;i<this.Effects.length;i++)this.Effects[i].draw(t)}drawEntities(t,i){for(let e=i.length-1;e>=0;e--)i[e].render(t)}findNearestShips(t,i,e){let s=(void 0===i?[...this.Entities[f.ally],...this.Entities[f.enemy],...this.Entities[f.neutral]]:this.Entities[i]).filter((t=>void 0!==t.currentHp));if(void 0!==e){const i=e*e;s=s.filter((e=>g.Z.subtract(e.position,t).lengthSq()<=i))}const n=s.map((i=>({ship:i,range:g.Z.subtract(i.position,t).lengthSq()})));return n.sort(((t,i)=>t.range-i.range)),n.map((t=>t.ship))}}var x=e(9444);class w{constructor(t,i,e,s,n){this.position=t,this.outerRadius=i,this.innerRadius=e,this.fillColor=s,this.timing=new x.Yw(n)}tick(){return this.timing.tick()}draw(t){const i=this.timing.sample(this.outerRadius),e=this.timing.sample(this.innerRadius),s=this.timing.sample(this.fillColor);t.beginPath(),t.arc(this.position.x,this.position.y,i,0,2*Math.PI,!1),e>=0&&t.arc(this.position.x,this.position.y,e,0,2*Math.PI,!0),t.closePath(),t.fillStyle=s.toString(),t.fill()}}const v={linear:t=>t,clamp:t=>Math.max(Math.min(t,1),0),fastIn:b(0,.8,1),fastOut:b(0,.2,1)};function b(...t){return i=>M(i,t,0,t.length)}function M(t,i,e,s){return 1===s?i[e]:M(t,i,e,s-1)*(1-t)+M(t,i,e+1,s-1)*t}var A=e(3033),k=e(5803);class S{constructor(t,i,e,s,n,r,o){this.position=t,this.burstXVariance=i,this.burstYVariance=e,this.numBursts=s,this.burstDelay=n,this.burstLifetime=r,this.burstOuterRadius=o,this.currentBurstDelay=0,this.maxExplosionIndex=0;const h=Math.floor(s.GetValue(Math.random()));this.explosions=new Array(h),this.triggerExplosions()}triggerExplosions(){for(;0===this.currentBurstDelay&&this.maxExplosionIndex<this.explosions.length;)this.currentBurstDelay=this.burstDelay,this.spawnBurst()}spawnBurst(){const t=this.position.x+this.burstXVariance.GetValue(Math.random()),i=this.position.y+this.burstYVariance.GetValue(Math.random()),e=this.burstLifetime.GetValue(Math.random()),s=this.burstOuterRadius.GetValue(Math.random()),n=s/4;this.explosions[this.maxExplosionIndex++]=new w(new g.Z(t,i),new x.r7((0,k.M)(n,s),v.linear),new x.r7((0,k.M)(-n,s),v.fastOut),new x.r7((0,k.M)(A.I.rgb(1,1,.5),A.I.rgb(1,0,0),A.I.rgb(.2,.2,0)),v.linear),e)}tick(){let t=!1;for(let i=0;i<this.maxExplosionIndex;i++)null!==this.explosions[i]&&void 0!==this.explosions[i]&&(this.explosions[i].tick()?this.explosions[i]=null:t=!0);return this.currentBurstDelay--,0===this.currentBurstDelay&&this.triggerExplosions(),!t&&this.maxExplosionIndex===this.explosions.length}draw(t){for(let i=0;i<this.maxExplosionIndex;i++)null!==this.explosions[i]&&void 0!==this.explosions[i]&&this.explosions[i].draw(t)}}var D=e(3123),R=e(275);class T{static normalize(t){return(t%=2*Math.PI)<0&&(t+=2*Math.PI),t}static relativeNormalize(t){var i=T.normalize(t);return i>=Math.PI?i-2*Math.PI:i}static accuteAngle(t,i){return T.relativeNormalize(i-t)}static angleBetween(t,i){return Math.atan2(i.y-t.y,i.x-t.x)}}var Z,E=e(1331);class z{constructor(t,i){this.start=t,this.end=i}ray(){return g.Z.subtract(this.end,this.start)}midpoint(){return g.Z.interpolate(this.start,this.end,.5)}interpolate(t){return g.Z.interpolate(this.start,this.end,t)}static intersection(t,i){const e=(t.start.x-t.end.x)*(i.start.y-i.end.y)-(t.start.y-t.end.y)*(i.start.x-i.end.x);return 0===e?z.parallelIntersection(t,i):{percentA:((t.start.x-i.start.x)*(i.start.y-i.end.y)-(t.start.y-i.start.y)*(i.start.x-i.end.x))/e,percentB:((t.end.x-t.start.x)*(t.start.y-i.start.y)-(t.end.y-t.start.y)*(t.start.x-i.start.x))/e}}static parallelIntersection(t,i){const e=t.ray().normalize();function s(i){return g.Z.dot(g.Z.subtract(i,t.start),e)}let n=new E.e(s(t.start),s(t.end)),r=new E.e(s(i.start),s(i.end)),o=n.GetPercentage(r.min),h=n.GetPercentage(r.max);return Math.abs(o)<=Math.abs(h)?{percentA:o,percentB:0}:{percentA:h,percentB:1}}}class I{constructor(t,i,e,s){this.position=t,this.size=i,this.origin=e,this.rotation=s}getVertecies(){let t=[new g.Z(0,0),new g.Z(this.size.x,0),new g.Z(this.size.x,this.size.y),new g.Z(0,this.size.y)];return t=t.map((t=>g.Z.subtract(t,this.origin))),t=t.map((t=>{const i=Math.atan2(t.y,t.x),e=t.length();return g.Z.fromAngle(i+this.rotation,e)})),t=t.map((t=>g.Z.add(t,this.position))),t}getEdges(){return this.getVertecies().map(((t,i,e)=>new z(t,e[(i+1)%e.length])))}findLineIntersection(t){let i=this.getEdges(),e=null;for(let s=0;s<i.length;s++){let n=z.intersection(t,i[s]);n.percentA>=0&&n.percentA<1&&n.percentB>=0&&n.percentB<1&&(null===e||n.percentA<e)&&(e=n.percentA)}return e}}class P{constructor(t,i,e,s,n,r){this.definition=t,this.position=i,this.rotation=e,this.ai=s,this.team=n,this.weaponGroups=r,this.Velocity=0,this.lastAccel=this.lastDeccel=this.lastTurn=0,this.currentHp=this.definition.maxHp,this.flares=this.definition.flares.map((t=>t.clone()))}getBounds(){return new I(this.position,this.definition.size,g.Z.multiply(this.definition.origin,this.definition.size),this.rotation)}tick(t,i){const{tgtVel:e,tgtHeading:s}=this.ai.TickAI(i,this);let n=0;if(e<this.Velocity&&this.definition.maxDeccel>0){var r=this.Velocity-e;this.lastDeccel=Math.min(1,r/this.definition.maxDeccel),n=-this.lastDeccel,this.Velocity-=this.lastDeccel*this.definition.maxDeccel}else e>this.Velocity&&(r=e-this.Velocity,this.lastAccel=Math.min(1,r/this.definition.maxAccel),n=this.lastAccel,this.Velocity+=this.lastAccel*this.definition.maxAccel);for(let t=0;t<this.weaponGroups.length;t++)this.weaponGroups[t].tick(i,this);var o=T.accuteAngle(this.rotation,s),h=Math.sign(o);o=Math.abs(o),this.lastTurn=Math.min(o/this.definition.maxTurnRate,1)*h;for(let t=0;t<this.flares.length;t++)this.flares[t].tick(n,this.lastTurn);return this.rotation+=this.lastTurn*this.definition.maxTurnRate,this.Velocity>=0?this.Velocity=Math.min(this.Velocity,this.definition.maxSpeed):this.Velocity=Math.max(this.Velocity,-this.definition.maxSpeed),this.position.addWith(g.Z.fromAngle(this.rotation,this.Velocity)),this.currentHp>0}render(t){for(let i=0;i<this.flares.length;i++)this.flares[i].draw(t,this.position,this.definition.origin,this.definition.size,this.rotation);for(let i=0;i<this.weaponGroups.length;i++)this.weaponGroups[i].draw(t,this);this.definition.sprite.draw(t,this.position,this.definition.size,this.rotation),this.ai.debugDraw(t,this)}getTeam(){return this.team}}class q{constructor(t,i){this.queue=[t],void 0===i?this.scaleFactor=new g.Z(1,1):V(t)?this.scaleFactor=new g.Z(i.x/t.sourceSize.x,i.y/t.sourceSize.y):this.scaleFactor=new g.Z(i.x/t.source.sourceSize.x,i.y/t.source.sourceSize.y)}current(){return this.queue[0]}enqueueFront(t){this.queue.splice(0,0,t)}play(t){this.queue=[t]}enqueue(t){this.queue.push(t)}tick(){(V(this.queue[0])||this.queue[0].tick())&&this.advance()}advance(){this.queue.length>1&&this.queue.splice(0,1)}render(t,i,e){this.queue[0].draw(t,i,this.getRenderSize(this.queue[0]),e)}getRenderSize(t){return V(t)?g.Z.multiply(t.sourceSize,this.scaleFactor):g.Z.multiply(t.source.sourceSize,this.scaleFactor)}}function V(t){return void 0!==t.origin}function B(t){return new g.Z(t[0],t[1])}function K(t){return new E.e(t[0],t[1])}function O(t,i){return new R.Z(i[t.file],B(t.srcOffset),B(t.srcSize),B(t.origin),0)}function W(t,i){return i[t.file].getAnimation(B(t.imgOffset),B(t.frameSize),B(t.origin),t.numFrames)}class C{constructor(){this.effects=[]}spawnEffect(t,i,e){this.effects.push(function(t,i,e){switch(t.type){case"explosion":return new S(i,K(t.burstXVariance),K(t.burstYVariance),K(t.numBursts),t.burstDelay,K(t.burstLifetime),K(t.burstOuterRadius))}}(t,i))}tick(){for(let t=this.effects.length-1;t>=0;t--)this.effects[t].tick()&&this.effects.splice(t,1)}draw(t){for(let i=0;i<this.effects.length;i++)this.effects[i].draw(t)}}class L{constructor(t,i){this.args=t,this.turretAngle=0,this.actualAnchor=this.args.offset.clone(),this.actualAnchor.subtractWith(g.Z.multiply(i.origin,i.size)),void 0!==t.sprite&&(this.imgControl=new q(t.sprite)),this.effects=new C}getWeaponLocation(t){const i=this.actualAnchor.rotate(t.rotation);return i.addWith(t.position),i}getWeaponAnchorAngle(t){return this.args.rotation+t.rotation}getWeaponCurrentAngle(t){return this.turretAngle+this.getWeaponAnchorAngle(t)}tick(t,i){var e;this.effects.tick(),null===(e=this.imgControl)||void 0===e||e.tick();const s=this.getWeaponLocation(t);if(i=i.filter((t=>{const i=g.Z.subtract(t,s).lengthSq();return(void 0===this.args.minRange||i>this.args.minRange*this.args.minRange)&&i<this.args.range*this.args.range})),void 0===this.args.turret){if(0===i.length)return null;const e=this.getWeaponAnchorAngle(t);for(let s=0;s<i.length;s++){const n=g.Z.subtract(i[s],t.position).direction(),r=T.accuteAngle(e,n);if(Math.abs(r)<this.args.acquisitionAngle)return i[s]}return null}{if(0===i.length)return this.turretAngle>0?this.turretAngle-=Math.min(this.turretAngle,this.args.turret.turnRate):this.turretAngle<0&&(this.turretAngle+=Math.min(Math.abs(this.turretAngle),this.args.turret.turnRate)),null;const e=this.getWeaponAnchorAngle(t),s=this.getWeaponCurrentAngle(t);let n=null,r=0,o=0,h=0;for(let s=0;s<i.length;s++){const a=g.Z.subtract(i[s],t.position).direction(),l=T.accuteAngle(e,a);(null===n||Math.abs(l)<Math.abs(r))&&(n=i[s],r=l,Math.abs(l)>this.args.turret.maxAngle?(o=this.args.turret.maxAngle*Math.sign(l),h=a):o=h=a)}const a=T.accuteAngle(s,o);Math.abs(a)<this.args.turret.turnRate&&(this.turretAngle+=a);const l=this.getWeaponCurrentAngle(t),c=T.accuteAngle(l,h);return Math.abs(c)<this.args.acquisitionAngle?n:null}}shoot(t,i){void 0!==this.imgControl&&void 0!==this.args.shootAnimation&&(this.imgControl.enqueue(this.args.shootAnimation.animation.play(this.args.shootAnimation)),this.imgControl.enqueue(this.args.sprite)),void 0!==this.args.shootEffect&&this.effects.spawnEffect(this.args.shootEffect,this.getWeaponLocation(i),this.getWeaponCurrentAngle(i))}render(t,i){if(void 0===this.imgControl)return;const e=this.getWeaponLocation(i);let s=this.getWeaponCurrentAngle(i);this.imgControl.render(t,e,s),this.effects.draw(t)}}class F{constructor(t,i,e){this.timer=t,this.weapons=i,this.burstAllWeapons=null==e||e}acquireTargets(t,i){let e=0;for(let s=0;s<this.weapons.length;s++)null!==this.weapons[s].tick(t,i.map((t=>t.position)))&&e++;return e}tick(t,i){const e=t.findNearestShips(i.position,i.getTeam()===f.enemy?f.ally:f.enemy,this.weapons[0].args.range),s=this.acquireTargets(i,e);this.timer.tick(s>0,(e=>this.onShoot(e,t,i)))}onShoot(t,i,e){if(this.burstAllWeapons)for(let t=0;t<this.weapons.length;t++)this.weapons[t].shoot(i,e);else this.weapons[t%this.weapons.length].shoot(i,e)}draw(t,i){for(let e=0;e<this.weapons.length;e++)this.weapons[e].render(t,i)}}class H{constructor(t){Object.assign(this,t),this.currentlyShooting=!1,this.currentReload=this.currentBurstDelay=this.currentBurstIndex=0}isShooting(){return this.currentlyShooting}canShoot(){return!this.currentlyShooting&&0===this.currentReload}shoot(){return!!this.canShoot()&&(this.currentlyShooting=!0,this.currentReload=this.reloadTime,this.currentBurstDelay=0,!0)}tick(t,i){if(t&&this.shoot(),this.currentlyShooting)if(0===this.currentBurstDelay){for(let t=0;t<this.shotsPerBurst;t++)i(this.currentBurstIndex,t);this.currentBurstIndex++,this.currentBurstIndex===this.burstCount?(this.currentReload=this.reloadTime,this.currentBurstIndex=0,this.currentlyShooting=!1):this.currentBurstDelay=this.burstDelay}else this.currentBurstDelay--;else 0!==this.currentReload&&this.currentReload--}}class G{constructor(t,i,e,s,n,r,o,h,a,l,c,u,g,d){this.size=i,this.origin=n,this.maxHp=r,this.maxAccel=o,this.maxDeccel=h,this.maxSpeed=a,this.turnAccel=l,this.maxTurnRate=c,this.flares=u,this.weapons=g,this.buildAi=d,this.sprite=t.getSprite(e,s,n)}buildShip(t,i,e){return new P(this,i,null!=e?e:0,this.buildAi(),t,this.weapons.map((t=>new F(new H(t.timer),t.weapons.map((t=>new L(t,this))),t.burstAll))))}}!function(t){t.Accel="accel",t.Deccel="deccel",t.TurnLeft="turnLeft",t.TurnRight="turnRight"}(Z||(Z={}));class N{constructor(t,i,e,s,n,r){this.animation=t,this.offset=i,this.rotation=e,this.conditions="string"==typeof s?[s]:s,this.rotPerTurn=null!=r?r:0,this.minTrigger=null!=n?n:0,this.playing=t.play(30,!0),this.shouldRender=!1}clone(){return new N(this.animation,this.offset,this.rotation,this.conditions,this.minTrigger,this.rotPerTurn)}tick(t,i){this.shouldRender=!1;for(let e=0;e<this.conditions.length;e++)switch(this.conditions[e]){case Z.Accel:this.shouldRender=this.shouldRender||t>this.minTrigger;break;case Z.Deccel:this.shouldRender=this.shouldRender||t<-this.minTrigger;break;case Z.TurnLeft:this.shouldRender=this.shouldRender||i<-this.minTrigger;break;case Z.TurnRight:this.shouldRender=this.shouldRender||i>this.minTrigger}this.adjRot=i*this.rotPerTurn,this.shouldRender&&this.playing.tick()}draw(t,i,e,s,n){if(!this.shouldRender)return;let r=this.offset.clone();r.subtractWith(g.Z.multiply(e,s)),r=r.rotate(n),r.addWith(i);let o=this.adjRot+this.rotation+n;this.playing.draw(t,r,this.animation.sourceSize,o)}}class U{constructor(t,i,e){this.point=t,this.color=i,this.radius=e}draw(t){var i,e;t.strokeStyle=null!==(i=this.color)&&void 0!==i?i:"red",t.beginPath(),t.arc(this.point.x,this.point.y,null!==(e=this.radius)&&void 0!==e?e:10,0,2*Math.PI),t.stroke()}}class j{constructor(t,i,e){this.point=t,this.color=i,this.radius=e}draw(t){var i,e;const s=null!==(i=this.radius)&&void 0!==i?i:10;t.strokeStyle=null!==(e=this.color)&&void 0!==e?e:"red",t.beginPath(),t.moveTo(this.point.x-s,this.point.y-s),t.lineTo(this.point.x+s,this.point.y+s),t.moveTo(this.point.x+s,this.point.y-s),t.lineTo(this.point.x-s,this.point.y+s),t.stroke()}}class Y{constructor(t,i,e){this.point=t,this.color=i,this.radius=e}draw(t){var i,e;const s=null!==(i=this.radius)&&void 0!==i?i:10;t.strokeStyle=null!==(e=this.color)&&void 0!==e?e:"red",t.beginPath(),t.moveTo(this.point.x,this.point.y-s),t.lineTo(this.point.x,this.point.y+s),t.moveTo(this.point.x-s,this.point.y),t.lineTo(this.point.x+s,this.point.y),t.stroke()}}class X{constructor(t,i,e,s){this.point=t,this.direction=i,this.color=e,this.radius=s}draw(t){var i,e;t.strokeStyle=null!==(i=this.color)&&void 0!==i?i:"red",t.beginPath(),t.moveTo(this.point.x,this.point.y);const s=g.Z.add(this.point,g.Z.fromAngle(this.direction,null!==(e=this.radius)&&void 0!==e?e:50));t.lineTo(s.x,s.y),t.stroke()}}class _{constructor(t,i,e){this.point=t,this.point2=i,this.color=e}draw(t){var i;t.strokeStyle=null!==(i=this.color)&&void 0!==i?i:"red",t.beginPath(),t.moveTo(this.point.x,this.point.y),t.lineTo(this.point2.x,this.point2.y),t.stroke()}}class J{constructor(t){var i;this.markers=[],this.doDebug=null!==(i=null==t?void 0:t.debug)&&void 0!==i&&i}debug(t){this.doDebug&&this.markers.push(t)}debugPoint(t,i,e){this.debug(new U(t,i,e))}debugCross(t,i,e){this.debug(new j(t,i,e))}debugPlus(t,i,e){this.debug(new Y(t,i,e))}debugRay(t,i,e,s){this.debug(new X(t,i,e,s))}debugLine(t,i,e){this.debug(new _(t,i,e))}debugDraw(t,i){if(0!==this.markers.length){for(let i=0;i<this.markers.length;i++)this.markers[i].draw(t);this.markers=[]}}}const Q={minDistance:100,maxDistance:500,orbitSpeed:.5,debug:!1};class $ extends J{constructor(t){super(t),this.args=Object.assign(Object.assign({},Q),t)}TickAI(t,i){const e=t.Player.position,s=g.Z.subtract(e,i.position),n=i.rotation,r=s.direction(),o=[T.normalize(r-Math.PI/2),T.normalize(r+Math.PI/2)];if(s.lengthSq()<this.args.minDistance*this.args.minDistance){const t=[T.normalize(r-5*Math.PI/6),T.normalize(r+5*Math.PI/6)],s=this.args.minDistance;this.debugPoint(e,"orange",s);const o=t.map((t=>g.Z.add(i.position,g.Z.fromAngle(t,s))));for(let t=0;t<o.length;t++)this.debugLine(i.position,o[t]);const h=tt(n,o.map((t=>g.Z.subtract(t,i.position).direction())));return{tgtVel:i.definition.maxSpeed,tgtHeading:h}}if(s.lengthSq()>this.args.maxDistance*this.args.maxDistance){const t=(this.args.minDistance+this.args.maxDistance)/2;this.debugPoint(e,void 0,t);const s=o.map((i=>g.Z.add(e,g.Z.fromAngle(i,t))));for(let t=0;t<s.length;t++)this.debugPoint(s[t]);const r=tt(n,s.map((t=>g.Z.subtract(t,i.position).direction())));return{tgtVel:i.definition.maxSpeed,tgtHeading:r}}{this.debugPoint(e,"green",this.args.minDistance),this.debugPoint(e,"yellow",this.args.maxDistance);const t=tt(n,o);return{tgtVel:i.definition.maxSpeed*this.args.orbitSpeed,tgtHeading:t}}}}function tt(t,i){const e=i.map((i=>T.accuteAngle(t,i)));let s=e[0],n=i[0];for(let t=1;t<e.length;t++)Math.abs(e[t])<Math.abs(s)&&(s=e[t],n=i[t]);return n}class it extends J{constructor(){super()}TickAI(t,i){var e=t.findNearestShips(i.position,i.getTeam()===f.enemy?f.ally:f.enemy)[0];if(void 0===e)return{tgtHeading:0,tgtVel:0};const s=T.angleBetween(i.position,e.position),n=T.accuteAngle(i.rotation,s);return{tgtVel:(1-Math.max(0,Math.min(1,Math.abs(n)/Math.PI)))*i.definition.maxSpeed,tgtHeading:s}}}const et={fighter:t=>new it,broadside:t=>new $(null!=t?t:{})};function st(t,i){const e={};for(let s in t.animations)e[s]=W(t.animations[s],i);return t.ships.map((t=>function(t,i,e){const s=[];for(let n=0;n<t.flares.length;n++){const r=t.flares[n],o="string"==typeof r.animation?i[r.animation]:W(r.animation,e);s.push(new N(o,B(r.offset),r.rotation*Math.PI*2,r.condition,r.minTrigger,r.rotPerTurn))}const n=et[t.ai];return new G(e[t.sprite.file],B(t.size),B(t.sprite.srcOffset),B(t.sprite.srcSize),B(t.sprite.origin),t.hp,t.maxAccel,t.maxDeccel,t.maxSpeed,t.turnAccel,t.maxTurnSpeed,s,t.weaponGroups.map((i=>{var s;return function(t,i,e){return{timer:t.timer,weapons:t.weapons.map((t=>function(t,i,e){if(function(t){return void 0!==t.range}(t)){let i;return void 0!==t.sprite&&(i=O(t.sprite,e)),{offset:B(t.offset),sprite:i,rotation:t.rotation,turret:t.turret,acquisitionAngle:t.acquisitionAngle,minRange:t.minRange,range:t.range}}{const s=i[t.definition];let n;return void 0===s&&console.error("Weapon referenced def "+t.definition+" which could not be found"),void 0!==s.sprite&&(n=O(s.sprite,e)),{offset:B(t.offset),sprite:n,rotation:t.rotation,turret:s.turret,acquisitionAngle:s.acquisitionAngle,minRange:s.minRange,range:s.range}}}(t,i,e))),burstAll:t.burstAll}}(i,null!==(s=t.weaponDefinitions)&&void 0!==s?s:{},e)})),(()=>n(t.aiParams)))}(t,e,i)))}let nt,rt,ot;function ht(){const t=new s.Z,i=new a.V(8,16,l,t.registerAssetLoadCallback()),d=new R.R(c,t.registerAssetLoadCallback()),b=new R.R(u,t.registerAssetLoadCallback());nt={Ships:d,Flares:b},t.onAllFinished((()=>function(t){e.e(738).then(e.t.bind(e,5711,19)).then((i=>{console.log("Got shipDefinitions.json");const e=st(i,nt);!function(t,i){const e=document.getElementById("canvas"),s=e.getContext("2d");rt=new o.Z(e,s,n,r,!0,(()=>{})),(0,h.Ci)(s),ot=nt.Ships.getSprite(new g.Z(96,0),new g.Z(32,48),new g.Z(.5,1));const a=new m.Z(document.body,!1),l=new p(t),c=new y(l,a);c.Effects.push(new w(new g.Z(0,0),new x.r7((0,k.M)(0,30),v.linear),new x.r7((0,k.M)(-10,30),v.fastOut),new x.r7((0,k.M)(A.I.rgb(1,1,.5),A.I.rgb(1,0,0),A.I.rgb(.2,.2,0)),v.linear),120)),c.Effects.push(new S(new g.Z(100,0),new D.e6(-30,30),new D.e6(-30,30),new D.e6(30,30),4,new D.e6(20,40),new D.e6(20,60)));for(let t=0;t<i.length;t++){const e=t%2==0?f.enemy:f.ally;c.Entities[e].push(i[t].buildShip(e,new g.Z(-100*(t+1),0),Math.random()*Math.PI*2))}at(c,l,a,e,s)}(t,e)}))}(i)))}function at(t,i,e,s,o){e.update(),t.tick(),i.tick(e),function(t,i,e,s){(0,h.Ci)(s),s.fillStyle="black",s.fillRect(0,0,n,r),s.save();const o=g.Z.add(i.position,g.Z.multiply(i.velocity,10));s.translate(-(o.x-500),-(o.y-400)),s.fillStyle="gray";const a=400;for(let t=Math.floor((o.y-400)/a)*a;t<=Math.floor((o.y+400)/a)*a;t+=a)s.fillRect(o.x-500,t,n,3);for(let t=Math.floor((o.x-500)/a)*a;t<=Math.floor((o.x+500)/a)*a;t+=a)s.fillRect(t,o.y-400,3,r);i.render(s),t.draw(s),s.restore()}(t,i,0,o),requestAnimationFrame((()=>at(t,i,e,s,o)))}},3033:(t,i,e)=>{e.d(i,{I:()=>s});class s{constructor(t){t.h||t.s||t.v?(this.hsv=t,this.rgb=void 0):(this.rgb=t,this.hsv=void 0)}static rgb(t,i,e){return new s({r:t,g:i,b:e})}static hsv(t,i,e){return new s({h:t,s:i,v:e})}r(t){if(this.reqRgb(),void 0===t)return this.rgb.r;this.rgb.r=t,this.hsv=void 0}g(t){if(this.reqRgb(),void 0===t)return this.rgb.g;this.rgb.g=t,this.hsv=void 0}b(t){if(this.reqRgb(),void 0===t)return this.rgb.b;this.rgb.b=t,this.hsv=void 0}h(t){if(this.reqHsv(),void 0===t)return this.hsv.h;this.hsv.h=t,this.hsv=void 0}s(t){if(this.reqHsv(),void 0===t)return this.hsv.s;this.hsv.s=t,this.hsv=void 0}v(t){if(this.reqHsv(),void 0===t)return this.hsv.v;this.hsv.v=t,this.hsv=void 0}componentToRgb(t){const i=(t+6*this.hsv.h)%6;return this.hsv.v-this.hsv.v*this.hsv.s*Math.max(Math.min(i,4-i,1),0)}reqRgb(){void 0===this.rgb&&this.calcRgb()}calcRgb(){this.rgb={r:this.componentToRgb(5),g:this.componentToRgb(3),b:this.componentToRgb(1)}}reqHsv(){void 0===this.hsv&&this.calcHsv()}calcHsv(){const{r:t,g:i,b:e}=this.rgb,s=Math.max(t,i,e),n=Math.min(t,i,e);let r=s===n?0:s===t?(i-e)/(s-n):s===i?2+(e-t)/(s-n):4+(t-i)/(s-n);for(r/=6;r<0;)r++;this.hsv={h:r,s:s===n?0:(s-n)/s,v:s}}toString(){return this.reqRgb(),"rgb("+this.toByte(this.rgb.r)+", "+this.toByte(this.rgb.g)+", "+this.toByte(this.rgb.b)+")"}toByte(t){return Math.floor(255*t)}}},7475:(t,i,e)=>{e.d(i,{L:()=>n});var s=e(8785);class n{constructor(t,i,e,n,r){this.atlas=t,this.sourceOffset=i,this.sourceSize=e,this.numFrames=n,this.origin=null!=r?r:new s.Z(0,0)}static FromJson(t,i){return new n(t,new s.Z(i.sourceOffset[0],i.sourceOffset[1]),new s.Z(i.frameSize[0],i.frameSize[1]),i.numFrames,void 0===i.origin?void 0:new s.Z(i.origin[0],i.origin[1]))}draw(t,i,e,s,n){t.save(),t.translate(i.x,i.y),void 0!==n&&t.rotate(n),t.scale(e.x,e.y),t.translate(-this.origin.x,-this.origin.y),t.drawImage(this.atlas.image,this.sourceOffset.x+s*this.sourceSize.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),t.restore()}play(t,i){var e;return void 0!==t.animation?new r(this,t.maxTime,null!==(e=t.loop)&&void 0!==e&&e):new r(this,t,null!=i&&i)}}class r{constructor(t,i,e){this.source=t,this.maxTime=i,this.loop=e,this.currentTime=0}tick(){return this.currentTime++,!(this.currentTime<this.maxTime||(this.loop&&(this.currentTime=0),0))}draw(t,i,e,s){const n=Math.floor(this.currentTime*this.source.numFrames/this.maxTime);this.source.draw(t,i,e,n,s)}}},275:(t,i,e)=>{e.d(i,{R:()=>r,Z:()=>o});var s=e(8785),n=e(7475);class r{constructor(t,i){this.onload=i,this.image=document.createElement("img"),this.image.src=t,this.image.addEventListener("load",(()=>this.loadFinished()))}loadFinished(){this.onload()}getSprite(t,i,e,s){return new o(this,t,i,e,s)}getAnimation(t,i,e,s){return new n.L(this,t,i,s,e)}}class o{constructor(t,i,e,n,r){this.atlas=t,this.sourceOffset=i,this.sourceSize=e,this.origin=null!=n?n:new s.Z(0,0),this.sourceRotation=null!=r?r:0}draw(t,i,e,s){t.save(),t.translate(i.x,i.y),t.rotate((null!=s?s:0)+this.sourceRotation),t.scale(e.x,e.y),t.translate(-this.origin.x,-this.origin.y),t.drawImage(this.atlas.image,this.sourceOffset.x,this.sourceOffset.y,this.sourceSize.x,this.sourceSize.y,0,0,1,1),t.restore()}}},6718:(t,i,e)=>{e.d(i,{Z:()=>r});class s{constructor(t,i){this.keys=t,this.changes=i}isKeyDown(t){return-1!==this.keys.indexOf(t)}isKeyUp(t){return-1===this.keys.indexOf(t)}}class n{constructor(t,i){this.attachedElement=t,this.logKeyNames=i,void 0===this.logKeyNames&&(this.logKeyNames=!1),t.addEventListener("keydown",(t=>this.onKeyDown(t))),t.addEventListener("keyup",(t=>this.onKeyUp(t))),this.downKeys=[],this.changes=[]}onKeyDown(t){this.logKeyNames&&console.log(t.key),-1===this.downKeys.indexOf(t.key)&&(this.changes.push({key:t.key,change:"press"}),this.downKeys.push(t.key))}onKeyUp(t){this.changes.push({key:t.key,change:"release"});const i=this.downKeys.indexOf(t.key);this.downKeys.splice(i,1)}Update(){const t=this.downKeys,i=this.changes;return this.downKeys=t.slice(),this.changes=[],new s(t,i)}}class r{constructor(t,i){this.watcher=new n(t,i),this.prvState=this.currentState=this.watcher.Update()}update(){this.prvState=this.currentState,this.currentState=this.watcher.Update()}isKeyDown(t){return this.currentState.isKeyDown(t)}isKeyUp(t){return this.currentState.isKeyUp(t)}isKeyPressed(t){return this.currentState.isKeyDown(t)&&this.prvState.isKeyUp(t)}isKeyReleased(t){return this.currentState.isKeyUp(t)&&this.prvState.isKeyDown(t)}changes(){return this.currentState.changes}}},9444:(t,i,e)=>{e.d(i,{r7:()=>n,Yw:()=>r});var s=e(5803);class n{constructor(t,i){this.range=t,this.timingFunction=i}static linear(t,...i){return new n((0,s.M)(t,...i),(t=>t))}}class r{constructor(t){this.totalTime=t,this.elapsedTime=0}tick(){return this.elapsedTime++,this.elapsedTime>=this.totalTime}sample(t){return t.range.sample(t.timingFunction(this.elapsedTime/this.totalTime))}}},5803:(t,i,e)=>{e.d(i,{M:()=>o});var s=e(3033);const n=(t,i,e)=>t+(i-t)*e,r=(t,i,e)=>s.I.rgb(n(t.r(),i.r(),e),n(t.g(),i.g(),e),n(t.b(),i.b(),e));function o(t,...i){"function"!=typeof t&&(i.splice(0,0,t),t=void 0);let e=1/(i.length-1),s=new h(i[0],t);for(let t=1;t<i.length;t++)s.addKeyFrame(e*t,i[t]);return s}class h{constructor(t,i){if(void 0===i)if("number"==typeof t)this.interpolator=n;else{if(void 0===t.r)throw"No default interpolator found";this.interpolator=r}else this.interpolator=i;this.keys=[{time:0,value:t}]}addKeyFrame(t,i){for(let e=0;e<this.keys.length;e++)if(t<this.keys[e].time)return void this.keys.splice(e,0,{time:t,value:i});this.keys.push({time:t,value:i})}sample(t){if(1===this.keys.length)return this.keys[0].value;for(var i=0;this.keys[i+1].time<t&&i+2<this.keys.length;)i++;let e=this.keys[i+1].time-this.keys[i].time,s=(t-this.keys[i].time)/e;return this.interpolator(this.keys[i].value,this.keys[i+1].value,s)}}},2909:(t,i,e)=>{e.d(i,{Z:()=>n});const s=2*Math.PI;class n{static normalize(t){return(t%=s)<0&&(t+=s),t}static relativeNormalize(t){return(t%=s)>Math.PI?t-=s:t<-Math.PI&&(t+=s),t}static relativeAngle(t,i){return n.relativeNormalize(t-i)}}},8785:(t,i,e)=>{e.d(i,{Z:()=>s});class s{constructor(t,i){this.x=t,this.y=i}static zero(){return new s(0,0)}static fromAngle(t,i){return new s(Math.cos(t)*(null!=i?i:1),Math.sin(t)*(null!=i?i:1))}lengthSq(){return s.dot(this,this)}length(){return Math.sqrt(this.lengthSq())}clone(){return new s(this.x,this.y)}negate(){return new s(-this.x,-this.y)}negateInPlace(){return this.x=-this.x,this.y=-this.y,this}static dot(t,i){return t.x*i.x+t.y*i.y}dotWith(t){return s.dot(this,t)}normalize(){let t=this.length();return s.multiply(this,1/t)}direction(){return Math.atan2(this.y,this.x)}truncate(){return new s(Math.trunc(this.x),Math.trunc(this.y))}addWith(t,i){const{x:e,y:s}=n(t,i);return this.x+=e,this.y+=s,this}multWith(t,i){const{x:e,y:s}=function(t,i){return void 0===i?void 0!==t.x?{x:t.x,y:t.y}:{x:t,y:t}:{x:t,y:i}}(t,i);return this.x*=e,this.y*=s,this}subtractWith(t,i){const{x:e,y:s}=n(t,i);return this.x-=e,this.y-=s,this}divideWith(t,i){const{x:e,y:s}=n(t,i);return this.x/=e,this.y/=s,this}equals(t){return this.x===t.x&&this.y===t.y}static add(t,i,e){const{x:r,y:o}=n(i,e);return new s(t.x+r,t.y+o)}static subtract(t,i,e){const{x:r,y:o}=n(i,e);return new s(t.x-r,t.y-o)}static multiply(t,i,e){return void 0!==e?new s(t.x*i,t.y*e):void 0!==i.x?new s(t.x*i.x,t.y*i.y):new s(t.x*i,t.y*i)}static interpolate(t,i,e){return 0===e?t:1===e?i:new s(t.x+(i.x-t.x)*e,t.y+(i.y-t.y)*e)}static componentMin(t,i){return t.x<=i.x&&t.y<=i.y?t:i.x<=t.x&&i.y<=t.y?i:new s(Math.min(t.x,i.x),Math.min(t.y,i.y))}static componentMax(t,i){return t.x>=i.x&&t.y>=i.y?t:i.x>=t.x&&i.y>=t.y?i:new s(Math.max(t.x,i.x),Math.max(t.y,i.y))}static Bezier(t,i){return 1===t.length?t[0]:2===t.length?s.add(s.multiply(t[1],i),s.multiply(t[0],1-i)):s.add(s.multiply(s.Bezier(t.slice(1),i),i),s.multiply(s.Bezier(t.slice(0,t.length-1),i),1-i))}rotate(t){const i=Math.atan2(this.y,this.x),e=this.length();return s.fromAngle(i+t,e)}}function n(t,i){return void 0===i?{x:t.x,y:t.y}:{x:t,y:i}}}}]);
//# sourceMappingURL=bullets.bundle.js.map