"use strict";(self.webpackChunktrading_game=self.webpackChunktrading_game||[]).push([[53],{3033:(t,e,i)=>{i.d(e,{I:()=>s});class s{constructor(t){t.h||t.s||t.v?(this.hsv=t,this.rgb=void 0):(this.rgb=t,this.hsv=void 0)}static rgb(t,e,i){return new s({r:t,g:e,b:i})}static hsv(t,e,i){return new s({h:t,s:e,v:i})}r(t){if(this.reqRgb(),void 0===t)return this.rgb.r;this.rgb.r=t,this.hsv=void 0}g(t){if(this.reqRgb(),void 0===t)return this.rgb.g;this.rgb.g=t,this.hsv=void 0}b(t){if(this.reqRgb(),void 0===t)return this.rgb.b;this.rgb.b=t,this.hsv=void 0}h(t){if(this.reqHsv(),void 0===t)return this.hsv.h;this.hsv.h=t,this.hsv=void 0}s(t){if(this.reqHsv(),void 0===t)return this.hsv.s;this.hsv.s=t,this.hsv=void 0}v(t){if(this.reqHsv(),void 0===t)return this.hsv.v;this.hsv.v=t,this.hsv=void 0}componentToRgb(t){const e=(t+6*this.hsv.h)%6;return this.hsv.v-this.hsv.v*this.hsv.s*Math.max(Math.min(e,4-e,1),0)}reqRgb(){void 0===this.rgb&&this.calcRgb()}calcRgb(){this.rgb={r:this.componentToRgb(5),g:this.componentToRgb(3),b:this.componentToRgb(1)}}reqHsv(){void 0===this.hsv&&this.calcHsv()}calcHsv(){const{r:t,g:e,b:i}=this.rgb,s=Math.max(t,e,i),n=Math.min(t,e,i);let r=s===n?0:s===t?(e-i)/(s-n):s===e?2+(i-t)/(s-n):4+(t-e)/(s-n);for(r/=6;r<0;)r++;this.hsv={h:r,s:s===n?0:(s-n)/s,v:s}}toString(){return this.reqRgb(),"rgb("+this.toByte(this.rgb.r)+", "+this.toByte(this.rgb.g)+", "+this.toByte(this.rgb.b)+")"}toByte(t){return Math.floor(255*t)}}},6718:(t,e,i)=>{i.d(e,{Z:()=>r});class s{constructor(t,e){this.keys=t,this.changes=e}isKeyDown(t){return-1!==this.keys.indexOf(t)}isKeyUp(t){return-1===this.keys.indexOf(t)}}class n{constructor(t,e){this.attachedElement=t,this.logKeyNames=e,void 0===this.logKeyNames&&(this.logKeyNames=!1),t.addEventListener("keydown",(t=>this.onKeyDown(t))),t.addEventListener("keyup",(t=>this.onKeyUp(t))),this.downKeys=[],this.changes=[]}onKeyDown(t){this.logKeyNames&&console.log(t.key),-1===this.downKeys.indexOf(t.key)&&(this.changes.push({key:t.key,change:"press"}),this.downKeys.push(t.key))}onKeyUp(t){this.changes.push({key:t.key,change:"release"});const e=this.downKeys.indexOf(t.key);this.downKeys.splice(e,1)}Update(){const t=this.downKeys,e=this.changes;return this.downKeys=t.slice(),this.changes=[],new s(t,e)}}class r{constructor(t,e){this.watcher=new n(t,e),this.prvState=this.currentState=this.watcher.Update()}update(){this.prvState=this.currentState,this.currentState=this.watcher.Update()}isKeyDown(t){return this.currentState.isKeyDown(t)}isKeyUp(t){return this.currentState.isKeyUp(t)}isKeyPressed(t){return this.currentState.isKeyDown(t)&&this.prvState.isKeyUp(t)}isKeyReleased(t){return this.currentState.isKeyUp(t)&&this.prvState.isKeyDown(t)}changes(){return this.currentState.changes}}},9444:(t,e,i)=>{i.d(e,{r7:()=>n,Yw:()=>r});var s=i(5803);class n{constructor(t,e){this.range=t,this.timingFunction=e}static linear(t,...e){return new n((0,s.M)(t,...e),(t=>t))}}class r{constructor(t){this.totalTime=t,this.elapsedTime=0}tick(){return this.elapsedTime++,this.elapsedTime>=this.totalTime}sample(t){return t.range.sample(t.timingFunction(this.elapsedTime/this.totalTime))}}},5803:(t,e,i)=>{i.d(e,{M:()=>o});var s=i(3033);const n=(t,e,i)=>t+(e-t)*i,r=(t,e,i)=>s.I.rgb(n(t.r(),e.r(),i),n(t.g(),e.g(),i),n(t.b(),e.b(),i));function o(t,...e){"function"!=typeof t&&(e.splice(0,0,t),t=void 0);let i=1/(e.length-1),s=new a(e[0],t);for(let t=1;t<e.length;t++)s.addKeyFrame(i*t,e[t]);return s}class a{constructor(t,e){if(void 0===e)if("number"==typeof t)this.interpolator=n;else{if(void 0===t.r)throw"No default interpolator found";this.interpolator=r}else this.interpolator=e;this.keys=[{time:0,value:t}]}addKeyFrame(t,e){for(let i=0;i<this.keys.length;i++)if(t<this.keys[i].time)return void this.keys.splice(i,0,{time:t,value:e});this.keys.push({time:t,value:e})}sample(t){if(1===this.keys.length)return this.keys[0].value;for(var e=0;this.keys[e+1].time<t&&e+2<this.keys.length;)e++;let i=this.keys[e+1].time-this.keys[e].time,s=(t-this.keys[e].time)/i;return this.interpolator(this.keys[e].value,this.keys[e+1].value,s)}}},615:(t,e,i)=>{i.d(e,{Nm:()=>s,Dz:()=>o,jR:()=>a});var s,n=i(8785);!function(t){t[t.Up=0]="Up",t[t.UpRight=1]="UpRight",t[t.Right=2]="Right",t[t.DownRight=3]="DownRight",t[t.Down=4]="Down",t[t.DownLeft=5]="DownLeft",t[t.Left=6]="Left",t[t.UpLeft=7]="UpLeft"}(s||(s={}));const r=[new n.Z(0,-1),new n.Z(1,-1),new n.Z(1,0),new n.Z(1,1),new n.Z(0,1),new n.Z(-1,1),new n.Z(-1,0),new n.Z(-1,-1)],o=[s.Up,s.UpRight,s.Right,s.DownRight,s.Down,s.DownLeft,s.Left,s.UpLeft];function a(t){return r[t]}s.Up,s.Right,s.Down,s.Left,s.UpRight,s.DownRight,s.DownLeft,s.UpLeft},8785:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e){this.x=t,this.y=e}static zero(){return new s(0,0)}static fromAngle(t,e){return new s(Math.cos(t)*(null!=e?e:1),Math.sin(t)*(null!=e?e:1))}lengthSq(){return s.dot(this,this)}length(){return Math.sqrt(this.lengthSq())}clone(){return new s(this.x,this.y)}negate(){return new s(-this.x,-this.y)}negateInPlace(){return this.x=-this.x,this.y=-this.y,this}static dot(t,e){return t.x*e.x+t.y*e.y}dotWith(t){return s.dot(this,t)}normalize(){let t=this.length();return s.multiply(this,1/t)}direction(){return Math.atan2(this.y,this.x)}truncate(){return new s(Math.trunc(this.x),Math.trunc(this.y))}addWith(t,e){const{x:i,y:s}=n(t,e);return this.x+=i,this.y+=s,this}multWith(t,e){const{x:i,y:s}=function(t,e){return void 0===e?void 0!==t.x?{x:t.x,y:t.y}:{x:t,y:t}:{x:t,y:e}}(t,e);return this.x*=i,this.y*=s,this}subtractWith(t,e){const{x:i,y:s}=n(t,e);return this.x-=i,this.y-=s,this}divideWith(t,e){const{x:i,y:s}=n(t,e);return this.x/=i,this.y/=s,this}equals(t){return this.x===t.x&&this.y===t.y}static add(t,e,i){const{x:r,y:o}=n(e,i);return new s(t.x+r,t.y+o)}static subtract(t,e,i){const{x:r,y:o}=n(e,i);return new s(t.x-r,t.y-o)}static multiply(t,e,i){return void 0!==i?new s(t.x*e,t.y*i):void 0!==e.x?new s(t.x*e.x,t.y*e.y):new s(t.x*e,t.y*e)}static interpolate(t,e,i){return 0===i?t:1===i?e:new s(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)}static componentMin(t,e){return t.x<=e.x&&t.y<=e.y?t:e.x<=t.x&&e.y<=t.y?e:new s(Math.min(t.x,e.x),Math.min(t.y,e.y))}static componentMax(t,e){return t.x>=e.x&&t.y>=e.y?t:e.x>=t.x&&e.y>=t.y?e:new s(Math.max(t.x,e.x),Math.max(t.y,e.y))}static Bezier(t,e){return 1===t.length?t[0]:2===t.length?s.add(s.multiply(t[1],e),s.multiply(t[0],1-e)):s.add(s.multiply(s.Bezier(t.slice(1),e),e),s.multiply(s.Bezier(t.slice(0,t.length-1),e),1-e))}rotate(t){const e=Math.atan2(this.y,this.x),i=this.length();return s.fromAngle(e+t,i)}}function n(t,e){return void 0===e?{x:t.x,y:t.y}:{x:t,y:e}}},5907:(t,e,i)=>{i.d(e,{Z:()=>r});var s=i(8785),n=i(615);class r{constructor(t,e,i,s){this.x=t,this.y=e,this.w=i,this.h=s}shift(t,e){return void 0===e?new r(this.x+t.x,this.y+t.y,this.w,this.h):new r(this.x+t,this.y+e,this.w,this.h)}shiftBy(t,e){void 0===e?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+=e)}edge(t){switch(t){case n.Nm.Up:return this.y;case n.Nm.Down:return this.y+this.h;case n.Nm.Left:return this.x;case n.Nm.Right:return this.x+this.w}}corner(t){switch(t){case n.Nm.UpRight:case n.Nm.DownRight:case n.Nm.DownLeft:case n.Nm.UpLeft:return new s.Z(this.x,this.y)}}equals(t){return t.x===this.x&&t.y===this.y&&t.w===this.w&&t.h===this.h}}},19:(t,e,i)=>{i.r(e),i.d(e,{default:()=>Kt});var s=i(7363),n=i(127),r=i(5901),o=i(7604),a=i(6718),h=i(8785);const l=32,c=32,u=new h.Z(16,24),d=(new h.Z(l,c),new h.Z(16,16)),p=416,g=new h.Z(192,192),w=new h.Z(-2,4);var m=i(3486);const y=i.p+"d4f5110b87c0d1ad71ce32f04ca66ca6.png",f=i.p+"b5124a83d98bc334e6e3de5f7e27e05f.png",Z=i.p+"b78374db2fae35ea358c6a9e2b27ccd6.png",x=i.p+"32e154daf23aa2143678fc17a3bf88d3.png",v=i.p+"03a3f451813fb76552aa69688d48cdef.png";var b=i(5922);class k{constructor(t,e,i){this.source=t,this.sourceBounds=e,this.origin=null!=i?i:new h.Z(0,0)}getSprite(){return this}getPixelSize(){return new h.Z(this.sourceBounds.w,this.sourceBounds.h)}getRenderable(){return this}width(){return this.sourceBounds.w}height(){return this.sourceBounds.h}tick(){return!1}draw(t,e,i){const s=t.getTransform();(0,r.ei)(t,e.x,e.y,this.origin.x,this.origin.y,i),t.drawImage(this.source,this.sourceBounds.x,this.sourceBounds.y,this.sourceBounds.w,this.sourceBounds.h,0,0,e.w,e.h),t.setTransform(s)}}var M,A=i(5907);!function(t){t[t.Right=0]="Right",t[t.DownRight=1]="DownRight",t[t.DownLeft=2]="DownLeft",t[t.Left=3]="Left",t[t.UpLeft=4]="UpLeft",t[t.UpRight=5]="UpRight"}(M||(M={}));const R=[M.Right,M.DownRight,M.DownLeft,M.Left,M.UpLeft,M.UpRight];class I{static ToAngle(t){return Math.PI*t/3-Math.PI/2}static ToPoint(t){switch(t){case M.Right:return new h.Z(1,0);case M.DownRight:return new h.Z(0,1);case M.DownLeft:return new h.Z(-1,1);case M.Left:return new h.Z(-1,0);case M.UpLeft:return new h.Z(0,-1);case M.UpRight:return new h.Z(1,-1)}}static FromPoint(t){return t.x>0&&0===t.y?M.Right:t.x<0&&0===t.y?M.Left:0===t.x&&t.y>0?M.DownRight:0===t.x&&t.y<0?M.UpLeft:t.x>0&&t.x===-t.y?M.UpRight:t.x<0&&t.x===-t.y?M.DownLeft:void 0}static Turn(t,e){return((t+e)%6+6)%6}}function S(t,e){for(let i=0;i<(null!=e?e:1);i++)t=new h.Z(-t.y,t.x+t.y);return t}function L(t,e){for(let i=0;i<(null!=e?e:1);i++)t=new h.Z(t.x+t.y,-t.x);return t}function T(t){return h.Z.add(h.Z.multiply(u,t.y),32*t.x+g.x,g.y)}function D(t){return Math.sign(t.x)===-Math.sign(t.y)?Math.max(Math.abs(t.x),Math.abs(t.y)):Math.abs(t.x)+Math.abs(t.y)}function P(t){if(0===t)return[new h.Z(0,0)];const e=[];let i=new h.Z(0,-t);for(var s=M.Right;s<=M.UpRight;s++)for(var n=I.ToPoint(s),r=0;r<t;r++)e.push(i),i=h.Z.add(i,n);return e}const q=new h.Z(8,26);class U{constructor(t){this.emptyHpImage=new k(t.image,new A.Z(0,0,4,5)),this.redHpImage=new k(t.image,new A.Z(3,0,4,5)),this.yellowHpImage=new k(t.image,new A.Z(6,0,4,5)),this.blueHpImage=new k(t.image,new A.Z(9,0,4,5))}draw(t,e,i,s){const n=Math.ceil(s/5);let r=s%5;0===r&&(r=5);const o=i<=s/4?this.redHpImage:i<=s/2?this.yellowHpImage:this.blueHpImage,a=this.emptyHpImage;let l=h.Z.add(T(e),q);for(let e=0;e<n-1;e++){const s=-2*(n-e-1);for(let e=0;e<5;e++){let n=i<=0?a:o;i--,n.draw(t,new A.Z(l.x+3*e,l.y+s,4,5),0)}}const c=3*(5-r)/2;for(let e=0;e<r;e++){let s=i<=0?a:o;i--,s.draw(t,new A.Z(l.x+3*e+c,l.y,4,5),0)}}}class F{constructor(t,e,i,s,n,r,o){this.source=t,this.firstFrame=e,this.origin=i,this.frameAdvance=s,this.numFrames=n,this.duration=r,this.loop=o}getPixelSize(){return new h.Z(this.firstFrame.w,this.firstFrame.y)}getRenderable(){return new E(this,this.loop)}getSprite(t){const e=new A.Z(this.firstFrame.x+t*this.frameAdvance.x,this.firstFrame.y+t*this.frameAdvance.y,this.firstFrame.w,this.firstFrame.h);return new k(this.source,e,this.origin)}}class E{constructor(t,e,i){this.source=t,this.loop=e,this.overrideDuration=i,this.duration=null!=i?i:t.duration,this.currentTick=0}tick(){return this.currentTick++,this.currentTick===this.duration&&(this.loop&&(this.currentTick=0),!0)}getSprite(){const t=this.currentTick*this.source.numFrames/this.duration;return this.source.getSprite(Math.floor(t))}draw(t,e,i){this.getSprite().draw(t,e,i)}}var B=i(9444);class C{constructor(t,e,i,s){this.entity=t,this.motion=e,this.target=i,this.duration=s,this.timer=new B.Yw(s)}tick(){return this.timer.tick()?(this.entity.position=this.target,!0):(this.entity.position=this.timer.sample(this.motion),!1)}draw(t){}}class K{constructor(t,e,i,s){this.renderable=t,this.bounds=e,this.fixedDuraiton=s,this.rotation=null!=i?i:0}tick(){return void 0!==this.fixedDuraiton?(this.fixedDuraiton--,-1===this.fixedDuraiton||(this.renderable.tick(),!1)):this.renderable.tick()}draw(t){this.renderable.draw(t,this.bounds,this.rotation)}}class _{constructor(t){this.steps=t}tick(){if(0===this.steps.length)return!0;for(;this.steps[0].tick();)if(this.steps.shift(),0===this.steps.length)return!0;return!1}draw(t){this.steps[0].draw(t)}}class z{constructor(t,e,i,s,n){this.renderable=t,this.size=e,this.fromPixel=i,this.toPixel=s,this.duration=n,this.angle=Math.atan2(s.y-i.y,s.x-i.x),this.time=0}tick(){return this.time++,this.time>=this.duration}draw(t){const e=h.Z.interpolate(this.fromPixel,this.toPixel,this.time/this.duration),i=new A.Z(e.x,e.y,this.size.x,this.size.y);this.renderable.draw(t,i,this.angle)}}function H(t,e,i,s,n){const r=T(i),o=new z(t,t.getPixelSize(),h.Z.add(T(e),d),h.Z.add(r,d),s);if(null!==n){const t=new K(n.getRenderable(),new A.Z(r.x,r.y,l,c),0);return new _([o,t])}return o}class N{constructor(t,e,i,s,n,r,o,a,h){this.attacker=t,this.target=e,this.affectedTiles=i,this.damage=s,this.bumpAnimation=n,this.impactAnimation=r,this.projectile=o,this.ignoreEnemies=a,this.ignorePlayer=h,this.startPoint=t.position}static basicAttack(t,e,i){return new N(t,e.position,[e.position],i,!0,null,null)}static animationAttack(t,e,i,s,n){return new N(t,e.position,[e.position],i,null!=n&&n,s,null)}static projectileAttack(t,e,i,s,n){return new N(t,e.position,[e.position],i,!1,null!=n?n:null,s)}getAffectedTiles(t){return[{damage:this.damage,positions:this.affectedTiles,ignorePlayer:this.ignorePlayer,ignoreEnemies:this.ignoreEnemies}]}toAnimations(){let t=[];if(this.bumpAnimation&&t.push(new C(this.attacker,B.r7.linear(h.Z.interpolate,this.attacker.position,h.Z.interpolate(this.attacker.position,this.target,.5),this.attacker.position),this.attacker.position,10*D(h.Z.subtract(this.startPoint,this.target)))),this.projectile){const t=6*D(h.Z.subtract(this.startPoint,this.target));return[H(this.projectile,this.startPoint,this.target,t,this.impactAnimation)]}if(this.impactAnimation){const e=T(this.target);t.push(new K(this.impactAnimation.getRenderable(),new A.Z(e.x,e.y,l,c)))}return t}}class V{constructor(t){this.position=t}static IsPlayer(t){return void 0!==t.primary}}class O extends V{draw(t){const e=T(this.position),i=new A.Z(e.x,e.y,l,c);this.getRenderable().draw(t,i,0)}}class j extends O{}class X extends j{constructor(t){super(t),this.hp=this.maxHp=1,this.isFlying=!1,this.goldValue=1}static onAssetsLoaded(t){X.sprite=new k(t.tiles.image,new A.Z(0,320,l,c))}getAttacks(t){const e=t.player.position;return 1===D(h.Z.subtract(e,this.position))?[N.basicAttack(this,t.player,1)]:[]}getMove(t,e,i){if(e.length>0)return this.position;const s=P(1).map((t=>h.Z.add(this.position,t)));let n=[],r=99;for(let e=0;e<s.length;e++){if(i.some((t=>t.equals(s[e]))))continue;if(!t.isValidMoveIgnoreEnemies(s[e],!1))continue;const o=D(h.Z.subtract(t.player.position,s[e]));o<r?(r=o,n=[s[e]]):o===r&&n.push(s[e])}return 0===n.length?this.position:n[Math.floor(Math.random()*n.length)]}getRenderable(){return X.sprite}}class W extends j{constructor(t){super(t),this.hp=this.maxHp=1,this.isFlying=!1,this.isAfraid=!1,this.goldValue=3}static onAssetsLoaded(t){W.sprite=new k(t.tiles.image,new A.Z(l,320,l,c)),W.fearsprite=new k(t.tiles.image,new A.Z(l,352,l,c)),W.projectileSprite=new k(t.tiles.image,new A.Z(178,96,14,4),new h.Z(7,2)),W.impactAnimation=t.getImpactAnimation(1)}getAttacks(t){const e=t.player.position,i=D(h.Z.subtract(e,this.position));if(i>1&&i<=5){let i=h.Z.subtract(e,this.position);if(0===i.x||0===i.y||i.x===-i.y){let s=new h.Z(Math.sign(i.x),Math.sign(i.y)),n=h.Z.add(s,this.position);for(;!n.equals(e);){if(void 0!==t.entityAt(n))return[];n=h.Z.add(s,n)}return[N.projectileAttack(this,t.player,1,W.projectileSprite,W.impactAnimation)]}}return[]}getMove(t,e,i){if(e.length>0)return this.isAfraid=!1,this.position;let s=h.Z.subtract(t.player.position,this.position);if(1===D(s)){this.isAfraid=!0;let e=h.Z.subtract(this.position,s);return t.isValidMoveIgnoreEnemies(e,!1)&&!i.some((t=>t.equals(e)))?e:this.position}this.isAfraid=!1;const n=P(1).map((t=>h.Z.add(this.position,t)));let r=[],o=99;for(let e=0;e<n.length;e++){if(!t.isValidMoveIgnoreEnemies(n[e],!1))continue;if(i.some((t=>t.equals(n[e]))))continue;const s=D(h.Z.subtract(t.player.position,n[e]));1!==s&&(s<o?(o=s,r=[n[e]]):s===o&&r.push(n[e]))}return 0===r.length?this.position:r[Math.floor(Math.random()*r.length)]}getRenderable(){return this.isAfraid?W.fearsprite:W.sprite}}class G extends j{constructor(t){super(t),this.hp=this.maxHp=1,this.isFlying=!1,this.goldValue=5}static onAssetsLoaded(t){G.sprite=new k(t.tiles.image,new A.Z(64,320,l,c)),G.cooldownsprite=new k(t.tiles.image,new A.Z(64,352,l,c)),G.projectileSprite=new k(t.tiles.image,new A.Z(178,100,14,4),new h.Z(7,2)),G.impactAnimation=t.getImpactAnimation(2)}getAttacks(t){if(this.attackOnCooldown)return[];const e=t.player.position;if(D(h.Z.subtract(e,this.position))<=5){let i=h.Z.subtract(e,this.position);if(0===i.x||0===i.y||i.x===-i.y){let s=new h.Z(Math.sign(i.x),Math.sign(i.y)),n=h.Z.add(s,this.position);for(;!n.equals(e);){if(void 0!==t.entityAt(n))return[];n=h.Z.add(s,n)}return this.attackOnCooldown=!0,[N.projectileAttack(this,t.player,1,G.projectileSprite,G.impactAnimation)]}}return[]}getMove(t,e,i){if(e.length>0)return this.position;if(this.attackOnCooldown)return this.attackOnCooldown=!1,this.position;const s=P(1).map((t=>h.Z.add(this.position,t)));let n=[],r=99;for(let e=0;e<s.length;e++){if(!t.isValidMoveIgnoreEnemies(s[e],!1))continue;if(i.some((t=>t.equals(s[e]))))continue;const o=D(h.Z.subtract(t.player.position,s[e]));o<r?(r=o,n=[s[e]]):o===r&&n.push(s[e])}return 0===n.length?this.position:n[Math.floor(Math.random()*n.length)]}getRenderable(){return this.attackOnCooldown?G.cooldownsprite:G.sprite}}class Y{constructor(t,e){this.source=t,this.delta=e}tick(){return this.source.tick()}draw(t,e,i){this.source.draw(t,new A.Z(e.x+this.delta.x*e.w,e.y+this.delta.y*e.h,e.w*this.delta.w,e.h*this.delta.h),i)}}class J{constructor(t,e){this.inner=t,this.delay=e}tick(){return 0===this.delay?this.inner.tick():(this.delay--,!1)}draw(t){if(0===this.delay)return this.inner.draw(t)}}class Q{constructor(t){this.steps=t}tick(){for(let t=this.steps.length-1;t>=0;t--)this.steps[t].tick()&&this.steps.splice(t,1);return 0===this.steps.length}draw(t){for(const e of this.steps)e.draw(t)}}class ${constructor(t,e,i,s,n,r){this.point=t,this.rings=e,this.delayPerRadius=i,this.animationSource=s,this.ignoreEnemies=n,this.ignorePlayer=r}getAffectedTiles(t){return this.rings.map((e=>({damage:e.damage,positions:P(e.radius).map((t=>h.Z.add(t,this.point))).filter((e=>t.tiles.isInBounds(e.x,e.y))),ignoreEnemies:this.ignoreEnemies,ignorePlayer:this.ignorePlayer})))}toAnimations(t){const e=[];for(const i of this.rings){const s=P(i.radius).map((t=>h.Z.add(t,this.point))).filter((e=>t.tiles.isInBounds(e.x,e.y)));e.push(new J(new Q(s.map((t=>new K(this.animationSource.getRenderable(),new A.Z(T(t).x,T(t).y,l,c))))),i.radius*this.delayPerRadius))}return[new Q(e)]}}class tt extends j{constructor(t){super(t),this.hp=this.maxHp=12,this.isFlying=!1,this.turnSequenceIndex=Math.floor(Math.random()*tt.turnSequence.length),this.lastTurn=tt.turnSequence[0===this.turnSequenceIndex?tt.turnSequence.length-1:this.turnSequenceIndex-1],this.goldValue=15}static onAssetsLoaded(t){tt.renderable=new Y(new k(t.tiles.image,new A.Z(224,320,l,64)),new A.Z(0,-1,1,2)),tt.bigAttackPrepImage=new Y(new k(t.tiles.image,new A.Z(256,320,l,64)),new A.Z(0,-1,1,2)),this.radialSmashAnimation=t.getImpactAnimation(3)}getAttacks(t){switch(tt.turnSequence[this.turnSequenceIndex]){case"move":const e=t.player.position;return 1===D(h.Z.subtract(e,this.position))?[N.basicAttack(this,t.player,3)]:[];case"skip":case"smashPrep":default:return[];case"smash":return[new $(this.position,[{radius:1,damage:3},{radius:2,damage:1}],8,tt.radialSmashAnimation,!0)]}}getMove(t,e,i){const s=tt.turnSequence[this.turnSequenceIndex];switch(this.turnSequenceIndex=(this.turnSequenceIndex+1)%tt.turnSequence.length,this.lastTurn=s,s){case"move":return e.length>0?this.position:this.internalGetMove(t,i);case"smash":return this.internalGetMove(t,i);default:return this.position}}internalGetMove(t,e){const i=P(1).map((t=>h.Z.add(this.position,t)));let s=[],n=99;for(let r=0;r<i.length;r++){if(!t.isValidMoveIgnoreEnemies(i[r],!1))continue;if(e.some((t=>t.equals(i[r]))))continue;const o=D(h.Z.subtract(t.player.position,i[r]));o<n?(n=o,s=[i[r]]):o===n&&s.push(i[r])}return 0===s.length?this.position:s[Math.floor(Math.random()*s.length)]}getRenderable(){return"smashPrep"===this.lastTurn?tt.bigAttackPrepImage:tt.renderable}}tt.turnSequence=["move","move","skip","move","smashPrep","smash"];class et{constructor(t,e,i){this.source=t,this.offset=e,this.rotation=i}tick(){return this.source.tick()}draw(t,e,i){var s;this.source.draw(t,e.shift(this.offset.x,this.offset.y),i+(null!==(s=null==this?void 0:this.rotation)&&void 0!==s?s:0))}}class it{constructor(t,e,i,s){this.point=t,this.infos=e,this.delayPerDist=i,this.animationSource=s}getAffectedTiles(t){return this.infos}toAnimations(t){const e=this.infos.reduce(((t,e)=>t.concat(e.positions)),[]);return[new Q(e.map((t=>{const e=D(h.Z.subtract(t,this.point)),i=this.delayPerDist*e,s=T(t);return new J(new K(this.animationSource.getRenderable(),new A.Z(s.x,s.y,l,c)),i)})))]}}class st extends j{constructor(t){super(t),this.hp=this.maxHp=3,this.isFlying=!0,this.prepFire=void 0,this.goldValue=5}static onAssetsLoaded(t){st.sprite=new k(t.tiles.image,new A.Z(128,320,l,c),new h.Z(16,16)),st.impactAnimation=t.getImpactAnimation(2)}getAttacks(t){if(void 0!==this.prepFire){const e=[],i=I.ToPoint(this.prepFire);let s=h.Z.add(this.position,i);for(let n=0;n<5&&t.tiles.isInBounds(s.x,s.y);n++)e.push(s),s=h.Z.add(s,i);return this.prepFire=void 0,[new it(this.position,[{damage:1,positions:e}],4,st.impactAnimation)]}const e=t.player.position;if(D(h.Z.subtract(e,this.position))<=5){let t=h.Z.subtract(e,this.position);this.prepFire=I.FromPoint(t)}return[]}getMove(t,e,i){if(e.length>0||void 0!==this.prepFire)return this.position;const s=P(1).map((t=>h.Z.add(this.position,t)));let n=[],r=99;for(let e=0;e<s.length;e++){if(!t.isValidMoveIgnoreEnemies(s[e],!0))continue;if(i.some((t=>t.equals(s[e]))))continue;const o=D(h.Z.subtract(t.player.position,s[e]));1!==o&&(o<r?(r=o,n=[s[e]]):o===r&&n.push(s[e]))}return r>D(h.Z.subtract(t.player.position,this.position))||0===n.length?this.position:n[Math.floor(Math.random()*n.length)]}getRenderable(){return void 0!==this.prepFire?new et(st.sprite,new h.Z(16,16),I.ToAngle(this.prepFire)):new et(st.sprite,new h.Z(16,16))}}class nt{constructor(t){this.tiles=new m.V(32,32,y,t.registerAssetLoadCallback()),this.floor_and_digits=new b.Z(f,t.registerAssetLoadCallback()),this.hpImage=new b.Z(Z,t.registerAssetLoadCallback()),this.impacts=new b.Z(x,t.registerAssetLoadCallback()),this.lavaLayers=new m.V(32,32,v,t.registerAssetLoadCallback())}getImpactAnimation(t){return new F(this.impacts.image,new A.Z(0,32*t,32,32),new h.Z(0,0),new h.Z(32,0),8,16,!1)}onLoadFinished(){this.hpRenderer=new U(this.hpImage),X.onAssetsLoaded(this),W.onAssetsLoaded(this),G.onAssetsLoaded(this),tt.onAssetsLoaded(this),st.onAssetsLoaded(this)}getDigitSprite(t,e){return new k(this.floor_and_digits.image,new A.Z(41+7*t,13*(null!=e?e:0),7,13))}drawNumber(t,e,i,s){const n=i.toString().split("").map((t=>parseInt(t)));for(var r=0;r<n.length;r++)this.getDigitSprite(n[r],s).draw(t,new A.Z(e.x+7*r,e.y,7,13),0)}}class rt extends class{constructor(t,e,i){this.type=t,"primary"===this.type?(this.sprite=new k(e.tiles.image,new A.Z(i.x*l,i.y*c,16,c)),this.iconImage=new k(e.tiles.image,new A.Z(i.x*l+16,i.y*c,16,c))):(this.sprite=new k(e.tiles.image,new A.Z(i.x*l+16,i.y*c,16,c)),this.iconImage=new k(e.tiles.image,new A.Z(i.x*l,i.y*c,16,c)))}}{constructor(t,e,i,s,...n){super(t,e,i),this.beforeMove=s,this.attacks=n}getAttacks(t,e,i,s){const n=[],r=h.Z.subtract(s,i);for(const s of this.attacks){if(D(r)!==D(s.onMove))continue;const o=rt.getRotation(r,s.onMove);if(void 0!==o)for(const r of s.pattern){const a=h.Z.add(i,L(r,o)),l=s.attack(t,e,a);void 0!==l&&n.push(l)}}return n}enableAdditionalMoves(t,e){return[]}getBeforeMoveAttacks(t,e,i,s){return this.beforeMove?this.getAttacks(t,e,i,s):[]}getAfterMoveAttacks(t,e,i,s){return this.beforeMove?[]:this.getAttacks(t,e,i,s)}static getRotation(t,e){for(let i=0;i<6;i++){if(t.equals(e))return i;t=S(t)}}}class ot extends rt{constructor(t){super("primary",t,new h.Z(8,1),!0,{onMove:new h.Z(1,0),pattern:[new h.Z(0,-1),new h.Z(1,-1),new h.Z(-1,1),new h.Z(0,1)],attack:(t,e,i)=>this.getAttack(t,e,i)}),this.impactAnimation=t.getImpactAnimation(0)}getAttack(t,e,i){const s=t.entityAt(i);if(void 0!==s&&!V.IsPlayer(s))return N.animationAttack(e,s,1,this.impactAnimation,!1)}}class at extends rt{constructor(t){super("secondary",t,new h.Z(10,0),!0,{onMove:new h.Z(1,0),pattern:[new h.Z(1,-1),new h.Z(0,1)],attack:(t,e,i)=>this.getAttack(t,e,i)})}getAttack(t,e,i){const s=t.entityAt(i);if(void 0!==s&&!V.IsPlayer(s))return N.basicAttack(e,s,1)}}class ht extends V{constructor(t,e){super(e),this.hpRenderer=t.hpRenderer,this.maxHp=this.hp=3,this.primary=new ot(t),this.secondary=new at(t),this.renderable=new k(t.tiles.image,new A.Z(256,0,l,c))}draw(t){const e=T(this.position),i=new A.Z(e.x,e.y,l,c);this.renderable.draw(t,i,0),this.primary.sprite.draw(t,new A.Z(i.x,i.y,i.w/2,i.h),0),this.secondary.sprite.draw(t,new A.Z(i.x+i.w/2,i.y,i.w/2,i.h),0),this.hpRenderer.draw(t,this.position,this.hp,this.maxHp)}}class lt{constructor(t,e,i,s){this.assets=t,this.enemies=[],this.changeFloor(i,s),this.regionId=0,this.player=new ht(t,w),this.gold=0,this.renderTickNumber=0}entityAt(t){return[this.player,...this.enemies].find((e=>e.position.equals(t)))}isValidMove(t,e){return!(!this.tiles.isInBounds(t.x,t.y)||!this.tiles.get(t).isPathable&&!e||t.equals(this.player.position)||this.enemies.some((e=>e.position.equals(t))))}isValidMoveIgnoreEnemies(t,e){return!(!this.tiles.isInBounds(t.x,t.y)||!this.tiles.get(t).isPathable&&!e||t.equals(this.player.position))}changeFloor(t,e){this.enemies=[],e.generateMap(this.assets,t,this),this.currentFloor=t,this.tiles.iterate(((t,e,i)=>{i.AfterWorldLoad(this,new h.Z(t,e))}))}draw(t,e){new k(this.assets.floor_and_digits.image,new A.Z(0,13*this.regionId,41,13)).draw(t,new A.Z(0,0,41,13),0),this.assets.drawNumber(t,new h.Z(42,0),this.currentFloor),new k(this.assets.floor_and_digits.image,new A.Z(0,39,41,13)).draw(t,new A.Z(0,14,41,13),0),this.assets.drawNumber(t,new h.Z(42,14),this.gold,3),this.tiles.iterate(((e,i,s)=>{s.draw(t,this,new h.Z(e,i))})),[this.player,...this.enemies].forEach((i=>{e&&e.includes(i)||(i.draw(t),i.hp!=i.maxHp&&this.assets.hpRenderer.draw(t,i.position,i.hp,i.maxHp))})),this.renderTickNumber++}}class ct{constructor(t,e){this.renderables=t,this.finishMode=null!=e?e:"any"}tick(){let t=!0,e=!1;for(let i=0;i<this.renderables.length;i++){const s=this.renderables[i].tick();t=t&&s,e=e||s}return"any"===this.finishMode?e:t}draw(t,e,i){for(let s=0;s<this.renderables.length;s++)this.renderables[s].draw(t,e,i)}}class ut{constructor(t,e){this.typeId=t,this.isPathable=e}AfterPlayerTurn(t,e,i){return[]}AfterEnemyTurn(t,e,i){return[]}}class dt extends ut{constructor(t,e,i,s,n){super(t,s),this.bg_renderable=new Y(new k(e.tiles.image,new A.Z(352,0,l,c)),new A.Z(0,.75,1,1)),!0===n&&(this.bg_renderable=new ct([this.bg_renderable,new k(e.tiles.image,new A.Z(0,0,l,c))])),this.renderable=new k(e.tiles.image,new A.Z(i.x*l,i.y*c,l,c))}AfterWorldLoad(t,e){}draw(t,e,i){let s=T(i);this.bg_renderable.draw(t,new A.Z(s.x,s.y,l,c),0),this.renderable.draw(t,new A.Z(s.x,s.y,l,c),0)}}class pt extends dt{constructor(t){super(pt.TypeID,t,new h.Z(5,0),!0,!0)}OnEntityStep(t){}}pt.TypeID=2;class gt{constructor(t,e){this.animations=t,this.onFinish=e}init(t){}tick(t,e){for(let t=this.animations.length-1;t>=0;t--)this.animations[t].tick()&&this.animations.splice(t,1);return 0===this.animations.length?this.onFinish(t):this}draw(t,e){e.draw(t);for(const e of this.animations)e.draw(t)}}function wt(t,e,i){for(const i of e){const e=i.getAffectedTiles(t);for(const i of e)for(const e of i.positions){const s=t.entityAt(e);void 0===s||V.IsPlayer(s)&&i.ignorePlayer||!V.IsPlayer(s)&&i.ignoreEnemies||(s.hp-=i.damage)}}let s=t.enemies.filter((t=>t.hp<=0)).map((t=>t.goldValue));return s.length>0&&(t.gold+=s.reduce(((t,e)=>t+e),0)*s.length),t.enemies=t.enemies.filter((t=>t.hp>0)),t.player.hp,i(t)}function mt(t,e,i){let s=[];return e?t.tiles.iterate(((e,i,n)=>{const r=n.AfterPlayerTurn(t,e,i);void 0!==r&&r.length>0&&s.push(...r)})):t.tiles.iterate(((e,i,n)=>{const r=n.AfterEnemyTurn(t,e,i);void 0!==r&&r.length>0&&s.push(...r)})),0===s.length?i(t):wt(t,s,i)}function yt(t){const e=t.enemies.map((t=>t.position)),i=[],s=[];for(let n=0;n<t.enemies.length;n++){const r=t.enemies[n].getMove(t,t.enemies[n].lastAttacks,e);if(r.equals(t.enemies[n].position))s.push(!1);else{i.push(new C(t.enemies[n],B.r7.linear(h.Z.interpolate,t.enemies[n].position,r),r,20));const o=e.findIndex((e=>e.equals(t.enemies[n].position)));e.splice(o,1,r),s.push(!0)}}return new gt(i,(t=>function(t,e){for(let i=0;i<e.length;i++)if(e[i]){const e=t.enemies[i];t.tiles.get(e.position).OnEntityStep(e)}return mt(t,!1,(()=>new Ft))}(t,s)))}class ft extends dt{constructor(t,e){super(ft.TypeID,t,null!=e?e:new h.Z(0,0),!0,void 0!==e)}OnEntityStep(t){}}ft.TypeID=0;class Zt{constructor(t,e){this._size=t,this.data=[];let i=2*t-1;for(let s=1-t;s<=t-1;s++){let t=[];for(let n=0;n<i-Math.abs(s);n++)t.push(e);this.data.push(t)}}size(){return this._size}get(t,e){const[i,s]=this.extractInputCoords(t,e);let[n,r]=this.toArrayCoords(i,s);return this.data[r][n]}set(t,e,i){const[s,n]=this.extractInputCoords(e,i),[r,o]=this.toArrayCoords(s,n);this.data[o][r]=t}extractInputCoords(t,e){return"number"==typeof t?[t,e]:void 0!==t.x?[t.x,t.y]:t}getRowLength(t){return 2*this._size-1-Math.abs(t)}isInBounds(t,e){if(e<=-this._size||e>=this._size)return!1;let[i,s]=this.getXRange(e);return t>=i&&t<s}getXRange(t){const e=this.getMinX(t);return[e,e+this.getRowLength(t)]}getMinX(t){const e=this._size-1+t;return-Math.min(e,this._size-1)}iterate(t){for(let e=1-this._size;e<this._size;e++){let[i,s]=this.getXRange(e);for(let n=i;n<s;n++)t(n,e,this.get(n,e))}}toArrayCoords(t,e){const i=this._size-1+e;return[t- -Math.min(i,this._size-1),i]}}const xt=[{directions:[M.UpLeft,M.UpRight],tileCoords:new h.Z(0,0),tileSlice:new A.Z(0,0,1,.5)},{directions:[M.DownLeft,M.DownRight],tileCoords:new h.Z(0,0),tileSlice:new A.Z(0,.5,1,.5)},{directions:[M.Left,M.UpLeft],tileCoords:new h.Z(0,1),tileSlice:new A.Z(0,0,.5,.5)},{directions:[M.Right,M.UpRight],tileCoords:new h.Z(0,1),tileSlice:new A.Z(.5,0,.5,.5)},{directions:[M.Left,M.DownLeft],tileCoords:new h.Z(0,1),tileSlice:new A.Z(0,.5,.5,.5)},{directions:[M.Right,M.DownRight],tileCoords:new h.Z(0,1),tileSlice:new A.Z(.5,.5,.5,.5)}];function vt(t,e,i,s,n,r){const o=R.map(r),a=xt.map((r=>{const a=r.directions.reduceRight(((t,e)=>(t<<1)+(o[e]?1:0)),0),h=new A.Z((r.tileCoords.x+a+r.tileSlice.x+e)*s,(r.tileCoords.y+r.tileSlice.y+i)*n,r.tileSlice.w*s,r.tileSlice.h*n);return new Y(new k(t,h),r.tileSlice)}));return new ct(a,"all")}class bt extends ut{constructor(t){super(bt.TypeID,!1),this.assets=t,this.bg_renderable=new k(t.tiles.image,new A.Z(352,0,l,c))}AfterEnemyTurn(t,e,i){const s=t.enemies.find((t=>t.position.x==e&&t.position.y==i));return void 0===s||s.isFlying?[]:[new it(new h.Z(e,i),[{damage:999,positions:[new h.Z(e,i)]}],0,this.assets.getImpactAnimation(2))]}OnEntityStep(t){}AfterWorldLoad(t,e){this.lavaStatic=vt(this.assets.lavaLayers.image,0,0,l,c,(i=>{const s=h.Z.add(e,I.ToPoint(i));return!t.tiles.isInBounds(s.x,s.y)||t.tiles.get(e).typeId!==t.tiles.get(s).typeId})),this.lavaOverlay=vt(this.assets.lavaLayers.image,0,2,l,c,(i=>{const s=h.Z.add(e,I.ToPoint(i));return!t.tiles.isInBounds(s.x,s.y)||t.tiles.get(e).typeId!==t.tiles.get(s).typeId}))}draw(t,e,i){let s=T(i);this.bg_renderable.draw(t,new A.Z(s.x,s.y+24,l,c),0),this.lavaStatic.draw(t,new A.Z(s.x,s.y,l,c),0);let n=Math.round(1.5*Math.sin(e.renderTickNumber/15+i.x/2));this.lavaOverlay.draw(t,new A.Z(s.x,s.y+n,l,c),0)}}bt.TypeID=1;const kt=[new h.Z(6,2),new h.Z(7,2),new h.Z(9,2),new h.Z(7,3),new h.Z(6,3),new h.Z(8,2)];class Mt{generateMap(t,e,i){i.tiles=new Zt(7,new ft(t));const s=P(2);for(var n=0;n<s.length;n++)i.tiles.set(new bt(t),s[n]);const r=P(3);for(n=0;n<r.length;n+=3)i.tiles.set(new bt(t),r[n]);const o=P(1).map((t=>h.Z.add(t,w)));for(let e=0;e<o.length;e++)i.tiles.set(new ft(t,kt[e]),o[e]);i.tiles.set(new pt(t),2,-4)}}function At(t){if(null===t.parent)return[t.position];const e=At(t.parent);return e.push(t.position),e}function Rt(t,e,i,s){const n=function(t,e,i){const s=[],n=[{position:t,parent:null,cost:0}];for(;n.length>0;){const t=n.reduce(((t,e,i)=>e.cost<n[t].cost?i:t),0),r=n.splice(t,1)[0];if(s.push(r),e(r.position))return At(r);for(const t of i(r.position)){const e={position:t.to,parent:r,cost:r.cost+t.cost};if(s.find((t=>t.position.equals(e.position))))continue;const i=n.findIndex((t=>t.position.equals(e.position)));-1===i?n.push(e):n[i].cost>e.cost&&(n[i]=e)}}return null}(w,i,(function(e){const i=[];for(const n of R){const r=h.Z.add(e,I.ToPoint(n));t.tiles.isInBounds(r.x,r.y)&&i.push({to:r,cost:t.tiles.get(r).isPathable?1-Math.random()*(null!=s?s:0):99})}return i}));for(const i of n)t.tiles.get(i).isPathable||t.tiles.set(new ft(e),i)}const It={1:new h.Z(0,6),3:new h.Z(0,7),5:new h.Z(0,8)};class St extends dt{constructor(t,e){super(St.TypeID,t,It[e],!0,!1),this.state="wait",this.assets=t,this.damage=e,this.state="wait"}OnEntityStep(t){if("wait"===this.state){const t=It[this.damage];super.renderable=new k(this.assets.tiles.image,new A.Z((t.x+1)*l,t.y*c,l,c))}}AfterEnemyTurn(t,e,i){if("wait"===this.state)void 0!==t.entityAt(new h.Z(e,i))&&(this.state="prep");else if("prep"===this.state){this.state="fire";const s=It[this.damage];if(super.renderable=new k(this.assets.tiles.image,new A.Z((s.x+2)*l,s.y*c,l,c)),void 0!==t.entityAt(new h.Z(e,i)))return[new it(new h.Z(e,i),[{damage:this.damage,positions:[new h.Z(e,i)]}],0,this.assets.getImpactAnimation(1))]}return[]}}St.TypeID=5;class Lt{generateMap(t,e,i){i.tiles=new Zt(7,new ft(t)),i.enemies=[];let s=Math.floor(5*Math.random())*(Math.random()>=.5?1:-1),n=i.tiles.getMinX(s);this.genLava(t,i,new h.Z(n,s),Math.floor(20*Math.random())+8);let r=Math.floor(5*Math.random())*(Math.random()>=.5?1:-1),o=i.tiles.getXRange(r)[1]-1;this.genLava(t,i,new h.Z(o,r),Math.floor(20*Math.random())+8);const a=-6+Math.floor(3*Math.random()),[l,c]=i.tiles.getXRange(a),u=Math.floor(Math.random()*(c-l))+l;i.tiles.set(new pt(t),u,a),function(t,e,i){Rt(t,e,(e=>t.tiles.get(e).typeId===pt.TypeID),1)}(i,t);let d=[];for(let t=-6;t<=1;t++){const[e,s]=i.tiles.getXRange(t);for(let n=e;n<s;n++)i.tiles.get(n,t).typeId===ft.TypeID&&d.push(new h.Z(n,t))}for(let t=0;t<Math.min(12,e);t++){let t=Math.floor(Math.random()*d.length);const[e]=d.splice(t,1),s=new X(e);i.enemies.push(s)}for(let t=0;t<Math.min(6,(e-3)/3);t++){let t=Math.floor(Math.random()*d.length);const[e]=d.splice(t,1),s=new W(e);i.enemies.push(s)}for(let t=0;t<Math.min(3,(e-4)/4);t++){let t=Math.floor(Math.random()*d.length);const[e]=d.splice(t,1),s=Math.random()<.2?new st(e):new G(e);i.enemies.push(s)}for(const e of i.enemies)e.isFlying||Rt(i,t,(t=>t.equals(e.position)),.3);let p=[];i.tiles.iterate(((t,e,i)=>{i.typeId===ft.TypeID&&p.push(new h.Z(t,e))}));for(let s=0;s<3+Math.min(3,(e-4)/4);s++){let e=p.splice(Math.floor(Math.random()*p.length),1)[0];i.tiles.set(new St(t,[1,3,5][Math.floor(3*Math.random())]),e.x,e.y)}}genLava(t,e,i,s){if(e.tiles.set(new bt(t),i),s<=1)return;const n=R.filter((t=>{const s=h.Z.add(i,I.ToPoint(t));return!(!e.tiles.isInBounds(s.x,s.y)||e.tiles.get(s).typeId!==ft.TypeID||s.equals(w))}));if(0===n.length)return;const r=n[Math.floor(Math.random()*n.length)];this.genLava(t,e,h.Z.add(i,I.ToPoint(r)),s-1)}}const Tt=[{range:[0,1],gen:new Mt},{range:[1,12],gen:new Lt},{range:[12,13],gen:new class{generateMap(t,e,i){i.tiles=new Zt(7,new ft(t)),i.tiles.set(new pt(t),0,0);const s=P(2);for(let e=0;e<s.length;e++)i.tiles.set(new ft(t,new h.Z(12,0)),s[e]);i.tiles.set(new bt(t),new h.Z(5,-1)),i.tiles.set(new bt(t),new h.Z(5,0)),i.tiles.set(new bt(t),new h.Z(4,1)),i.tiles.set(new bt(t),new h.Z(-4,-1)),i.tiles.set(new bt(t),new h.Z(-5,0)),i.tiles.set(new bt(t),new h.Z(-5,1)),i.enemies.push(new tt(new h.Z(0,0))),i.enemies.push(new st(new h.Z(0,-2))),i.enemies.push(new st(new h.Z(2,-2))),i.enemies.push(new st(new h.Z(2,0))),i.enemies.push(new st(new h.Z(-2,0)))}}},{range:[13,-1],gen:new Lt}];class Dt{constructor(){this.time=0}init(t){}tick(t,e){return this.time++,this.time>=30?new Pt:this}draw(t,e){e.draw(t),t.fillStyle="#000000",t.globalAlpha=this.time/30,t.fillRect(0,0,p,p),t.globalAlpha=1,e.player.draw(t)}}class Pt{constructor(){this.time=0}init(t){const e=t.currentFloor+1,i=Tt.filter((t=>e>=t.range[0]&&(-1===t.range[1]||e<t.range[1])))[0].gen;this.playerStartPoint=t.player.position,t.changeFloor(e,i)}tick(t,e){return this.time++,this.time>=30?(t.player.position=w.clone(),new Et):this}draw(t,e){const i=this.time/30,s=h.Z.interpolate(this.playerStartPoint,w,i);e.player.position=s,e.player.draw(t)}}function qt(t,e,i,s){const n=t=>(s.equals(e)||t.tiles.get(s).OnEntityStep(t.player),t.tiles.get(t.player.position).typeId===pt.TypeID?new Dt:0===t.enemies.length?mt(t,!0,(t=>mt(t,!1,(()=>new Ft)))):mt(t,!0,(t=>function(t){const e=[];for(let i=0;i<t.enemies.length;i++)t.enemies[i].lastAttacks=t.enemies[i].getAttacks(t),e.push(t.enemies[i].lastAttacks);if(e.some((t=>t.length>0))){const i=e.map((e=>new _(e.map((e=>new Q(e.toAnimations(t)))))));return new gt(i,(()=>wt(t,e.reduce(((t,e)=>t.concat(e)),[]),(t=>yt(t)))))}return yt(t)}(t)))),r=s=>{const r=[...t.player.primary.getAfterMoveAttacks(t,t.player,e,i),...t.player.secondary.getAfterMoveAttacks(t,t.player,e,i)];if(0===r.length)return n(s);const o=new _(r.map((t=>new Q(t.toAnimations()))));return new gt([o],(t=>wt(t,r,n)))},o=t=>t.isValidMove(s,!1)?new gt([new C(t.player,B.r7.linear(h.Z.interpolate,e,s),s,0===t.enemies.length?2:10)],r):r(t);if(0===t.enemies.length)return o(t);if(t.enemies.length>0){const s=[...t.player.primary.getBeforeMoveAttacks(t,t.player,e,i),...t.player.secondary.getBeforeMoveAttacks(t,t.player,e,i)];if(0===s.length)return o(t);const n=new _(s.map((t=>new Q(t.toAnimations()))));return new gt([n],(t=>wt(t,s,o)))}}const Ut=[{key:"a",dir:M.Left},{key:"4",dir:M.Left},{key:"q",dir:M.UpLeft},{key:"7",dir:M.UpLeft},{key:"w",dir:M.UpRight},{key:"9",dir:M.UpRight},{key:"d",dir:M.Right},{key:"6",dir:M.Right},{key:"x",dir:M.DownRight},{key:"3",dir:M.DownRight},{key:"z",dir:M.DownLeft},{key:"1",dir:M.DownLeft}];class Ft{init(t){}tick(t,e){const i=this.tryGetDirection(e);if(void 0!==i){const e=h.Z.add(t.player.position,I.ToPoint(i)),s=[...t.player.primary.enableAdditionalMoves(t,t.player),...t.player.secondary.enableAdditionalMoves(t,t.player)];if(!t.isValidMove(e,!1)){const i=s.find((t=>t.dest.equals(e)));return void 0!==i?qt(t,t.player.position,e,i.forceMove):this}return qt(t,t.player.position,e,e)}return this}tryGetDirection(t){for(let e=0;e<Ut.length;e++)if(t.isKeyPressed(Ut[e].key))return Ut[e].dir}draw(t,e){e.draw(t)}}class Et{constructor(){this.animationTime=0}init(t){}tick(t,e){return this.animationTime++,this.animationTime>=60?new Ft:this}draw(t,e){e.draw(t),t.fillStyle="#000000",this.animationTime<=60&&(t.globalAlpha=1-this.animationTime/60,t.fillRect(0,0,p,p),t.globalAlpha=1),e.player.draw(t)}}class Bt{constructor(){this.animationTime=0}init(t){}tick(t,e){return this.animationTime++,this.animationTime>=120?new Et:this}draw(t,e){e.player.draw(t),t.fillStyle="#000000",this.animationTime<=120&&(t.globalAlpha=1-this.animationTime/120,t.fillRect(0,0,p,p),t.globalAlpha=1)}}function Ct(){let t,e,i;const s=new n.Z,h=new nt(s);let l,c=new Bt;function u(){i.TryRescale(),(0,r.Ci)(t);const s=c.tick(l,e);t.clearRect(0,0,p,p),t.fillStyle="#000000",t.fillRect(0,0,p,p),c.draw(t,l),s!==c&&(c=s,s.init(l)),e.update(),requestAnimationFrame((()=>u()))}return e=new a.Z(document.body),s.onAllFinished((function(){h.onLoadFinished();const e=document.getElementById("mainCanvas");t=e.getContext("2d"),i=new o.Z(e,t,p,p,!0,(()=>{})),l=new lt(h,7,0,new Mt),(0,r.Ci)(t),u()})),()=>i.Detatch()}function Kt(){return s.useEffect((()=>Ct())),s.createElement("div",{className:"rpgt rpgt_body full_body center",style:{background:"black"}},s.createElement("canvas",{id:"mainCanvas"}))}}}]);
//# sourceMappingURL=hoplite.bundle.js.map